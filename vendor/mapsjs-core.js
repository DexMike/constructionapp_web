
/**
 * The code below uses open source software. Please visit the URL below for an overview of the licenses:
 * http://js.api.here.com/v3/3.1.2.0/HERE_NOTICE
 */

(function(){var n,aa=[];function ba(a){return function(){return aa[a].apply(this,arguments)}}function ca(a,b){return aa[a]=b}var da="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ea="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;
function fa(a,b){if(b){var c=ea;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&da(c,a,{configurable:!0,writable:!0,value:b})}}fa("Array.prototype.find",function(a){return a?a:function(a,c){a:{var b=this;b instanceof String&&(b=String(b));for(var e=b.length,f=0;f<e;f++){var g=b[f];if(a.call(c,g,f,b)){a=g;break a}}a=void 0}return a}});function ha(){ha=function(){};ea.Symbol||(ea.Symbol=ja)}
var ja=function(){var a=0;return function(b){return"jscomp_symbol_"+(b||"")+a++}}();function ka(){ha();var a=ea.Symbol.iterator;a||(a=ea.Symbol.iterator=ea.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&da(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return la(this)}});ka=function(){}}function la(a){var b=0;return ma(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}function ma(a){ka();a={next:a};a[ea.Symbol.iterator]=function(){return this};return a}
function oa(a,b){ka();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}fa("Array.prototype.keys",function(a){return a?a:function(){return oa(this,function(a){return a})}});
fa("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}});fa("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}});fa("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}});var pa=this;function qa(a){return void 0!==a}
function ra(a){return"string"==typeof a}function sa(a,b,c){a=a.split(".");c=c||pa;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&qa(b)?c[d]=b:c[d]&&c[d]!==Object.prototype[d]?c=c[d]:c=c[d]={}}function ta(){}
function ua(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function va(a){var b=ua(a);return"array"==b||"object"==b&&"number"==typeof a.length}function wa(a){return"function"==ua(a)}function xa(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var ya="closure_uid_"+(1E9*Math.random()>>>0),za=0;function Aa(a,b,c){return a.call.apply(a.bind,arguments)}
function Ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function Da(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Da=Aa:Da=Ba;return Da.apply(null,arguments)}
function Ea(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}function r(a,b){sa(a,b,void 0)}function u(a,b){function c(){}c.prototype=b.prototype;a.l=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Qo=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};function Fa(a){if(Error.captureStackTrace)Error.captureStackTrace(this,Fa);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}u(Fa,Error);Fa.prototype.name="CustomError";function Ga(a,b){this.c=a;this.f=b;this.b=0;this.a=null}Ga.prototype.get=function(){if(0<this.b){this.b--;var a=this.a;this.a=a.next;a.next=null}else a=this.c();return a};Ga.prototype.put=function(a){this.f(a);100>this.b&&(this.b++,a.next=this.a,this.a=a)};function Ha(){this.b=this.a=null}var Ka=new Ga(function(){return new Ia},function(a){a.reset()});Ha.prototype.add=function(a,b){var c=Ka.get();c.set(a,b);this.b?this.b.next=c:this.a=c;this.b=c};Ha.prototype.remove=function(){var a=null;this.a&&(a=this.a,this.a=this.a.next,this.a||(this.b=null),a.next=null);return a};function Ia(){this.next=this.b=this.a=null}Ia.prototype.set=function(a,b){this.a=a;this.b=b;this.next=null};Ia.prototype.reset=function(){this.next=this.b=this.a=null};function La(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1}function Ma(a){for(var b in a)return!1;return!0}function Na(a){var b={},c;for(c in a)b[c]=a[c];return b}function Oa(a){var b=ua(a);if("object"==b||"array"==b){if(wa(a.clone))return a.clone();b="array"==b?[]:{};for(var c in a)b[c]=Oa(a[c]);return b}return a}var Pa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function Qa(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Pa.length;f++)c=Pa[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var Ra=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function Sa(a,b){return-1!=a.indexOf(b)}function Ta(a,b){return a<b?-1:a>b?1:0};var Ua;a:{var Va=pa.navigator;if(Va){var Wa=Va.userAgent;if(Wa){Ua=Wa;break a}}Ua=""}function Xa(a){return Sa(Ua,a)};var Ya=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(ra(a))return ra(b)&&1==b.length?a.indexOf(b,0):-1;for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function Za(a){pa.setTimeout(function(){throw a;},0)}var $a;
function ab(){var a=pa.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!Xa("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow;a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host;a=Da(function(a){if(("*"==d||a.origin==d)&&a.data==
c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&!Xa("Trident")&&!Xa("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(qa(c.next)){c=c.next;var a=c.nj;c.nj=null;a()}};return function(a){d.next={nj:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(a){var b=document.createElement("SCRIPT");
b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){pa.setTimeout(a,0)}};function bb(a,b){cb||db();eb||(cb(),eb=!0);fb.add(a,b)}var cb;function db(){if(-1!=String(pa.Promise).indexOf("[native code]")){var a=pa.Promise.resolve(void 0);cb=function(){a.then(gb)}}else cb=function(){var a=gb;!wa(pa.setImmediate)||pa.Window&&pa.Window.prototype&&!Xa("Edge")&&pa.Window.prototype.setImmediate==pa.setImmediate?($a||($a=ab()),$a(a)):pa.setImmediate(a)}}var eb=!1,fb=new Ha;function gb(){for(var a;a=fb.remove();){try{a.a.call(a.b)}catch(b){Za(b)}Ka.put(a)}eb=!1};function hb(a){this.B=ib;this.i=void 0;this.c=this.a=this.b=null;this.f=this.g=!1;if(a!=ta)try{var b=this;a.call(void 0,function(a){jb(b,kb,a)},function(a){jb(b,lb,a)})}catch(c){jb(this,lb,c)}}var ib=0,kb=2,lb=3;function mb(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}mb.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};var ob=new Ga(function(){return new mb},function(a){a.reset()});function pb(a,b,c){var d=ob.get();d.f=a;d.b=b;d.c=c;return d}
function qb(a){if(a instanceof hb)return a;var b=new hb(ta);jb(b,kb,a);return b}function rb(a){return new hb(function(b,c){c(a)})}function sb(){var a,b,c=new hb(function(c,e){a=c;b=e});return new tb(c,a,b)}hb.prototype.then=function(a,b,c){return ub(this,wa(a)?a:null,wa(b)?b:null,c)};hb.prototype.then=hb.prototype.then;hb.prototype.$goog_Thenable=!0;hb.prototype.cancel=function(a){this.B==ib&&bb(function(){var b=new vb(a);wb(this,b)},this)};
function wb(a,b){if(a.B==ib)if(a.b){var c=a.b;if(c.a){for(var d=0,e=null,f=null,g=c.a;g&&(g.g||(d++,g.a==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.B==ib&&1==d?wb(c,b):(f?(d=f,d.next==c.c&&(c.c=d),d.next=d.next.next):xb(c),yb(c,e,lb,b)))}a.b=null}else jb(a,lb,b)}function zb(a,b){a.a||a.B!=kb&&a.B!=lb||Ab(a);a.c?a.c.next=b:a.a=b;a.c=b}
function ub(a,b,c,d){var e=pb(null,null,null);e.a=new hb(function(a,g){e.f=b?function(c){try{var e=b.call(d,c);a(e)}catch(l){g(l)}}:a;e.b=c?function(b){try{var e=c.call(d,b);!qa(e)&&b instanceof vb?g(b):a(e)}catch(l){g(l)}}:g});e.a.b=a;zb(a,e);return e.a}hb.prototype.m=function(a){this.B=ib;jb(this,kb,a)};hb.prototype.u=function(a){this.B=ib;jb(this,lb,a)};
function jb(a,b,c){if(a.B==ib){a===c&&(b=lb,c=new TypeError("Promise cannot resolve to itself"));a.B=1;a:{var d=c,e=a.m,f=a.u;if(d instanceof hb){zb(d,pb(e||ta,f||null,a));var g=!0}else{if(d)try{var h=!!d.$goog_Thenable}catch(l){h=!1}else h=!1;if(h)d.then(e,f,a),g=!0;else{if(xa(d))try{var k=d.then;if(wa(k)){Bb(d,k,e,f,a);g=!0;break a}}catch(l){f.call(a,l);g=!0;break a}g=!1}}}g||(a.i=c,a.B=b,a.b=null,Ab(a),b!=lb||c instanceof vb||Db(a,c))}}
function Bb(a,b,c,d,e){function f(a){h||(h=!0,d.call(e,a))}function g(a){h||(h=!0,c.call(e,a))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Ab(a){a.g||(a.g=!0,bb(a.j,a))}function xb(a){var b=null;a.a&&(b=a.a,a.a=b.next,b.next=null);a.a||(a.c=null);return b}hb.prototype.j=function(){for(var a;a=xb(this);)yb(this,a,this.B,this.i);this.g=!1};
function yb(a,b,c,d){if(c==lb&&b.b&&!b.g)for(;a&&a.f;a=a.b)a.f=!1;if(b.a)b.a.b=null,Eb(b,c,d);else try{b.g?b.f.call(b.c):Eb(b,c,d)}catch(e){Fb.call(null,e)}ob.put(b)}function Eb(a,b,c){b==kb?a.f.call(a.c,c):a.b&&a.b.call(a.c,c)}function Db(a,b){a.f=!0;bb(function(){a.f&&Fb.call(null,b)})}var Fb=Za;function vb(a){Fa.call(this,a)}u(vb,Fa);vb.prototype.name="cancel";function tb(a,b,c){this.mi=a;this.resolve=b;this.reject=c};var w=this;function Gb(){return Object.create(x,void 0)}var z=Da,Hb=String,Ib=w.Object.freeze||function(a){return a};function Jb(a){for(var b=Object.keys(a),c=b.length,d;c--;)d=a[b[c]],xa(d)&&Jb(d);return Ib(a)}var A=self.eval("undefined"),x=self.eval("null");function Kb(a,b){return Hb(a).split(b!==A?b:" ")}var Lb="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function B(a,b,c,d,e){if(!(b=a instanceof b)&&c)throw new C(c,d,Mb(e)?e:a);return b}function Nb(a,b){if(!0===(B(a,b)&&a.constructor===b))throw new TypeError("Illegal constructor "+Ob(b));}r("H.lang.isObject",xa);r("H.lang.isEmptyObject",Ma);function Pb(a,b,c,d,e){if(!(b=Qb(a)===b)&&c)throw new C(c,d,Mb(e)?e:a);return b}function Rb(a,b,c,d){return Pb(a,"Array",b,c,d)}r("H.lang.isArray",Rb);function Mb(a){return a!==A}r("H.lang.isString",ra);var Sb=parseInt,Tb=parseFloat,D=isNaN;
function Vb(a){return a===+a}r("H.lang.isNumber",Vb);function Wb(a){return!D(+a)}function Qb(a){var b=Object[Lb[0]][Lb[6]].call(a).match(/^\[object (\w+)\]$/);return b?b[1]:typeof a}var Xb=[];function Yb(a){0>Xb.indexOf(a)&&Xb.push(a)}Yb(Xb);
function Ob(a,b,c,d){var e="",f=2>arguments.length,g;f&&(b={H:w.H},c="",d=Xb.slice());Zb(b,!0,function(b,f){try{if(g=b[f],f=$b(b,g),!(xa(g)&&g.window===g&&g.self===g||xa(g)&&0<g.nodeType&&wa(g.cloneNode))&&xa(g)){if(g===a)return e=c+"."+f,!0;if(0>d.indexOf(g)&&(d.push(g),e=Ob(a,g,c+"."+f,d)))return!0}}catch(l){}});f&&(e=e?e.substr(1).replace("."+Lb[0]+".","#"):"~"+(wa(a)?ac(a)+"()":Qb(a)));return e}
function $b(a,b){var c=[];Zb(a,!1,function(a,e){a[e]===b&&c.push(e)});return c.sort(bc)[0]}function bc(a,b){return b.length-a.length}var cc=Object[Lb[0]][Lb[2]];function Zb(a,b,c){var d;if(a){for(e in a)if((!b||cc.call(a,e))&&c(a,e,!0))return;for(d=Lb.length;d--;){var e=Lb[d];if((!b||cc.call(a,e))&&c(a,e,!1))break}}}function ac(a){return(a=/^\s*function ([^\( ]+)/.exec(a))?a[1]:"anonymous"}function dc(a,b,c){c[b]="#"+b}var ec=!!w.__karma__;function fc(){throw Error("unimplemented method");};function gc(a,b){b=b||{};"status"in b&&(this.status=+b.status);"statusText"in b&&(this.statusText=b.statusText);this.ok=200<=this.status&&300>this.status;this.bodyUsed=!1;a?"string"===typeof a?this.c=a:ArrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(a)||a.buffer)?this.a=a.buffer||a:Blob.prototype.isPrototypeOf(a)&&(this.b=a):this.c=""}r("H.net.Response",gc);gc.prototype.type="default";gc.prototype.type=gc.prototype.type;gc.prototype.status=200;gc.prototype.status=gc.prototype.status;
gc.prototype.statusText="OK";gc.prototype.statusText=gc.prototype.statusText;gc.a=function(a){if(a.bodyUsed)return rb(new TypeError("Already read"));a.bodyUsed=!0};gc.error=function(){gc.b||(gc.b=new gc(null,{status:0,statusText:""}),gc.b.type="error");return gc.b};gc.error=gc.error;gc.prototype.text=function(){var a=gc.a(this);a||(this.c?a=qb(this.c):this.a?a=gc.c(this.a):this.b?a=gc.g(this.b):a=rb("Unsupported response body"));return a};gc.prototype.json=function(){return this.text().then(w.JSON.parse)};
gc.prototype.blob=function(){var a,b=gc.a(this);b||(this.b?a=this.b:this.a&&(a=new Blob([this.a],{type:"application/octet-stream"})));return b||qb(a)};gc.prototype.arrayBuffer=function(){return this.a?gc.a(this)||qb(this.a.slice(0)):this.blob().then(gc.f)};gc.f=function(a){var b=new FileReader;b.readAsArrayBuffer(a);return new hb(function(a,d){b.onload=function(){a(b.result)};b.onerror=function(){d(b.error)}})};
gc.g=function(a){var b=new FileReader;b.readAsText(a);return new hb(function(a,d){b.onload=function(){a(b.result)};b.onerror=function(){d(b.error)}})};gc.c=function(a){a=new Uint8Array(a);var b=a.length,c=Array(b),d;for(d=0;d<b;d++)c[d]=String.fromCharCode(a[d]);return qb(c.join(""))};!ec&&w.Response&&w.Response.error&&(gc=w.Response,Yb(gc.prototype));function hc(a,b,c){function d(){var a=z(l.a,l),b=+k.timeout||0;ic?(jc(l,"timeout",a),e.timeout=b):b&&(l.c=setTimeout(function(){e.abort();l.a({type:"timeout"})},b));jc(l,"error",a);jc(l,"load",a);e.send(k.data)}var e,f,g,h=c&&c.headers||{},k={},l=this;if(!wa(b))throw new C(hc,1,"function required");Qa(h,kc.headers,h);Qa(k,kc,c||{});k.headers=h;this.b=b;this.ga=e=new XMLHttpRequest;b=k.method;try{e.open(b,a,!0);for(f in h)h.hasOwnProperty(f)&&(g=h[f])&&e.setRequestHeader(f,g);e.withCredentials=!!k.withCredentials;
d()}catch(m){this.a({type:"cors"})}}r("H.net.Xhr",hc);var kc={method:"GET",headers:{},data:null},lc="withCredentials"in new XMLHttpRequest,ic="timeout"in new XMLHttpRequest;function jc(a,b,c){lc?a.ga.addEventListener(b,c):a.ga["on"+b]=c}function mc(a,b,c){lc?a.ga.removeEventListener(b,c):a.ga["on"+b]=null}hc.prototype.abort=function(){this.ga&&(this.ga.abort(),this.ga&&this.a({type:"abort"}))};hc.prototype.abort=hc.prototype.abort;
hc.prototype.a=function(a){var b=a.type;a=this.ga;var c,d;this.c&&clearTimeout(this.c);"load"===b?a instanceof XMLHttpRequest&&200!==a.status&&(c="network"):c=4===a.readyState&&0===a.status&&"error"==b?"cors":"error"!=b?b:"network";b=this.a;mc(this,"timeout",b);mc(this,"error",b);mc(this,"load",b);0===a.status||c&&"network"!==c?d=gc.error():d=new gc(a.responseText,a);c=this.b;delete this.a;delete this.b;delete this.ga;c(d)};function nc(a,b){var c=[];a&&c.push(Ob(a));1<arguments.length&&c.push(b);this.message=c.join(" ");this.stack=Error().stack}u(nc,Error);r("H.lang.IllegalOperationError",nc);nc.prototype=Error();nc.prototype.name="IllegalOperationError";var oc;function C(a,b,c){var d=arguments.length;b=1<d?+b:b;d=2<d?Hb(c):"";if(b!==A){var e=(e=/^.*?\(([^\)]+)/.exec((""+a).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?Kb(e[1].replace(/\s+/g,""),","):[];e.forEach(dc);e=e[b]||"#"+b}this.message=(a?Ob(a):"")+(e||d?" (":"")+(e?"Argument "+e:"")+(d?(e?" ":"")+d:"")+(e||d?")":"");this.stack=Error().stack}r("H.lang.InvalidArgumentError",C);C.prototype=Error();C.prototype.name="InvalidArgumentError";function pc(){if(!ra("STATIC_DB"))throw new C(this.constructor,0);this.g=w.indexedDB||w.webkitIndexedDB||w.mozIndexedDB||w.msIndexedDB;if(!this.g)throw new nc(this.constructor,"This browser does not support IndexedDB");this.a=[];this.c=[];this.gi=z(this.gi,this)}var qc,rc;n=pc.prototype;n.put=function(a,b,c,d){if(!ra(a)&&!Vb(a))throw new C(this.put,0);if(!sc(b))throw new C(this.put,1);tc(this,function(e){uc(e.put(b,a),c,d)},d)};
n.get=function(a,b,c){var d;if(!ra(a)&&!Vb(a))throw new C(this.get,0);if(!wa(b))throw new C(this.get,1);tc(this,function(e){d=e.get(a);uc(d,b,c)},c);return{cancel:function(){d&&(d.onsuccess=vc)}}};n.remove=function(a,b,c){if(!ra(a)&&!Vb(a))throw new C(this.remove,0);tc(this,function(d){uc(d["delete"](a),b,c)},c)};n.clear=function(a,b){tc(this,function(c){uc(c.clear(),a,b)},b)};n.gi=function(){var a=this.b.result;a.objectStoreNames.contains("data")||a.createObjectStore("data")};
function wc(a,b,c){if(a.b)a.a?(a.a.push(b),c&&a.c.push(c)):a.f?c&&c(a.f):b(a.b.result);else{a.b=a.g.open(xc+"STATIC_DB",1);a.b.onupgradeneeded=a.gi;var d=a.b.onerror=function(){clearTimeout(a.i);a.f=this.error;a.c.forEach(function(b){b(a.f)});a.a=a.c=null};a.i=setTimeout(function(){d.call({error:Error("DbOpenTimeoutError")})},500);a.b.onsuccess=function(){clearTimeout(a.i);a.a?(a.a.forEach(function(a){a(this.result)},this),a.a=a.c=null):(a.b=a.f=null,a.a=[],a.c=[])};a.a.push(b);c&&a.c.push(c)}}
function tc(a,b,c){wc(a,function(a){a=a.transaction(["data"],"readwrite");b(a.objectStore("data"))},c)}function uc(a,b,c){b&&(a.onsuccess=function(){b(this.result)});c&&(a.onerror=function(){c(this.error)})}function sc(a){var b=Object.prototype.toString.call(a);return"[object Blob]"===b||"[object ArrayBuffer]"===b||ra(a)||xa(a)}function yc(){qc||(qc=new pc);return qc}r("H.util.IndexedDBStorage.getInstance",yc);var xc="H_";
function zc(){if(!Mb(rc))if("file:"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&128<=window.location.href.length)rc=!1;else{var a=w.indexedDB||w.webkitIndexedDB||w.mozIndexedDB||w.msIndexedDB;var b=xc+"TEST_DB";try{var c=a&&a.open(b,1)}catch(d){}rc=!!c&&null===c.onupgradeneeded;c&&a.deleteDatabase&&a.deleteDatabase(b)}return rc}r("H.util.IndexedDBStorage.isSupported",zc);function Ac(){0!=Bc&&(Cc[this[ya]||(this[ya]=++za)]=this);this.Dd=this.Dd;this.Wa=this.Wa}var Bc=0,Cc={};Ac.prototype.Dd=!1;Ac.prototype.D=function(){if(!this.Dd&&(this.Dd=!0,this.s(),0!=Bc)){var a=this[ya]||(this[ya]=++za);if(0!=Bc&&this.Wa&&0<this.Wa.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Cc[a]}};
Ac.prototype.Jb=function(a,b){this.Dd?qa(b)?a.call(b):a():(this.Wa||(this.Wa=[]),this.Wa.push(qa(b)?Da(a,b):a))};Ac.prototype.s=function(){if(this.Wa)for(;this.Wa.length;)this.Wa.shift()()};function Dc(a){a&&"function"==typeof a.D&&a.D()};function Ec(a,b){this.type=a;this.currentTarget=this.target=b;this.f=this.a=!1;this.Vk=!0}Ec.prototype.stopPropagation=function(){this.a=!0};Ec.prototype.preventDefault=function(){this.f=!0;this.Vk=!1};r("H.util.Event",Ec);Ec.prototype.stopPropagation=Ec.prototype.stopPropagation;Ec.prototype.stopPropagation=Ec.prototype.stopPropagation;Ec.prototype.CAPTURING_PHASE=1;Ec.prototype.CAPTURING_PHASE=Ec.prototype.CAPTURING_PHASE;Ec.prototype.AT_TARGET=2;Ec.prototype.AT_TARGET=Ec.prototype.AT_TARGET;Ec.prototype.BUBBLING_PHASE=3;Ec.prototype.BUBBLING_PHASE=Ec.prototype.BUBBLING_PHASE;Ec.prototype.eventPhase=0;Ec.prototype.eventPhase=Ec.prototype.eventPhase;function Fc(a,b,c){Fc.l.constructor.call(this,a,c);this.data=b}u(Fc,Ec);r("H.util.DataEvent",Fc);function Gc(a,b,c){Gc.l.constructor.call(this,a,c);this.message=b}u(Gc,Ec);r("H.util.ErrorEvent",Gc);var Hc=Math,Ic=Hc.min,Jc=Hc.max,Kc=Hc.round,Lc=Hc.floor,Mc=Hc.ceil,Nc=Hc.abs,Oc=Hc.log,Pc=Hc.sqrt,Rc=Hc.pow,Sc=Hc.exp,Tc=Hc.sin,Uc=Hc.asin,Vc=Hc.cos,Wc=Hc.tan,Xc=Hc.atan,Yc=Hc.atan2,Zc=Hc.LN2,$c=Hc.PI,ad=$c/2,bd=$c/4,cd=2*$c,dd=3*$c,ed=$c/180,fd=180/$c,gd=1/0,hd=Rc(-2,53),id=id||function(a){return Oc(a)/Zc};function jd(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}function kd(a,b,c){b-=c=c||0;a-=c;return a-Lc(a/b)*b+c}r("H.math.normalize",kd);function ld(a,b,c){return a>c?c:a<b?b:a}
r("H.math.clamp",ld);function md(a,b,c,d){d||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}function nd(a,b,c,d,e,f){return Pc(Rc((a-e)*(d-f)-(b-f)*(c-e),2)/(Rc(c-e,2)+Rc(d-f,2)))}var od={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};r("H.math.CoverType",od);
function pd(a,b,c,d,e){for(var f=c.length,g=f,h,k,l,m=c[0],p=0,q=0,t=0,v=d/2||0,y=e?1:3;1!=p&&g>y;){h=c[--g];d=c[--g];l=c[g?g-1:(f+(g-1))%f];k=c[g?g-2:(f+(g-2))%f];if(d>=a-v&&d<=a+v&&h>=b-v&&h<=b+v||k>=a-v&&k<=a+v&&l>=b-v&&l<=b+v)p=1;else if(!p&&d===a)k===a&&(h<b&&l>b||h>b&&l<b)||(m<=a&&k>a||m>=a&&k<a)&&(h>=b?++q:++t),p=md(b,h,l,v)&&nd(a,b,d,h,k,l)<=v?2:0;else if(!p&&md(a,d,k,v)){if(d<a&&k>a||d>a&&k<a)m=h+(a-d)/(k-d)*(l-h),q+=m>b,t+=m<b;p=md(b,h,l,v)&&nd(a,b,d,h,k,l)<=v?2:0}m=d}!p&&e&&0!==t&&0!==
q%2&&(p=3);return p}r("H.math.isCoveredBy",pd);function qd(a,b,c){this.type=a;this.data=b;this.f=sb();this.resolve=z(this.resolve,this);this.reject=z(this.reject,this);this.c=rd;c!==A&&(this.c=c);this.rh().add(this)}var rd=1,sd={Lo:0,Oo:rd,Ko:2};n=qd.prototype;n.then=function(a,b,c){return this.f.mi.then(a,b,c)};n.resolve=function(a){this.be=3;this.f.resolve(a)};n.reject=function(a){this.be=5;this.f.reject(a)};n.be=0;n.cancel=function(){this.f.mi.cancel();3>this.be&&(this.xe(),this.rh().remove(this),this.be=4)};function td(a){var b;this.vd={};for(b in sd)this.vd[sd[b]]=[];this.pg=a;this.pg.addEventListener("allocatable",z(this.Dj,this))}r("H.util.JobManager",td);var ud=Object.keys(sd).map(function(a){return sd[a]}).sort().reverse();
Qa(td.prototype,{add:function(a){B(a,qd,this.add,0);this.vd[a.c].push(a);this.Dj()},contains:function(a){return-1<this.vd[a.c].indexOf(a)},remove:function(a){var b=a.c;a=this.vd[b].indexOf(a);return-1<a?(this.vd[b].splice(a,1),!0):!1},Dj:function(){ud.forEach(function(a){this.vd[a]=this.vd[a].filter(function(a){var b;if((b=this.pg.Pg(a))!==x){var d=z(this.pg.bh,this.pg,b,a);a.then(d,d);a.be=a.Cj(b)?1:5}else return!0},this)},this)}});function vd(a,b,c){var d=[];1<arguments.length&&d.push(b);2<arguments.length&&d.push("out of ["+c[0]+"..."+c[1]+"]");this.message=(a?Ob(a):"")+(d.length?" ("+d.join(" ")+")":"");this.stack=Error().stack}r("H.lang.OutOfRangeError",vd);vd.prototype=Error();vd.prototype.name="OutOfRangeError";var wd="closure_listenable_"+(1E6*Math.random()|0);function xd(a){return!(!a||!a[wd])}var yd=0;function zd(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.Pf=e;this.key=++yd;this.fe=this.zf=!1}function Bd(a){a.fe=!0;a.listener=null;a.proxy=null;a.src=null;a.Pf=null};function Cd(a){this.src=a;this.a={};this.b=0}Cd.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var g=Dd(a,b,d,e);-1<g?(b=a[g],c||(b.zf=!1)):(b=new zd(b,this.src,f,!!d,e),b.zf=c,a.push(b));return b};Cd.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.a))return!1;var e=this.a[a];b=Dd(e,b,c,d);return-1<b?(Bd(e[b]),Array.prototype.splice.call(e,b,1),0==e.length&&(delete this.a[a],this.b--),!0):!1};
function Ed(a,b){var c=b.type;if(!(c in a.a))return!1;var d=a.a[c],e=Ya(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Bd(b),0==a.a[c].length&&(delete a.a[c],a.b--));return f}Cd.prototype.fa=function(a){a=a&&a.toString();var b=0,c;for(c in this.a)if(!a||c==a){for(var d=this.a[c],e=0;e<d.length;e++)++b,Bd(d[e]);delete this.a[c];this.b--}return b};
function Fd(a,b){var c=qa(b),d=c?b.toString():"",e=qa(void 0);return La(a.a,function(a){for(var b=0;b<a.length;++b)if(!(c&&a[b].type!=d||e&&void 0!=a[b].capture))return!0;return!1})}function Dd(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.fe&&f.listener==b&&f.capture==!!c&&f.Pf==d)return e}return-1};function Gd(a){Gd[" "](a);return a}Gd[" "]=ta;var Hd=Xa("Opera"),Id=Xa("Trident")||Xa("MSIE"),Jd=Xa("Edge"),Kd=Xa("Gecko")&&!(Sa(Ua.toLowerCase(),"webkit")&&!Xa("Edge"))&&!(Xa("Trident")||Xa("MSIE"))&&!Xa("Edge"),Ld=Sa(Ua.toLowerCase(),"webkit")&&!Xa("Edge");function Md(){var a=pa.document;return a?a.documentMode:void 0}var Nd;
a:{var Od="",Pd=function(){var a=Ua;if(Kd)return/rv:([^\);]+)(\)|;)/.exec(a);if(Jd)return/Edge\/([\d\.]+)/.exec(a);if(Id)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(Ld)return/WebKit\/(\S+)/.exec(a);if(Hd)return/(?:Version)[ \/]?(\S+)/.exec(a)}();Pd&&(Od=Pd?Pd[1]:"");if(Id){var Qd=Md();if(null!=Qd&&Qd>parseFloat(Od)){Nd=String(Qd);break a}}Nd=Od}var Rd={},Sd;var Td=pa.document;Sd=Td&&Id?Md()||("CSS1Compat"==Td.compatMode?parseInt(Nd,10):5):void 0;var Ud;(Ud=!Id)||(Ud=9<=Number(Sd));var Vd=Ud,Wd;
if(Wd=Id){var Xd;if(Object.prototype.hasOwnProperty.call(Rd,"9"))Xd=Rd["9"];else{for(var Yd,Zd=0,$d=Ra(String(Nd)).split("."),ae=Ra("9").split("."),be=Math.max($d.length,ae.length),ce=0;0==Zd&&ce<be;ce++){var de=$d[ce]||"",ee=ae[ce]||"";do{var fe=/(\d*)(\D*)(.*)/.exec(de)||["","","",""],ge=/(\d*)(\D*)(.*)/.exec(ee)||["","","",""];if(0==fe[0].length&&0==ge[0].length)break;Zd=Ta(0==fe[1].length?0:parseInt(fe[1],10),0==ge[1].length?0:parseInt(ge[1],10))||Ta(0==fe[2].length,0==ge[2].length)||Ta(fe[2],
ge[2]);de=fe[3];ee=ge[3]}while(0==Zd)}Yd=0<=Zd;Xd=Rd["9"]=Yd}Wd=!Xd}var he=Wd,ie=function(){if(!pa.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});pa.addEventListener("test",ta,b);pa.removeEventListener("test",ta,b);return a}();function je(a,b){Ec.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType="";this.b=null;if(a){var c=this.type=a.type,d=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(Kd){a:{try{Gd(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==
c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;null===d?(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0);this.button=a.button;this.key=a.key||"";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=
a.metaKey;this.pointerId=a.pointerId||0;this.pointerType=ra(a.pointerType)?a.pointerType:ke[a.pointerType]||"";this.b=a;a.defaultPrevented&&this.preventDefault()}}u(je,Ec);var ke={2:"touch",3:"pen",4:"mouse"};je.prototype.stopPropagation=function(){je.l.stopPropagation.call(this);this.b.stopPropagation?this.b.stopPropagation():this.b.cancelBubble=!0};
je.prototype.preventDefault=function(){je.l.preventDefault.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,he)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var le="closure_lm_"+(1E6*Math.random()|0),me={},ne=0;function oe(a,b,c,d,e){if(d&&d.once)return pe(a,b,c,d,e);if("array"==ua(b)){for(var f=0;f<b.length;f++)oe(a,b[f],c,d,e);return null}c=qe(c);return xd(a)?a.Y.add(String(b),c,!1,xa(d)?!!d.capture:!!d,e):re(a,b,c,!1,d,e)}
function re(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=xa(e)?!!e.capture:!!e,h=te(a);h||(a[le]=h=new Cd(a));c=h.add(b,c,d,g,f);if(c.proxy)return c;d=ue();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)ie||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(ve(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");ne++;return c}
function ue(){var a=we,b=Vd?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function pe(a,b,c,d,e){if("array"==ua(b)){for(var f=0;f<b.length;f++)pe(a,b[f],c,d,e);return null}c=qe(c);return xd(a)?a.Y.add(String(b),c,!0,xa(d)?!!d.capture:!!d,e):re(a,b,c,!0,d,e)}
function xe(a,b,c,d,e){if("array"==ua(b)){for(var f=0;f<b.length;f++)xe(a,b[f],c,d,e);return null}d=xa(d)?!!d.capture:!!d;c=qe(c);if(xd(a))return a.Y.remove(String(b),c,d,e);if(!a)return!1;if(a=te(a))if(b=a.a[b.toString()],a=-1,b&&(a=Dd(b,c,d,e)),c=-1<a?b[a]:null)return ye(c);return!1}
function ye(a){if("number"==typeof a||!a||a.fe)return!1;var b=a.src;if(xd(b))return Ed(b.Y,a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(ve(c),d):b.addListener&&b.removeListener&&b.removeListener(d);ne--;(c=te(b))?(Ed(c,a),0==c.b&&(c.src=null,b[le]=null)):Bd(a);return!0}function ve(a){return a in me?me[a]:me[a]="on"+a}
function ze(a,b,c,d){var e=!0;if(a=te(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.fe&&(f=Ae(f,d),e=e&&!1!==f)}return e}function Ae(a,b){var c=a.listener,d=a.Pf||a.src;a.zf&&ye(a);return c.call(d,b)}
function we(a,b){if(a.fe)return!0;if(!Vd){if(!b)a:{b=["window","event"];for(var c=pa,d=0;d<b.length;d++)if(c=c[b[d]],null==c){b=null;break a}b=c}d=b;b=new je(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.a&&0<=e;e--){b.currentTarget=d[e];var f=ze(d[e],a,!0,b);c=c&&f}for(e=0;!b.a&&e<d.length;e++)b.currentTarget=
d[e],f=ze(d[e],a,!1,b),c=c&&f}return c}return Ae(a,new je(b,this))}function te(a){a=a[le];return a instanceof Cd?a:null}var Be="__closure_events_fn_"+(1E9*Math.random()>>>0);function qe(a){if(wa(a))return a;a[Be]||(a[Be]=function(b){return a.handleEvent(b)});return a[Be]};function F(){Ac.call(this);this.Y=new Cd(this);this.vn=this;this.Zg=null}u(F,Ac);F.prototype[wd]=!0;n=F.prototype;n.hc=function(){return this.Zg};n.ba=function(a){this.Zg=a};n.addEventListener=function(a,b,c,d){oe(this,a,b,c,d)};n.removeEventListener=function(a,b,c,d){xe(this,a,b,c,d)};
n.dispatchEvent=function(a){var b,c=this.hc();if(c)for(b=[];c;c=c.hc())b.push(c);c=this.vn;var d=a.type||a;if(ra(a))a=new Ec(a,c);else if(a instanceof Ec)a.target=a.target||c;else{var e=a;a=new Ec(d,c);Qa(a,e)}e=!0;if(b)for(var f=b.length-1;!a.a&&0<=f;f--){var g=a.currentTarget=b[f];e=g.kd(d,!0,a)&&e}a.a||(g=a.currentTarget=c,e=g.kd(d,!0,a)&&e,a.a||(e=g.kd(d,!1,a)&&e));if(b)for(f=0;!a.a&&f<b.length;f++)g=a.currentTarget=b[f],e=g.kd(d,!1,a)&&e;return e};
n.s=function(){F.l.s.call(this);this.Y&&this.Y.fa(void 0);this.Zg=null};n.kd=function(a,b,c){a=this.Y.a[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.fe&&f.capture==b){var g=f.listener,h=f.Pf||f.src;f.zf&&Ed(this.Y,f);d=!1!==g.call(h,c)&&d}}return d&&0!=c.Vk};r("H.util.EventTarget",F);F.prototype.ba=F.prototype.ba;F.prototype.setParentEventTarget=F.prototype.ba;F.prototype.hc=F.prototype.hc;F.prototype.getParentEventTarget=F.prototype.hc;F.prototype.addEventListener=F.prototype.addEventListener;F.prototype.addEventListener=F.prototype.addEventListener;F.prototype.removeEventListener=F.prototype.removeEventListener;F.prototype.removeEventListener=F.prototype.removeEventListener;F.prototype.dispatchEvent=F.prototype.dispatchEvent;
F.prototype.dispatchEvent=F.prototype.dispatchEvent;F.prototype.D=F.prototype.D;F.prototype.dispose=F.prototype.D;F.prototype.Jb=F.prototype.Jb;F.prototype.addOnDisposeCallback=F.prototype.Jb;F.prototype.Dn=F.prototype.kd;
F.prototype.kd=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?"AT_TARGET":b?"CAPTURING_PHASE":(d=!0,"BUBBLING_PHASE")];if(!d||"pointerenter"!==(e=c.type)&&"pointerleave"!==e)c.eventPhase=g,f=F.prototype.Dn.apply(this,arguments),d&&this.hc&&null===this.hc()&&delete c.eventPhase;return f};function Ce(a){a=a||{};var b=a.callback;this.a=a.label;wa(b)&&(this.callback=b);this.u=!!a.disabled;Ce.l.constructor.call(this)}u(Ce,F);r("H.util.ContextItem",Ce);Ce.prototype.Ne=function(){return this.a};Ce.prototype.getLabel=Ce.prototype.Ne;Ce.prototype.Nc=function(a){this.a!==a&&(this.a=a,this.dispatchEvent("update"));return this};Ce.prototype.setLabel=Ce.prototype.Nc;Ce.prototype.Dc=function(){return this.u};Ce.prototype.isDisabled=Ce.prototype.Dc;
Ce.prototype.Aa=function(a){a^this.u&&(this.u=a,this.dispatchEvent("update"));return this};Ce.prototype.setDisabled=Ce.prototype.Aa;var De=new Ce;Ce.SEPARATOR=De;function Ee(){if(w.document){var a=document.createElement("canvas");a.width=a.height=1;return a.getContext("2d")}return null}var Fe=/^rgba\(([^,]+),([^,]+),([^,]+),([^)]+)\)$/;
function Ge(a){var b=He[a],c=w.RegExp;b||(w.Uint8ClampedArray||(w.Uint8ClampedArray=function(a){return a instanceof Number?Array(a):a.map(function(a){return ld(Kc(a),0,255)})}),"none"===a?b=new Uint8ClampedArray([0,0,0,0]):(Ie.fillStyle="black",Ie.fillStyle=a,Fe.test(Ie.fillStyle)?b=new Uint8ClampedArray([c.$1,c.$2,c.$3,255*c.$4]):(Ie.clearRect(0,0,1,1),Ie.fillRect(0,0,1,1),b=Ie.getImageData(0,0,1,1).data)),He[a]=b);return b}function Je(a){return"none"!==a&&0<Ge(a)[3]}var He=Gb(),Ke=!!w.VBArray;
r("H.util.eval",function(a){return eval(a)});function Le(a,b){return a!==A?a:b}function Me(a){return/^<svg/.test(a)?"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a):a}r("H.util.provide",function(a){sa(a,void 0)});function Ne(a){this.mc=0<a?Hc.round(a):0}Ne.prototype.next=function(a){if(9007199254740992===this.mc)throw new vd(a,this.mc,[0,9007199254740991]);return this.mc++};var Oe=new Ne,Pe=z(Oe.next,Oe);function Qe(){return!0}function Re(){return!1}function vc(){}
var Se=Ib([]),Te=Ib({});function Ue(a){return"CANVAS"===a.tagName?[a]:a.getElementsByTagName("CANVAS")}function Ve(a,b,c){var d;b=a.ownerDocument===b?a.cloneNode(!0):b.importNode(a,!0);if(c)for(a=Ue(a),c=Ue(b),d=c.length;d--;)c[d].getContext("2d").drawImage(a[d],0,0);return b}var Ie=Ee(),We=Ee();function Xe(a){var b=a.complete,c=0<a.naturalWidth;if(b&&!c&&Ke)try{We.drawImage(a,0,0),c=!0}catch(d){}return b&&c}var Ye=w.BlobBuilder||w.WebKitBlobBuilder||w.MozBlobBuilder;
function Ze(a,b){b=b||"";if(Ye){var c=new Ye;c.append(a);a=c.getBlob(b)}else a=new Blob([a],{type:b});return a};function $e(){var a=$e.a;a||(a=this,$e.a=a,Yb($e.a),F.call(a),this.a());return a}u($e,F);$e.prototype.s=function(){$e.l.s.call(this);this.a()};
Qa($e.prototype,{a:function(){this.Sn=10;this.Tn=6;this.ge=Gb();this.ti=Gb();this.ui=0},Pg:function(a){a=a.type;var b=this.ge[a]||0;if(this.ui<this.Sn&&b<this.Tn){var c=this.Co();this.ui++;this.ge[a]=b+1;this.ti[c]=a;return c}return x},bh:function(a){var b=this.ti[a];if(!Mb(b)||!this.ge[b])throw new nc(this.bh,"Unknown requestId");this.ui--;this.ge[b]--;this.ge[b]||delete this.ge[b];delete this.ti[a];this.dispatchEvent("allocatable")},Hn:-1,Co:function(){return++this.Hn}});function af(a,b,c,d){if(!this.b[a])throw new C(af,0,"Mime type is not supported");this.i=a;a=d?Na(d):{};"crossOrigin"in a||(a.crossOrigin="anonymous");this.a=a;a=bf;a.href=b.toString();qd.call(this,a.protocol+"//"+a.hostname,b,c)}u(af,qd);af.prototype.Cj=function(){this.g=this.b[this.i].call(this);return!0};af.prototype.xe=function(){this.g&&(this.g.abort(),this.g=null)};
af.prototype.b={"application/json":function(){var a=this,b=cf(this.a),c=b.headers;b.headers=c=c?Na(c):{};c.Accept="application/json";return new hc(this.data,function(b){200<=b.status&&300>b.status?a.resolve(b.json()):a.reject(b)},b)},"text/plain":function(){var a=this;return new hc(this.data,function(b){200<=b.status&&300>b.status?a.resolve(b.text()):a.reject(b)},cf(this.a))},image:function(){var a=w.document.createElement("img"),b=this,c=this.data;a.onload=z(this.resolve,this,a);a.onerror=function(){b.reject(gc.error())};
a.crossOrigin=this.a.crossOrigin;a.src=c;return{abort:function(){a.onerror=a.onload=null;Ke&&Xe(a)||a.removeAttribute("src")}}}};
(function(){try{var a=new XMLHttpRequest;a.open("get","/",!0)}catch(b){a={}}"response"in a&&(af.prototype.b.arraybuffer=function(){var a=new XMLHttpRequest,c=this,d=this.a,e=d.headers,f;a.open("GET",this.data);df(a,d);a.responseType="arraybuffer";if(e)for(f in e)a.setRequestHeader(f,e[f]);a.onerror=a.ontimeout=function(){c.reject(gc.error())};a.onload=function(){c.resolve(new gc(a.response))};a.send();return a})})();var ef=new td(new $e);af.prototype.rh=function(){return ef};var bf=w.document.createElement("a");
function cf(a){var b=Na(a);delete b.crossOrigin;df(b,a);return b}function df(a,b){a.withCredentials="use-credentials"===b.crossOrigin};function G(a,b){this.x=+a;this.y=+b}r("H.math.Point",G);G.prototype.set=G;G.prototype.set=G.prototype.set;G.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new G(this.x,this.y);return a};G.prototype.clone=G.prototype.clone;G.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};G.prototype.add=G.prototype.add;G.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};G.prototype.sub=G.prototype.sub;G.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};
G.prototype.scale=G.prototype.scale;G.prototype.round=function(){this.x=Kc(this.x);this.y=Kc(this.y);return this};G.prototype.round=G.prototype.round;G.prototype.floor=function(){this.x=Lc(this.x);this.y=Lc(this.y);return this};G.prototype.floor=G.prototype.floor;G.prototype.ceil=function(){this.x=Mc(this.x);this.y=Mc(this.y);return this};G.prototype.ceil=G.prototype.ceil;G.prototype.ca=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};G.prototype.equals=G.prototype.ca;
G.prototype.Mj=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=a;if(c||d){var f=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d);0>=f?e=a:1<=f?e=b:e=new G(a.x+f*c,a.y+f*d)}return e};G.prototype.getNearest=G.prototype.Mj;G.prototype.ab=function(a){return Pc(Rc(this.x-a.x,2)+Rc(this.y-a.y,2))};G.prototype.distance=G.prototype.ab;function ff(a){if(!a)throw Error("invalid argument");return a instanceof G?a:new G(a.x,a.y)}G.fromIPoint=ff;function gf(a){var b=hf[a];if(!b)if(a in jf)b=hf[a]=a;else{b=kf.length;var c="",d=a.charAt(0).toUpperCase()+a.substr(1),e="",f=!1;lf&&(e=lf+d,f=e in jf);for(;b--&&!f;)c=kf[b],e=c+d,f=e in jf;f&&(lf=c);if(b=f?e:null)hf[a]=b;else throw Error("Could not find any variant of CSS property ["+a+"]");}return b}r("H.dom.cssPrefixer.prefix",gf);var kf=["O","Ms","ms","Moz","Webkit"],hf={},lf="",jf=document.createElement("span").style;function mf(a,b,c,d){if(!a||!b||!c)throw new C(mf,null,"Must specify name, version and revision parameter");this.name=a;this.version=b;this.revision=c;d&&Qa(this,d)}r("H.util.BuildInfo",mf);mf.prototype.toString=function(){var a,b=[];for(a in this)ra(this[a])&&b.push(this[a]);return b.join(";")};var nf={};function of(a,b,c,d){if(!a)throw new C(of,1,"Must specify a name parameter");return nf[a]||(nf[a]=new mf(a,b,c,d))}mf.get=of;function pf(){pf.l.constructor.call(this);this.a=qf(this);this.f=Gb();this.c=z(this.c,this);this.a.addEventListener("message",this.c);this.b={}}u(pf,F);pf.prototype.s=function(){this.a.terminate()};pf.prototype.i=function(a){var b=a.type,c=!!this.f[b],d=a.data,e=rf++,f=d&&d.Bo?d.Bo:A,g=!0;c?(this.b[e]=a,sf(this,b,e,d&&d.message,f)):(a.reject(new C(this.i,0,"processor_not_found")),g=!1);return g};
pf.prototype.c=function(a){a=a.data;var b=this.b[a.taskId],c=a.taskId,d=a.data,e=this;if(2===a.type)(new af("arraybuffer",d)).then(function(a){return a.arrayBuffer()}).then(function(a){e.a.postMessage(["3",c,[a]],[a])},function(){e.a.postMessage(["3",c,[null,"ERROR"]])});else{if(b){switch(a.type){case 1:b.resolve(d);break;case 0:b.reject(d)}delete this.b[c]}this.dispatchEvent(new Ec(this.g.IDLE))}};var rf=0;function tf(a,b,c){var d=rf++,e;a.b[d]=e=sb();sf(a,b,d,c);return e.mi}
function sf(a,b,c,d,e){d===A||va(d)||(d=[d]);try{a.a.postMessage([b,c,d],e)}catch(f){a=a.b[c],a.reject(f.message)}}pf.prototype.g={IDLE:"idle",Yi:"error"};pf.prototype.j=function(a,b){var c=this.m||(this.m=new Ec(this.g.Yi));c.data=b;delete this.f[a];this.dispatchEvent(c)};pf.prototype.importScripts=function(a){tf(this,"0",a)};
function qf(a){var b=w.H.__bootstrap__;b=wa(b)?(""+b).replace(/^[^{]+{((.|[\r\n])+?)}\s*$/,"$1"):""+b;if(w.Worker&&w.URL)try{var c=new w.Worker(w.URL.createObjectURL(Ze(b,"application/javascript")))}catch(d){}c||(a=new uf(a),function(){eval("var self = arguments[0];"+b)}(a),c=new vf(a));return c}function vf(a){F.call(this);this.a=a}u(vf,F);vf.prototype.postMessage=function(a){w.setTimeout(z(this.b,this,a),0)};vf.prototype.b=function(a){var b=new Ec("message");b.data=a;this.a.dispatchEvent(b)};
vf.prototype.terminate=function(){this.a.D();this.D()};function uf(a){F.call(this);this.a=a;this.addEventListener=z(this.addEventListener,this);this.removeEventListener=z(this.removeEventListener,this);this.postMessage=z(this.postMessage,this);this.eval=z(eval,this)}u(uf,F);uf.prototype.postMessage=function(a){var b=new Ec("message");b.data=a;w.setTimeout(z(this.a.c,this.a,b),0)};function wf(){var a=xf;a||(a=xf=this,F.call(a),this.a());return a}var xf;u(wf,F);wf.prototype.s=function(){wf.l.s.call(this);this.a()};
Qa(wf.prototype,{a:function(){var a=this.Ag,b;if(a)for(b=a.length;b--;)a[b].D();this.Ag=[];Yb(this.Ag);this.Rf=Gb();this.Nk=Gb()},Pg:function(a){var b;a=a.type;if(b=this.Nk[a]){var c=this.Ag;var d=c[0];d||(d=c[0]=new pf,this.Jb(Ea(Dc,d)),Ma(this.Rf)||d.importScripts(w.Object.keys(this.Rf)));c=d;c.f[a]||(c.f[a]=b,tf(c,"1",[a,wa(b)?b+"":b]).then(vc,z(c.j,c,a)))}else throw new nc(this.Pg,'Unknown type "'+a+'"');return d},bh:function(){},gg:function(a,b){var c=this.Nk,d=c[a];if(d){if(b!==d)throw new nc(this.gg,
'Type "'+a+'" is already registered');}else c[a]=b},importScripts:function(a){[].concat(a).forEach(function(a){this.Rf[a]||(this.Rf[a]=!0,this.Ag.forEach(function(b){b.importScripts(a)}))},this)}});function yf(a,b,c){qd.call(this,a,b,c)}var zf;u(yf,qd);yf.prototype.rh=function(){zf||(zf=new td(new wf));return zf};yf.prototype.xe=function(){};yf.prototype.Cj=function(a){return a.i(this)};var Af={undefined:"GL",GL:"GL",OL:"OL",SL:"SL",SB:"SB",WE:"WE",WG:"WG"};r("H.geo.AltitudeContext",Af);function Bf(a,b,c){var d=ld(+a,-90,90);if(b&&D(d))throw new C(b,c,a);return d}function Df(a,b,c){var d=+a;if(-180>d||180<d)d=jd(d+180,360)-180;if(b&&D(d))throw new C(b,c,a);return d}function Ef(a,b,c){var d;if(a!==A&&D(d=+a)&&b)throw new C(b,c,a);return d}function Ff(a,b,c){var d=!Af[a];if(b&&d)throw new C(b,c,a);return!d}function Gf(a,b){return 0!==(0>a^0>b)&&180<Nc(b-a)}
r("H.geo.isDBC",Gf);function Hf(){Nb(this,Hf)}r("H.geo.AbstractGeometry",Hf);Hf.prototype.getBoundingBox=Hf.prototype.F;Hf.prototype.equals=Hf.prototype.ca;Hf.prototype.lb="";Hf.prototype.toString=function(){return this.Pc([this.lb.toUpperCase()," "]).join("")};Hf.prototype.toString=Hf.prototype.toString;Hf.prototype.W=function(){return{type:this.lb,coordinates:this.vc(),boundingBox:this.F().W()}};function H(a,b,c,d){this.lat=Bf(a,H,0);this.lng=Df(b,H,1);c!==A&&(this.alt=Ef(c,H,2));d!==A&&Ff(d,H,3)&&(this.ctx=d)}u(H,Hf);r("H.geo.Point",H);H.prototype.ca=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&Af[this.ctx]===Af[a.ctx]&&(this.alt||0)===(a.alt||0)};H.prototype.equals=H.prototype.ca;
H.prototype.ab=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*ed;var c=a.lat*ed;a=1.274200158E7*Uc(Ic(1,Pc(Rc(Tc((b-c)/2),2)+Vc(b)*Vc(c)*Rc(Tc((this.lng*ed-a.lng*ed)/2),2))))}return a};H.prototype.distance=H.prototype.ab;
H.prototype.zg=function(a,b,c){if(c){if(b/=6371000.79){a*=ed;var d=ed*this.lat;var e=Tc(d);var f=Tc(b);var g=Vc(b);var h=ed*this.lng;var k=Vc(d);d=Uc(k*Vc(a)*f+e*g);a=Yc(Tc(a)*k*f,g-e*Tc(d));a=(h+a+$c)%(2*$c)-$c;k=a*fd}return b?new H(d*fd,(k+540)%360-180):this}a=(a%360+360)%360;if(0===(a+90)%180)return d=this.lng+b/(6371000.79*cd*Vc(this.lat*ed))*(270===a?-360:360),new H(this.lat,(d+540)%360-180);if(b/=6371000.79){a*=ed;h=this.lat*ed;e=this.lng*ed;f=h+b*Vc(a);g=f-h;d=Oc(Wc(f/2+bd)/Wc(h/2+bd));d=D(g/
d)?Vc(h):g/d;var l=b*Tc(a)/d;Nc(f)>ad&&(f=0<f?$c-f:-($c+f))}return b?new H(f*fd,((e+l+dd+(Nc(h+g)>ad?$c:0))%cd-$c)*fd):this};H.prototype.walk=H.prototype.zg;H.prototype.F=function(){return new I(this.lat,this.lng,this.lat,this.lng)};H.prototype.getBoundingBox=H.prototype.F;function If(a,b,c){var d=!!a&&!(D(a.lat=Bf(a.lat))||D(a.lng=Df(a.lng))||a.alt!==A&&D(a.alt=Ef(a.alt))||a.ctx!==A&&!Ff(a.ctx));if(!d&&b)throw new C(b,c,a);return d}H.validate=If;
function Jf(a){if(!a)throw new C(Jf,0,a);return new H(a.lat,a.lng,a.alt,a.ctx)}H.fromIPoint=Jf;H.prototype.lb="Point";H.prototype.Pc=function(a){a.push("(",this.lng," ",this.lat,")");return a};H.prototype.vc=function(){return[this.lat,this.lng]};function I(a,b,c,d){Kf(this,Bf(a,I,0),Df(b,I,1),Bf(c,I,2),Df(d,I,3))}u(I,Hf);r("H.geo.Rect",I);I.prototype.lb="Polygon";I.prototype.Pc=function(a){var b=this.la,c=this.aa,d=this.ha,e=this.da;a.push("(","(",c," ",b,",",e," ",b,",",e," ",d,",",c," ",d,",",c," ",b,")",")");return a};I.prototype.ca=function(a){return this===a||!!a&&this.la===a.la&&this.aa===a.aa&&this.ha===a.ha&&this.da===a.da};I.prototype.equals=I.prototype.ca;I.prototype.clone=function(){return new I(this.la,this.aa,this.ha,this.da)};
I.prototype.clone=I.prototype.clone;function Kf(a,b,c,d,e){a.aa=c;a.da=e;b<d&&(c=b,b=d,d=c);a.la=b;a.ha=d;a.c=a.a=a.b=null;return a}I.prototype.Sb=function(){this.c||(this.c=new H(this.la,this.aa));return this.c};I.prototype.getTopLeft=I.prototype.Sb;I.prototype.Ob=function(){this.a||(this.a=new H(this.ha,this.da));return this.a};I.prototype.getBottomRight=I.prototype.Ob;I.prototype.ln=function(){return this.la};I.prototype.getTop=I.prototype.ln;I.prototype.mm=function(){return this.ha};
I.prototype.getBottom=I.prototype.mm;I.prototype.Km=function(){return this.aa};I.prototype.getLeft=I.prototype.Km;I.prototype.en=function(){return this.da};I.prototype.getRight=I.prototype.en;I.prototype.jb=function(){this.b||(this.b=new H(this.ha+(this.la-this.ha)/2,Lf(this.aa,this.Cb())));return this.b};I.prototype.getCenter=I.prototype.jb;I.prototype.Cb=function(){return Mf(this.aa,this.da)};I.prototype.getWidth=I.prototype.Cb;I.prototype.Pd=function(){return this.la-this.ha};
I.prototype.getHeight=I.prototype.Pd;I.prototype.Db=function(){return this.aa>this.da};I.prototype.isCDB=I.prototype.Db;I.prototype.Tf=function(){return!this.Cb()&&!this.Pd()};I.prototype.isEmpty=I.prototype.Tf;I.prototype.F=function(){return new I(this.la,this.aa,this.ha,this.da)};I.prototype.getBoundingBox=I.prototype.F;
I.prototype.Cf=function(a,b,c){var d=this.jb();c||(a=Bf(a,this.Cf,0),b=Df(b,this.Cf,1));b=this.cd(a,b,c);a=b.jb();return a.lat===d.lat&&a.lng===d.lng&&this.Pd()===b.Pd()&&this.Cb()===b.Cb()};I.prototype.containsLatLng=I.prototype.Cf;I.prototype.Hd=function(a,b){b||If(a,this.Hd,0);return this.Cf(a.lat,a.lng,b)};I.prototype.containsPoint=I.prototype.Hd;
I.prototype.Wg=function(a,b){var c=this.jb();if(!b&&!B(a,I))throw new C(this.Wg,0,a);b=this.lc(a,b);a=b.jb();return a.lat===c.lat&&a.lng===c.lng&&this.Pd()===b.Pd()&&this.Cb()===b.Cb()};I.prototype.containsRect=I.prototype.Wg;I.prototype.cd=function(a,b,c,d){if(!c){if(D(a=Bf(a)))throw new C(this.cd,0,a);if(D(b=Df(b)))throw new C(this.cd,1,b);}return Nf(this.la,this.aa,this.ha,this.da,a,b,a,b,d)};I.prototype.mergeLatLng=I.prototype.cd;
I.prototype.wk=function(a,b,c){b||If(a,this.wk,0);return this.cd(a.lat,a.lng,b,c)};I.prototype.mergePoint=I.prototype.wk;I.prototype.lc=function(a,b,c){if(!b&&!B(a,I))throw new C(this.lc,0,a);return Nf(this.la,this.aa,this.ha,this.da,a.la,a.aa,a.ha,a.da,c)};I.prototype.mergeRect=I.prototype.lc;I.prototype.Gc=function(a,b,c,d,e,f){e||(a=Bf(a,this.Gc,0),b=Df(b,this.Gc,1),c=Bf(c,this.Gc,2),d=Df(d,this.Gc,3));return Nf(this.la,this.aa,this.ha,this.da,a,b,c,d,f)};I.prototype.mergeTopLeftBottomRight=I.prototype.Gc;
I.prototype.Wd=function(a,b){var c=this.aa<=this.da,d=a.aa<=a.da,e=this.aa<a.da,f=a.aa<this.da;if(!b&&!B(a,I))throw new C(this.Wd,0,a);return this.ha<=a.la&&a.ha<=this.la&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};I.prototype.intersects=I.prototype.Wd;function Mf(a,b){a=b-a;return a+(0>a?360:0)}function Lf(a,b){a+=b/2;return a-(180<a?360:0)}
function Nf(a,b,c,d,e,f,g,h,k){c=Ic(c,g);a=Jc(a,e);e=Mf(b,d);var l=Lf(b,e);g=Mf(f,h);var m=Lf(f,g)-l;m+=0>m-1E-6?360:0;if(180>m-1E-6){l=b;var p=h}else m=360-m,l=f,p=d;m=m+e/2+g/2;360<=m+5E-7?(l=-180,p=180):m-5E-7<e?(l=b,p=d):m-5E-7<g&&(l=f,p=h);return k?Kf(k,a,l,c,p):new I(a,l,c,p)}I.merge=Nf;function Of(a,b,c){c||(If(a,Of,0),If(b,Of,1));return new I(a.lat,a.lng,b.lat,b.lng)}I.fromPoints=Of;
function Pf(a,b){var c=1,d=a.length,e=null;if(!va(a))throw new C(Pf,0,a);if(0<d){var f=a[0];for(e=Of(f,f,b);c<d;c++)f=a[c],e.cd(f.lat,f.lng,b,e)}return e}I.coverPoints=Pf;function Qf(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new C(Qf,0,a);if(0<d)for(e=new I(a[0],a[1],a[0],a[1]);c<d;c+=3)e.cd(a[c],a[c+1],b,e);return e}I.coverLatLngAlts=Qf;
function Rf(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new C(Rf,0,a);if(0<d)for(e=new I(a[0].la,a[0].aa,a[0].ha,a[0].da);c<d;c++)e.lc(a[c],b,e);return e}I.coverRects=Rf;
I.prototype.Uk=function(a,b){var c=this.aa,d=this.la,e=this.da,f=this.ha,g=this.jb().lng;If(a,this.Uk,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?Kf(b,d,a,f,e):new I(d,a,f,e)};I.prototype.resizeToCenter=I.prototype.Uk;I.prototype.W=function(){return this.vc()};I.prototype.vc=function(){return[this.la,this.aa,this.ha,this.da]};function Sf(a,b,c,d,e,f){Nb(this,Sf);this.c=a||10;this.b=this.a=null;this.f=d||0;this.g=e||0;this.i=b||1;this.j=c||1;this.u=!!f;this.flush()}var Tf={Jl:0,Kl:1,yl:2,zl:3};function Uf(a){var b=a.b;if(a.u&&!b){var c=a.head;if(c.entries||c[0]||c[1]||c[2]||c[3])b=[c],b=Vf([b,b,b,b],[c[6],c[7],c[4],c[5]]),a.b=b}return b}
function Vf(a,b){var c,d,e,f,g=0;for(c=3;0<=c;c--){var h=c+4;var k=0<c%3;var l=[];var m=b[c];var p=a[c];for(d=p.length;d--;){var q=p[d];if(e=q.entries)for(f=e.length;f--;){var t=e[f].md(c);if(k?t>m:t<m)m=t}for(f=4;f--;)(e=q[f])&&(k?e[h]>m:e[h]<m)&&l.push(e)}g+=l.length;b[c]=m;a[c]=l}g&&(b=Vf(a,b));return b}function Wf(a,b,c){var d,e;if(a.u&&(d=a.b))for(e=3;0<=e;e--){var f=b.md(e);if(e%3?f>=d[e]:f<=d[e])if(c)d[e]=f;else{a.b=null;break}}}
Sf.prototype.remove=function(a){var b,c,d,e=!1;a&&(b=a.node)&&b.b===this&&(c=b.entries)&&0<=(d=c.indexOf(a))&&(c.splice(d,1),this.m(b),Wf(this,a,!1),e=!0);return e};Sf.prototype.flush=function(){var a=new Xf(null,NaN,this.f-this.i,this.g-this.j,this.f+this.i,this.g+this.j);a.b=this;this.head=this.a=a;this.b=null};function Yf(a,b){var c=a.head,d;if(b){var e=b;if(e!==c)for(c=e;e=e.parent;)if(e.entries||1<e.a)c=e}else for(;!c.entries&&2>(d=c.a);)if(d)c=e;else break;a.head=c}
Sf.prototype.Ya=function(a,b,c,d){var e=[],f=this.head,g=this.a;a<=f[5]&&b<=f[6]&&c>f[7]&&d>f[4]&&Zf(this,f,e,a,b,c,d,d>=g[6],c>=g[5]);return e};
function Zf(a,b,c,d,e,f,g,h,k){var l=b.entries,m=b[7],p=b[4],q=b[5],t=b[6],v=b[8],y=b[9],E;if(l){var N=l.length;if(e>p||d>m||g<t||f<q)for(;N--;){m=l[N];p=m.md(3);q=m.md(0);t=m.md(1);var Y=m.md(2);Y>=e&&t>=d&&(q<g||h&&q==g)&&(p<f||k&&p==f)&&c.push(m)}else for(;N--;)c.push(l[N])}f>v&&(e<y&&(E=b[Tf.Kl])&&Zf(a,E,c,d,e,f,g,h,k),g>y&&(E=b[Tf.zl])&&Zf(a,E,c,d,e,f,g,h,k));d<v&&(e<y&&(E=b[Tf.Jl])&&Zf(a,E,c,d,e,f,g,h,k),g>y&&(E=b[Tf.yl])&&Zf(a,E,c,d,e,f,g,h,k))}Sf.prototype.Qc=ba(1);var $f=0;
function Xf(a,b,c,d,e,f){this.c=b;a&&(this.parent=a,this.b=a.b,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}Xf.prototype.a=0;function ag(a,b){return a[b]||(++a.a,a[b]=new Xf(a,b))}Xf.prototype.removeChild=function(a){var b=a.c;this[b]===a&&(delete this[b],delete a.parent,--this.a)};Xf.prototype.Qc=ba(0);function bg(a,b){(a.entries||(a.entries=[])).push(b);b.node=a}
function cg(a,b,c,d,e){var f=a[5],g=a[6];return a[7]<=b&&a[4]<=c&&(f>d||f===d&&f===a.b.a[5])&&(g>e||g===e&&g===a.b.a[6])};function dg(a,b,c,d,e,f){dg.l.constructor.apply(this,arguments)}u(dg,Sf);dg.prototype.m=function(a){for(var b,c,d=this.head;a;){if(!(b=a.entries)||!b.length)if(b&&delete a.entries,!a.a&&(c=a.parent)){c.removeChild(a);d===a&&(d=c);a=c;continue}a=x}this.head!==d&&(this.head=d,Yf(this))};function eg(a,b,c,d,e){if(cg(a.a,b,c,d,e))return fg(a,a.a,b,c,d,e,a.c);throw Error("Coordinates out of bounds");}dg.prototype.Cc=function(a,b){return eg(this,a,b,a,b)};
function fg(a,b,c,d,e,f,g){var h=b[8],k=b[9],l,m;g&&(e<h||(l=c>=h))&&(f<k||(m=d>=k))?c=fg(a,ag(b,l|m<<1),c,d,e,f,g-1):(bg(b,c=new gg(c,d,e,f)),Wf(a,c,!0),Yf(a,b));return c}function gg(a,b,c,d){this.id=$f++;this[0]=b;this[1]=c;this[2]=d;this[3]=a}gg.prototype.md=function(a){return this[a]};function hg(a){this.f=new dg(+a||10,180,90,0,0,!0);this.c=[];this.g=!1;this.a=this.b=this.N=null}r("H.geo.QuadTree",hg);n=hg.prototype;n.Nh=0;n.Yc=function(){return this.Nh};n.Db=function(){return this.g};
n.F=function(){var a,b;if(!this.N){var c=[];!this.b&&(a=Uf(this.f))&&(this.b=new I(-a[0],a[3],-a[2],a[1]));(b=this.b)&&c.push(b);var d,e,f;if(!this.a&&(f=(e=this.c).length)){a=90;var g=360;var h=-90;for(d=0;f--;){var k=e[f];a=Ic(a,k[0]);g=Ic(g,k[3]);h=Jc(h,k[2]);d=Jc(d,k[1])}this.a=new I(-a,g,-h,d-360)}(b=this.a)&&c.push(b);if(b=c[0])c[1]&&(b=b.lc(c[1],!0)),this.N=b}return this.N};
function ig(a,b,c,d,e,f){f?(f=new gg(e,-b,c+360,-d),a.c.push(f),a.g=!0,a.a&&a.a.Gc(b,c,d,e,!0,a.a)):(f=eg(a.f,c,-b,e,-d),a.b&&a.b.Gc(b,c,d,e,!0,a.b));++a.Nh;a.N=null;return f}n.Cc=function(a){var b=a.lng;a=a.lat;return ig(this,a,b,a,b,!1)};n.$j=function(a){var b=a.Sb(),c=a.Ob();return(a=a.Db())?ig(this,b.lat,c.lng,c.lat,b.lng,a):ig(this,b.lat,b.lng,c.lat,c.lng,a)};hg.prototype.insertBoundingBox=hg.prototype.$j;
hg.prototype.remove=function(a){var b;if(a.node){var c=this.f.remove(a);this.b=null}else if(a=(b=this.c).indexOf(a),c=0<=a)b.splice(a,1),this.g=0<b.length,this.a=null;c&&(--this.Nh,this.N=null);return c};hg.prototype.remove=hg.prototype.remove;function jg(a,b,c,d,e){a=a.c;var f=a.length,g=[],h;if(f){var k=c+360;for(h=e+360;f--;){var l=a[f];kg(l,b,c,d,e)?g.push(l):kg(l,b,k,d,h)&&g.push(l)}}return g}function kg(a,b,c,d,e){var f=a[3],g=a[1],h=a[2];return a[0]<d&&f<e&&h>=b&&g>=c}
function lg(a,b){var c,d,e;if(c=b.length){var f=a.length;for(d={};f--;)d[a[f].id]=1;for(;c--;)(e=b[c]).id in d||a.push(e)}}hg.prototype.Sf=function(a){var b=this.f,c=a.Sb(),d=a.Ob(),e=-c.lat;c=c.lng;var f=-d.lat;d=d.lng;e===f||c===d?a=[]:a.Db()?(a=b.Ya(-180,e,d,f),lg(a,b.Ya(c,e,180,f)),lg(a,jg(this,e,d,f,c+360))):(a=b.Ya(c,e,d,f),lg(a,jg(this,e,c,f,d)));return a};hg.prototype.intersectBoundingBox=hg.prototype.Sf;function J(a,b){J.l.constructor.call(this);a&&mg(a,J,0);this.ma=a||[];this.b=b;this.a=ng(this,0,this.ma.length)}u(J,Hf);r("H.geo.LineString",J);function ng(a,b,c){a=a.ma;var d=0;b=Jc(b,0);c=Ic(c,a.length);c-=2;for(b+=1;b<c;)d+=Gf(a[b],a[b+=3]);return d}J.prototype.ri=function(a,b,c){og(this,a,b,c,this.ri)};J.prototype.pushLatLngAlt=J.prototype.ri;
function og(a,b,c,d,e){var f=a.ma.length;b=Bf(b,e);c=Df(c,e);a.ma.push(Bf(b,e),Df(c,e),d===A?0:Ef(d,e));f&&(a.a+=Gf(a.ma[f-2],c));delete a.N;delete a.c}J.prototype.sf=function(a,b,c){c&&mg(c,this.sf,2);void 0===b&&(b=this.ma.length);b&&(this.a-=ng(this,a-3,a+b+3));var d=c?this.ma.splice.apply(this.ma,[a,b].concat(c)):this.ma.splice(a,b);c&&(this.a+=ng(this,a-3,a+c.length+3));b&&!c&&(this.a+=ng(this,a-3,a-3));delete this.N;delete this.c;return d};J.prototype.spliceLatLngAlts=J.prototype.sf;
J.prototype.ak=function(a,b,c,d){this.sf(a,0,[b,c,d])};J.prototype.insertLatLngAlt=J.prototype.ak;J.prototype.Qk=function(a){this.sf(a,3)};J.prototype.removeLatLngAlt=J.prototype.Qk;J.prototype.ud=function(a){og(this,a.lat,a.lng,a.alt,this.ud)};J.prototype.pushPoint=J.prototype.ud;J.prototype.Cc=function(a,b){this.ak(3*a,b.lat,b.lng,b.alt)};J.prototype.insertPoint=J.prototype.Cc;J.prototype.df=function(a){this.Qk(3*a)};J.prototype.removePoint=J.prototype.df;
J.prototype.Fe=function(a,b){var c=this.ma,d=3*a;a=c[d];var e=c[d+1];c=c[d+2];b&&(b.lat=a,b.lng=e,b.alt=c,void 0!==c&&this.b&&(b.ctx=this.b));return b||new H(a,e,c,null!=c?this.b:void 0)};J.prototype.extractPoint=J.prototype.Fe;J.prototype.am=function(a,b,c){var d=this.ma;b=b||0;c=Le(c,d.length/3);for(var e=3*b;b<c;)a(d[e++],d[e++],d[e++],b++)};J.prototype.eachLatLngAlt=J.prototype.am;J.isDBC=Gf;J.prototype.oh=function(a){var b=this.a;a&&(a=this.ma,b+=Gf(a[a.length-2],a[1]));return b};
J.prototype.getDBCs=J.prototype.oh;J.prototype.Oe=function(){return this.ma.length/3};J.prototype.getPointCount=J.prototype.Oe;J.prototype.Im=function(){return this.ma};J.prototype.getLatLngAltArray=J.prototype.Im;J.prototype.N=x;
J.prototype.F=function(){var a;if(!(a=this.N)){a=this.ma;var b=a.length,c=3,d,e,f=x,g=Nf;if(3<=b){var h=d=a[0];var k=e=a[1];for(f=new I(h,k,d,e);c<b;c+=3){h=a[c-3];k=a[c-2];d=a[c];e=a[c+1];if(k>e&&180<e-k||k<e&&-180>k-e||e<k&&180>Nc(e-k)){var l=k;k=e;e=l}h<d&&(l=h,h=d,d=l);g(f.la,f.aa,f.ha,f.da,h,k,d,e,f)}}a=this.N=f}return a};J.prototype.getBoundingBox=J.prototype.F;J.prototype.tn=function(){return this.N!==x};J.prototype.hasBoundingBox=J.prototype.tn;
function mg(a,b,c){for(var d=a.length,e=!(d%3),f;e&&d;)e=!(D(a[--d]=Ef((f=a[d])===A?0:f))||D(a[--d]=Df(a[d]))||D(a[--d]=Bf(a[d])));if(!e&&b)throw new C(b,c,a);}function pg(a){var b=new J,c=0,d=a.length;if(d%2)throw new C(pg,0,a);for(;c<d;)og(b,a[c++],a[c++],0,pg);return b}J.fromLatLngArray=pg;J.prototype.ca=function(a){var b=this===a,c;if(!b&&(b=B(a,J))){var d=this.ma;a=a.ma;for(b=(c=d.length)===a.length;b&&c--;)b=d[c]==a[c]}return b};J.prototype.equals=J.prototype.ca;
function qg(a,b){return a.a-b.a}
function rg(a,b){var c=a.ma,d=-2,e=[],f;var g=a.c;if(!g){g=a.c=new hg;var h=0;var k=a.ma;var l=k.length;for(f=0;f<l;f+=3){var m=k[f];var p=k[f+1];if(f){if(t<p){var q=t;var t=p}else q=p;if(y<m)var v=m;else{v=y;var y=m}q=ig(g,v,q,y,t,180<t-q);q.a=h++}y=m;t=p}}g=g.Sf(b).sort(qg);k=g.length;for(b=0;b<k;b++){h=g[b];h=h.a;l=3*h;if(h>d+1){var E=[c[l],c[l+1]];e.push(E)}d=h;E.push(c[l+3],c[l+4])}if(a.a){c=[];d=e.length;for(b=0;b<d;b++)if(E=e[b],g=E.length){k=[];for(a=0;a<g;a+=2)h=E[a],l=E[a+1],k.push(h,l),
f=E[a-1],a&&Gf(l,f)&&(c.push(k),k=[],f+=0>f?360:-360,k.push(E[a-2],f,h,l));c.push(k)}e=c}return e}J.prototype.lb="LineString";J.prototype.Pc=function(a){var b=this.ma,c=b.length,d;if(c){a.push("(");for(d=0;d<c;d+=3)d&&a.push(","),a.push(b[d+1]," ",b[d]);a.push(")")}else a.push("EMPTY");return a};J.prototype.vc=function(){var a=this.ma,b;if(this.F().Db()){a=a.slice();var c=1;for(b=a.length;c<b;c+=3)0>a[c]&&(a[c]+=360)}return a};function sg(a){sg.l.constructor.call(this);void 0!==a&&(this.data=a)}u(sg,F);r("H.map.Feature",sg);sg.prototype.getData=function(){return this.data};sg.prototype.getData=sg.prototype.getData;sg.prototype.s=function(){sg.l.s.call(this);delete this.data};function tg(){}r("H.map.provider.Invalidations",tg);tg.MARK_INITIAL=hd;tg.prototype.update=function(a,b){b!==ug.NONE&&(this.a=a,b&ug.SPATIAL&&(this.f=a),b&ug.VISUAL&&(this.g=a),b&ug.ADD&&(this.b=a),b&ug.REMOVE&&(this.c=a),b&ug.Z_ORDER&&(this.j=a),b&ug.VOLATILITY&&(this.i=a))};tg.prototype.update=tg.prototype.update;tg.prototype.Om=function(){return this.a};tg.prototype.getMark=tg.prototype.Om;tg.prototype.a=hd;tg.prototype.yn=function(a){return this.a>a};tg.prototype.isAny=tg.prototype.yn;
tg.prototype.g=hd;tg.prototype.Zd=function(a){return this.g>a};tg.prototype.isVisual=tg.prototype.Zd;tg.prototype.f=hd;tg.prototype.Hh=function(a){return this.f>a};tg.prototype.isSpatial=tg.prototype.Hh;tg.prototype.b=hd;tg.prototype.bk=function(a){return this.b>a};tg.prototype.isAdd=tg.prototype.bk;tg.prototype.c=hd;tg.prototype.Uf=function(a){return this.c>a};tg.prototype.isRemove=tg.prototype.Uf;tg.prototype.j=hd;tg.prototype.Ih=function(a){return this.j>a};tg.prototype.isZOrder=tg.prototype.Ih;
tg.prototype.i=hd;tg.prototype.Cn=function(a){return this.i>a};tg.prototype.isVolatility=tg.prototype.Cn;var ug={NONE:0,VISUAL:1,SPATIAL:2,ADD:4,REMOVE:8,Z_ORDER:16,VOLATILITY:32};tg.Flag=ug;function vg(a,b,c){vg.l.constructor.call(this,a);this.oldValue=c;this.newValue=b}u(vg,Ec);r("H.util.ChangeEvent",vg);function K(a){Nb(this,K);K.l.constructor.call(this,a?a.data:A);this.K=wg.next();if(a){var b="min";Vb(a[b])&&(this.m=a[b]);b="max";Vb(a[b])&&(this.j=a[b]);b="visibility";b in a&&(this.c=!!a[b]);b="volatility";b in a&&(this.o=!!a[b]);b="zIndex";b in a&&(this.i=+a[b]||0);b="provider";b in a&&(this.a=a[b],this.Ga(ug.ADD))}}u(K,sg);r("H.map.Object",K);var wg=new Ne(1),xg={ANY:0,OVERLAY:1,SPATIAL:2,MARKER:3,DOM_MARKER:4,GROUP:5};K.Type=xg;K.prototype.cb=function(){return this.K};
K.prototype.getId=K.prototype.cb;K.prototype.m=-1/0;K.prototype.j=1/0;K.prototype.Pm=function(){return this.j};K.prototype.getMax=K.prototype.Pm;K.prototype.Rm=function(){return this.m};K.prototype.getMin=K.prototype.Rm;K.prototype.c=!0;K.prototype.sb=function(a){var b=this.c;(a=!!a)^b&&(this.c=a,this.invalidate(ug.VISUAL));return this};K.prototype.setVisibility=K.prototype.sb;K.prototype.Ac=function(a){for(var b=this,c;(c=b.c)&&a&&(b=b.Ua););return c};K.prototype.getVisibility=K.prototype.Ac;
K.prototype.o=!1;K.prototype.Sj=function(a){for(var b=this,c;!(c=b.o)&&a&&(b=b.Ua););return c};K.prototype.getVolatility=K.prototype.Sj;K.prototype.ll=function(a){var b=this.o;b^a&&(this.o=!b,this.invalidate(ug.VOLATILITY));return this};K.prototype.setVolatility=K.prototype.ll;K.prototype.i=A;K.prototype.Tj=function(){return this.i};K.prototype.getZIndex=K.prototype.Tj;K.prototype.pf=function(a){a!==this.i&&(this.gf(),this.i=a,this.invalidate(ug.Z_ORDER));return this};K.prototype.setZIndex=K.prototype.pf;
K.prototype.v=A;function yg(a){var b=a.v,c,d;if(!b){var e=(c=a.i)!==A;(b=a.Ua)?(b=yg(b).slice(),b[0]|=e):b=[e|0];b.push(c||0,0>(d=a.Ji)?a.K:d);a.v=b}return b}K.prototype.gf=function(){this.v=A};function zg(a,b,c){var d,e;if(!c||a[0]|b[0]){var f=a.length;var g=b.length;var h=Ic(f,g);var k=1;for(e=1+c;k<h;k+=e)if(d=a[k]-b[k])return d}return c?0:f-g}function Ag(a,b){return a.oj(b)}K.compareZOrder=Ag;K.prototype.oj=function(a){return this.Bg-a.Bg||zg(yg(this),yg(a),!1)};K.prototype.compareZOrder=K.prototype.oj;
n=K.prototype;n.previousSibling=x;n.nextSibling=x;n.Ji=-1;n.Ua=x;n.Tm=function(){return this.Ua};K.prototype.getParentGroup=K.prototype.Tm;K.prototype.ic=function(){for(var a=this,b;b=a.Ua;)a=b;return a};K.prototype.getRootGroup=K.prototype.ic;K.prototype.contains=function(a){return this===a};K.prototype.contains=K.prototype.contains;K.prototype.ba=function(a){if(this.Ua)throw new nc(this.ba,"Not allowed for a child of a group");K.l.ba.call(this,a)};K.prototype.setParentEventTarget=K.prototype.ba;
K.prototype.a=x;K.prototype.ya=function(){return this.a};K.prototype.getProvider=K.prototype.ya;K.prototype.je=function(a,b){var c=this.a,d;if(d=c!==a){if(b&&(c&&!B(c,L)||a&&!B(a,L)))throw new nc(b,"Only LocalObjectProvider allows an object transfers");b=this.type!==xg.GROUP;c&&(this.invalidate(ug.REMOVE),b&&c.Ia(this));if(this.a=a)b&&a.T(this),this.S=x,this.invalidate(ug.ADD)}return d};K.prototype.Qb=function(){return this.S||(this.S=new tg)};K.prototype.getInvalidations=K.prototype.Qb;
K.prototype.Ga=function(a){var b=this.ya(),c;(c=!!b)&&b.invalidateObject(this,a);return c};K.prototype.invalidate=K.prototype.Ga;K.prototype.s=function(){this.Ua&&this.Ua.Ia(this);K.l.s.call(this)};K.prototype.setData=function(a){this.data=a;return this};K.prototype.setData=K.prototype.setData;K.prototype.W=function(){return{id:this.K,properties:{min:this.m,max:this.j,zIdx:this.i,sIdx:this.Ji,parent:this.Ua?this.Ua.cb():0,visible:this.Ac(),"volatile":this.Sj()},type:"Feature"}};
K.prototype.forWorkerMessage=K.prototype.W;function Bg(a){var b;if(a){var c=Cg;for(b=B(a,Bg);c--;){var d=Dg[c];if(a.hasOwnProperty(d)){var e=a[d];if(b)this[d]=e;else{if((e=Eg[c](e))===Fg)throw new C(Bg,0,d+": "+a[d]);e!==this[d]&&e!==A&&(this[d]=e)}}}c=b?a.Se:this.lineWidth&&Je(this.strokeColor);c||(this.Se=c);c=b?a.Tb:Je(this.fillColor);c||(this.Tb=c);c=b?a.Re:"none"!==this.strokeColor&&this.lineWidth;c||(this.Re=c)}Ib(this)}r("H.map.SpatialStyle",Bg);Bg.prototype.Tb=!0;Bg.prototype.Se=!0;Bg.prototype.Re=!0;var Dg=[];
Bg.prototype[Dg[0]="strokeColor"]="rgba(0,85,170,.6)";Bg.prototype[Dg[1]="fillColor"]="rgba(0,85,170,.4)";Bg.prototype[Dg[2]="lineWidth"]=2;Bg.prototype[Dg[3]="lineCap"]="round";Bg.prototype[Dg[4]="lineJoin"]="miter";Bg.prototype[Dg[5]="miterLimit"]=1;Bg.prototype[Dg[6]="lineDash"]=Se;Bg.prototype[Dg[7]="lineDashOffset"]=0;Bg.prototype[Dg[8]="lineHeadCap"]=A;Bg.prototype[Dg[9]="lineTailCap"]=A;var Cg=Dg.length;
Bg.prototype.ca=function(a){var b=this===a;if(!b&&a){for(b=0;b<Cg;b++){var c=Dg[b];if(this[c]!==a[c])break}b=b===Cg}return b};Bg.prototype.equals=Bg.prototype.ca;Bg.prototype.Kj=function(a){if(a){var b={};Qa(b,this,a)}else b=this;return new Bg(b)};Bg.prototype.getCopy=Bg.prototype.Kj;
var Fg=Ib({}),Eg=[function(a){return a?Hb(a):Fg},function(a){return a?Hb(a):Fg},function(a){return 0<=a&&100>=a?+a:Fg},function(a){a=Hb(a);return"butt"===a||"square"===a||"round"===a||"arrow-head"===a||"arrow-tail"===a?a:Fg},function(a){return"round"===a||"bevel"===a||"miter"===a?a:Fg},function(a){return 0<a&&100>=a?+a:Fg},function(a){return a&&a.every&&a.every(Wb)?a:Fg},function(a){return D(+a)?Fg:+a},function(a){return Mb(a)?Eg[3](a):A},function(a){return Mb(a)?Eg[3](a):A}];Bg.MAX_LINE_WIDTH=100;
var Gg=new Bg;Bg.DEFAULT_STYLE=Gg;var Hg="fillColor strokeColor lineWidth lineCap lineJoin miterLimit lineDashOffset lineDash lineTailCap lineHeadCap".split(" ");Bg.prototype.W=function(){for(var a={},b=Hg.length,c;b--;)c=Hg[b],a[c]=this[c];return a};Bg.prototype.forWorkerMessage=Bg.prototype.W;function Ig(a){var b;if(a){var c=B(a,Ig);for(b in a)if(b in this){var d=a[b];d!==this[b]&&("fillColor"===b||0<(d=+d))&&(this[b]=d)}a=c?a.Tb:!!(Je(this.fillColor)&&this.width&&this.width);a||(this.Tb=a)}Ib(this)}r("H.map.ArrowStyle",Ig);Ig.prototype.Tb=!0;Qa(Ig.prototype,{fillColor:"rgba(255,255,255,.75)",width:1.2,length:1.6,frequency:5});
Ig.prototype.ca=function(a){var b=this===a;!b&&a&&(b=a.width===this.width&&a.fillColor===this.fillColor&&a.length===this.length&&a.frequency===this.frequency);return b};Ig.prototype.equals=Ig.prototype.ca;function Jg(a,b){var c;Jg.l.constructor.call(this,b);b&&this.ke(b.style);a&&(this.g=!0);b&&(c=b.arrows)&&this.$k(c)}u(Jg,K);r("H.map.Spatial",Jg);Jg.prototype.type=xg.SPATIAL;Jg.prototype.Bg=0;Jg.prototype.style=Gg;Jg.prototype.Ta=function(){return this.style};Jg.prototype.getStyle=Jg.prototype.Ta;Jg.prototype.ke=function(a){var b=!0;a?this.style=B(a,Bg)?a:new Bg(a):this.style?delete this.style:b=!1;b&&this.invalidate(ug.VISUAL);return this};Jg.prototype.setStyle=Jg.prototype.ke;
Jg.prototype.jm=function(){return this.f};Jg.prototype.getArrows=Jg.prototype.jm;Jg.prototype.$k=function(a){var b=this.f,c=!1;!a&&b?(delete this.f,c=!0):!a||b&&b.ca(a)||(this.f=new Ig(a),c=!0);c&&"none"!==this.style.strokeColor&&this.Ga(1);return this};Jg.prototype.setArrows=Jg.prototype.$k;function Kg(a,b){var c=!1,d=!1,e;if(b.length){for(c=0;c<b.length;c++)if(b[c]!==Lg){d=!0;break}b=a.style;c=d?b.Se||b.Tb&&a.g||(e=a.f||!1)&&b.Re&&e.Tb:b.Tb}return c&&a.Ac(!0)}Jg.prototype.g=!1;Jg.prototype.An=function(){return this.g};
Jg.prototype.isClosed=Jg.prototype.An;Jg.prototype.getGeometriesForTile=Jg.prototype.Od;Jg.prototype.sh=function(){return x};Jg.prototype.getLabels=Jg.prototype.sh;function Mg(a,b){Mg.l.constructor.call(this,a,b)}u(Mg,Jg);r("H.map.GeoShape",Mg);Mg.prototype.getBoundingBox=Mg.prototype.F;function Ng(a,b,c,d){var e=[],f=b.length,g;for(g=0;g<f;g++){var h=b[g];h.length&&e.push(Og(a,h,c,d))}return e}function Og(a,b,c,d){var e,f=[],g=b.length,h=0;a.L=0;for(e=e||0;h<g;)f.push(Pg(a,b[h++],b[h++],e,d));c&&f.push(Pg(a,b[0],b[1],e,d));return f}function Pg(a,b,c,d,e){var f=a.L;f&&180<Nc(f-c)&&(c+=0>f?-360:360);a.L=c;return e.Jh(b,c+d)}
function Qg(a,b,c){for(var d=b,e,f=a.length+b,g,h;d--;){b=a[d];g=b.length;for(e=Array(g);g--;)h=b[g],e[g]=new G(h.x+c,h.y);a[--f]=e}}var Rg=new J([0,0,0,0,0,0,0,0,0]);function Sg(a){Nb(this,Sg);Sg.l.constructor.call(this);this.qa=Tg(this,a,this.constructor,0)}u(Sg,Hf);r("H.geo.MultiGeometry",Sg);Sg.prototype.splice=function(a,b,c){a=[a];b!==A&&a.push(b);c&&(b=Tg(this,c,this.splice,2),a=a.concat(b));this.N=x;return this.qa.splice.apply(this.qa,a)};Sg.prototype.splice=Sg.prototype.splice;Sg.prototype.nc=function(a){var b=this.qa.length;if(!(0<=a&&a<b))throw new vd(this.nc,a,[0,b-1]);this.N=x;return this.qa.splice(a,1)[0]};Sg.prototype.removeAt=Sg.prototype.nc;
Sg.prototype.remove=function(a){a=this.qa.indexOf(a);if(0<=a){var b=this.qa.splice(a,1)[0];this.N=x}return b||x};Sg.prototype.remove=Sg.prototype.remove;Sg.prototype.Bm=function(){return this.qa};Sg.prototype.getGeometries=Sg.prototype.Bm;Sg.prototype.push=function(a){var b=Tg(this,[a],this.push,0)[0];this.N&&(this.N=this.N.lc(a.F()));this.qa.push(b)};Sg.prototype.push=Sg.prototype.push;
Sg.prototype.F=function(){var a;if(!(a=this.N)){a=x;var b,c;if(this.qa.length)for(a=this.qa[0].F(),c=1;c<this.qa.length;c++)if(b=this.qa[c].F())a=a?a.lc(b):b}return this.N=a};Sg.prototype.getBoundingBox=Sg.prototype.F;Sg.prototype.N=x;function Tg(a,b,c,d){var e,f=[];if(!Rb(b))throw new C(c,d);for(e=0;e<b.length;e++)if(a.a(b[e]))f.push(a.b(b[e]));else throw new C(c,d);return f}Sg.prototype.b=function(a){return a};
Sg.prototype.ca=function(a){var b=this===a,c;if(!b&&(b=B(a,this.constructor))){var d=this.qa;a=a.qa;for(b=(c=d.length)===a.length;b&&c--;)b=d[c].ca(a[c])}return b};Sg.prototype.equals=Sg.prototype.ca;Sg.prototype.Pc=function(a){var b=this.qa,c=b.length,d,e,f=!1;if(c){a.push("(");for(d=0;d<c;d++)(e=0<d&&f)&&a.push(","),b[d].Pc(a),"EMPTY"===a[a.length-1]?a.splice(-1-e,1+e):f=!0;f?a.push(")"):a.splice(-1,1,"EMPTY")}else a.push("EMPTY");return a};
Sg.prototype.toString=function(){return this.Pc([this.lb.toUpperCase()," "]).join("")};Sg.prototype.vc=function(){for(var a=[],b=this.qa,c=b.length;c--;)a[c]=b[c].vc();return a};Sg.prototype.W=function(){var a=Sg.l.W.call(this);a.type=this.lb;return a};function Ug(a){Ug.l.constructor.call(this,a)}u(Ug,Sg);r("H.geo.MultiLineString",Ug);Ug.prototype.a=function(a){return B(a,J)};Ug.prototype.lb="Multi"+J.prototype.lb;function Vg(a,b){Vg.l.constructor.call(this,!1,b);this.ea(a)}u(Vg,Mg);r("H.map.Polyline",Vg);Vg.prototype.F=function(){return this.bb.F()};Vg.prototype.getBoundingBox=Vg.prototype.F;Vg.prototype.bb=x;Vg.prototype.ea=function(a){var b=this.ea,c,d;if(B(a,Ug)){var e=a.qa;if(c=e.length)for(d=0;d<c;d++)Wg(e[d],b);else throw new C(b,0);}else Wg(a,b);this.pd=!!e;this.bb=a;this.Ga(ug.SPATIAL);return this};Vg.prototype.setGeometry=Vg.prototype.ea;Vg.prototype.ia=function(){return this.bb};
Vg.prototype.getGeometry=Vg.prototype.ia;Vg.prototype.clip=function(a){var b=this.bb;return rg(this.pd?b.qa[0]:b,a)};Vg.prototype.clip=Vg.prototype.clip;Vg.prototype.Od=function(a){var b=this.bb;var c,d=[];if(this.pd)for(b=b.qa,c=b.length;c--;)Xg(this,b[c],a,d);else Xg(this,b,a,d);return d.length?d:A};Vg.prototype.getGeometriesForTile=Vg.prototype.Od;function Wg(a,b){if(!B(a,J)||2>a.Oe())throw new C(b,0);}
function Xg(a,b,c,d){var e=rg(b,c.Lf());if(e.length&&(b=c.Nf(),a=Ng(a,e,!1,b),e=a.length)){var f=c.Qe();b=b.w;c.x||Qg(a,e,-b);c.x===(1<<c.z)-1&&Qg(a,e,b);c=Yg(a,f.left,f.top,f.right,f.bottom,!1);c.length&&d.push(new Zg(c))}}Vg.prototype.W=function(){var a=Vg.l.W.call(this);a.geometry=this.ia().W();a.properties.style=this.Ta().W();return a};Vg.prototype.forWorkerMessage=Vg.prototype.W;function M(a,b){var c;M.l.constructor.call(this);B(a,J,M,0);if(b!==A&&Rb(b,M,1)){for(c=0;c<b.length;c++)B(b[c],J,M,1,"index "+c);this.eb=b}else this.eb=[];this.gc=a;this.a=[]}u(M,Hf);r("H.geo.Polygon",M);function $g(a){var b=M,c=J,d=a.la,e=a.aa,f=a.ha,g=a.da;e=[d,e,A,d,g,A,f,g,A,f,e,A];180<=a.Cb()&&(e.splice(9,0,f,a=a.jb().lng,A),e.splice(3,0,d,a,A));return new b(new c(e))}var ah={NORTH:90,SOUTH:-90};M.Direction=ah;M.prototype.rd=ah.NORTH;
M.prototype.hl=function(a){this.rd!==a&&(this.N=x,this.a.length=0,this.rd=a);return this};M.prototype.setPoleCovering=M.prototype.hl;M.prototype.Ym=function(){return this.rd};M.prototype.getPoleCovering=M.prototype.Ym;M.prototype.wm=function(){return this.gc};M.prototype.getExterior=M.prototype.wm;M.prototype.dl=function(a){if(!B(a,J))throw new C(this.dl,0,a);this.gc=a;this.N=x};M.prototype.setExterior=M.prototype.dl;M.prototype.Fm=function(){return this.eb};M.prototype.getInteriors=M.prototype.Fm;
M.prototype.wg=function(a,b,c){var d=arguments.length,e;for(e=2;e<d;e++)B(arguments[e],J,this.wg,e);var f=this.eb.splice.apply(this.eb,arguments);for(e=2;e<d;e++)arguments[e]=A;this.a.splice.apply(this.a,arguments);return f};M.prototype.spliceInteriors=M.prototype.wg;M.prototype.ko=function(a){return this.wg(a,1)[0]};M.prototype.removeInteriorAt=M.prototype.ko;M.prototype.jo=function(a){a=this.eb.indexOf(a);return 0>a?A:this.wg(a,1)[0]};M.prototype.removeInterior=M.prototype.jo;
M.prototype.Ok=function(a){if(!B(a,J))throw new C(this.Ok,0,a);this.eb.push(a)};M.prototype.pushInterior=M.prototype.Ok;M.prototype.F=function(){var a=this.N;a||(this.N=a=bh(this.gc,this.rd));return a};M.prototype.getBoundingBox=M.prototype.F;n=M.prototype;n.Jj=function(a){var b=this.eb.length;if(0>a||a>=b)throw new vd(this.Jj,a,[0,b-1]);(b=this.a[a])||(this.a[a]=b=bh(this.eb[a],this.rd));return b};n.gc=x;n.eb=[];
function bh(a,b){var c,d,e;if(e=a.F())(c=a.oh(!0))&&(d=a.Oe())&&(e=e.lc(Pf([a.Fe(0),a.Fe(d-1)],!0),!0)),360===e.Cb()&&1===c%2&&(e=e.cd(b,0));return e}n.lb="Polygon";n.Pc=function(a){var b=this.eb,c=b.length,d;if(this.gc.Oe()){a.push("(");this.gc.Pc(a);for(d=0;d<c;d++)b[d].Oe()&&(a.push(","),b[d].Pc(a));a.push(")")}else a.push("EMPTY");return a};n.W=function(){var a=M.l.W.call(this);this.F().Db()&&(a.type="Multi"+a.type);return a};
n.vc=function(){var a=[],b=this.eb,c=b.length;for(a.push(this.gc.vc());c--;)a[c+1]=b[c].vc();return this.F().Db()?[a]:a};n.ca=function(a){var b=a.eb,c=this.eb.length,d=b.length;a=this.gc.ca(a.gc)&&c===d;for(d=0;a&&d<c;)a=a&&this.eb[d].ca(b[d]),d++;return a};function ch(a){ch.l.constructor.call(this,a)}u(ch,Sg);r("H.geo.MultiPolygon",ch);ch.prototype.a=function(a){return B(a,M)};ch.prototype.lb="Multi"+M.prototype.lb;function Zg(a,b,c){this.paths=this.a=a;b!==A&&(this.interiorsIndex=this.b=b);c!==A&&(this.outlinesIndex=this.c=c)}Zg.prototype.interiorsIndex=Zg.prototype.b=gd;Zg.prototype.outlinesIndex=Zg.prototype.c=gd;var Lg=Jb(new Zg([])),dh=Ib([]);function eh(a,b){eh.l.constructor.call(this,!0,b);b&&b.extrude&&(b=b.extrude,this.$=b>fh?fh:b);B(a,J)?this.ea(new M(a)):this.ea(a)}u(eh,Mg);r("H.map.Polygon",eh);eh.prototype.bb=x;var fh=2047;eh.MAX_EXTRUDE_HEIGHT=fh;eh.prototype.ia=function(){return this.bb};eh.prototype.getGeometry=eh.prototype.ia;eh.prototype.ea=function(a){if(a===x||B(a,M))var b=!1;else B(a,ch,this.ea,0),b=!0;this.pd=b;b=this.bb;this.bb=a;b!==x&&this.Ga(ug.SPATIAL);return this};eh.prototype.setGeometry=eh.prototype.ea;
eh.prototype.F=function(){return this.ia().F()};eh.prototype.getBoundingBox=eh.prototype.F;eh.prototype.Od=function(a){var b,c=this.ia(),d,e;if(this.pd){c=c.qa;var f=0;for(e=c.length;f<e;f++)if(d=gh(this,c[f],a,c[f].rd))b||(b=[]),b.push(d)}else d=this.na,d===A&&(d=this.pd?ah.NORTH:this.ia().rd),(d=gh(this,c,a,d))&&(b=[d]);return b};eh.prototype.getGeometriesForTile=eh.prototype.Od;
function gh(a,b,c,d){var e,f,g=0,h=!0;if(e=hh(a,b.gc,c,d,b.F())){var k=new Zg(e);var l=b.eb;if(f=l.length)for(k.b=k.a.length;g<f;g++)if(e=hh(a,l[g],c,d,b.Jj(g)))k.a=k.a.concat(e);f=k.a.length;for(g=0;g<f;g++)if(k.a[g]!==dh){h=!1;break}h&&(k=g%2?Lg:A)}return k}
function hh(a,b,c,d,e){var f=c.Qe(),g=e,h=g.Cb();var k=[[]];var l=b.ma;var m=[],p=l.length,q,t=!1;for(q=0;q<p;q+=3){var v=l[q];var y=l[q+1];t||180!=Nc(y)||(m.push(v),m.push(y),m.push(v),m.push(-y),t=!0);m.push(v);m.push(y)}l=m;360>h&&-180==g.aa&&(g=new I(g.la,180,g.ha,g.da));360>h&&180==g.da&&(g=new I(g.la,g.aa,g.ha,-180));if(g.Db()){h=l;v=h.length;l=-1;for(m=0;m<v-2;m+=2)if(Gf(h[m+1],h[m+3])){l=m+2;break}-1===l&&Gf(h[v-1],h[1])&&(l=v);-1!==l&&(p=h[l-2],m=h[l-1],q=h[l%v],t=h[(l+1)%v],180!==Nc(p)&&
180!==Nc(q)&&(y=Nc(q-p),v=Nc(t-m),v+=180<v?-360:0,t=Nc(180-t),t+=180<t?-360:0,v&&t&&(y/=Nc(v)/Nc(t),p=q+(q>p?-y:y),m=0<m?180:-180,h.splice(l,0,p,m,p,-m))));l=h}k[0]=ih([].concat(l),g.aa);360>g.Cb()&&g.Hd(new H(g.la,180))&&(l=ih([].concat(l),g.da),k.push(l));g=c.Nf();a=Ng(a,k,!0,g);if(360===e.Cb()&&1===b.oh(!0)%2){b=a;a=c.Qe();b[0][1].x>b[0][b[0].length-1].x&&(b[0]=b[0].reverse());l=[];h=b[0].length-1;for(k=0;k<h;k++)m=b[0][k],l[k]=new G(m.x-2*g.w,m.y),l[k+h]=new G(m.x-g.w,m.y),l[k+2*h]=new G(m.x,
m.y),l[k+3*h]=new G(m.x+g.w,m.y),l[k+4*h]=new G(m.x+2*g.w,m.y);b[0]=l;k=g.Jh(d,0);k.y=2*a[d===ah.NORTH?"top":"bottom"];d=k.clone();k.x=b[0][b[0].length-1].x+1;d.x=b[0][0].x-1;b[0].push(k,d);a=b}d=f.left;b=f.top;k=f.right;f=f.bottom;if(Yg(a,d,b,k,f,!0).length){if(!c.Lf().Wg(e)){c=a;e=[new G(d,b),new G(k,b),new G(k,f),new G(d,f)];f=[];for(a=c.length;a--;)if(d=jh(e,c[a]))for(b=kh(d),f.push(b);d.bi;)d=d.bi,b=kh(d),f.push(b);a=f}}else c=lh(d,b,a[0]),a[1]&&(c^=lh(d,b,a[1])),a=c?[dh]:A;return a}
function lh(a,b,c){var d,e,f;var g=d=c[0].x;var h=e=c[0].y;var k=1;for(f=c.length;k<f;k++){var l=c[k].x;var m=c[k].y;l>d?d=l:l<g&&(g=l);m>e?e=m:m<h&&(h=m)}return g<=a&&a<=d&&h<=b&&b<=e&&mh({x:a,y:b},c.concat(c[0]))}function kh(a){var b=[],c=a;do{var d=Kc(100*(c.$n?c.$n:c.x))/100;var e=Kc(100*(c.ao?c.ao:c.y))/100;if(!f||.01<Pc(Rc(f.x-d,2)+Rc(f.y-e,2))){var f=new G(d,e);b.push(f)}c=c.next}while(c&&c!==a);return b}eh.prototype.A=x;
function ih(a,b){var c,d=Number.POSITIVE_INFINITY,e=-1,f=a.length;for(c=0;c<f;c+=2){var g=Nc(a[c+1]-b);g+=180<g?360-g:g;g<d&&(d=g,e=c)}return 0<c?(b=a.splice(e,a.length-e),b.concat(a)):a}
eh.prototype.W=function(){var a=eh.l.W.call(this),b=this.ia();b=this.pd?b.qa:[b];var c;a.geometry=this.ia().W();a.properties.style=this.Ta().W();this.$&&(a.properties.extrude=this.$);if(this.F().Db()&&(a.geometry.type="MultiPolygon",this.pd)){var d=[];b.forEach(function(b,f){c=a.geometry.coordinates[f];b.F().Db()?d=d.concat(c):d.push(c)});a.geometry.coordinates=d}return a};eh.prototype.forWorkerMessage=eh.prototype.W;function nh(a,b,c){nh.l.constructor.call(this,Rg,c);this.tg(a);this.Fi(b);c&&"precision"in c&&this.Ei(c.precision)}u(nh,eh);r("H.map.Circle",nh);nh.prototype.tg=function(a){(a=Jf(a)).ca(this.b)||(this.b=a,oh(this))};nh.prototype.setCenter=nh.prototype.tg;nh.prototype.jb=function(){return this.b};nh.prototype.getCenter=nh.prototype.jb;nh.prototype.Fi=function(a){if(D(a=ld(a,0,6371000.79*$c/2)))throw new C(this.Fi,0,a);this.I!==a&&(this.I=a,oh(this))};nh.prototype.setRadius=nh.prototype.Fi;
nh.prototype.dn=function(){return this.I};nh.prototype.getRadius=nh.prototype.dn;nh.prototype.u=60;nh.prototype.Ei=function(a){if(!Vb(a))throw new C(this.Ei,0,a);this.u!==(a=ld(Kc(a),4,360))&&(this.u=a,oh(this))};nh.prototype.setPrecision=nh.prototype.Ei;nh.prototype.$m=function(){return this.u};nh.prototype.getPrecision=nh.prototype.$m;nh.prototype.ea=function(){return this};nh.prototype.setGeometry=nh.prototype.ea;nh.prototype.ia=function(){this.bb||nh.l.ea.call(this,ph(this));return this.bb};
nh.prototype.getGeometry=nh.prototype.ia;function oh(a){a.bb!==x&&nh.l.ea.call(a,ph(a))}function ph(a){var b=a.b,c=b.lat,d=a.I,e=0,f=new J;if(90===Nc(c))for(c=b.zg(0,d,!0).lat;360>e;e+=120)f.ri(c,e-180,A);else for(a=a.u,a=360/a;360>e;e+=a)f.ud(b.zg(e,d,!0));b=new M(f);0>c&&b.hl(ah.SOUTH);return b};function qh(a,b){if(!B(a,Element)){rh.innerHTML=a;a=rh.firstElementChild;if(!a)throw new C(qh,0,"No element data");rh.removeChild(a);var c=!0;rh.innerHTML=""}this.a=0!==Ue(a).length;this.c=c?a:Ve(a,w.document,this.a);b&&(c="onAttach",c in b&&Pb(a=b[c],"Function",qh,1,c)&&(this.ci=a),c="onDetach",c in b&&Pb(a=b[c],"Function",qh,1,c)&&(this.b=a))}r("H.map.DomIcon",qh);var rh=document.createElement("DIV");qh.prototype.ci=null;qh.prototype.b=null;qh.prototype.a=!1;function sh(a){sh.l.constructor.call(this,a)}u(sh,Sg);r("H.geo.MultiPoint",sh);sh.prototype.a=function(a){return If(a)};sh.prototype.b=function(a){return B(a,H)?a:Jf(a)};sh.prototype.lb="Multi"+H.prototype.lb;function th(a,b){this.w=+a;this.h=+b}r("H.math.Size",th);function uh(a,b){var c;var d=a;var e=b||[];if(a!==vh.NONE){b=c=e.length;if(-1===this.b.indexOf(d))throw new C(uh,0,a);if(!e)throw new C(uh,1,e);for(;c--;)if(D(e[c]))throw new C(uh,1,e);d===vh.RECT&&3<b&&(e=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]],d=vh.POLYGON);if(d===vh.CIRCLE&&2<b&&(a=e[2],0<a)){d=e[0];var f=e[1];c=Ic(2*Mc(a),40);var g=360/c;for(e=[];c--;){var h=g*c*ed;e.push(d+Tc(h)*a,f+Vc(h)*a)}d=vh.POLYGON}if(d!==vh.POLYGON||!b||e.length%2)throw new C(uh,1,e);this.a=e}}
r("H.map.HitArea",uh);var vh={NONE:0,RECT:1,CIRCLE:2,POLYGON:3};uh.ShapeType=vh;uh.prototype.b=[vh.RECT,vh.CIRCLE,vh.POLYGON];uh.prototype.Qf=function(a,b,c){return this.a?pd(a,b,this.a,c,!0):od.NONE};uh.prototype.hitTest=uh.prototype.Qf;function wh(a,b){var c;Nb(this,wh);wh.l.constructor.call(this,b);this.ea(a);b&&"icon"in b&&(c=b.icon);this.fd(c||xh(this))}u(wh,K);r("H.map.AbstractMarker",wh);wh.prototype.ia=function(){return this.b};wh.prototype.getGeometry=wh.prototype.ia;wh.prototype.ea=function(a){var b=this.b;B(a,H)||B(a,sh)?this.b=a:(If(a,this.ea,0),this.b=Jf(a));b&&this.Ga(ug.SPATIAL);return this};wh.prototype.setGeometry=wh.prototype.ea;wh.prototype.F=function(){return this.b.F()};wh.prototype.yb=function(){return this.icon};
wh.prototype.getIcon=wh.prototype.yb;wh.prototype.fd=function(a){var b=this.icon,c=!b;if(b!==a){if(!this.dk(a))throw C.apply(b=new C,c?[this.constructor,1,"icon"]:[this.ea,0,a]),b;this.icon=a;c||this.Ga(ug.VISUAL)}return this};wh.prototype.setIcon=wh.prototype.fd;function xh(a){var b=a.g;b||(b=a.constructor.prototype.g=a.f(yh));return b}
var yh={svg:'<svg xmlns="http://www.w3.org/2000/svg" width="38" height="47" viewBox="0 0 38 47"><g fill="none"><path fill="#0F1621" fill-opacity=".4" d="M15 46c0 .317 1.79.574 4 .574s4-.257 4-.574c0-.317-1.79-.574-4-.574s-4 .257-4 .574z"></path><path fill="#01b6b2" d="M33.25 31.652A19.015 19.015 0 0 0 38 19.06C38 8.549 29.478 0 19 0S0 8.55 0 19.059c0 4.823 1.795 9.233 4.75 12.593L18.975 46 33.25 31.652z"></path><path fill="#6A6D74" fill-opacity=".5" d="M26.862 37.5l4.714-4.77c3.822-3.576 5.924-8.411 5.924-13.62C37.5 8.847 29.2.5 19 .5S.5 8.848.5 19.11c0 5.209 2.102 10.044 5.919 13.614l4.719 4.776h15.724zM19 0c10.493 0 19 8.525 19 19.041 0 5.507-2.348 10.454-6.079 13.932L19 46 6.079 32.973C2.348 29.495 0 24.548 0 19.04 0 8.525 8.507 0 19 0z"></path></g></svg>',size:new th(38,
47),anchor:new G(19,45),hitArea:new uh(3,[19,46,2,27,0,18,5,6,19,0,32,5,38,15,36,27,19,47])};wh.prototype.W=function(){var a=wh.l.W.call(this),b=this.yb(),c=b.Bb(),d=b.ld();a.geometry=this.ia().W();c&&(b=a.properties.icon={id:b.uid},b.size={w:c.w,h:c.h},b.offset=[c.w/2-(d?d.x:0),c.h/2-(d?d.y:0)]);return a};wh.prototype.forWorkerMessage=wh.prototype.W;function zh(a,b){zh.l.constructor.call(this,a,b)}u(zh,wh);r("H.map.DomMarker",zh);zh.prototype.type=xg.DOM_MARKER;zh.prototype.Bg=2;zh.prototype.f=function(a){var b=new qh(a.svg,a);a=a.anchor;b.c.style.margin=-a.y+"px 0 0 -"+a.x+"px";return b};zh.prototype.dk=function(a){return B(a,qh)};function Ah(a,b,c,d){Ah.l.constructor.call(this,a,b,c);this.modifiers=d}u(Ah,vg);r("H.map.ChangeEvent",Ah);Ah.prototype.Gl=1;Ah.prototype.SIZE=Ah.prototype.Gl;Ah.prototype.dc=2;Ah.prototype.POSITION=Ah.prototype.dc;Ah.prototype.rc=4;Ah.prototype.HEADING=Ah.prototype.rc;Ah.prototype.ec=8;Ah.prototype.TILT=Ah.prototype.ec;Ah.prototype.qe=16;Ah.prototype.INCLINE=Ah.prototype.qe;Ah.prototype.Rc=32;Ah.prototype.ZOOM=Ah.prototype.Rc;Ah.prototype.Bd=64;Ah.prototype.BOUNDS=Ah.prototype.Bd;function Bh(){this.a=[];Bh.l.constructor.call(this)}u(Bh,F);r("H.util.OList",Bh);function Ch(a,b,c){a=a.a.length;if(c)var d=a;else if(D(d=0>(d=+b)?Jc(0,a+d):Ic(a,d)))throw new vd(Bh,b,[0,a-1]);return d}Bh.prototype.add=function(a,b){b=Ch(this,b,D(b));this.a.splice(b,0,a);this.dispatchEvent(new Dh(this,this.b.ne,b,a,null,null))};Bh.prototype.add=Bh.prototype.add;function Eh(a,b){var c=a.a.splice(b,1)[0];a.dispatchEvent(new Dh(a,a.b.re,b,null,c,null));return c}
Bh.prototype.nc=function(a){this.get(a);return Eh(this,a)};Bh.prototype.removeAt=Bh.prototype.nc;Bh.prototype.remove=function(a){a=this.indexOf(a);return 0<=a?(Eh(this,a),!0):!1};Bh.prototype.remove=Bh.prototype.remove;Bh.prototype.set=function(a,b){this.get(a);a=Ch(this,a,!1);var c=this.a[a];this.a[a]=b;this.dispatchEvent(new Dh(this,this.b.se,a,b,c,null));return c};Bh.prototype.set=Bh.prototype.set;Bh.prototype.indexOf=function(a){return this.a.indexOf(a)};Bh.prototype.indexOf=Bh.prototype.indexOf;
Bh.prototype.get=function(a){var b=Ch(this,a,!1),c=this.a;if(b>=c.length)throw new vd(this.get,a,[0,c.length-1]);return c[b]};Bh.prototype.get=Bh.prototype.get;Bh.prototype.Lm=function(){return this.a.length};Bh.prototype.getLength=Bh.prototype.Lm;Bh.prototype.$a=function(){return[].concat(this.a)};Bh.prototype.asArray=Bh.prototype.$a;Bh.prototype.flush=function(){for(var a=this.a.length;a--;)Eh(this,a)};Bh.prototype.flush=Bh.prototype.flush;Bh.prototype.s=function(){this.flush();Bh.l.s.call(this)};
Bh.prototype.b={ne:"add",re:"remove",se:"set",No:"move"};function Dh(a,b,c,d,e,f){Dh.l.constructor.call(this,b,a);this.idx=c;this.added=d;this.removed=e;this.moved=f}u(Dh,Ec);var Fh={};r("H.geo.mercator",Fh);Fh.a=function(a){return Ic(1,Jc(0,.5-Oc(Wc(bd+ad*a/180))/$c/2))};Fh.b=function(a){return a/360+.5};Fh.Vf=function(a,b,c){c?(c.x=Fh.b(b),c.y=Fh.a(a)):c=new G(Fh.b(b),Fh.a(a));return c};Fh.latLngToPoint=Fh.Vf;Fh.Nb=function(a,b){return Fh.Vf(a.lat,a.lng,b)};Fh.geoToPoint=Fh.Nb;Fh.f=function(a){return 0>=a?90:1<=a?-90:fd*(2*Xc(Sc($c*(1-2*a)))-ad)};Fh.c=function(a){return 360*(1===a?1:jd(a,1))-180};
Fh.Na=function(a,b,c){c?(c.lat=Fh.f(b),c.lng=Fh.c(a)):c=new H(Fh.f(b),Fh.c(a));return c};Fh.xyToGeo=Fh.Na;Fh.eg=function(a,b){return Fh.Na(a.x,a.y,b)};Fh.pointToGeo=Fh.eg;r("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0);r("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);function Gh(a,b){this.projection=a||Fh;this.b=0;this.a=this.exp=Oc(b||256)/Zc;Hh(this);this.y=this.x=0}r("H.geo.PixelProjection",Gh);var Ih=Nc(24)+Nc(-8);Gh.prototype.Ba=function(a){if(D(a))throw new C(this.Ba,0,a);var b=this.x/this.w;var c=this.y/this.h;this.b=a;this.a=this.exp+a;Hh(this);this.x=b*this.w;this.y=c*this.h};Gh.prototype.rescale=Gh.prototype.Ba;function Hh(a){a.a>Ih&&(a.a=Ih);a.w=Rc(2,a.a);a.h=Rc(2,a.a)}Gh.prototype.Uj=function(){return this.b||0};Gh.prototype.getZoomScale=Gh.prototype.Uj;
Gh.prototype.ib=function(a,b){a=this.projection.Vf(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Gh.prototype.geoToPixel=Gh.prototype.ib;Gh.prototype.$e=function(a,b){return this.projection.Na((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};Gh.prototype.pixelToGeo=Gh.prototype.$e;Gh.prototype.Na=function(a,b,c){return this.projection.Na((a+this.x)/this.w,(b+this.y)/this.h,c)};Gh.prototype.xyToGeo=Gh.prototype.Na;
Gh.prototype.Jh=function(a,b,c){a=this.projection.Vf(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Gh.prototype.latLngToPixel=Gh.prototype.Jh;Gh.prototype.dd=function(a){return new G(a.x*this.w-this.x,a.y*this.h-this.y)};Gh.prototype.pointToPixel=Gh.prototype.dd;var Jh;function Kh(a,b){if(w.URL)return(new w.URL(a,b)).toString();if(!a||!Lh(a))return a;if(!b||Lh(b))throw new TypeError("Failed to construct 'URL': Invalid base URL");Jh||(Jh=document.createElement("a"),Yb(Jh));var c=Jh;c.href=b;"/"!==a[0]?a=c.href.replace(/\/[^\/]*$/,"/")+a:((b=c.origin)||(b=c.protocol+"//"+c.host),a=b+a);return a}function Lh(a){var b=!1;"string"===typeof a&&(b=!(-1<a.search(/^(http|https|data|blob):/)||"//"===a.substr(0,2)));return b};function Mh(a){return w.H.gl.yaml.safeLoad(a,{json:!0})}function Nh(a,b){var c,d=arguments.length,e,f;for(c=1;c<d;c++)if((e=arguments[c])&&e!==a&&e!==g){var g=e;for(f in e){var h=e[f];a[f]!==h&&(h&&h[Lb[1]]===w.Object?a[f]=a[f]&&a[f][Lb[1]]===w.Object?Nh(a[f],h):Oa(h):void 0!==h&&(a[f]=Oa(h)))}}return a}var Oh=Gb();function Ph(a,b,c){var d=c[a];return b&&d in b&&0>Lb.indexOf(d)?(b=b[d],++a<c.length?Ph(a,b,c):b):Oh}
var Qh=Ph.bind(null,0),Rh={polygons:1,lines:1,"pattern-lines":1,points:1,text:1,raster:1,custom_icons:1,overlays:1},Sh={data:1,draw:1,enabled:1,filter:1,properties:1},Th=Object.keys(Sh);function Uh(a,b,c,d,e,f){var g=d[a],h=c[g];if(++a<d.length){var k=b[g]||{};for(c=Th.length;c--;){var l=Th[c];if("draw"!==l||!f){var m=h[l];m!==A&&(k[l]=Oa(m))}}Uh(a,k,h,d,e,f)}else e?k=Oa(h):(k=h,delete c[g]);b[g]=b[g]?Nh(b[g],k):k}var Vh=Uh.bind(null,0);function Wh(a,b){a in Rh&&(b[a]=1)}
function Xh(a,b,c){var d,e,f;for(d in a)if(Sh[d]){if("draw"===d){var g=a[d];for(e in g){var h=g[e];(f=h.style)?(h.style=b+f,Wh(f,c)):(delete g[e],g[b+e]=h,Wh(e,c))}}}else Xh(a[d],b,c)}
function Yh(a,b){var c={},d,e,f,g;b+="_";a=Nh({},a);if(d=a.styles)for(e in d){var h=d[e];delete d[e];d[b+e]=h;if(f=h.mix)for(ra(f)&&(f=[f]),g=f.length;g--;)Wh(f[g],c),f[g]=b+f[g];if(g=h.base)f||(f=h.mix=[]),f.unshift(b+g),delete h.base,Wh(g,c);Wh(e,c)}else d=a.styles={};if(h=a.layers)for(e in h)f=h[e],delete h[e],(g=f.data)&&!g.layer&&(g.layer=e),h[b+e]=f,Xh(f,b,c);for(e in c)d[b+e]={base:e};return a}
function Zh(a,b){var c=a.sources,d=Object.keys(c)[0],e=Nh(c[d],{uid:b});c=a.layers;var f;a.sources={};a.sources[b]=e;for(f in c)a=c[f],a.data?a.data.source===d&&(a.data.source=b):a.data={source:b}}function ci(a,b){var c;var d=a.textures;var e=a.fonts;for(c in d){var f=d[c];f.url&&(f.url=Kh(f.url,b))}for(c in e)if(d=e[c],Rb(d))for(f=0;f<d.length;f++){var g=d[f];g.url=g.url&&Kh(g.url,b)}else g=a.fonts[c],g.url=g.url&&Kh(g.url,b)}
function di(a,b){return"function(){return "+("feature."+a+(b||""))+";}"}function ei(a){return di("style."+a,void 0)}function fi(a,b,c){return{base:a,blend:b,blend_order:c}}function gi(a,b,c,d){a={data:{source:a,layer:b}};c&&(a.draw=c);d&&(a.filter=d);return a};function hi(a){a=a||{};hi.l.constructor.call(this);this.min=0;this.max=22;this.Wl=!!a.dark;a.min&&this.Bi(a.min);a.max&&this.zi(a.max);this.pixelProjection=new Gh(a.projection,a.minWorldSize);a.provider&&(this.a=a.provider,this.g=z(this.g,this),this.a.addEventListener(ii.prototype.i.Ca,this.g,!1,this),this.i=z(this.i,this),this.a.addEventListener(ii.prototype.i.oe,this.i,!1,this))}u(hi,F);r("H.map.layer.Layer",hi);hi.prototype.b={Ca:"update",oe:"configchange",bj:"minchange",aj:"maxchange"};
hi.prototype.ya=function(){return this.a};hi.prototype.getProvider=hi.prototype.ya;hi.prototype.Bn=function(a){return this.min<=a&&a<=this.max};hi.prototype.isValid=hi.prototype.Bn;function ji(a,b,c){var d=a[b],e="min"===b,f=e?a.Bi:a.zi;if(c!==d)if(e?c<=a.max:c>=a.min)a[b]=c,a.g(),a.i(),a.dispatchEvent(new vg(e?a.b.bj:a.b.aj,c,d));else throw new C(f,0,"Invalid condition min <= max");return a}hi.prototype.Bi=function(a){return ji(this,"min",+a)};hi.prototype.setMin=hi.prototype.Bi;
hi.prototype.zi=function(a){return ji(this,"max",+a)};hi.prototype.setMax=hi.prototype.zi;hi.prototype.g=function(){this.dispatchEvent(this.b.Ca)};hi.prototype.i=function(){this.dispatchEvent(this.b.oe)};hi.prototype.s=function(){hi.l.s.call(this)};hi.prototype.va=function(){return null};hi.prototype.getCopyrights=hi.prototype.va;function ki(a){var b;ki.l.constructor.call(this);this.dispatchEvent=z(this.dispatchEvent,this);if(a){var c=a.length;for(b=0;b<c;b++)this.add(a[b])}}u(ki,Bh);r("H.map.DataModel",ki);function li(a,b){var c=b.getProvider&&b.getProvider();c&&(mi[c.uid]=c);b.ba(a)}function ni(a){var b=a.getProvider&&a.getProvider();b&&delete mi[b.uid];a.ba(null)}ki.prototype.add=function(a,b){B(a,hi,this.add,0);li(this,a);ki.l.add.call(this,a,b)};ki.prototype.add=ki.prototype.add;
ki.prototype.set=function(a,b){B(b,hi,this.set,0);li(this,b);a=ki.l.set.call(this,a,b);ni(a);return a};ki.prototype.set=ki.prototype.set;ki.prototype.nc=function(a){var b;(b=ki.l.nc.call(this,a))&&ni(b);return b};ki.prototype.removeAt=ki.prototype.nc;ki.prototype.remove=function(a){var b;(b=ki.l.remove.call(this,a))&&ni(a);return b};ki.prototype.remove=ki.prototype.remove;ki.prototype.flush=function(){for(var a=this.a.length;a--;)this.nc(a);ki.l.flush.call(this)};ki.prototype.flush=ki.prototype.flush;
var mi={};Yb(mi);function oi(a,b,c){if(a=mi[a])return B(a[b],Function,oi,1,"invalid method"),a[b].apply(a,c)}ki.invoke=oi;function pi(a,b){wa(a)&&(this.i=a);Vb(b)&&(this.a=b)}r("H.util.Request",pi);pi.State={PENDING:0,PROCESSING:1,COMPLETE:2,CANCELLED:3,ERROR:4};var qi={dj:0,Hg:1,Fg:2,Ho:3,Yi:4},ri=[0,1,2,3,4];pi.prototype.B=0;pi.prototype.getState=function(){return this.B};pi.prototype.getState=pi.prototype.getState;pi.prototype.P=function(a){if(0>ri.indexOf(a))throw new C(this.P,0,a);if(this.B!==a||1===a&&1<this.a)this.B=a,this.i&&this.i(this)};pi.prototype.a=1;pi.prototype.mn=function(){return this.a};
pi.prototype.getTotal=pi.prototype.mn;pi.prototype.b=0;pi.prototype.an=function(){return this.b};pi.prototype.getProcessed=pi.prototype.an;pi.prototype.g=0;pi.prototype.xm=function(){return this.g};pi.prototype.getFailed=pi.prototype.xm;function si(a,b){a.b<a.a&&(Mb(b)||(b=qi.Fg),b===qi.dj||b===qi.Hg||a.B!==qi.dj&&a.B!==qi.Hg||(a.b++,b!==qi.Fg&&a.g++,a.P(a.b<a.a?qi.Hg:qi.Fg)))}pi.prototype.xe=function(){};pi.prototype.cancel=function(){3!==this.B&&(this.xe(),this.P(3))};pi.prototype.cancel=pi.prototype.cancel;function ti(){}r("H.util.ICapturable",ti);ti.prototype.capture=function(){};ti.prototype.capture=ti.prototype.capture;r("H.util.Disposable",Ac);Ac.prototype.Jb=Ac.prototype.Jb;Ac.prototype.addOnDisposeCallback=Ac.prototype.Jb;r("H.util.dispose",Dc);function ui(a,b){var c=a.G(),d=c.ownerDocument;ui.l.constructor.call(this);this.a=a;this.O=c=c.appendChild(vi(d,"DIV","position:absolute;bottom:0;right:0;left:0px;z-index:1;direction:ltr;pointer-events:none;height:40px",null,"H_imprint"));this.xf=vi(d,"DIV","margin: -"+wi+"px 0 0 "+wi+"px; display:inline-block;",xi,"H_logo");c.appendChild(this.xf);c=c.appendChild(vi(d,"DIV","-webkit-touch-callout: none;-webkit-user-select:none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select:none;right:0;bottom:0;position:absolute;background-color:rgba(255,255,255,.8);color:#0F1621;padding:2px 16px",
null,"H_copyright"));this.g=c.appendChild(vi(d,"A","color:inherit; margin:0px 8px; text-decoration:none; pointer-events:all;","Terms of use"));this.g.target="_blank";this.f=c.appendChild(vi(d,"SPAN","margin:0px 8px"));this.j=Na(yi);this.Ci(b);this.c=z(this.c,this);this.b=z(this.b,this);this.a.addEventListener(this.a.j.$i,this.c);this.a.a.addEventListener("add",this.b);this.a.a.addEventListener("remove",this.b);this.a.a.addEventListener("set",this.b);this.b()}var zi;u(ui,Ac);
r("H.map.Imprint",ui);var wi=16,yi={font:'11px "Lucida Grande", Arial, Helvetica, sans-serif',href:"https://legal.here.com/{LN}/terms/serviceterms/{CN}",invert:!1,reportHref:"https://wego.here.com/",locale:"en-US"};
ui.prototype.Ci=function(a){var b,c=this.xf.firstChild.firstChild.childNodes;a||(this.j=Na(yi));var d=this.j;for(b in d)a&&b in a&&(d[b]=a[b]);a=(this.Fh=a=d.invert)?Ai:Bi;c[0].style.fill=a.ml;c[0].style.fillOpacity=a.nl;c[1].style.fill=a.rl;c[1].style.fillOpacity=a.sl;a=d.locale;Ci[a]||(a="en-US",d.locale=a);this.g.innerHTML=Ci[a];a=a.split("-");this.g.href=d.href.replace("{LN}",a[0]).replace("{CN}",a[1].toLowerCase());this.O.style.font=d.font};ui.prototype.setOptions=ui.prototype.Ci;
function vi(a,b,c,d,e){a=a.createElement(b);c&&(a.style.cssText=c);d&&(a.innerHTML=d);e&&(a.className=e);return a}ui.prototype.G=function(){return this.O};ui.prototype.c=function(){this.f.innerHTML=this.i+" "+this.va()};ui.prototype.b=function(){this.c();setTimeout(this.c,5E3)};
var xi='<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>',Bi=
{rl:"#0F1621",sl:.3,ml:"#fff",nl:.6},Ai={rl:"#fff",sl:1,ml:"#0F1621",nl:.7},Di="1987&ndash;"+Jc(2015,(new Date).getFullYear())+" HERE";ui.prototype.va=function(){var a=this.a,b=a.nb(),c=a.b.mb().bounds;a=a.a;var d=a.a.length,e={},f=0,g,h,k,l=[Di];if(c)for(;f<d;f++)if(h=a.get(f).getCopyrights(c.F(),b))for(g=0;g<h.length;g++)e[k=h[g].label]||(l.push(k),e[k]=1);return l.join(", ")};ui.prototype.getCopyrights=ui.prototype.va;ui.prototype.Ta=function(){return this.O.style};ui.prototype.i=String.fromCharCode(169);
ui.prototype.s=function(){this.a.removeEventListener(this.a.j.$i,this.c);this.a.a.removeEventListener("add",this.b);this.a.a.removeEventListener("remove",this.b);this.a.a.removeEventListener("set",this.b);if(this.O.parentNode){var a=this.O;a.parentNode.removeChild(a)}};
ui.prototype.capture=function(a,b,c,d){var e=a.getContext("2d"),f=window.getComputedStyle(this.f.parentElement),g=2*Sb(f.paddingLeft,10),h=(this.f.offsetWidth+2*g)*b,k=this.f.offsetHeight*b,l=Tb(f.getPropertyValue("font-size")),m=this.O.ownerDocument,p=+a.width,q=+a.height,t=wi*b,v=this.xf.childNodes[0].getBoundingClientRect(),y=v.width*b,E=v.height*b,N=vc;wa(d)&&(N=function(){d("capture_error")});e.fillStyle=f.backgroundColor;e.fillRect(p-h,q-k,h,k);h=this.i+" "+function(a){a=vi(m,"div",null,a);
return a.textContent||a.innerText||""}(this.va());e.font=l*b+"px "+f.getPropertyValue("font-family");e.fillStyle=f.getPropertyValue("color");e.textBaseline="bottom";e.textAlign="right";e.fillText(h,p-g*b,q);Ei(this,e.font,function(b){(new af("image",b)).then(function(b){e.drawImage(b,t,q-(E+t),y,E);c(a)},N)},N)};ui.prototype.capture=ui.prototype.capture;
function Ei(a,b,c,d){Fi(z(function(a){a?this.Fh?c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAADNklEQVRYR82XW6hVVRSGv7+rmJfSMKSnSkMEfY7EogcJC7tilGRopBAiSaI+SBARQSCIIqgFISih2YW0oAgLCsKXojA0RB+81VugZEFZv/yHuWTt7d7Hfc4+6+h4OWefNfcc3xlj/v+YS1zjoab5bE8DZgGngB8keSg5GwO0PQ54F3i2BnQIWCLpx14hGwG0fT3wOfBwB5DzwOOSDvQC2RTgM8Ae4D/gaeA3YDdwN5AWvyxp+6gD2r4OmAq8AbwInAMmA/OAT4CbgBWStvYClzUjWkHbrwHLgF8LVHJ8DDxah7P9JHCil7M40oA/A7OBC8ANtSqlrQOVs30/8CWQat8r6cxg1RwRQNvPA88Bk4D7gJzBV4A5teSp5MlS4VuA/ZIeu1Kr+wa0/QTwIRDlRhT5eTswBvi2CKOd42AULilndNAYCcA7gK+BmbVMiyXtsh3Qt4FFBTgW8w6wXtLfV4LrSyS2FwAvAWOBX+JtwF0laUDmS/oun23fDNwJnJb0Ty9g1ZphVdB2qrK2LdFfBbb685/AIxXkUKDqa4cMaDs2kjalRe8Fola57J3qRQSJviGHA3gMuAdYI2lDUfDOArQLWAd8VTuTOW9vjUoFy6TIGYpS9wKfAjuK5wVuSfn91iKcvZJeHy5ci0hsZwzNk5Qh3xIFbLyks7aPAtPLgv+L4VZwDwLvA6uKz6XdfcVAi22PBz4q4+lVSRurXW2vKYKIZfwEHCmmXC35HngAyITYD0ys2t8XWflyBfhmvKm24QCk7aVFCPVc7WMszzKucknI+NoHPCUppt13VICZm2nNwjoksByY0SXL72Vi3FieZ97mgrpyqF432H9xScW2O0H+W6oSE/4D2FYuA9kzlUzVTwO3Ad9IOtx3ydo2aLGZLpABm5KW2Z4AfAbMLfsEcpGkKLqRuMwHu0CukrSpCCrvGlF6hBEVL5MUw24kOhp1B8gc+FTqgxpkFLuzSbjk6jpJOkC2tDPeKCkVbDRkO67fDTTC2VK7vgfyBUlfNEpV2zyAK4HNXRLmZfshScdHC6g9T+WDGU2XpkdZdNXhWs6g7dXAhmsJ7jKR2M77bG4kV7Wt9TZfBLgYEC7PSpcIAAAAAElFTkSuQmCC"):c("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIMSURBVFiFzdZPiE1RGADwXzPTTPIMQoodVpbKgpoUG5qExUi8DSVJQv4slJJsbNjYWFhNETWLUUosRDRLUVLCYhIiojFojHkW997uvefNGIuZc99Xp/fOO6/Or++c75xDi0d7hDlWYQNqeB9hvv+OGq6jUWjPsKZKVBbtuKOMy9p3bKqOlsROCWYc27AWr9PfJnCgKlgbluNqivmGDmzBrxR3sCocnMEw7sqXdEAzboeK9uLTFPVbed8VcesxglFJtqNEHbcxlIL68ChADuCSpEgauBULt11SDI3C5yJJdrLCCNsQumMBl+J5AKinY4slBfNTfsRcxJwYsK0YxD3J0r1RPut6Cv/twgp0xoDBBc3LNhr0RwJktNifAn7gsnLmsuxVinyVTn4i7dcLoH4sU96Tp2Pi2uSVehN75Gdev+QO7pIXztmZnLwTvf+AzU+/v5Rn50+A24gP2IW5M4mbJ7+ejgVjJ/EpHXuCa8p77nGK68FX5eWfsTgfTJoh92qu1vAaa+CtPJuDZuEh3CHZUyHyxSSYrL3DWKE/gStm8aybDDkmKYperJM/BrJMnsJuHMLq2YJNh/wsX7JuPAyQfTFg0yGPFMZreCCv4n2xgTQjxyXP+CxquK8iXBYhMlzOtliQBVg4RVuCG/iSto/YHAuWxWFTHyXDWBkbNFkc1cK4LI5rYVwW57QY7i/pZeJv8QQJRQAAAABJRU5ErkJggg=="):
(a=this.xf.cloneNode(!0),a.firstChild.setAttribute("style","font:"+b),c(Me(a.innerHTML)))},a),d)}ui.prototype.Fh=!1;function Fi(a,b){var c="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(xi),d=zi;Mb(d)?a(d):(new af("image",c)).then(function(b){Ie.drawImage(b,0,0);try{Ie.getImageData(0,0,1,1),d=!1}catch(f){d=18===f.code}finally{zi=d,a(d)}},b)}
var Ci={"de-DE":"Nutzungsbedingungen","en-US":"Terms of use","en-GB":"Terms of use","es-ES":"Condiciones de uso","fi-FI":"Palveluehdot","fr-FR":"Conditions d'utilisation","it-IT":"Condizioni di utilizzo","nl-NL":"Dienstvoorwaarden","pl-PL":"Warunki \u015bwiadczenia us\u0142ugi","pt-BR":"Termos de servi\u00e7o","pt-PT":"Termos do servi\u00e7o","ru-RU":"\u0423\u0441\u043b\u043e\u0432\u0438\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f","tr-TR":"Servis Ko\u015fullar\u0131",
"zh-CN":"\u4f7f\u7528\u6761\u6b3e"};function O(a){var b={};this.u=b.previousSibling=b.nextSibling=b;this.A=new Ne;O.l.constructor.call(this,a);a&&"objects"in a&&this.gd(a.objects)}u(O,K);r("H.map.Group",O);O.prototype.type=xg.GROUP;O.prototype.je=function(a,b){this.f=!0;a=O.l.je.call(this,a,b);this.f=!1;a&&this.forEach(Gi,!0);return a};O.prototype.setProvider=O.prototype.je;function Gi(a,b,c){a.je(c.a)}O.prototype.contains=function(a){var b=this===a;if(!b&&this.b&&B(a,K))for(;!b&&a;)a===this?b=!0:a=a.Ua;return b};
O.prototype.contains=O.prototype.contains;O.prototype.gf=function(){this.v=A;this.forEach(Hi,!0)};O.prototype.resetZInfo=O.prototype.gf;function Hi(a){a.gf()}O.prototype.f=!1;O.prototype.Ga=function(a){var b=O.l.Ga.call(this,a);b&&!this.f&&(this.g=a,this.forEach(Ii,!0),delete this.g);return b};O.prototype.invalidate=O.prototype.Ga;function Ii(a,b,c){a.Ga(c.g)}
O.prototype.forEach=function(a,b,c){var d;if(this.b){var e=this.u;var f=e.nextSibling;for(d=0;f!==e;){var g=f.nextSibling;a.call(c,f,d++,this);b&&B(f,O)&&f.forEach(a,b,c);f=g}}};O.prototype.forEach=O.prototype.forEach;O.prototype.Ab=function(a){var b=[];this.forEach(Ji,a,b);return b};O.prototype.getObjects=O.prototype.Ab;O.prototype.F=function(){var a=null;this.b&&this.forEach(function(b){(b=b.F())&&(a?a=a.lc(b):a=b)});return a};O.prototype.getBoundingBox=O.prototype.F;
function Ji(a){this.push(a)}O.prototype.b=0;O.prototype.om=function(){return this.b};O.prototype.getChildCount=O.prototype.om;
O.prototype.T=function(a){var b=this.u,c=b.previousSibling;B(a,K,this.T,0);if(a.contains(this))throw new nc(this.T,"The new object contains the parent group");var d=a.Ua;if(d!==this){if(d){d=a.previousSibling;var e=a.nextSibling;d.nextSibling=e;e.previousSibling=d}a.Ua=this;K.l.ba.call(a,this);c.nextSibling=a;a.previousSibling=c;a.nextSibling=b;b.previousSibling=a;this.b++}a.Ji=this.A.next();a.gf();a.je(this.a,this.T)||a.Ga(ug.Z_ORDER);return a};O.prototype.addObject=O.prototype.T;
O.prototype.gd=function(a){var b;Rb(a,this.gd,0);var c=a.length;for(b=0;b<c;b++)this.T(a[b])};O.prototype.addObjects=O.prototype.gd;O.prototype.Ia=function(a){if(!a||a.Ua!==this)throw new nc(this.Ia,"object not found");var b=a.previousSibling,c=a.nextSibling;b.nextSibling=c;c.previousSibling=b;a.Ua=null;K.l.ba.call(a,null);delete a.previousSibling;delete a.nextSibling;B(a.a,L)&&a.je(null,this.Ia);this.b--;return a};O.prototype.removeObject=O.prototype.Ia;
O.prototype.wd=function(a){var b;Rb(a,this.wd,0);var c=a.length;for(b=0;b<c;b++)this.Ia(a[b])};O.prototype.removeObjects=O.prototype.wd;O.prototype.fa=function(){var a=this.Ab();this.wd(a)};O.prototype.removeAll=O.prototype.fa;O.prototype.W=function(){var a=O.l.W.call(this);a.type="Group";return a};O.prototype.forWorkerMessage=O.prototype.W;function Ki(a,b,c,d,e){b&&(this.b=b);Mb(c)&&(this.Qg=!!c);this.Qg&&d&&(this.Sg=new th(d.w,d.h));Mb(e)&&(this.c={crossOrigin:e});switch(Li[Qb(a)]){case 2:this.sd=a;Mi(this,1);break;case 1:if(Xe(a)){this.sd=a;Ni(this);Mi(this,1);break}a=a.src;case 0:if(a){a=Me(a);this.a=new af("image",a,A,this.c);this.a.then(z(this.Xn,this),z(this.Wn,this));break}default:throw Mi(this,-1),new C(Ki,0,"No image data");}}n=Ki.prototype;n.B=0;n.getState=function(){return this.B};
function Mi(a,b){a.B=b;delete a.a;a.b&&a.b(b,a)}n.Qg=!0;function Ni(a){if(a.Qg){var b=a.sd,c=Oi(a),d=c&&c.w||+b.width,e=c&&c.h||+b.height;if(B(b,w.HTMLCanvasElement))c=b;else{c=b.ownerDocument.createElement("CANVAS");c.width=d;c.height=e;var f=c.getContext("2d");f.drawImage(b,0,0,d,e)}a.sd=c}}n.sd=x;n.getData=function(){return this.sd};var Li={String:0,HTMLImageElement:1,HTMLCanvasElement:2};n=Ki.prototype;n.Sg=x;n.Bb=function(){return 1===this.B?Oi(this):x};
function Oi(a){var b=a.Sg,c;if(!b){var d=a.sd;b=d.naturalWidth||d.width;if(0===b&&Ke&&1===Li[Qb(d)]){var e=!0;if(c=d.parentNode)var f=d.nextSibling;document.body.appendChild(d)}a.Sg=b=new th(d.naturalWidth||d.width,d.naturalHeight||d.height);e&&(c?c.insertBefore(d,f):document.body.removeChild(d))}return b}n.Xn=function(a){this.sd=a;Ni(this);Mi(this,1)};n.Wn=function(){Mi(this,-1)};n.cancel=function(){this.a&&this.a.cancel()};function Pi(a,b){var c,d="anonymous";this.uid=Qi.next();Pi.l.constructor.call(this);if(b){var e="size";if(e in b){var f=b[e];if(!f||isNaN(f.w)||isNaN(f.h))throw new C(Pi,1,e);this.c=new th(f.w,f.h)}e="anchor";if(e in b){f=b[e];if(!f||isNaN(f.x)||isNaN(f.y))throw new C(Pi,1,e);this.b=new G(f.x,f.y)}e="hitArea";e in b&&(f=b[e],B(f,uh,Pi,1),this.g=b[e]);e="asCanvas";e in b&&(c=b[e]);e="crossOrigin";e in b&&(d=b[e])}a=new Ki(a,z(this.i,this),c,this.c,d);b=this.B=a.getState();0!==b?this.i(b,a):this.f=
a}u(Pi,F);r("H.map.Icon",Pi);var Qi=new Ne;Pi.State={ERROR:-1,LOADING:0,READY:1};Pi.prototype.getState=function(){return this.B};Pi.prototype.getState=Pi.prototype.getState;Pi.prototype.i=function(a,b){this.a=b.getData();if(1===a){var c=this.c;c||(c=this.c=b.Bb());this.b||(this.b=new G(c.w/2|0,c.h))}this.f&&(this.B=a,delete this.f,this.dispatchEvent("statechange"))};Pi.prototype.a=x;Pi.prototype.Xc=function(){return this.a};Pi.prototype.getBitmap=Pi.prototype.Xc;Pi.prototype.c=x;
Pi.prototype.Bb=function(){return this.c};Pi.prototype.getSize=Pi.prototype.Bb;Pi.prototype.b=x;Pi.prototype.ld=function(){return this.b};Pi.prototype.getAnchor=Pi.prototype.ld;Pi.prototype.g=x;Pi.prototype.Cm=function(){return this.g};Pi.prototype.getHitArea=Pi.prototype.Cm;Pi.prototype.s=function(){Pi.l.s.call(this);this.a?(this.a.removeAttribute("src"),delete this.a):(this.f.cancel(),delete this.f)};function Ri(a,b,c,d,e,f){Ri.l.constructor.call(this,isNaN(a)?15:a,b,c,d,e,f)}u(Ri,Sf);Ri.prototype.m=function(a){for(var b,c,d,e=this.head;a;){if(b=a.entries)if(c=b.length){if(2>c&&(d=a.parent)&&1===d.a){d.removeChild(a);e===a&&(e=d);d.entries=b;a=b[0].node=d;continue}}else if(delete a.entries,d=a.parent)if(d.removeChild(a),e===a&&(e=d),1===d.a){a=d.a?d[0]||d[1]||d[2]||d[3]:null;continue}a=x}this.head!==e&&(this.head=e,Yf(this))};
Ri.prototype.Cc=function(a,b){if(cg(this.a,a,b,a,b))return Si(this,this.a,a,b,this.c);throw Error("Coordinates out of bounds");};function Si(a,b,c,d,e){var f=b.entries;if(e)if(b.a)f=Ti(a,b,c,d,e);else if(f){f=f[0];var g=ag(b,f[1]>=b[8]|(f[0]>=b[9])<<1);g.entries=b.entries;delete b.entries;f.node=g;Yf(a,g);f=Ti(a,b,c,d,e)}else bg(b,f=new Ui(c,d)),Yf(a,b),Wf(a,f,!0);else f||Yf(a,b),bg(b,f=new Ui(c,d)),Wf(a,f,!0);return f}function Ti(a,b,c,d,e){return Si(a,ag(b,c>=b[8]|(d>=b[9])<<1),c,d,e-1)}
function Ui(a,b){this.id=$f++;this[0]=b;this[1]=a}Ui.prototype.md=function(a){return this[a%2]};function Vi(){this.a=new Ri(10,180,90,0,0,!0)}n=Vi.prototype;n.Mh=0;n.Yc=function(){return this.Mh};n.N=null;n.F=function(){var a=this.N,b;!a&&(b=Uf(this.a))&&(this.N=a=new I(-b[0],b[3],-b[2],b[1]));return a};n.Cc=function(a){++this.Mh;this.N=null;return this.a.Cc(a.lng,-a.lat)};n.remove=function(a){if(a=this.a.remove(a))--this.Mh,this.N=null;return a};
n.Sf=function(a){var b=this.a,c=a.Sb(),d=a.Ob(),e=-c.lat;c=c.lng;var f=-d.lat;d=d.lng;var g;a.Db()?g=b.Ya(-180,e,d,f).concat(b.Ya(c,e,180,f)):g=b.Ya(c,e,d,f);return g};function Wi(a,b,c){this.c=a;this.a=b;this.f=c;this.b={}};function Xi(a,b,c,d){this.a=a;this.b=b;this.c=c;this.tf=d}function Yi(a,b,c,d){a={type:b,uid:a.b,tiled:c,max_zoom:a.c};d&&Qa(a,d);return a};function Zi(a){this.a=a};function $i(a,b,c,d,e){this.a=a;this.b=b;this.c=c;this.f=d;this.tf=e}
function aj(a){if(a.a&32&&!(a.a&16))return{};var b=new Xi(a.a,a.b,a.c,a.tf);var c=new Zi(a.a);a=new Wi(a.a,a.b,a.f);var d={},e=b.b;b=b.a&1?Yi(b,"ObjectSource",!1,{progressiveUpdate:!0,has_volatile_data:!!(b.a&128)}):b.a&2?Yi(b,"RemoteRasterTileSource",!0,{url:""}):Yi(b,"ObjectTileSource",!0,{tile_size:b.tf});d[e]=b;b={};c.a&2&&(b={"translucent-raster":fi("raster","inlay",1)});c.a&28&&(e={"translucent-polygons":fi("polygons","inlay",2),"translucent-pattern-lines":fi("pattern-lines","inlay",3),"translucent-overlays":fi("overlays",
"inlay",4),markers:fi("custom_icons","overlay",5)},e["translucent-pattern-lines"].crop_by_tile=!!(c.a&64),e.markers.suppress_fade=!0,Qa(b,e));a.c&2&&(a.b["tile_layer_"+a.a]=gi(a.a,"_default",{"translucent-raster":{color:[1,1,1,a.f],order:0}}));if(a.c&4){c={"translucent-pattern-lines":{color:ei("strokeColor"),width:ei("lineWidth * $meters_per_pixel"),join:ei("lineJoin"),cap:ei("lineCap"),tail_cap:ei("lineTailCap"),head_cap:ei("lineHeadCap"),miter_limit:ei("miterLimit"),order:2,interactive:!0,dash:ei("lineDash"),
dash_phase:ei("lineDashOffset")}};e=a.b;var f="polygon_layer_"+a.a;var g=gi(a.a,"polygons",{"translucent-polygons":{color:ei("fillColor"),order:1,interactive:!0}},"function(){return sources[$source].isVisible(feature, $zoom)}");g.extrude={filter:{extrude:!0},draw:{"translucent-polygons":{extrude:di("extrude")}}};e[f]=g;a.b["outline_layer_"+a.a]=gi(a.a,"outlines",c,"function(){return sources[$source].isVisible(feature, $zoom)}");a.b["polyline_layer_"+a.a]=gi(a.a,"polylines",c,"function(){return sources[$source].isVisible(feature, $zoom)}")}a.c&
8&&(a.b["overlay_layer_"+a.a]=gi(a.a,"overlays",{"translucent-overlays":{color:[1,1,1,a.f],order:3,interactive:!0}},"function(){return sources[$source].isVisible(feature, $zoom)}"));a.c&16&&(a.b["marker_layer_"+a.a]=gi(a.a,"markers",{markers:{sprite:di("icon.id"),offset:di("icon.offset"),collide:!1,priority:4,interactive:!0}},"function(){return sources[$source].isVisible(feature, $zoom)}"));return{sources:d,styles:b,layers:a.b}};function bj(a,b){bj.l.constructor.call(this);this.B=cj.INIT;this.a=null;if(b&&Lh(b))throw new C(bj,1,"Base URL must be absolute");this.b=b;if(dj.test(a))this.C=a,b||(this.b=Lh(this.C)?A:this.C);else if(ra(a))this.c=a;else if(xa(a))ej(this,Oa(a));else throw new C(bj,0,fj);}u(bj,F);r("H.map.Style",bj);bj.prototype.getState=function(){return this.B};bj.prototype.getState=bj.prototype.getState;bj.prototype.Ld=function(){return this.b};bj.prototype.getBaseUrl=bj.prototype.Ld;bj.prototype.Kf=function(){return Oa(this.a)};
bj.prototype.getConfig=bj.prototype.Kf;bj.prototype.load=function(){var a=this;if(this.C)this.B=cj.LOADING,(new af("text/plain",this.C)).then(function(a){return Mh(a)}).then(function(b){ej(a,b)},function(b){gj(a,b.message)}),this.C=null;else if(this.c){this.B=cj.LOADING;try{ej(this,Mh(this.c))}catch(b){gj(this,b.message)}this.c=null}};bj.prototype.load=bj.prototype.load;
bj.prototype.fl=function(a,b){var c,d;hj(this);a=ij(this,a,this.fl);var e=a.length;for(c=0;c<e;c++){var f=a[c].ob.draw;for(d in f)f[d].interactive=!!b}jj(this)};bj.prototype.setInteractive=bj.prototype.fl;
bj.prototype.setProperty=function(a,b,c){var d,e=a.split("."),f=0,g=e.length;hj(this);if(!Mb(b))throw new C(this.setProperty,1,"value");if(d=kj(this.a,e)){if(!(d.parent instanceof Object)||d.parent instanceof Array)if(c)e.pop(),e=kj(this.a,e),d.parent=e.parent[e.fg]={};else throw new C(this.setProperty,0,a+" property is not primitive type");d.parent[d.fg]=b}else{for(d=this.a;f!==g-1;)d[e[f]]={},d=d[e[f++]];d[e[f]]=b}lj(this)&&jj(this)};bj.prototype.setProperty=bj.prototype.setProperty;
bj.prototype.bn=function(a){hj(this);return(a=kj(this.a,a.split(".")))?Oa(a.node):void 0};bj.prototype.getProperty=bj.prototype.bn;bj.prototype.removeProperty=function(a){hj(this);(a=kj(this.a,a.split(".")))&&a.parent&&a.parent.hasOwnProperty(a.fg)&&(delete a.parent[a.fg],lj(this)&&jj(this))};bj.prototype.removeProperty=bj.prototype.removeProperty;bj.prototype.Yf=function(a){hj(this);if(!xa(a))throw new C(this.Yf,0,"config");ej(this,Nh(this.a,a))};bj.prototype.mergeConfig=bj.prototype.Yf;
bj.prototype.Ej=function(a,b,c){var d;hj(this);var e=this.a;var f=e.layers;var g=ij(this,a,this.Ej);a=g.length;for(d={};a--;)Vh(d,f,g[a].id,!!b,!!c);c={};g=Object.keys(e);for(a=g.length;a--;){var h=g[a];var k=e[h];c[h]=k===f?d:Oa(k)}b||jj(this);return c};bj.prototype.extractConfig=bj.prototype.Ej;bj.prototype.toString=function(){return this.B===cj.READY?w.H.gl.yaml.safeDump(this.a,{lineWidth:120}):""};bj.prototype.s=function(){bj.l.s.call(this);this.a=this.c=this.C=null};
function lj(a){var b=a.a,c;if(xa(b)){var d;if(d=a.f){b=b&&b.sources;d=!1;for(var e in b)if(b[e].type===a.f){d=!0;break}d=!(b?d:1)}d&&(c="invalid source, the only valid type is "+a.f)}else c=fj;c&&gj(a,c);return!c}function gj(a,b){a.a=null;a.B=cj.ERROR;var c=mj;Fd(a.Y,qa(c)?String(c):void 0)?a.dispatchEvent(new Gc(mj,b,a)):console.error(b)}function jj(a){a.dispatchEvent(new Ec(nj,a))}function ej(a,b){a.a=b;lj(a)&&(a.B=cj.READY,jj(a))}
function hj(a){if(a.B!==cj.READY)throw new nc(a.Yf,"style is not ready yet");}function ij(a,b,c){var d=[],e=Rb(b)?b:[b],f=e.length;for(e=e.sort();f--;){b=(""+e[f]).split(".");a:{var g=a.a;for(var h=b.length;h--&&!Sh[b[h]];);if(g&&0>h&&(g=Qh(g.layers,b))&&g[Lb[1]]===w.Object)break a;g=Oh}if(g===Oh)throw new C(c,0,'Unresolvable layer ID "'+e[f]+'"');d[f]={id:b,ob:g}}return d}
function kj(a,b){var c=0,d;for(d=b.length;c!==d;){var e=b[c++];var f=a;a=f[e];if(!a)break}return c===d?{node:a,parent:f,fg:e}:void 0}var dj=/^(http[s]?)?.*\.ya?ml/,fj="invalid style configuration",cj={ERROR:-1,INIT:0,LOADING:1,READY:2};bj.State=cj;var nj="change",mj="error";function ii(a){var b=""+Pe(),c;ii.l.constructor.call(this);a=a||{};this.min=a.min||0;this.max=a.max||22;if(c=a.uri){if(/_/.test(c))throw new C(ii,0,"uri "+c);}else c=b;this.uri=c||b;this.uid=b;a.getCopyrights&&Pb(a.getCopyrights,"Function",ii)&&(this.getCopyrights=a.getCopyrights);this.f=this.f.bind(this);this.na=!0}u(ii,F);r("H.map.provider.Provider",ii);ii.prototype.i={oe:"configchange",Ca:"update"};function oj(a,b){a.dispatchEvent(new Ec(a.i.Ca,b))}ii.prototype.f=function(){this.dispatchEvent(this.i.oe)};
ii.prototype.s=function(){F.prototype.s.call(this);this.c&&(this.c.removeEventListener(nj,this.f),this.c=null)};ii.prototype.va=function(){return null};ii.prototype.getCopyrights=ii.prototype.va;ii.prototype.m=function(){var a=0;this.oi()&&(a|=1);this.providesRasters()&&(a|=2);this.providesSpatials()&&(a|=4);this.providesOverlays()&&(a|=8);this.providesMarkers()&&(a|=16);this.providesDomMarkers()&&(a|=32);return a};ii.prototype.oi=Re;ii.prototype.bf=Re;ii.prototype.providesRasters=ii.prototype.bf;
ii.prototype.Hc=Re;ii.prototype.providesSpatials=ii.prototype.Hc;ii.prototype.pi=Re;ii.prototype.providesOverlays=ii.prototype.pi;ii.prototype.Wb=Re;ii.prototype.providesMarkers=ii.prototype.Wb;ii.prototype.Vb=Re;ii.prototype.providesDomMarkers=ii.prototype.Vb;ii.prototype.li=vc;ii.prototype.j=1;function pj(a,b){b=ld(b,0,1);D(b)&&(b=1);a.j!==b&&(a.j=b,a.na&&qj(a),a.f(),oj(a))}
ii.prototype.nf=function(a,b){this.c&&(this.c.removeEventListener(nj,this.f),this.c.removeEventListener(mj,this.f));this.c=a;this.c.addEventListener(nj,this.f);this.c.addEventListener(mj,this.f);b||this.f();this.na=!1};ii.prototype.setStyleInternal=ii.prototype.nf;ii.prototype.Rb=function(){this.c||qj(this);return this.c};ii.prototype.getStyleInternal=ii.prototype.Rb;function qj(a){var b=new $i(a.m(),a.uid,a.max,a.j,a.tileSize);a.c=new bj(aj(b));a.na=!0}
function rj(a){a=a.m();var b=sj;a&1?b=tj:a&2?b=null:a&28&&(b=uj);return b}ii.prototype.ym=function(){return!1};ii.prototype.getFeatureProxy=ii.prototype.ym;function vj(a){var b;Nb(this,vj);vj.l.constructor.call(this,a);this.Oa=a=[];for(b in xg)a[xg[b]]=new tg}u(vj,ii);r("H.map.provider.ObjectProvider",vj);vj.prototype.oi=Qe;vj.prototype.providesByViewport=vj.prototype.oi;vj.prototype.Qb=function(a){return this.Oa[a||xg.ANY]};vj.prototype.getInvalidations=vj.prototype.Qb;vj.prototype.Xd=function(a,b){if(b!==ug.NONE){var c=this.Oa[xg.ANY];var d=c.a+1;c.update(d,b);c=this.Oa[a.type];c.update(d,b);a.Qb().update(d,b);oj(this,a)}};
vj.prototype.invalidateObject=vj.prototype.Xd;vj.prototype.requestOverlays=vj.prototype.xd;vj.prototype.requestSpatials=vj.prototype.ng;vj.prototype.requestSpatialsByTile=vj.prototype.og;vj.prototype.Pa=!1;vj.prototype.requestMarkers=vj.prototype.Jc;vj.prototype.requestDomMarkers=vj.prototype.Ic;function L(a){a=a||{};L.l.constructor.call(this,a);this.b=a=new O({provider:this,min:a.min,max:a.max});a.ba(this);this.J=new hg;this.o=new hg;this.g=new Vi;this.u=new hg;this.K=new Vi;this.I=new hg}u(L,vj);r("H.map.provider.LocalObjectProvider",L);L.prototype.m=function(){return 125};L.prototype.Rb=function(){if(!this.L){this.L=L.l.Rb.call(this);var a=new $i(this.m()|128,this.uid+"_vol",this.max,this.j,this.tileSize);this.L.Yf(aj(a))}return this.L};L.prototype.ic=function(){return this.b};
L.prototype.getRootGroup=L.prototype.ic;L.prototype.Xd=function(a,b){b&ug.SPATIAL&&this.T(a);L.l.Xd.call(this,a,b)};L.prototype.invalidateObject=L.prototype.Xd;L.prototype.T=function(a){var b;B(a,K,this.T,0);if(a.a!==this)throw new nc(this.T,"foreign object");this.Ia(a);var c=a.type;if(c===xg.MARKER)if((b=a.ia())instanceof H){var d=!0;c=this.g}else c=this.u;else c===xg.DOM_MARKER?(b=a.ia())instanceof H?(d=!0,c=this.K):c=this.I:c=c===xg.OVERLAY?this.J:this.o;d=d?c.Cc(b):c.$j(a.F());d.Vi=a;a.J=d};
L.prototype.Ia=function(a){var b;if(a)if(a.a!==this){if(B(a,K))throw new nc(this.Ia,"foreign object");}else if(b=a.J){var c=a.type;c===xg.MARKER?this.g.remove(b)||this.u.remove(b):c===xg.DOM_MARKER?this.K.remove(b)||this.I.remove(b):c===xg.OVERLAY?this.J.remove(b):this.o.remove(b);delete b.Vi;delete a.J}};L.prototype.removeObject=L.prototype.Ia;
function wj(a,b,c,d,e,f){var g;f=f||[];if(b.Yc())for(a=b!==a.g&&b!==a.u,e=!e,b=b.Sf(c),c=b.length,g=0;g<c;g++){var h=b[g].Vi;for(var k,l=Lc(d),m=h;(k=m.m<=l&&m.j>=l)&&(m=m.Ua););k&&(e||h.Ac(!0))&&(a||1===h.yb().getState())&&f.push(h)}return f}L.prototype.pi=function(){return 0<this.J.Yc()};L.prototype.providesOverlays=L.prototype.pi;L.prototype.xd=function(a,b,c){return wj(this,this.J,a,b,c).filter(function(a){return a.Xc()})};L.prototype.requestOverlays=L.prototype.xd;
L.prototype.Hc=function(){return 0<this.o.Yc()};L.prototype.providesSpatials=L.prototype.Hc;L.prototype.ng=function(a,b,c){return wj(this,this.o,a,b,c)};L.prototype.requestSpatials=L.prototype.ng;L.prototype.og=function(a,b){return wj(this,this.o,a.Lf(),a.zL,b)};L.prototype.requestSpatialsByTile=L.prototype.og;L.prototype.Wb=function(){return 0<this.g.Yc()+this.u.Yc()};L.prototype.providesMarkers=L.prototype.Wb;L.prototype.Jc=function(a,b,c){var d=wj(this,this.g,a,b,c);wj(this,this.u,a,b,c,d);return d};
L.prototype.requestMarkers=L.prototype.Jc;L.prototype.Vb=function(){return 0<this.K.Yc()+this.I.Yc()};L.prototype.providesDomMarkers=L.prototype.Vb;L.prototype.Ic=function(a,b,c){var d=wj(this,this.K,a,b,c);wj(this,this.I,a,b,c,d);return d};L.prototype.requestDomMarkers=L.prototype.Ic;L.prototype.s=function(){L.l.s.call(this);this.b.fa()};var xj={PENDING:0,ACTIVE:1,DONE:2};r("H.map.render.RenderState",xj);function yj(a,b){b=b||{};var c;if(!B(a,Element))throw new C(yj,0,a);var d=a.ownerDocument.createElement("div");this.O=a;yj.l.constructor.call(this);this.padding=new zj(0,0,0,0);this.center=new G(0,0);this.margin=0;this.element=d;d.style.zIndex=0;d.style.height=d.style.width="100%";d.style.position="relative"===a.style.position?"absolute":"relative";this.resize();a.appendChild(d);(c=b.padding)!==A&&this.Di(c.top,c.right,c.bottom,c.left);this.yi((c=b.margin)!==A?c:0)}u(yj,F);
r("H.map.ViewPort",yj);yj.prototype.a={Ca:"update",te:"sync"};yj.prototype.yi=function(a){if(this.margin!==+a){if(D(this.margin=+a))throw new C(this.yi,0,a);Aj(this);this.dispatchEvent(this.a.Ca)}};yj.prototype.setMargin=yj.prototype.yi;yj.prototype.Di=function(a,b,c,d){var e=this.padding;if(e.top!==a||e.right!==b||e.bottom!==c||e.left!==d){if(D(a+b+c+d))throw new C(this.Di);e.top=a;e.right=b;e.bottom=c;e.left=d;Aj(this);this.dispatchEvent(this.a.Ca)}};yj.prototype.setPadding=yj.prototype.Di;
function Aj(a){var b=a.padding;a.center.set((a.width+b.left-b.right)/2<<0,(a.height+b.top-b.bottom)/2<<0)}yj.prototype.resize=function(){var a=this.O.offsetWidth,b=this.O.offsetHeight;if(this.width!==a||this.height!==b)this.c=new th(this.width,this.height),this.width=a,this.height=b,Aj(this),this.dispatchEvent(this.a.Ca)};yj.prototype.resize=yj.prototype.resize;function Bj(a,b){a.dispatchEvent(new Ah(a.a.te,a.c,b,Ah.prototype.SIZE))}
yj.prototype.s=function(){w.clearTimeout(this.b);this.b=null;this.O.removeChild(this.element);this.element=this.O=null;yj.l.s.call(this)};yj.prototype.qc=fc;yj.prototype.startInteraction=yj.prototype.qc;yj.prototype.kc=fc;yj.prototype.interaction=yj.prototype.kc;yj.prototype.xb=fc;yj.prototype.endInteraction=yj.prototype.xb;function Cj(a,b,c,d,e,f){var g;for(g=[];d<=e;d++)g=g.concat(Dj(a,c,d));a=g.length;pi.call(this,f,a);this.j=c=[];this.f=z(this.f,this);this.c=z(this.c,this);for(this.P(1);a--;)f=g[a],c.push(Ej(b,f[0],f[1],f[2],this.f,this.c))}u(Cj,pi);Cj.prototype.f=function(){si(this,2)};Cj.prototype.c=function(){si(this,4)};Cj.prototype.xe=function(){for(var a=this.j,b=a.length;b--;)a[b].cancel();this.j=x};function Fj(a,b){var c=this;if(!wa(b))throw new C(Gj,1,b);if(!wa(a.next||wa(a.cycle)))throw new C(Fj,2,'Argument "mode" must implement H.util.AsyncQueue.Mode');this.b=[];this.c=[];this.g=a;this.i=b;this.j=function(){Hj(c)};this.a=null;this.f=function(){c.a||(c.a=w.setTimeout(c.j,1))}}r("H.util.AsyncQueue",Fj);Fj.prototype.push=function(a,b){if(!wa(b))throw new C(this.push,1,b);a=Ij(new Jj,a,this.f,b);this.b.push(a);this.f();return a};Fj.prototype.push=Fj.prototype.push;
function Hj(a){var b=a.c,c=0,d=a.g;d.Oc=Kj();for(a.a=null;c<b.length;){var e=b[c];e.ck?b.splice(c,1):c++}for(;e=d.next(a.b,a.c);)e.cancelled?e.done(null,"cancelled"):(b.push(e),a.i(e,e.data))}function Jj(){Ij(this,null,null,null)}Fj.Task=Jj;function Ij(a,b,c,d){a.data=b;a.cancelled=!1;a.ck=!1;a.b=c;a.c=d;a.a=null;return a}Jj.prototype.done=function(a,b){this.ck=!0;this.b();this.c(this,a,b)};Jj.prototype.done=Jj.prototype.done;Jj.prototype.cancel=function(){this.a&&this.a();this.cancelled=!0};
Jj.prototype.cancel=Jj.prototype.cancel;Jj.prototype.qo=function(a){this.a=a;return this};Jj.prototype.setCancelFn=Jj.prototype.qo;function Lj(a,b){Lj.l.constructor.call(this,new Mj(a),b)}u(Lj,Fj);r("H.util.SequentialQueue",Lj);function Mj(a){if(isNaN(a)||0>a)throw new C(Lj,1,'Argument "maxTime" must be a positive number');this.a=a;this.Oc=Kj()}Mj.prototype.next=function(a){return a.length&&Kj()-this.Oc<this.a?a=a.shift():null};function Nj(a){Nb(this,Nj);Nj.l.constructor.call(this,a);if(a&&"tileSize"in a){var b=Oc(+a.tileSize)/Zc;if(isNaN(b)||b%1||0>b||30<b)throw new C(Nj,0,"tileSize: "+a.tileSize);this.tileSize=+a.tileSize}}u(Nj,ii);r("H.map.provider.TileProvider",Nj);function Oj(a,b){return id(a)-8-Kc(id(b))}Nj.getZoomLevelOffset=Oj;Nj.prototype.Of=function(a,b,c){return this.uri.concat("_",a,"_",b,"_",c)};Nj.prototype.getTileKey=Nj.prototype.Of;Nj.prototype.tf=256;Nj.prototype.tileSize=Nj.prototype.tf;function Pj(){}r("H.util.ICache",Pj);Pj.prototype.add=function(){};Pj.prototype.add=Pj.prototype.add;Pj.prototype.get=function(){};Pj.prototype.get=Pj.prototype.get;Pj.prototype.Gf=function(){};Pj.prototype.drop=Pj.prototype.Gf;Pj.prototype.forEach=function(){};Pj.prototype.forEach=Pj.prototype.forEach;Pj.prototype.fa=function(){};Pj.prototype.removeAll=Pj.prototype.fa;Pj.prototype.ee=function(){};Pj.prototype.registerOnDrop=Pj.prototype.ee;Pj.prototype.ah=function(){};
Pj.prototype.deRegisterOnDrop=Pj.prototype.ah;function Qj(a,b,c){this.g=[];b&&this.ee(b);if(c&&!wa(c))throw new C(Qj,2,c);this.b=0;this.filter=c;this.a={};this.f=this.c=null;this.Ai(a)}r("H.util.Cache",Qj);Qj.prototype.add=function(a,b,c){c=+c;if(!Vb(c)||0>c)throw new C(this.add,2,c);a=String(a);var d=this.a[a];var e=!0;this.filter&&(e=this.filter(a,b,c));d?e?(this.b+=c-d.size,d.size=c,d.data=b,Rj(this,d)):Sj(this,d,!0):e&&(this.a[a]=Tj(this,{id:a,data:b,size:c,mc:null,ed:null},this.c));Uj(this);return e};Qj.prototype.add=Qj.prototype.add;
Qj.prototype.ee=function(a){if(!wa(a))throw new C(this.ee,0,a);this.g.push(a)};Qj.prototype.registerOnDrop=Qj.prototype.ee;Qj.prototype.ah=function(a){this.g=this.g.filter(function(b){return b!==a})};Qj.prototype.deRegisterOnDrop=Qj.prototype.ah;Qj.prototype.get=function(a,b){return(a=b?this.a[a]:Rj(this,this.a[a]))&&a.data};Qj.prototype.get=Qj.prototype.get;Qj.prototype.Gf=function(a){var b;(b=this.a[a])&&Sj(this,b,!0)};Qj.prototype.drop=Qj.prototype.Gf;
Qj.prototype.forEach=function(a,b,c){var d;for(d in this.a){var e=this.a[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};Qj.prototype.forEach=Qj.prototype.forEach;Qj.prototype.fa=function(a){var b;for(b in this.a){var c=this.a[b];(a?a(b,c.data,c.size):1)&&Sj(this,this.a[b],!0)}};Qj.prototype.removeAll=Qj.prototype.fa;Qj.prototype.Ai=function(a){if(!(0<+a))throw new C(Qj.prototype.Ai,0,a);this.i=+a;Uj(this);return this};Qj.prototype.setMaxSize=Qj.prototype.Ai;Qj.prototype.Qm=function(){return this.i};
Qj.prototype.getMaxSize=Qj.prototype.Qm;Qj.prototype.sm=function(){return this.b};Qj.prototype.getCurrentSize=Qj.prototype.sm;function Rj(a,b){b&&(a.c=Tj(a,b,a.c));return b}function Uj(a){for(;a.b>a.i&&a.f;)Sj(a,a.f,!0)}function Tj(a,b,c){if(c!==b){(b.mc||b.ed)&&Sj(a,b);if(b.mc=c)b.ed=c.ed,c.ed=b;b.ed||(a.c=b);b.mc||(a.f=b);a.b+=b.size}return b}
function Sj(a,b,c){var d=b.ed,e=b.mc;if(d||e||b==a.c&&b==a.f)if(d?d.mc=e:a.c=e,e?e.ed=d:a.f=d,a.b-=b.size,c){for(c=a.g.length;c--;)a.g[c].call(a,b.id,b.data,b.size);delete a.a[b.id]}b.mc=b.ed=null};var Vj,Wj=function(){function a(){}for(var b,c,d,e=Kb("o ms moz webkit "),f=5;f--&&!b;)b=e[f],b=(c=w[b+(b?"R":"r")+"equestAnimationFrame"])&&!D(c.call(window,a))&&(d=w[b+(b?"C":"c")+"ancelAnimationFrame"]);Vj=b?function(a){return c.call(w,a)}:function(a){return w.setTimeout(a,25)};return b?function(a){return d.call(w,a)}:function(a){return w.clearTimeout(a)}}(),Kj=w.performance&&w.performance.now?function(){return w.performance.now()}:function(){return w.Date.now()};function Yg(a,b,c,d,e,f){var g,h,k=a.length,l,m;if(k)for(g=[];k--;){var p=a[k];var q=p.length;var t=0;for(l=1;l<q;l++)if(m=Xj(p[l-1],p[l],c,b,d,e)){var v=m[0];var y=m[1];t&&t.ca(v)?h.push(y):g.push(h=m);t=y;f&&(l=q,k=0)}}else g=a;return g}r("H.math.clipping.clipStrips",Yg);
function Xj(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var l=a;g=h;a=b;h=k;b=l;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var m=1;a=-a;b=-b;l=f;f=-c;c=-l}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);m&&(a=-a,b=-b);return k?[new G(h,-b),new G(g,-a)]:[new G(g,-a),new G(h,-b)]}
function jh(a,b,c){a=Yj(a,!0);b=Yj(b,!1);var d,e;var f={};var g=d=1;switch(~~(c||0)){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.Ef=Zj(b.x,b.y,null,ak(b));a.Ef=Zj(a.x,a.y,null,ak(a));for(g=b;g.next;g=g.next)if(!g.Ya)for(d=a;d.next;d=d.next)if(!d.Ya){var k=bk(g.next);var l=bk(d.next);if(e=ck(g,k,d,l,f)){e=f.Nl;var m=f.Ol;var p=f.Fo;var q=f.Go;e=Zj(p,q,null,null,null,null,!0,0,0,e);dk(e,g,k);k=Zj(p,q,null,null,null,null,!0,0,0,m);dk(k,d,l);e.ai=k;k.ai=e}}f=mh(b,a);
c&&(f=!f);for(g=b;g;g=g.next)g.Ya&&(g.gh=f,f=!f);f=mh(a,b);h&&(f=!f);for(d=a;d.next;d=d.next)d.Ya&&(d.gh=f,f=!f);ek(b);for(ek(a);(a=fk(b))!=b;){for(c=null;!a.yg;a=a.ai){for(f=a.gh;;){c=Zj(a.x,a.y,c);c.artificial=a.Ya||a.zn;a.yg=1;a=f?a.next:a.Ub;if(!a)break;if(a.Ya){a.yg=1;break}}if(!a)break}c.bi=t;var t=c}return t}}r("H.math.clipping.clipPolygon",jh);
function Zj(a,b,c,d,e,f,g,h,k,l){a={x:a,y:b,next:c||null,Ub:d||null,bi:e||null,ai:f||null,Ya:!!g,gh:h||0,yg:k||0,alpha:l||0};d&&(a.Ub.next=a);c&&(a.next.Ub=a);return a}function bk(a){for(;a&&a.Ya;)a=a.next;return a}function ak(a){if(a)for(;a.next;)a=a.next;return a}function fk(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.Ya||b.Ya&&b.yg))}return b}function ek(a){var b=ak(a);b.Ub.next=a;a.Ub=b.Ub}
function ck(a,b,c,d,e){var f,g=b.x-a.x,h=b.y-a.y;var k=d.x-c.x;var l=d.y-c.y;var m=g*l-h*k;if(!m)return 0;k=((c.x-a.x)*l-(c.y-a.y)*k)/m;m=(h*(c.x-a.x)-g*(c.y-a.y))/m;if(0>k||1<k||0>m||1<m)return 0;0===k?f=a:1===k?f=b:0===m?f=c:1===m&&(f=d);if(f)return f.x+=2.480549651603763E-5,f.y+=7.321997314118067E-5,f.Ef&&(f.Ef.x=f.x,f.Ef.y=f.y),ck(a,b,c,d,e);e.Fo=a.x+k*g;e.Go=a.y+k*h;e.Nl=k;e.Ol=m;return 1}
function mh(a,b){var c=[];if(Array.isArray(b))c=b.reduce(function(a,b){a.push(b.x,b.y);return a},c);else for(;b;)c.push(b.x,b.y),b=b.next;return pd(a.x,a.y,c,0,!0)!==od.NONE}function dk(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.Ub=b.Ub;a.next.Ub=a;a.Ub.next=a}function Yj(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=Zj(a[e].x,a[e].y,d);c.zn=b;if(c.next=d)d.Ub=c;d=c}return d};function gk(a,b,c,d){this.key="";this.x=a;this.y=b;this.z=c;this.data=d;this.valid=!0}r("H.map.provider.Tile",gk);function hk(a,b,c,d){a-=c;b-=d;return a*a+b*b}function ik(a,b,c){return jk(a,b*b,c||0,0,a.length-1)}r("H.math.simplifyDP",ik);
function jk(a,b,c,d,e){var f=0,g=d,h=a[d].x,k=a[d].y,l=a[e].x,m=a[e].y,p=d+1,q=hk(h,k,l,m);if(q)for(;p<e;){var t=a[p++];var v=t.x;t=t.y;var y=((v-h)*(l-h)+(t-k)*(m-k))/q;v=0>y?hk(v,t,h,k):1<y?hk(v,t,l,m):hk(v,t,h+y*(l-h),k+y*(m-k));v>f&&(f=v,g=p-1)}else for(;p<e;)t=a[p++],v=t.x,t=t.y,v=hk(v,t,h,k),v>f&&(f=v,g=p-1);f>=b||0<c&&g-d?(--c,1<g-d?(d=jk(a,b,c,d,g),d.splice(d.length-1,1)):d=[a[d]],d=1<e-g?d.concat(jk(a,b,c,g,e)):d.concat(a.slice(g,e+1))):d=[a[d],a[e]];return d};function kk(a,b,c,d,e,f,g,h){kk.l.constructor.call(this,b,c,d,null);this.key=a;this.Y=h;this.a=e;1!==f&&(this.c=f);this.i={};this.zL=g;this.u=Mc(Bg.MAX_LINE_WIDTH/2*this.c+1)}u(kk,gk);r("H.map.provider.SpatialTile",kk);kk.prototype.f=hd;kk.prototype.o=hd;kk.prototype.b=hd;function lk(a){return a.Y.getInvalidations(xg.SPATIAL)}
function mk(a){var b=lk(a),c=b.a,d=a.f,e=d===c,f;if(!(e||b.bk(d)||b.Hh(d))){e=a.g;var g=a.i;if(b.Uf(d))for(f=e.length;f--;){var h=e[f];if(h.Qb().Uf(d)){e.splice(f,1);var k=k||nk(a,h.cb())}}if(b.Ih(d)){for(f=e.length;f--;)if(h=e[f],h.Qb().Ih(d)){var l=1;if((h=g[h.cb()])&&h.a){k=1;break}}l&&e.sort(ok)}if(!k&&b.Zd(d))for(f=e.length;f--;)if(e[f].Qb().Zd(d)){var m=1;break}a.o!==d||m||(a.o=c,a.b!==d||k||(a.b=c));a.f=c;e=!0}return e}
kk.prototype.Yd=function(){var a=lk(this),b=a.a,c=this.b,d=c===b;d||(this.Y.Pa&&!a.Zd(c)?d=!0:mk(this)&&(d=this.b===b));return d};kk.prototype.isCanvasValid=kk.prototype.Yd;Object.defineProperty(kk.prototype,"valid",{get:function(){return this.Yd()},set:vc,configurable:!0});function pk(a,b){this.b=a;this.a=b}function nk(a,b){a=a.i;var c=a[b];if(c)return delete a[b],c.a}kk.prototype.g=Se;
function qk(a){var b=lk(a),c=a.f,d=a.g,e;if(!mk(a)){for(e=d.length;e--;){var f=d[e];var g=f.Qb();(g.Uf(c)||g.Hh(c))&&nk(a,f.cb())}a.g=a.Y.requestSpatialsByTile(a,!1,!1).sort(ok);a.f=b.a}}function ok(a,b){return zg(yg(a),yg(b),!1)}kk.prototype.Ab=function(){return this.g};kk.prototype.getObjects=kk.prototype.Ab;var rk={};kk.prototype.Qe=function(){var a=this.a+"_"+this.c,b=rk[a];if(!b){b=-this.u;var c=this.a-b;b=rk[a]=new zj(b,b,c,c)}return b};kk.prototype.getPxClipRect=kk.prototype.Qe;
kk.prototype.Lf=function(){var a=this.Wa;if(!a){var b=this.Nf();a=0;var c=this.a;this.z&&(c-=a+=this.Qe().top);a=this.Wa=Of(b.$e(new G(a,a)),b.$e(new G(c,c)))}return a};kk.prototype.getGeoClipRect=kk.prototype.Lf;kk.prototype.Nf=function(){var a=this.v;if(!a){var b=this.a;a=this.v=new Gh(A,b);a.Ba(this.z);a.x=this.x*b;a.y=this.y*b}return a};kk.prototype.getPxProj=kk.prototype.Nf;kk.prototype.c=1;kk.prototype.Xa=function(){return this.c};kk.prototype.getPixelRatio=kk.prototype.Xa;
kk.prototype.hg=function(){var a=this.data;this.data=null;this.b=hd;return a};kk.prototype.releaseCanvas=kk.prototype.hg;kk.prototype.ig=function(){this.i={};delete this.g;this.f=hd};kk.prototype.releaseData=kk.prototype.ig;
kk.prototype.V=function(a){var b=a.getContext("2d"),c,d,e,f,g=0;qk(this);if(this.b<this.f){var h=this.g;if(c=h.length){a.width=a.height=this.a;b.clearRect(0,0,this.a,this.a);var k=this.i;for(d=0;d<c;d++){var l=h[d];var m=l.cb();if(f=(e=k[m])?e.b:l.getGeometriesForTile(this)){if(e)l.Qb().Zd(this.b)&&(e.a=Kg(l,f)),e=e.a;else{e=Kg(l,f);var p;var q=f;for(var t=l.g?2:0,v=q.length;v--;){var y=q[v];if(y!==Lg){var E=y.a;for(p=E.length;p--;)y=E[p],4<y.length&&(E[p]=ik(y,.6,t))}}this.i[m]=new pk(f,e)}if(e){b.save();
q=l.g?this.K:this.A;for(m=0;m<f.length;m++)q.call(this,l,f[m],l.Ta(),b);if(f=l.getLabels(this))for(l=b,m=f.length;m--;)for(t=f[m],q=t.size,l.font=q+"px "+t.font,l.fillStyle=t.color,l.textAlign="center",l.translate(t.x,t.y),l.rotate(t.angle),q=t.lineHeight||1.375*q,v=t.lines,t=v.length;t--;)l.fillText(v[t],0,t*q);b.restore()}g|=e}}}this.data=g?a:null;this.o=this.b=this.f}else this.data&&(g=1);return 0<g};kk.prototype.render=kk.prototype.V;
kk.prototype.A=function(a,b,c,d){var e;c.Se&&(sk(d,c,this.c),tk(b,d,!1,!0,!1,this.a,this.u));c.Re&&(e=a.f)&&e.Tb&&(uk(d,e),vk(this,d,b,e,c.lineWidth))};
kk.prototype.K=function(a,b,c,d){var e=c.Tb,f=c.Se,g,h=this.a,k=this.u;if(b===Lg)e&&(uk(d,c),d.fillRect(0,0,h,h));else{f&&sk(d,c,this.c);if(c.Re&&(g=a.f)){var l=c.lineWidth;g.Tb||(g=null)}a=b.c;if(a===gd){if(f||e)uk(d,c),tk(b,d,!0,f,e,h,this.u);g&&(uk(d,g),vk(this,d,b,g,l,0))}else e&&(uk(d,c),tk(b,d,!0,!1,e,h,k,0,a)),f&&tk(b,d,!1,f,!1,h,k,a),g&&(uk(d,g),vk(this,d,b,g,l,a))}};
function tk(a,b,c,d,e,f,g,h,k){var l=a.a,m=-g;g=f+g;h=h||0;k===A&&(k=l.length);if(e&&a===Lg)b.fillRect(0,0,f,f);else if(k>h){b.beginPath();for(f=h;f<k;f++){var p=l[f];var q=p.length;if(p===dh)b.moveTo(m,m),b.lineTo(m,g),b.lineTo(g,g),b.lineTo(g,m);else{var t=p[0];b.moveTo(t.x,t.y);for(h=1;h<q;h++)t=p[h],b.lineTo(t.x,t.y)}c&&b.closePath()}c&&e&&b.fill(a.b!==gd?"evenodd":"nonzero");d&&b.stroke()}}
function sk(a,b,c){var d;a.strokeStyle=b.strokeColor;a.lineWidth=b.lineWidth*c;a.lineCap=b.lineCap;a.lineJoin=b.lineJoin;a.miterLimit=b.miterLimit;a.setLineDash&&(d=b.lineDash)!==Se&&(a.setLineDash(d),a.lineDashOffset=b.lineDashOffset)}function uk(a,b){a.fillStyle=b.fillColor}
function vk(a,b,c,d,e,f){var g=e*d.width/2;e=e*d.length/2;var h=e/2;d=2*e*d.frequency;var k=Pc(Rc(e,2)+Rc(g,2));a=a.a-k;a=new zj(k,k,a,a);c=c.a;var l,m,p,q,t,v,y,E=$c/2;f=f||0;for(k=c.length;k-- >f;){var N=0;var Y=c[k];if(m=l=Y.length){var Ca=Y;m=Ca.length;for(p=0;--m;)p+=Ca[m].ab(Ca[m-1]);m=(Ca=p)>=d}if(m)for(m=Ic(Lc(Ca/d),1E3),m=Ca/(m+1),p=m/2;--l;){for(q=(t=Y[l]).ab(v=Y[l-1]);p<=N+q;){var na=t.x+(v.x-t.x)*(y=(p-N)/q);y=t.y+(v.y-t.y)*y;a.Df(na,y)&&(b.save(),b.translate(na,y),b.rotate(-Xc((v.y-t.y)/
(t.x-v.x))+(t.x<v.x?E:-E)),b.beginPath(),b.moveTo(-g,-e),b.lineTo(0,e),b.lineTo(g,-e),b.lineTo(0,-h),b.closePath(),b.fill(),b.restore());p+=m}N+=q}}}var wk=[];
kk.prototype.Ea=function(a,b,c){for(var d=this.g,e=d.length,f,g,h,k,l,m,p=Se,q,t=this.c;e--;)if(g=d[e],g.Ac(!0)&&(h=this.i[g.cb()])&&(k=h.b)){f=g.Ta();m="none"!==f.fillColor&&g.g;q="none"===f.strokeColor?0:f.lineWidth*t;for(f=k.length;f--;){l=k[f];var v;if(!(v=m&&l===Lg)&&(v=m||q)){var y;v=a;var E=b,N=m,Y=q,Ca=l.b,na=l.c,Ja=na!==gd,ia=l.a,Ub=ia.length,nb=0,Qc=0,$h=!1;for(l=0;l<Ub;l++){var se=ia[l];var Cb=l>=na;var ai=!Cb&&l>=Ca;if(se===dh&&N)ai?nb++:Qc++;else{var bi=se.length;wk.length=2*bi;for(y=
0;y<bi;y++){var Cf=se[y];wk[2*y]=Cf.x;wk[2*y+1]=Cf.y}y=N&&!Cb;Cb=Ja&&!Cb?0:Y;if(y||Cb)if(Cb=pd(v,E,wk,Cb,y),Cb===od.EDGE||Cb===od.VERTEX){$h=!0;break}else if(Cb===od.SURFACE)if(ai)nb++;else if(Qc++,Ca===gd)break}}v=$h||0<Qc&&!(nb%2)}if(v){p===Se&&(p=[]);p.push(g);break}}if(c&&p.length)break}return p};function xk(a,b){var c;xk.l.constructor.call(this,b);this.K=a;this.I=a=b.pixelRatio;this.tileSize=c=1<<Kc(id((b.tileSize||256)*a));this.J=Oj(c,a);this.Ph=z(this.Ph,this);this.di=z(this.di,this);this.Qh=z(this.Qh,this);this.Oh=z(this.Oh,this);this.o=z(this.o,this);this.K.addEventListener(ii.prototype.i.Ca,this.o,!1,this);this.b=[];this.g=new Qj(b.tileCacheSize||256,this.Ph);this.u=new Qj(b.dataCacheSize||512,this.di);this.A=new Lj(20,this.Qh);this.a={};this.v=Kj()}u(xk,Nj);
r("H.map.provider.SpatialTileProvider",xk);xk.prototype.o=function(a){a.target.type===xg.SPATIAL&&oj(this,a.target)};xk.prototype.gb=function(a,b,c,d){var e=this.getTileKey(a,b,c),f;if(f=this.g.get(e,d)){if(d||f.Yd())return f;d||this.g.Gf(e)}if((f=this.u.get(e,d))&&(d||mk(f)))return a=this.b.pop()||document.createElement("canvas"),f.V(a)||this.b.push(a),this.g.add(e,f,1),f;d||((f=this.a[e])?f.count++:(f=this.A.push([e,a,b,c],this.Oh),f.count=1,this.a[e]=f))};xk.prototype.requestTile=xk.prototype.gb;
xk.prototype.jd=function(){};xk.prototype.Tc=function(a,b,c){this.Af(this.getTileKey(a,b,c))};xk.prototype.cancelTile=xk.prototype.Tc;xk.prototype.Af=function(a){var b;if(b=this.a[a])b.count--,b.count||(b.cancel(),delete this.a[a])};xk.prototype.cancelTileByKey=xk.prototype.Af;n=xk.prototype;
n.Qh=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];c=this.g.get(c)||new kk(c,d,e,f,this.tileSize,this.I,f+this.J,this.K);d=c.data||this.b.pop()||document.createElement("canvas");c.V(d)||this.b.push(d);b.push(c);a.done(c)};n.Oh=function(a,b){a=a.data[0];b&&this.g.add(a,b,1);delete this.a[a];oj(this)};n.Ph=function(a,b){b.data&&this.b.push(b.hg());this.u.add(a,b,1)};n.di=function(a,b){b.ig()};n.s=function(){for(var a in this.a)this.a[a].cancel();this.g.fa();this.u.fa();this.b.length=0;xk.l.s.call(this)};function yk(a,b){b=b||{};if(!a)throw new C(zk,0,a);this.tileSize=a.tileSize;this.c={};hi.call(this,{min:void 0!==b.min?b.min:a.min,max:void 0!==b.max?b.max:a.max,minWorldSize:this.tileSize,projection:b.Uo,dark:b.dark,provider:a})}u(yk,hi);r("H.map.layer.BaseTileLayer",yk);yk.prototype.He=function(a,b){var c=this.pixelProjection;if(!B(a,I))throw new C(this.He,0,a);if(!D(b)){var d=c.Uj();c.Ba(b)}a=Ak(c.ib(a.Sb()),c.ib(a.Ob()));!D(d)&&c.Ba(d);return a};yk.prototype.geoRectToRect=yk.prototype.He;
yk.prototype.Vd=function(a,b){var c=Rc(2,Lc(b)),d=this.tileSize;if(!B(a,zj))throw new C(this.Vd,0,a);if(D(b=+b))throw new C(this.Vd,1,b);b=Lc(a.left/d);b===c&&--b;var e=Lc(a.right/d);e===c&&--e;return new zj(b,ld(Lc(a.top/d),0,c-1),e,ld(Lc(a.bottom/d),0,c-1))};yk.prototype.getTileBounds=yk.prototype.Vd;yk.prototype.gb=function(a,b,c,d){return this.a.requestTile(a,b,c,d)};yk.prototype.Tc=function(a,b,c){this.a.cancelTile(a,b,c)};yk.prototype.cancelTile=yk.prototype.Tc;
yk.prototype.va=function(a,b){return this.a.getCopyrights?this.a.getCopyrights(a,b):null};yk.prototype.getCopyrights=yk.prototype.va;function Bk(a,b,c,d,e){d=Lc(d);var f=Rc(2,d),g=b.left,h=b.top,k=b.right;c=k+(c?f+(k===b.left?0:1):1);var l=b.bottom,m=[];if(e){var p=g+(1+k-g)/2+e.x/a.tileSize-.5;var q=h+(1+l-h)/2+e.y/a.tileSize-.5}for(;g<c;){for(h=b.top;h<=l;)a=g%f,m.push([a,h,d,e?Nc(p-g)+Nc(q-h):0]),h++;g++}return m}
function Dj(a,b,c){c=Lc(c);a.pixelProjection.Ba(c);b=a.He(b);var d=a.Vd(b,c);return Bk(a,d,b.left>b.right,c)}
yk.prototype.Pe=function(a,b,c,d,e,f){var g,h=[],k,l=this.a;f=null!=f?f:"__default__";var m=l.requestTile;if(!B(a,zj))throw new C(this.Pe,0,a);if(D(c=+c))throw new C(this.Pe,1,c);d||(g={});b=Bk(this,a,b,c,e);if(a=b.length)for(d||b.sort(Ck),c=a;c--;)e=b[c],d||(g[l.Of.apply(l,e)]=!0),e[3]=+d,(k=m.apply(l,e))&&h.push(k);if(!d){d=g;var p;g=this.c[f]||{};for(p in g)g.hasOwnProperty(p)&&g[p]&&!d[p]&&this.a.cancelTileByKey(p);this.c[f]=d}return{total:a,tiles:h}};yk.prototype.getProviderTiles=yk.prototype.Pe;
function Ck(a,b){return b[3]-a[3]};function P(a){Nb(this,P);P.l.constructor.call(this,a);this.g={};this.u={};this.fc=new Dk;this.hd=z(this.hd,this);this.L=Ek;this.createTileInternal=this.jd.bind(this)}u(P,Nj);r("H.map.provider.RemoteTileProvider",P);P.prototype.Nd=function(){return 1};P.prototype.getEntryWeight=P.prototype.Nd;var Ek=new Qj(65536);P.prototype.Pb=function(){return this.L};P.prototype.getCache=P.prototype.Pb;P.prototype.K=ba(2);P.prototype.hd=function(a){var b=this.uri;return!a.indexOf(b)&&"_"===a.charAt(b.length)};
P.prototype.cacheFilter=P.prototype.hd;P.prototype.Pa=function(a,b){b.valid=!1};P.prototype.reload=function(a){var b,c=this.getCache();a?c.fa(this.hd):c.forEach(this.Pa,this,this.hd);for(b in this.g)this.g[b].cancel(),this.u[b].cancel();this.g={};this.u={};oj(this)};P.prototype.reload=P.prototype.reload;P.prototype.we=function(){return!1};P.prototype.canStore=P.prototype.we;P.prototype.MAX_STORE_TIME=Infinity;P.prototype.Ud=function(){return this.fc};P.prototype.getStorage=P.prototype.Ud;
P.prototype.$=function(a,b){b(a)};function Ej(a,b,c,d,e,f){var g=a.Ud();d=~~d;return a.requestInternal(b,c,d,function(h,k){g.put(a.Of(b,c,d),k&&{raw:k.raw,timestamp:w.Date.now()},e,f)},f,0)}P.prototype.requestInternal=P.prototype.Za;
P.prototype.gb=function(a,b,c,d){var e=this;var f=this.getCache();if(D(a=+a))throw new C(this.gb,0,a);if(D(b=+b))throw new C(this.gb,0,b);if(D(c=+c))throw new C(this.gb,0,c);c=~~c;var g=this.getTileKey(a,b,c);f=f.get(g);f&&f.valid||d||this.g[g]||(f=A,this.requestTileAsPromise(a,b,c,d).then(function(a){oj(e,a)},vc));return f};P.prototype.requestTile=P.prototype.gb;
P.prototype.Tk=function(a,b,c,d){var e=this,f=this.getCache(),g=this.getTileKey(a,b,c),h=this.g,k=this.u,l,m=this.Ud();if(k[g])return k[g];k[g]=k=new hb(function(k,q){l=m.get(g,function(l){var p,t;var E=function(d,h){t=e.createTileInternal(a,b,c,d,h);t.key=g;f.add(g,t,e.Nd(d));k(t);Fk(e,g)};l&&(p=w.Date.now()-l.timestamp);l&&p<e.MAX_STORE_TIME?e.$(l.raw,E):(p&&m.remove(g),(t=f.get(g))&&t.valid||d?k(t||null):h[g]=e.requestInternal(a,b,c,E,q))},q)});h[g]||(h[g]=l);k.then(function(){Fk(e,g)},function(){Fk(e,
g)});return k};P.prototype.requestTileAsPromise=P.prototype.Tk;P.prototype.Sk=function(a,b){var c=this,d=a.id,e=a.tile.coords;return new hb(function(a,g){c.Tk(e.x,e.y,e.z,b).then(function(b){var c=x;b=b.Ab?b.Ab():b.data;for(var e=b.length,f;e--;)if(f=b[e],f.cb()===d){c=f;break}a(c)},g)})};P.prototype.requestObjectAsPromise=P.prototype.Sk;function Fk(a,b){delete a.g[b];delete a.u[b]}var Gk={cancel:function(){}};P.prototype.jd=function(a,b,c,d){return new gk(a,b,c,d)};
P.prototype.Af=function(a){var b=this.g[a];b&&(b.cancel(),this.u[a].cancel(),Fk(this,a))};P.prototype.cancelTileByKey=P.prototype.Af;P.prototype.Tc=function(a,b,c){this.cancelTileByKey(this.getTileKey(a,b,c))};P.prototype.cancelTile=P.prototype.Tc;P.prototype.s=function(){var a;P.l.s.call(this);this.getCache().fa(this.hd);for(a in this.g)this.g[a].cancel(),this.u[a].cancel(),Fk(this,a)};function Dk(){}P.NullStorage=Dk;Dk.prototype.get=function(a,b){b();return Gk};Dk.prototype.get=Dk.prototype.get;
Dk.prototype.put=function(a,b,c){c&&c()};Dk.prototype.put=Dk.prototype.put;Dk.prototype.clear=function(a){a&&a()};Dk.prototype.clear=Dk.prototype.clear;Dk.prototype.remove=function(a,b){b&&b()};Dk.prototype.remove=Dk.prototype.remove;function Gj(a){Gj.l.constructor.call(this,a);a&&(this.I={crossOrigin:a.crossOrigin||"anonymous"},this.A=a.getURL);if(!wa(this.A))throw new C(Gj,0,"getURL");pj(this,a.opacity);this.b=w.URL||w.webkitURL;a=this.I.crossOrigin;if(!(a="anonymous"===a||"use-credentials"===a)){a=this.A(0,0,0);var b=window.location,c=document.createElement("a");c.href=a;a=c.hostname===b.hostname&&c.port===b.port&&c.protocol===b.protocol}(this.S=a&&!!af.prototype.b.arraybuffer&&!!this.b)&&this.Pb().ee(z(this.Hb,this))}
u(Gj,P);r("H.map.provider.ImageTileProvider",Gj);Gj.prototype.oc=function(a){pj(this,a)};Gj.prototype.setOpacity=Gj.prototype.oc;Gj.prototype.Zc=function(){return this.j};Gj.prototype.getOpacity=Gj.prototype.Zc;Gj.prototype.bf=Qe;Gj.prototype.providesRasters=Gj.prototype.bf;Gj.prototype.Nd=function(){return this.tileSize};Gj.prototype.getEntryWeight=Gj.prototype.Nd;
Gj.prototype.Za=function(a,b,c,d,e,f){var g=this,h=this.A(a,b,c),k;a=null;if(h){var l=w.setTimeout(function(){g.S?k=(new af("arraybuffer",h,f,g.I)).then(function(a){return a.blob()}).then(function(a){var b=new Image;b.onload=z(d,null,b,{raw:a});b.onerror=z(e,null,"bad url");try{b.src=g.b.createObjectURL(a)}catch(q){}},e):k=(new af("image",h,f,g.I)).then(d,e)},150);a={cancel:function(){k?k.cancel():w.clearTimeout(l)}}}else d(null);return a};Gj.prototype.requestInternal=Gj.prototype.Za;
Gj.prototype.$=function(a,b){var c=new Image;c.onload=function(){b(this)};c.src=this.b.createObjectURL(a)};Gj.prototype.Hb=function(a,b){(a=b.data)&&a instanceof HTMLImageElement&&this.b.revokeObjectURL(a.src)};function zj(a,b,c,d){this.left=+a;this.top=+b;this.right=+c;this.bottom=+d}r("H.math.Rect",zj);zj.prototype.set=zj;zj.prototype.set=zj.prototype.set;zj.prototype.Sb=function(){return this.c||(this.c=new G(this.left,this.top))};zj.prototype.getTopLeft=zj.prototype.Sb;zj.prototype.Ob=function(){return this.a||(this.a=new G(this.right,this.bottom))};zj.prototype.getBottomRight=zj.prototype.Ob;zj.prototype.Df=function(a,b){return this.left<=a&&this.right>=a&&this.top<=b&&this.bottom>=b};
zj.prototype.containsXY=zj.prototype.Df;function Ak(a,b){return new zj(a.x,a.y,b.x,b.y)}zj.fromPoints=Ak;zj.prototype.clone=function(){return new zj(this.left,this.top,this.right,this.bottom)};zj.prototype.clone=zj.prototype.clone;function zk(a,b){yk.call(this,a,b)}u(zk,yk);r("H.map.layer.TileLayer",zk);zk.prototype.yd=function(a,b,c,d,e){if(!B(a,I))throw new C(this.yd,0,a);if(D(b=+b))throw new C(this.yd,1,b);b=Lc(b);this.pixelProjection.Ba(b);a=this.He(a);var f=this.Vd(a,b);return this.Pe(f,a.left>a.right,b,c,d,e)};zk.prototype.requestTiles=zk.prototype.yd;function Hk(a,b){b=b?Na(b):{};b.tileSize=b.tileSize||256;b.pixelRatio=b.pixelRatio||1;b.max=24;this.c=new xk(a,b);this.f=new zk(this.c);b.minWorldSize=this.c.tileSize;b.provider=a;Hk.l.constructor.call(this,b);this.tileSize=this.f.tileSize;this.j=z(this.j,this);this.c.addEventListener(this.c.i.Ca,this.j);a.addEventListener("update",this.j)}u(Hk,hi);r("H.map.layer.ObjectLayer",Hk);Hk.prototype.j=function(a){a.currentTarget!==this.c&&a.target.type===xg.SPATIAL||this.g()};var Ik={markers:Se,total:0};
Hk.prototype.Jc=function(a,b,c){var d=this.a,e;return d.providesMarkers()&&(e=d.requestMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:Ik};Hk.prototype.requestMarkers=Hk.prototype.Jc;Hk.prototype.Ic=function(a,b,c){var d=this.a,e;return d.providesDomMarkers()&&(e=d.requestDomMarkers(a,b,!0,c)).length?{markers:e,total:e.length}:Ik};Hk.prototype.requestDomMarkers=Hk.prototype.Ic;var Jk={tiles:Se,total:0};
Hk.prototype.yd=function(a,b,c,d){if(this.a.providesSpatials()){var e=this.f.yd(a,b,c,d);c||(c=this.c,e=Kj(),33<e-c.v&&(Hj(c.A),c.v=e),e=this.f.yd(a,b,!0,d))}else e=Jk;return e};Hk.prototype.requestTiles=Hk.prototype.yd;Hk.prototype.gb=function(a,b,c,d){return this.f.gb(a,b,c,d)};Hk.prototype.requestTile=Hk.prototype.gb;Hk.prototype.Tc=function(a,b,c){this.f.Tc(a,b,c)};Hk.prototype.cancelTile=Hk.prototype.Tc;var Kk={overlays:Se,total:0};
Hk.prototype.xd=function(a,b,c){var d=this.a,e=Kk;d.providesOverlays&&d.providesOverlays()&&(a=d.requestOverlays(a,b,!0,c),b=a.length)&&(e={overlays:a,total:b});return e};Hk.prototype.requestOverlays=Hk.prototype.xd;Hk.prototype.s=function(){this.c.D();this.f.D();this.a.dispose();Hk.l.s.call(this)};function Lk(a,b,c,d){var e=new zj(0,0,0,0);Lk.l.constructor.call(this);if(!a)throw new C(Lk,0,a);if(!b)throw new C(Lk,1,b);if(!c)throw new C(Lk,2,c);if("object"!==typeof d)throw new C(Lk,3,d+" is not an object");if("number"!==typeof d.pixelRatio)throw new C(Lk,3,d.pixelRatio+" is not a number");this.ra=d.pixelRatio;this.zoom=0;this.fb=Oc(this.ra)/Zc;this.a=new Gh;this.Hb={1:e.clone(),2:e.clone(),4:e.clone()};this.c=new G(.5,.5);this.j=a;Mk(this,this.ra);this.qc=z(this.qc,this);this.kc=z(this.kc,this);
this.xb=z(this.xb,this);a.startInteraction=this.qc;a.interaction=this.kc;a.endInteraction=this.xb;a.addEventListener(a.a.Ca,this.td,!1,this);this.K=b;this.pc=z(this.pc,this);this.control=z(this.control,this);this.wb=z(this.wb,this);b.startControl=this.pc;b.control=this.control;b.endControl=this.wb;b.addEventListener(b.a.Ca,this.Tg,!1,this);this.i=c;this.$f=z(this.$f,this);this.Ue=z(this.Ue,this);this.Ve=z(this.Ve,this);this.Zf=z(this.Zf,this);c.addEventListener(hi.prototype.b.Ca,this.$f,!1,this);
c.addEventListener(c.b.ne,this.Ue,!1,this);c.addEventListener(c.b.re,this.Ve,!1,this);c.addEventListener(c.b.se,this.Zf,!1,this)}u(Lk,F);r("H.map.render.RenderEngine",Lk);n=Lk.prototype;n.ra=1;function Mk(a,b){var c=a.j,d=c.width,e=c.height,f=c.padding,g=f.top,h=f.left,k=f.bottom;f=f.right;c=c.margin;var l=-(d+h-f)/2<<0,m=-(e+g-k)/2<<0;d+=l;e+=m;a=a.Hb;a[1].set((l-c)*b,(m-c)*b,(d+c)*b,(e+c)*b);a[2].set(l*b,m*b,d*b,e*b);a[4].set((l+h)*b,(m+g)*b,(d-f)*b,(e-k)*b)}n.td=function(){Mk(this,this.ra)};
n.s=function(){var a=this.j,b=this.K,c=this.i;a.removeEventListener(a.a.Ca,this.td,!1,this);a.startInteraction===this.qc&&(a.startInteraction=yj.prototype.qc);a.interaction===this.kc&&(a.interaction=yj.prototype.kc);a.endInteraction===this.xb&&(a.endInteraction=yj.prototype.xb);b.removeEventListener(b.a.Ca,this.Tg,!1,this);b.startControl===this.pc&&(b.startControl=Nk.prototype.pc);b.control===this.control&&(b.control=Nk.prototype.control);b.endControl===this.wb&&(b.endControl=Nk.prototype.wb);c.removeEventListener(hi.prototype.b.Ca,
this.$f,!1,this);c.removeEventListener(c.b.ne,this.Ue,!1,this);c.removeEventListener(c.b.re,this.Ve,!1,this);c.removeEventListener(c.b.se,this.Zf,!1,this)};n.control=function(){};n.capture=function(){return rb(Error("not implemented"))};function Ok(a,b){a.style.transition="opacity 1.5s";a.addEventListener("transitionend",b,!1);a.style.opacity=0}var Pk={ZOOM:1,HEADING:2,TILT:4,INCLINE:8,COORD:16};Lk.InteractionModifiers=Pk;n=Lk.prototype;n.ik={gj:"render"};n.$f=function(a){this.Ck(a);this.ja()};
n.Ue=function(a){this.Xe(a.idx,a.added)};n.Ve=function(a){this.ei(a.idx,a.removed,a.type===this.i.b.se)};n.Zf=function(a){this.Ve(a);this.Ue(a)};n.Ck=vc;n.Xe=function(a,b){this.Dh(a,b);0===a&&this.Kb();B(b,hi)&&Qk(this,b,!0);this.he();this.ja()};n.Kb=function(){var a=this.i.$a();if(0<a.length){var b=a[0].max;this.Cg=a[0].min;this.Kg=b}else a=this.getCapabilities().lookAt.zoom,b=a.max,this.Cg=a.min,this.Kg=b;a=Rk(this,this.zoom);a!==this.zoom&&(this.zoom=a,this.a.Ba(a),Sk(this))};
function Sk(a,b){a.J=a.mb();b&&(a.J.position=b);a.J.zoom=a.zoom-a.fb;a.J.position.alt=0}n.yo=0;n.heading=180;n.mb=function(){return Tk(this,{position:this.a.projection.eg(this.c),zoom:this.zoom,tilt:this.yo,heading:this.heading})};function Tk(a,b){b.tilt=Uk(a,b.tilt);b.heading=Vk(a,b.heading);b.incline=a.getCapabilities().lookAt.incline.min;return b}function Rk(a,b){var c=a.getCapabilities().lookAt.zoom;return ld(b,Jc(c.min,a.Cg),Ic(c.max,a.Kg))}
function Uk(a,b){a=a.getCapabilities().lookAt.tilt;return ld(b,a.min,a.max)}function Vk(a,b){a=a.getCapabilities().lookAt.heading;return ld((b%360+360)%360,a.min,a.max)}function Qk(a,b,c){c=c?b.addEventListener:b.removeEventListener;c.call(b,b.b.bj,a.fi,!1,a);c.call(b,b.b.aj,a.fi,!1,a)}n.Dh=vc;n.ei=vc;n.ro=function(a,b){this.I={mj:a,kj:b}};Lk.prototype.setOnRenderCallbacks=Lk.prototype.ro;var Wk={P2D:0,WEBGL:1};Lk.EngineType=Wk;var Xk={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:85},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:Pk.ZOOM,COORD:Pk.COORD},capture:!0};r("H.map.render.webgl.capabilities",Xk);function Yk(a){var b,c=this,d=w.H.gl;Yk.l.constructor.call(this);this.a=b=d.Scene.create(w.URL.createObjectURL(Ze(JSON.stringify(Zk))),{viewport:a.viewport,container:a.sc,disableRenderLoop:!0,devicePixelRatio:a.devicePixelRatio,logLevel:"error"});a.Yn&&b.subscribe({load:a.Yn});b.subscribe({view_complete:function(){c.f=!0;a.Ek()}});var e=b.requestRedraw;b.requestRedraw=function(){e.apply(b);a.Ek()};this.g=z(this.g,this);this.mg=z(this.mg,this);this.si=z(this.si,this);this.i=0;this.c={};this.b={}}
u(Yk,Ac);Yk.prototype.f=!1;Yk.prototype.V=function(){var a=w.H.gl.Task;this.a.immediateRedraw();a.setState({user_moving_view:this.a.view.user_input_active});a.processAll();if(a=this.f&&!this.a.dirty&&!this.a.building){a:{a=this.a.sources;for(c in a){var b=a[c];if(b.hasPendingCommands&&b.hasPendingCommands()){var c=!0;break a}}c=!1}a=!c}return a&&!Object.keys(this.b).length};function $k(a){a.f=!1;a.a.resetViewComplete()}function al(a){return a.a.view}
function bl(a,b){function c(){var c=b.$a(),e={},f={},g,h,k=++a.i,l;Nh(f,Zk);for(g=0;g<c.length;g++){var m=c[g];var p=m.ya();var q=p.Rb();if(q.getState()===cj.READY){var t=q.Kf();if(!Ma(t)){delete t.cameras;delete t.camera;e[g]=t=Yh(t,g);B(m,Hk)||Zh(t,p.uid);for(h in t.sources){var v=t.sources[h];v.max_zoom=Ic(p.max,Xk.lookAt.zoom.max);v.max_display_zoom=m.max;v.min_display_zoom=m.min;p.tileSize&&(v.tile_size=p.tileSize)}(l=q.Ld())&&ci(t,l);Nh(f,t)}}}a.a.config=f;return a.a.updateConfig().then(function(){var b=
{},d,f;if(k!==a.i)return!1;a.i=0;for(f in e){m=c[+f];var g=e[f].sources;for(d in g)if(g=a.a.sources[d])b[d]=g,g.initialize&&m.getProvider()&&g.initialize(m.getProvider(),a.g,a.a.getWorkers().length,g.tiled?A:a.a.tile_manager.getWorkerForTile(x,g))}for(d in a.c)!b[d]&&a.c[d].dispose&&a.c[d].dispose();a.c=b;return!0})}a.a.initialized?c():a.a.load(x,{blocking:!1}).then(c)}
Yk.prototype.g=function(a,b){var c=this.a.sources[a];b?!0!==this.b[a]&&(this.b[a]||(this.b[a]={}),this.b[a][b.x+"/"+b.y+"/"+b.z]=!0):this.b[a]=!0;c&&c.has_volatile_data?this.mg():(w.clearTimeout(this.j),this.j=w.setTimeout(this.mg,cl))};var cl=100;n=Yk.prototype;n.si=function(a){var b=!1,c=this.b[a.source.name];c&&(b=!0===c?!0:!!c[a.coords.key]);return b};n.mg=function(){this.a.tile_manager.removeTiles(this.si);this.a.tile_manager.updateTilesForView();$k(this);this.b={}};n.Kf=function(){return this.a.config};
function dl(a){return a.a.screenshot(void 0).then(function(a){return new hb(function(b,d){new Ki(URL.createObjectURL(a.blob),function(a,c){1===a?b(c.getData()):d()},!1)})})}n.Xa=function(){return this.a.pixelRatio()};n.s=function(){var a=this.c;Yk.l.s.call(this);this.a.destroy();this.b={};a&&Object.keys(a).forEach(function(b){a[b].dispose()});w.clearTimeout(this.j);this.c=this.a=null};
var Zk={scene:{background:{color:"#FFFFFF"}},lights:{default_light:{type:"directional",name:"default_light",visible:!0}},camera:{type:"perspective"},fonts:{},sources:{skybox:{type:"SkyBox"}},layers:{skybox:{data:{source:"skybox"},draw:{skybox:{color:{top:"rgb(52,123,192)",bottom:"rgb(237,242,249)",fog:"rgb(255,255,255)"}}}}},global:{}};function el(a,b){if(D(this.x=+a))throw new C(el,0,a);if(D(this.y=+b))throw new C(el,1,b);}el.prototype.add=function(a){return new el(this.x+a.x,this.y+a.y)};el.prototype.a=function(a){if(!B(a,el))throw new C(this.a,0,a);a=this.b(a);return a.x+a.y};el.prototype.b=function(a){if(!B(a,el))throw new C(this.b,0,a);return new el(this.x*a.x,this.y*a.y)};el.prototype.Ba=function(a){return new el(this.x*a,this.y*a)};function fl(a){return Pc(a.a(a))};function gl(){this.Wa=Mb(Te.Vn)?Te.Vn:3;this.Y=Mb(Te.Un)?Te.Un:300;this.o=Mb(Te.Do)?Te.Do:3;this.v=Mb(Te.zo)?Te.zo:50;this.f=[];this.clear()}gl.prototype.start=function(a,b){var c=Pk.HEADING,d=Pk.TILT;this.a&&this.clear();this.b=a;this.m=!!b;this.a=!0;this.j=!(a&(c|d))||a===c||a===d};
gl.prototype.store=function(a,b,c,d,e){var f=!1;if(this.a){a=new hl(a,b,c,d,e);f=a.c;this.u=this.c;this.c=a;if(this.g){if(this.i=!0,f){b=this.b;var g=this.j;if(!g&&this.i){e=Pk.HEADING;var h=Pk.TILT;c=Pk.COORD;d=Pk.ZOOM;var k=b&(c|h)?il(this,!0):jl;var l=b&d?kl(this,!0):1;var m=b&e?Nc(this.i?ll(this.g,this.c):0):0;var p=Nc(k.x);var q=Nc(k.y);k=10<p||10<q;p=10<q&&q>3*p;l=.8>l||1.2<l;m=7<m;b&h&&(m||l||k&&!p?ml(this,h):p&&(ml(this,~h>>>0),g=!0));!g&&b&e&&b&(c|d)&&(l||k?(ml(this,e),g=!0):m&&(ml(this,
h),g=!0));this.j=g}}}else this.g=a,f||(this.j=!0);this.m&&this.f.push(a)}return f};gl.prototype.clear=function(){this.f.length=0;this.a=this.m=this.i=this.j=!1;this.g=this.u=this.c=void 0};function ml(a,b){a.b^=a.b&b}gl.prototype.Ha=function(){return this.a};var jl=Ib(new el(0,0));function nl(a){var b;if(a.m){var c=a.f;var d=c.length;var e=0;for(b=new el(0,0);--d&&e<a.o;)b=b.add(ol(c[d-1],c[d])),e++}else b=il(a);a=b;c=fl(a);return 0!==c?new el(a.x/c,a.y/c):a}
function pl(a){var b=Kj(),c,d;if(a.m){var e=a.f;var f=a.f.length;var g=a.f[f-1];for(d=c=0;--f&&c<a.o;)d+=fl(ol(e[f],e[f-1])),c++;e=d/c}else g=a.c,e=fl(il(a));return e=e>=a.Wa&&b-g.timestamp<=a.v?e>a.Y?a.Y:e:0}function ql(a){return a.c?rl(a.c):A}function il(a,b){return(b=b?a.g:a.u)?ol(b,a.c):new el(0,0)}function kl(a,b){var c=1;if(a.i){var d=a.c;a=b?a.g:a.u;if(a=sl(a))if(d=sl(d))c=d/a}return c}
function hl(a,b,c,d,e){this.a=new G(a,b);c!==A&&(this.b=new G(c,d),this.c=!0);this.timestamp=e!==A?e:Kj()}hl.prototype.c=!1;function rl(a){var b=a.a;return(a=a.b)?new G(b.x-(b.x-a.x)/2,b.y-(b.y-a.y)/2):A}function tl(a,b){var c=a.a;return(a=a.b)&&a.ab(b)<c.ab(b)?a:c}function ol(a,b){var c=a.b,d=b.b;d&&c?(b=rl(b),a=rl(a)):c?(b=b.a,a=tl(a,b)):d?(a=a.a,b=tl(b,a)):(b=b.a,a=a.a);return new el(b.x-a.x,b.y-a.y)}
function ll(a,b){var c=a.b,d=b.b,e=0;c&&d&&(a=a.a,b=b.a,e-=Yc(d.y-b.y,d.x-b.x)*fd-Yc(c.y-a.y,c.x-a.x)*fd);return e}function sl(a){var b=a.b;return b?a.a.ab(b):0};var sj=1,tj=2,uj=3;function ul(){F.call(this);this.reset()}u(ul,F);ul.prototype.start=function(a,b){this.a&&this.reset();D(a-b)||(this.b=+a,this.c=+b);this.a=!0};ul.prototype.reset=function(){this.a=!1;this.b=this.c=null;this.f=new vl(0,0,0,0,0,0)};ul.prototype.Ha=function(){return this.a};ul.prototype.g={Dg:"animationupdate"};function wl(a){wl.l.constructor.call(this,ul.prototype.g.Dg);this.c=a}u(wl,Ec);
ul.prototype.set=function(a,b,c,d,e,f){var g=this.f;this.a&&(a=new vl(a/1E3,b/1E3,c/1E3,d/1E3,e/1E3,f/1E3),g.ca(a)||(this.f=a,this.dispatchEvent(new wl(xl(this)))))};function xl(a){return w.Object.create(a.f)}function yl(a){var b=xl(a);a=zl(xl(a))||1;return new vl(b.pb/a,b.qb/a,b.rb/a,b.hf,b.jf,b.rg)}ul.prototype.s=function(){this.reset();ul.l.s.call(this)};function vl(a,b,c,d,e,f){this.pb=a;this.qb=b;this.rb=c;this.hf=d;this.jf=e;this.rg=f}
function zl(a){return Pc(a.pb*a.pb+a.qb*a.qb+a.rb*a.rb)}vl.prototype.ca=function(a){return!!a&&this.pb===a.pb&&this.qb===a.qb&&this.rb===a.rb&&this.hf===a.hf&&this.jf===a.jf&&this.rg===a.rg};function Al(a,b,c,d){Al.l.constructor.call(this);this.sc=a;this.ra=d;this.a=a.appendChild(this.createElement(a.ownerDocument));Bl(this,b,c)}u(Al,Ac);n=Al.prototype;n.G=function(){return this.a};function Bl(a,b,c){a.size?(a.size.w=b,a.size.h=c):a.size=new th(b,c);a.kl(a.a,a.a.style,b,c,a.ra)}n.Bb=function(){return this.size};n.Xa=function(){return this.ra};n.ek=!0;n.sb=function(a){a!==this.ek&&(this.a.style.display=a?"block":"none",this.ek=a)};n.Rh=1;
n.oc=function(a){this.Rh!==a&&(this.jk(a),this.Rh=a)};n.Zc=function(){return this.Rh};n.pf=function(a){this.a.style.zIndex=a};n.Tj=function(){return+this.a.style.zIndex};n.Wc=function(){};n.clear=function(){};n.s=function(){this.clear();this.sc.removeChild(this.a);Bl(this,0,0);this.a=this.sc=null;Al.l.s.call(this)};n.Pk=0;n.qg=function(){++this.Pk};n.release=function(){--this.Pk||this.D()};function Cl(a,b,c,d){Cl.l.constructor.apply(this,arguments)}u(Cl,Al);n=Cl.prototype;n.createElement=function(a){a=a.createElement("DIV");a.style.position="absolute";return a};n.kl=function(a,b,c,d){b.width=c+"px";b.height=d+"px"};n.jk=function(a){this.a.style.opacity=a};n.Wc=function(a,b,c){var d=this.ra,e=a.style;e[gf("transform")]="matrix(1,0,0,1,"+b/d+","+c/d+")";a.parentNode!==this.a&&(e.position="absolute",this.a.appendChild(a))};n.clear=function(a){a?this.a.removeChild(a):this.a.innerHTML=""};r("H.util.animation.ease.LINEAR",function(a){return a});r("H.util.animation.ease.EASE_IN_QUAD",function(a){return a*a});function Dl(a){return-a*(a-2)}r("H.util.animation.ease.EASE_OUT_QUAD",Dl);r("H.util.animation.ease.EASE_IN_OUT_QUINT",function(a){a*=2;return 1>a?Rc(a,5)/2:(a-=2,Rc(a,5)/2+1)});r("H.util.animation.ease.EASE_OUT_CIRC",function(a){return Pc(2*a-a*a)});function El(a,b,c,d){if(!wa(this.i=a))throw new C(El,0,a);if(D(this.g=+b))throw new C(El,1,b);if(!wa(this.f=c)&&null!=c)throw new C(El,2,c);if(!wa(this.c=d)&&null!=d)throw new C(El,3,d);this.id=Fl.next();this.a=!1}r("H.util.animation.Animation",El);var Fl=new Ne;El.prototype.start=function(){var a=this,b=Vj;var c=function(){var e=Kj(),f=e-a.Oc,g=f/a.g;if(1<=g){g=1;var h=!0}a.c&&(g=a.c(g));a.i(g,f,e-d,e);d=e;h?a.stop():a.b=b(c)};a.Oc=Kj();var d=a.Oc;a.a=!0;a.b=b(c)};El.prototype.start=El.prototype.start;
El.prototype.stop=function(a){Wj(this.b);this.a=!1;a||this.f&&this.f(this)};El.prototype.stop=El.prototype.stop;El.prototype.Ha=function(){return this.a};El.prototype.isRunning=El.prototype.Ha;function Gl(a){this.ob=a}u(Gl,Ac);Gl.prototype.zb=function(){return this.ob};Gl.prototype.le=function(a){var b=this.Gb;a!==b&&(this.Gb=a,a.qg(),b&&b.release())};Gl.prototype.s=function(){this.Gb.release()};Gl.prototype.$c=ba(4);function Hl(a,b){Hl.l.constructor.call(this,a);this.uc=!(!b||!b.uc);this.c={}}u(Hl,Gl);Hl.prototype.le=function(a){Hl.l.le.call(this,a);this.f=a.sc.ownerDocument};var Il=function(a,b){b=b.ia();return B(b,Sg)?b.qa:(a[0]=b,a)}.bind(null,[]);
Hl.prototype.V=function(a,b,c,d,e,f,g){var h=this.ob,k,l,m,p;this.j=b=this.c;this.c=c={};if(d>=h.min&&d<=h.max){var q=this.Gj(a,d,e,f);var t=q.markers;if(a=t.length){d=[];e=this.Gb;for(f=0;f<a;f++){h=t[f];var v=Il(h);for(k=v.length;k--;)if(l=g(v[k]))(p=b[m=h.cb()+"_"+k])?delete b[m]:p={vk:h},c[m]=p,d.push([p,h,h.yb(),e,l.x,l.y])}d.sort(Jl);a=d.length;for(f=0;f<a;f++)this.Rk.apply(this,d[f])}}return!q||q.requested&&q.requested===q.total||!q.requested&&t.length===q.total?xj.DONE:xj.PENDING};
function Jl(a,b){var c=yg(a[1]),d=yg(b[1]);return zg(c,d,!0)||a[5]-b[5]||zg(c,d,!1)}Hl.prototype.Ea=function(){};function Kl(a,b){Kl.l.constructor.apply(this,arguments);this.b=0;this.a=[];this.jh=z(this.jh,this)}u(Kl,Hl);n=Kl.prototype;n.Gj=function(){return this.ob.Ic.apply(this.ob,arguments)};n.V=function(a,b,c,d,e,f,g){this.jh();this.i=0;var h=Kl.l.V.apply(this,arguments);var k=this.Gb,l=this.j,m;for(m in l)Ll(this,k,l[m]);return 0===this.a.length&&h?xj.DONE:xj.PENDING};n.le=function(a){Kl.l.le.call(this,a);this.g=a.Xa()};
n.jh=function(){for(var a=this.a.length,b,c,d;a--;)d=this.a[a],b=d.uf,c=d.uf.yb(),c.ci(d,c,b);this.a.length=0};n.Rk=function(a,b,c,d,e,f){var g;var h=d.Xa();var k=b.Qb();e*=h;f*=h;this.uc||(e=Kc(e),f=Kc(f));a.detail&&(k.Zd(a.xn)?Ll(this,d,a):g=a.detail);g||(a.detail=g=Ve(c.c,this.f,c.a),this.b++,wa(c.ci)&&this.a.push(g));a.xn=k.a;g.style.zIndex=this.i++;g.uf=b;d.Wc(g,e,f,0,0)};var Ml,Nl="pointer-events",Ol;
if(Ke){var Pl;Ke&&oc!==x&&(oc=(Pl=/(MSIE\s+|rv:)([^\);]+)(\)|;)/.exec(navigator.userAgent))?+Pl[2]:x);Ol=oc;9===Ol?Nl="display":10===Ol&&(Nl="visibility")}Ml=Nl;
Kl.prototype.Ea=function(a,b,c){var d=this.g,e=Se,f,g,h,k,l;if(this.b){a/=d;b/=d;d=this.f;var m=d.documentElement;var p=this.Gb.G();var q=p.getBoundingClientRect();a+=q.left;for(b+=q.top;(g=h=d.elementFromPoint(a,b))&&g!==p&&g!==m&&h!==t;){for(;(k=g.parentNode)&&(!wa(k.contains)||!k.contains(p));)g=k;if(k===p&&(g!==h||"svg"!==g.nodeName)&&0>e.indexOf(l=g.uf)&&(e===Se&&(e=[]),e.push(l),c))break;f||(f=[]);var t=g.style;f.push({rj:t.getPropertyValue(Ml),wn:t.getPropertyPriority(Ml),style:t});t.setProperty(Ml,
"visibility"===Ml?"hidden":"none","important");t=h}if(f)for(b=f.length;b--;)a=f[b],a.style.removeProperty(Ml),ra(a.rj)&&a.style.setProperty(Ml,a.rj,a.wn)}return e};Kl.prototype.$c=ba(3);function Ll(a,b,c){b.clear(b=c.detail);delete b.uf;a.b--;c=(a=c.vk).yb();c.b&&c.b(b,c,a)}Kl.prototype.s=function(){this.a.length=0;var a=this.Gb,b=this.c,c;for(c in b)Ll(this,a,b[c]);this.Gb.D();Kl.l.s.call(this)};function Ql(a,b){var c=b||{},d=c.contextType;c=c.contextAttributes;Ql.l.constructor.call(this,b);B(a,Function,Ql,0,"invalid render callback");if(d){if(-1===Rl.indexOf(d))throw new C(Ql,1,"invalid context type");this.f=d}c&&(this.m=c);this.j=a}u(Ql,hi);r("H.map.layer.CanvasLayer",Ql);var Rl=Kb("2d webgl webgl2 experimental-webgl");Ql.prototype.f="2d";Ql.prototype.Md=ba(5);Ql.prototype.V=function(a,b){this.c&&this.c.canvas===a||(this.c=a.getContext(this.f,this.m));return this.j(this.c,b)};
Ql.prototype.s=function(){Ql.l.s.call(this);this.c=A};function Sl(a,b){Sl.l.constructor.call(this,b);B(a,Function,Sl,0,"invalid render callback");this.c=a}u(Sl,hi);r("H.map.layer.DomLayer",Sl);Sl.prototype.V=function(a,b){return this.c(a,b)};function Tl(a,b){if(D(this.b=+a))throw new C(Tl,0,a);this.a=0;b&&this.el(b)}r("H.util.kinetics.KineticMove",Tl);Tl.prototype.el=function(a){this.a=a;return this};Tl.prototype.setInitialSpeed=Tl.prototype.el;Tl.prototype.vm=function(){return Math.abs(this.a/this.b)};Tl.prototype.getDuration=Tl.prototype.vm;Tl.prototype.Le=function(a){return this.a+this.b*a};Tl.prototype.getCurrentSpeed=Tl.prototype.Le;Tl.prototype.rm=function(a){return this.a*a+this.b*a*a/2};Tl.prototype.getCurrentPath=Tl.prototype.rm;r("H.util.events.listenOnce",pe);r("H.util.events.dispatchEvent",function(a,b){return a.dispatchEvent(b)});r("H.util.events.fireListeners",function(a,b,c,d){return xd(a)?a.kd(b,c,d):ze(a,b,c,d)});r("H.util.events.listen",oe);r("H.util.events.unlisten",xe);var Ul=Ae;
Ae=function(a,b){var c,d,e=!0;var f=b[b.currentTarget===b.target?"AT_TARGET":a.capture?"CAPTURING_PHASE":(c=!0,"BUBBLING_PHASE")];if(!c||"pointerenter"!==(d=b.type)&&"pointerleave"!==d)b.eventPhase=f,e=Ul(a,b),c&&a.src&&a.src.hc&&null===a.src.hc()&&delete b.eventPhase;return e};function Nk(){Nk.l.constructor.call(this);this.c={};this.b={position:new H(0,0),zoom:0,heading:180,incline:0,tilt:0,bounds:new M(pg([90,-180,90,0,90,180,-90,180,-90,-180]))}}u(Nk,F);r("H.map.ViewModel",Nk);Nk.prototype.a={Ca:"update",te:"sync"};
Nk.prototype.$b=function(a,b){var c=Vl;if(!a)throw new C(this.$b,0,a);var d=a[c.dc];if(Mb(d)&&!If(d))throw new C(this.$b,0,c.dc);d=a[c.Rc];if(Mb(d)&&D(+d))throw new C(this.$b,0,c.Rc);d=a[c.Bd];if(Mb(d)&&!B(d,Hf))throw new C(this.$b,0,c.Bd);a=w.Object.assign({},a);c=Wl(a,this.c,this.b);Xl(this,this.c,a);this.dispatchEvent(new Yl(this.c,c,b));return this};Nk.prototype.setLookAtData=Nk.prototype.$b;Nk.prototype.mb=function(){var a={};a[Zl]=Jf(this.b[Zl]);Xl(this,a,this.b,!0);return a};
Nk.prototype.getLookAtData=Nk.prototype.mb;var Zl="position",Vl={dc:Zl,Rc:"zoom",rc:"heading",ec:"tilt",qe:"incline",Bd:"bounds"},$l=Object.keys(Vl).map(function(a){return Vl[a]});
function Xl(a,b,c,d){a.i={};a.g={};a.f=[];for(var e=a.m,f=a.j,g=$l.length,h,k,l,m;g--;)if(h=$l[g],m=c[h],k=b[h],null==k||!d)if(null!=m){Mb(e)&&e.call(a,h,k,m);l=h;var p;(p="position"!==h)||(p=m,p=!p||D(p.lat)||D(p.lng)?!1:!0);b[l]=p?m:Jf(m);if(Mb(f)){switch(h){case "position":l=m&&k&&(m.lat!==k.lat||m.lng!==k.lng);break;case "bounds":l=m&&k&&!m.ca(k);break;default:l=m!==k}l&&f.call(a,h,k,m)}}else delete b[h]}Nk.prototype.m=function(a,b,c){this.i[a]=b;this.g[a]=c};Nk.prototype.j=function(a){this.f.push(am[a])};
var am=$l.reduce(function(a,b){a[b]=Ah.prototype[b.toUpperCase()];return a},{});function Wl(a,b,c){var d=Vl,e=am,f=0;[d.ec,d.qe,d.rc,d.Rc].forEach(function(d){if(D(a[d])){var g=D(b[d])?c[d]:b[d];a[d]=g}else f|=e[d]});[d.dc,d.Bd].forEach(function(d){a[d]?f|=e[d]:a[d]=b[d]||c[d]});return f}function bm(a,b){var c={},d={};Xl(a,a.b,b);a.c={};c.lookAt=a.g;d.lookAt=a.i;b=a.f;b=b.length?b.reduce(cm):0;a.dispatchEvent(new Ah(a.a.te,c,d,b))}function cm(a,b){return a|b}
Nk.prototype.qf=function(a,b){if(D(a=+a))throw new C(this.qf,0,"zoom");this.$b({zoom:a},b)};Nk.prototype.nb=function(){return this.b.zoom};Nk.prototype.pc=fc;Nk.prototype.startControl=Nk.prototype.pc;Nk.prototype.control=fc;Nk.prototype.control=Nk.prototype.control;Nk.prototype.wb=fc;Nk.prototype.endControl=Nk.prototype.wb;function Yl(a,b,c){Yl.l.constructor.call(this,Nk.prototype.a.Ca,a,null,b);this.b=!!c}u(Yl,Ah);function Q(a,b,c,d){Q.l.constructor.call(this,a,b,c,d);this.Ed=new Qj(100);this.$=new G(0,0);this.Ee=!!d.enableSubpixelRendering;this.tb=dm;this.u=new gl;this.m=d=new ul;this.ub=z(this.ub,this);d.addEventListener(d.g.Dg,this.ub);d=a.element;this.L=a=d.ownerDocument.createElement("div");a.style.position="absolute";a.style.width=a.style.height="100%";a.style.zIndex=0;d.insertBefore(a,d.firstChild);a=w.H.gl;if(!a)throw new nc(Q,'"H-webgl" module is missing');this.b=new Yk({viewport:this.j,sc:this.L,
devicePixelRatio:this.ra,Ek:z(this.ja,this)});a.WorkerBroker.addTarget("model",ki);em(this);this.fc=z(this.fc,this);this.Th=z(this.Th,this);this.Da=z(this.Da,this);c.addEventListener(hi.prototype.b.oe,this.fc);this.B=fm;this.ff();this.zoom=Rk(this,this.K.nb());this.Kb();this.a.Ba(this.zoom);this.c=this.a.projection.Nb(b.mb().position);this.a.x=this.a.w*this.c.x;this.a.y=this.a.h*this.c.y;this.td()}u(Q,Lk);r("H.map.render.webgl.RenderEngine",Q);
Q.prototype.fc=function(a){a=(a=a.target.ya())&&a.Rb();(a&&a.getState())===cj.INIT?a.load():($k(this.b),bl(this.b,this.i),this.ja())};Q.prototype.type=Wk.WEBGL;Q.prototype.type=Q.prototype.type;var fm=2;Q.prototype.getState=function(){return this.B};Q.prototype.getState=Q.prototype.getState;function gm(a,b,c){b=c-b;return Nc(b)<a.a.w/2?b:b-a.a.w*c/Nc(c)}
Q.prototype.Tg=function(a){var b=a.newValue,c=a.modifiers,d=al(this.b);hm(this);this.$.set(0,0);var e=im(this,b);jm(this);$l.forEach(function(b){c&a[b.toUpperCase()]||delete e[b]});a.b?km(this,e,a):d.setLookAtData(e);lm(this);$k(this.b);this.ja()};
function km(a,b,c){var d=[],e=c.modifiers,f=al(a.b),g=f.getLookAtData(),h,k,l,m=0,p={},q=f.setLookAtData.bind(f);$l.forEach(function(a){switch(a){case "heading":case "tilt":case "incline":if(e&(c.rc|c.ec|c.qe)){var f=b[a]-g[a];p[a]=-180<f&&180>=f?f:180<f?f-360:f+360;p[a]&&d.push(a)}break;case "zoom":e&c.Rc&&(p[a]=b[a]-g[a],p[a]&&d.push(a));break;case "position":if(e&c.dc){h=Jf(g.position);var m=b.position;f=m.lat*ed;var q=h.lat*ed,t=m.lng*ed-h.lng*ed;m=Tc(t)*Vc(f);f=Vc(q)*Tc(f)-Tc(q)*Vc(f)*Vc(t);
f=Math.atan2(m,f);l=(0<=f?f:cd+f)*fd;(k=h.ab(b.position))&&d.push(a)}}delete g.bounds});d.length?mm(a,function(a){var b=a-m,f={};e&(c.rc|c.ec|c.qe|c.Rc)&&d.forEach(function(a){Vb(p[a])&&(g[a]+=p[a]*b,f[a]=g[a])});e&c.dc&&(f.position=h.zg(l,k*a,!0));q(f);$k(this.b);this.ja();m=a}.bind(a),a.S,function(){q(b);$k(this.b);this.ja()}.bind(a),a.na):q(b)}Q.prototype.S=300;Q.prototype.kf=function(a){var b=Vb(a);if(!b||b&&0>a)throw new C(this.kf,1,"positive number required");this.S=a};
Q.prototype.setAnimationDuration=Q.prototype.kf;Q.prototype.lh=function(){return this.S};Q.prototype.getAnimationDuration=Q.prototype.lh;Q.prototype.na=Dl;Q.prototype.lf=function(a){if(!wa(a))throw new C(this.lf,1,"function required");this.na=a};Q.prototype.setAnimationEase=Q.prototype.lf;Q.prototype.mh=function(){return this.na};Q.prototype.getAnimationEase=Q.prototype.mh;Q.prototype.ff=function(){this.na=Dl;this.S=300};Q.prototype.resetAnimationDefaults=Q.prototype.ff;n=Q.prototype;
n.Ck=function(){$k(this.b);this.ja()};n.Xe=function(a,b){Q.l.Xe.call(this,a,b);nm(b)&&($k(this.b),(a=(a=b.ya())&&a.Rb())&&a.getState()===cj.INIT&&a.load())};n.ei=function(a,b,c){var d;this.Oa=Kj();if(b.requestDomMarkers){var e=this.A.ka;for(d=e.length;d--;){var f=e[d];if(f.zb()===b){e.splice(d,1);f.D();break}}}nm(b)&&bl(this.b,this.i);this.f=this.i.$a();0===a&&(Qk(this,b,!1),this.Kb());this.he();c||this.ja()};function nm(a){return!(B(a,Sl)||B(a,Ql))}
function em(a){var b=a.i.$a(),c=0,d=b.length;[a.A={}].forEach(function(a){a.Vc=[];a.ka=[]});for(a.f=b;c<d;c++){var e=b[c];a.Xe(c,e);Qk(a,e,!0)}a.Kb()}n.fi=function(){this.Kb()};n.Kb=function(){Q.l.Kb.call(this);var a=this.getCapabilities().lookAt.zoom;al(this.b).setZoomConstraints(Jc(a.min,this.Cg),Ic(a.max,this.Kg))};
n.Dh=function(a,b){if(b){a={uc:this.Ee,fb:this.fb};if(b.requestDomMarkers){var c=om(this);a=new Kl(b,a);c=new Cl(this.L,c.w,c.h,1);c.G().style.zIndex=2;a.le(c);this.A.ka.push(a)}nm(b)&&bl(this.b,this.i)}this.f=this.i.$a()};function pm(a){var b=[];b=b.concat(a.A.ka);return b=b.filter(Mb)}function im(a,b){var c=b.position;return Tk(a,{zoom:Rk(a,b.zoom),position:new H(c.lat,c.lng),tilt:b.tilt,heading:b.heading,bounds:b.bounds})}
function lm(a){var b=a.a,c=al(a.b).getLookAtData();b.Ba(c.zoom);a.zoom=c.zoom;a.c=b.projection.Nb(c.position);b.x=b.w*a.c.x;b.y=b.h*a.c.y}n.Da=function(a){return al(this.b).geoToPixel(a)};Q.prototype.geoToScreen=Q.prototype.Da;Q.prototype.Va=function(a,b){return al(this.b).xyToGeo(a,b)};Q.prototype.screenToGeo=Q.prototype.Va;Q.prototype.sg=function(a,b){a=this.Va(a,b);b=this.K.mb();b.position=a;return b};
Q.prototype.ve=function(a,b,c,d,e,f){var g,h,k,l=0,m;var p=function(){0===--l&&e(d)};if(f&&f.features)for(l=k=f.features.length,m=0;m<k;m++){var q=f.features[m];var t=q.id;if(g=this.b.a.sources[q.source_name]){var v=g.provider;var y=rj(v);if(y===tj){var E=q.source_layer;"overlays"===E?qm(this,a,b,c,d,g,q.properties.overlays_config):(h=g.getMapObjectById(t))&&("markers"!==E||rm(this,a,b,h))&&d.push(h);l--}else if(y===sj){g=q.tile.coords;var N=v.getFeatureProxy(q.properties,g,function(a){if(a){for(var b=
a,c=v,e;b&&(e=b.hc())&&e!==c;)b=e;e||b.ba(c);d.push(a)}p()});N||(h=this.Ed.get(t),h||(h=new sg(q),h.ba(v),this.Ed.add(t,h,1)),d.push(h),l--)}else y===uj&&(N=!0,v.Sk(q,!1).then(function(c){c&&(c instanceof wh?rm(this,a,b,c):1)&&d.push(c);p()},function(){p()},this))}}y&&(N||0!==l)||e(d)};function qm(a,b,c,d,e,f,g){var h=g.length;b=a.Va(b,c);for(c=0;c<h&&!((a=f.getMapObjectById(g[c].id))&&a.F().Hd(b)&&(e.push(a),d));c++);}
function rm(a,b,c,d){var e=d.yb(),f=e.g,g,h=!f;if(f)if(e=e.ld(),b+=e.x,c+=e.y,e=d.ia(),B(e,sh))for(d=e.qa,g=d.length;g--&&!h;)e=a.Da(d[g]),h=f.Qf(b-e.x,c-e.y,0)!==od.NONE;else e=a.Da(e),h=f.Qf(b-e.x,c-e.y,0)!==od.NONE;return h}
Q.prototype.Ea=function(a,b,c,d){for(var e=[],f=this.A.ka,g=f.length,h;g--&&!((h=f[g])&&h.Ea&&(e=e.concat(h.Ea(a,b,c)),e.length&&c)););c&&e.length?d(e):this.b.a.initialized?(f=this.b,g=f.a.getFeatureAt({x:a,y:b},{radius:sm,top_most_only:c}),f.a.update(),g.then(this.ve.bind(this,a,b,c,e,d))):d(e)};Q.prototype.getObjectsAt=Q.prototype.Ea;Q.prototype.Pa=x;function om(a){a=a.Hb[2];return{w:a.right-a.left,h:a.bottom-a.top}}
Q.prototype.td=function(){var a=this.A.ka.length;Mk(this,1);this.$.set(0,0);var b=om(this);var c=b.w;var d=b.h;for(this.b.a.handleViewportUpdate();a--;){b=this.A.ka[a].Gb;var e=b.Bb();e.w===c&&e.h===d||Bl(b,c,d)}this.Pa=new th(c,d);$k(this.b);this.ja()};Q.prototype.getCapabilities=function(){return Xk};Q.prototype.getCapabilities=Q.prototype.getCapabilities;function tm(a){Kj()-a.Oa<a.tb&&!a.v?a.Jg=Vj(a.Th):(a.v&&(a.he(),um(a)),a.B=fm)}n=Q.prototype;n.he=function(){this.A.Vc.length=0};
n.Th=function(){this.I&&this.I.mj();var a=al(this.b).getLookAtData(!0);var b=this.j.center.clone();var c=a.bounds&&a.bounds.F();var d=this.zoom;var e=this.$;var f=this.f;var g=f.length;for(this.tb=dm;g--;){var h=f[g];B(h,hi)&&h.ya()&&h.ya().li(c,d)}f=this.v=this.b.V();g=this.A;h=g.ka.length;var k=!0,l;for(l=0;l<h;l++){var m=g.ka[l];var p=g.Vc;if(m){var q=m.V(c,b,this.a,d,!1,e,this.Da);q===xj.ACTIVE&&(this.tb=Infinity);q!==xj.DONE||p[l]||(um(this,m.zb()),p[l]=!0);p[l]||(k=!1)}}this.v=f&k;bm(this.K,
a);this.Pa&&(Bj(this.j,this.Pa),this.Pa=x);this.I&&this.I.kj();tm(this)};function um(a,b){setTimeout(z(a.dispatchEvent,a,{type:a.ik.gj,target:b||a}),1)}n.s=function(){var a=this.i.$a()[0],b=this.j;Wj(this.Jg);jm(this,!0);a&&Qk(this,a,!1);pm(this).forEach(function(a){a.D()});b.element&&b.element.removeChild(this.L);this.L=null;this.B=3;this.b.D();Q.l.s.call(this)};n.ja=function(){this.Oa=Kj();this.B===fm&&(this.v=!1,this.B=1,tm(this))};
function vm(a,b,c){al(a.b).applyPxOffset([b,c]);lm(a);a.$.set(0,0);$k(a.b);a.ja()}n.me=function(a,b,c){a=Rk(this,Rk(this,a));wm(this,a,b,c)};Q.prototype.zoomAt=Q.prototype.me;function wm(a,b,c,d){al(a.b).setLookAtData({zoom:b},Vb(c)&&Vb(c)?[c,d]:A);lm(a);$k(a.b);a.ja()}function hm(a){jm(a,!0);a.m.Ha()&&a.wb(!0);a.u.Ha()&&a.xb(!0);jm(a,!0)}function xm(a,b){if(b){var c={};c.af=b.power;c.Kd=b.ease;c.duration=b.duration;a.o=c}}
Q.prototype.qc=function(a,b){var c=!!(b||a&(Pk.HEADING|Pk.TILT));hm(this);xm(this,b);this.u.start(a,c)};Q.prototype.startInteraction=Q.prototype.qc;
Q.prototype.kc=function(a,b,c,d,e){var f=this.u;var g=!1;if(f.Ha()){var h=al(this.b);var k=h.getLookAtData();var l=this.j.center;l=[l.x,l.y];b=f.store(a,b,c,d,e);c=ql(f);a=il(f);d=kl(this.u);e=this.u;e=e.i?ll(e.u,e.c):0;f.j&&(0<(f.b&Pk.TILT)&&(h.setLookAtData({tilt:Uk(this,k.tilt+a.y/this.j.height*-180)},l),g=!0),b&&1!==d&&0<(f.b&Pk.ZOOM)&&(g=ql(f),d=Oc(Rc(2,this.zoom)*d)/Zc,wm(this,Rk(this,d),g.x,g.y),g=!0),0<(f.b&Pk.COORD)&&0<fl(a)&&(vm(this,-a.x,-a.y),g=!0),0<(f.b&Pk.HEADING)&&(b?h.setLookAtData({heading:k.heading+
Vk(this,e)},[c.x,c.y]):a.x&&h.setLookAtData({heading:Vk(this,k.heading+a.x/this.j.width*360)},l),g=!0),g&&($k(this.b),this.ja()))}};Q.prototype.interaction=Q.prototype.kc;Q.prototype.xb=function(a){var b=this;if(this.u.Ha()&&!a){if(this.o){a=pl(this.u);var c=nl(this.u);var d=this.o.duration;var e=(this.o.af||1)*a;var f=new Tl(-e/(0<d?d:1),e);!D(c.x)&&!D(c.y)&&0<e&&0<(b.u.b&Pk.COORD)&&mm(this,function(a){e=f.Le(a*d);D(e)||vm(b,Kc(-c.x*e),Kc(-c.y*e))},d,void 0,this.o.Kd)}this.o=null;this.u.clear()}};
Q.prototype.endInteraction=Q.prototype.xb;Q.prototype.pc=function(a,b,c){hm(this);this.m.start(b,c);xm(this,a)};Q.prototype.startControl=Q.prototype.pc;Q.prototype.control=function(a,b,c,d,e,f){for(var g=0,h;g<arguments.length;g++)if(h=+arguments[g],h!==h)throw new C(this.control,g,h);this.m.Ha()&&this.m.set(a,b,c,d,e,f)};Q.prototype.control=Q.prototype.control;
Q.prototype.wb=function(a,b){var c=this,d;if(this.m.Ha()){jm(this,!0);var e=Kj();var f=e-this.oa;if(1<=f){var g=xl(this.m);ym(this,g,f)}if(!this.o||a||b)"function"===typeof b&&(a=al(this.b),a=a.getLookAtData(),b(a),zm(this,a));else{b=zl(xl(this.m));var h=yl(this.m);var k=this.o.duration;var l=(this.o.af||1)*b;var m=new Tl(-l/(0<k?k:1),l);!D(h.pb)&&!D(h.qb)&&0<l&&mm(this,function(a,b,f,g){e&&(f=g-e,e=0);l=m.Le(a*k)*f;D(l)||((d=h.rb*l)&&wm(c,Rk(c,c.zoom+d),c.m.b,c.m.c),vm(c,Kc(h.pb*l),Kc(h.qb*l)))},
k,void 0,this.o.Kd)}this.m.reset()}};Q.prototype.endControl=Q.prototype.wb;
function zm(a,b){var c=a.c,d=a.a.projection.Nb(b.position),e=a.a.dd(d);d=e.y;e=e.x;var f=b.zoom;c=a.a.dd(c);b=c.y;var g=c.x;c=a.zoom;var h=zl(xl(a.m)),k=a.m.b,l=a.m.c,m=0;e=gm(a,g,e);e-=g;d-=b;c=f-c;b=Pc(e*e+d*d+c*c);if(0!==h&&0!==b){var p=e/b;var q=d/b;var t=c/b;var v=h*h/(2*b);mm(a,function(b,c){var d;if(1!==b){b=h*c-v*c*c/2;c=b-m;if(d=t*c)d=Rk(a,a.zoom+d),wm(a,d,k,l);vm(a,Kc(p*c),Kc(q*c));m=b}else wm(a,Rk(a,f),k,l),a.ja()},2*b/h)}}
Q.prototype.ub=function(a){var b=this,c=a.c;this.$.set(0,0);c.pb||c.qb||c.rb||c.hf||c.jf||c.rg?(this.oa=Kj(),mm(this,function(a,e,f,g){b.oa=g;ym(b,c,f)},gd)):jm(this,!0)};function ym(a,b,c){c=c||0;var d=a.m,e=al(a.b),f=e.getLookAtData();b.rb&&wm(a,Rk(a,f.zoom+b.rb*c),d.b,d.c);e.setLookAtData({heading:Vk(a,f.heading+b.jf*c),tilt:Uk(a,f.tilt+b.hf*c)});lm(a);vm(a,b.pb*c,b.qb*c)}function mm(a,b,c,d,e){a.g&&a.g.Ha()&&a.g.stop(!0);a.g=new El(b,c,d,e);a.g.start()}
function jm(a,b){a.g&&a.g.Ha()&&a.g.stop(b)}Q.prototype.fh=function(){};Q.prototype.enter=Q.prototype.fh;Q.prototype.Hf=function(a){Ok(this.L,a)};Q.prototype.exit=Q.prototype.Hf;Q.prototype.capture=function(a,b,c,d){var e=this;return dl(e.b).then(function(f){var g=e.L.ownerDocument.createElement("canvas"),h=e.ra,k=g.getContext("2d"),l=e.b.Xa()/h,m=(c-a)*h;h*=d-b;g.width=m;g.height=h;k.drawImage(f,a*l,b*l,m*l,h*l,0,0,m,h);return g})};var dm=5E3,sm=2.575;function R(a,b,c){var d={};R.l.constructor.call(this);this.I=z(R.prototype.I,this);this.g=Am(c,R);this.b=c=new Nk;this.o=!1;c.addEventListener(c.a.te,this.oa,!1,this);if(!B(a,Element))throw new C(R,0,a);c=this.O=a.ownerDocument.createElement("div");var e=c.style;e.position="relative";e.height=c.style.width="100%";e.overflow="hidden";e.webkitTapHighlightColor="transparent";"transparent"!==e.webkitTapHighlightColor&&(e.webkitTapHighlightColor="rgba(0,0,0,0)");a.appendChild(c);this.za=new yj(this.O,
this.g);this.za.addEventListener(this.za.a.te,this.oa,!1,this);a=this.a=new ki(this.g.layers);a.addEventListener(a.b.se,this.L,!1,this);a.addEventListener(a.b.ne,this.L,!1,this);a.addEventListener(a.b.re,this.L,!1,this);this.u=new L({max:24});this.J=new Hk(this.u,this.g);this.Ng(this.J);this.f=null;this.a.add(b,0);this.c=this.K(null!=this.g.engineType?this.g.engineType:Bm.WEBGL,this.g);this.v=z(this.v,this);this.A=z(this.A,this);b=this.g.imprint;if(b!==A&&"object"!==typeof b)throw new C(R,1,"imprint");
this.i=null===b?b:new ui(this,b);b=this.g.autoColor;this.$=b===A||!!b;Cm(this);(b=this.g.zoom)&&(d.zoom=b);(b=this.g.bounds)&&(d.bounds=b);(b=this.g.center)&&(d.position=b);this.b.$b(d)}u(R,F);r("H.Map",R);function Am(a,b){if(a){var c=a.pixelRatio;if(c===A)a.pixelRatio=1;else if(!(0<c))throw new C(b,0,"pixelRatio: "+c);}else a={pixelRatio:1};a.renderBaseBackground||(a.renderBaseBackground={lower:3,higher:2});return a}
R.prototype.s=function(){this.$=!1;this.i&&this.i.D();this.c.D();this.b.D();this.za.D();this.J.D();this.u.D();this.a.D();var a=this.O;a.parentNode.removeChild(a);this.O=null;F.prototype.s.call(this)};R.prototype.G=function(){return this.O};R.prototype.getElement=R.prototype.G;R.prototype.Xa=function(){return this.g.pixelRatio};R.prototype.getPixelRatio=R.prototype.Xa;function Cm(a){a.i&&a.$&&a.i.Ci({invert:a.f&&a.f.Wl})}
R.prototype.L=function(a){var b=a.added,c=a.removed;b&&b.ya()&&b.ya().ba(this);c&&c.ya()&&c.ya().ba(null);0===a.idx&&(this.dispatchEvent(new vg(this.j.Eg,this.f=a.type!==this.a.b.re?b:0<this.a.a.length?this.a.get(0):x,a.type!==this.a.b.ne?c:1<this.a.a.length?this.a.get(1):x)),Cm(this))};R.prototype.oa=function(a){a.modifiers&&(this.o||(Dm(this,"start"),this.o=!0),Dm(this,"",a));this.o&&(this.na&&w.clearTimeout(this.na),this.na=w.setTimeout(this.A,333))};
function Dm(a,b,c){a.dispatchEvent(c?new Ah(a.j.Zi,c.newValue,c.oldValue,c.modifiers):a.j.Zi+b)}R.prototype.A=function(){Dm(this,"end");this.o=!1};R.prototype.tg=function(a,b){this.c.getCapabilities().lookAt&&this.b.$b({position:a},!!b);return this};R.prototype.setCenter=R.prototype.tg;R.prototype.jb=function(){var a=this.b.mb();return a?a.position:x};R.prototype.getCenter=R.prototype.jb;R.prototype.qf=function(a,b){this.b.qf(a,!!b);return this};R.prototype.setZoom=R.prototype.qf;R.prototype.nb=function(){return this.b.nb()};
R.prototype.getZoom=R.prototype.nb;R.prototype.me=function(a,b,c){this.c.me(a,b,c)};R.prototype.zoomAt=R.prototype.me;R.prototype.qn=function(){return this.za};R.prototype.getViewPort=R.prototype.qn;R.prototype.pn=function(){return this.b};R.prototype.getViewModel=R.prototype.pn;R.prototype.Jm=function(){return this.a};R.prototype.getLayers=R.prototype.Jm;R.prototype.Em=function(){return this.i};R.prototype.getImprint=R.prototype.Em;
R.prototype.capture=function(a,b,c,d,e,f){function g(a,b){q?a.cancel():(y.save(),b.capture(v,m,function(b){y.restore();a.done(b)},function(b){a.done(null,b);h(null)}))}function h(b){q||(q=!0,a(b))}var k=this.wc(),l=k.getCapabilities(),m=this.g.pixelRatio,p=this.za,q=!1,t=this,v,y;if(!wa(a))throw new C(this.capture,0,a);c=c||0;d=d||0;e=e||p.width;f=f||p.height;var E=Jc(0,Ic(c,e));var N=Jc(0,Ic(d,f));c=Ic(p.width,Jc(c,e));d=Ic(p.height,Jc(d,f));l.capture?k.capture(E,N,c,d).then(function(a){var c=t.i,
d=b||[];v=a;y=v.getContext("2d");v.style.width=v.width/m+"px";v.style.height=v.height/m+"px";var e=new Lj(10,g);d=d.concat(c).filter(function(a){return wa(a&&a.capture)});d.length?(a=d.pop(),d.forEach(function(a){e.push(a,vc)}),e.push(a,z(h,t,v)),Hj(e)):h(v)},function(){h(x)}):a(null)};R.prototype.capture=R.prototype.capture;R.prototype.wc=function(){return this.m||this.c};R.prototype.getEngine=R.prototype.wc;
R.prototype.cl=function(a){this.c.type===a||this.S||(this.S=!0,this.m=this.K(a),this.m.addEventListener("render",this.v));return this};R.prototype.setEngineType=R.prototype.cl;R.prototype.v=function(a){a.target===this.m&&(this.m.removeEventListener("render",this.v),this.c.Hf(this.I))};R.prototype.I=function(){var a=this.c.type;this.c.D();this.c=this.m;this.m=A;this.S=!1;this.dispatchEvent(new vg(this.j.Bl,this.c.type,a))};
R.prototype.K=function(a,b){b=b?Am(b,this.K):this.g;if(a===Bm.P2D)return Cm(this),new w.H.map.render.p2d.RenderEngine(this.za,this.b,this.a,b);if(a===Bm.WEBGL)return Cm(this),new Q(this.za,this.b,this.a,b);throw new C(this.cl,0,a);};
R.prototype.xg=function(a,b,c,d,e){var f;b=Mb(b)?B(b,I,this.xg,1,b)&&b:this.b.mb().bounds.F();c=Mb(c)?+c:this.nb();d=Mb(d)?+d:this.nb();if(!(c<=d))throw new C(this.xg,A,"!(min <= max)");e=e||this.f;if(!B(e,yk))throw new C(this.xg,4);if(!(f=e.ya())||!B(f,P)||!f.we())throw new nc(this.constructor,"Storing is not supported");return new Cj(e,f,b,c,d,a)};R.prototype.storeContent=R.prototype.xg;function Em(a){pi.call(this,a)}u(Em,pi);Em.prototype.f=function(){si(this,2)};
Em.prototype.c=function(){si(this,4)};R.prototype.Vl=function(a){a=new Em(a);yc().clear(z(a.f,a),z(a.c,a));return a};R.prototype.clearContent=R.prototype.Vl;R.prototype.Ng=function(a,b){var c=this.a,d=c.indexOf(a),e=b!==+b;b=e?c.a.length-1:b;0>d?c.add(a,b):d-b&&(c.nc(d),c.add(a,e?b-1:b));return this};R.prototype.addLayer=R.prototype.Ng;R.prototype.kg=function(a){var b=this.a.indexOf(a);a!==this.f&&a!==this.J&&-1!==b&&this.a.nc(b);return this};R.prototype.removeLayer=R.prototype.kg;
R.prototype.Ad=function(a){this.f!==a&&(this.a.set(0,a),this.f=a);return this};R.prototype.setBaseLayer=R.prototype.Ad;R.prototype.lm=function(){return this.f};R.prototype.getBaseLayer=R.prototype.lm;R.prototype.Da=function(a){if(!If(a))throw new C(this.Da,0,a);return(a=this.c.Da(a))?ff(a):x};R.prototype.geoToScreen=R.prototype.Da;R.prototype.Va=function(a,b){var c;if(c=+D(a)||2*D(b))throw new C(this.Va,c-1,arguments[c-1]);return(c=this.c.Va(a,b))?Jf(c):x};R.prototype.screenToGeo=R.prototype.Va;
R.prototype.sg=function(a,b){return this.c.sg(a,b)};R.prototype.screenToLookAtData=R.prototype.sg;R.prototype.T=function(a){if(!B(a,K))throw new C(this.T,0,a);this.u.ic().T(a);return a};R.prototype.addObject=R.prototype.T;R.prototype.Ia=function(a){if(!B(a,K))throw new C(this.Ia,0,a);this.u.ic().Ia(a);return a};R.prototype.removeObject=R.prototype.Ia;R.prototype.Ab=function(a){return this.u.ic().Ab(a)};R.prototype.getObjects=R.prototype.Ab;
R.prototype.gd=function(a){var b;Rb(a,this.gd,0,a);var c=a.length;for(b=0;b<c;b++)this.T(a[b]);return this};R.prototype.addObjects=R.prototype.gd;R.prototype.wd=function(a){var b;Rb(a,this.wd,0,a);var c=a.length;for(b=0;b<c;b++)this.Ia(a[b]);return this};R.prototype.removeObjects=R.prototype.wd;R.prototype.Rd=function(a,b,c){var d;if(d=+D(a)||2*D(b))throw new C(this.Rd,d-1,arguments[d-1]);this.c.Ea(a,b,!0,function(a){c(a[0])})};R.prototype.getObjectAt=R.prototype.Rd;
R.prototype.Ea=function(a,b,c){var d;if(d=+D(a)||2*D(b))throw new C(this.Rd,d-1,arguments[d-1]);this.c.Ea(a,b,!1,c)};R.prototype.getObjectsAt=R.prototype.Ea;var Bm={P2D:Wk.P2D,WEBGL:Wk.WEBGL};R.EngineType=Bm;R.prototype.j={Mo:"mapviewchangestart",Zi:"mapviewchange",$i:"mapviewchangeend",Eg:"baselayerchange",Bl:"enginechange"};function Fm(a,b){Fm.l.constructor.call(this,a,b)}u(Fm,wh);r("H.map.Marker",Fm);n=Fm.prototype;n.type=xg.MARKER;n.Bg=1;n.Ga=function(a){if(a!==ug.VISUAL||1===this.Mk||1===this.icon.getState())var b=Fm.l.Ga.call(this,a);return b||!1};n.Mk=0;n.dk=function(a){return B(a,Pi)};n.Gh=!1;n.Bk=function(){this.Ga(ug.VISUAL)};
n.fd=function(a){var b=this.icon;this.Gh&&(b.removeEventListener("statechange",this.Bk,!1,this),delete this.Gh);b&&(this.Mk=b.getState());Fm.l.fd.call(this,a);0===a.getState()&&(this.Gh=!0,pe(a,"statechange",this.Bk,!1,this));return this};Fm.prototype.setIcon=Fm.prototype.fd;Fm.prototype.f=function(a){return new Pi(a.svg,a)};function Gm(a,b){Gm.l.constructor.call(this,Rg,b);this.ie(a)}u(Gm,eh);r("H.map.Rect",Gm);Gm.prototype.ie=function(a){if(!B(a,I))throw new C(this.ie,0,a);a.ca(this.A)||(this.A=this.N=a,this.bb!==x&&Gm.l.ea.call(this,$g(a)))};Gm.prototype.setBoundingBox=Gm.prototype.ie;Gm.prototype.F=function(){return this.N};Gm.prototype.getBoundingBox=Gm.prototype.F;Gm.prototype.ea=function(){return this};Gm.prototype.setGeometry=Gm.prototype.ea;
Gm.prototype.ia=function(){this.bb||Gm.l.ea.call(this,$g(this.A));return this.bb};Gm.prototype.getGeometry=Gm.prototype.ia;function Hm(a,b,c){var d="anonymous",e=1;this.f=z(this.f,this);K.call(this,c);this.ie(a);c&&(a="crossOrigin",a in c&&(d=c[a]),a="opacity",a in c&&(e=c[a]));this.bl(b,d);this.oc(e)}u(Hm,K);r("H.map.Overlay",Hm);Hm.prototype.type=xg.OVERLAY;Hm.prototype.F=function(){return this.N};Hm.prototype.getBoundingBox=Hm.prototype.F;Hm.prototype.ie=function(a){var b=this.N,c=!b;B(a,I,Hm,0,a);if(c||!b.ca(a))this.N=a,c||this.Ga(ug.SPATIAL);return this};Hm.prototype.setBoundingBox=Hm.prototype.ie;
Hm.prototype.Xc=function(){return this.b.getData()};Hm.prototype.getBitmap=Hm.prototype.Xc;Hm.prototype.bl=function(a,b){var c=this.b;c&&1!==c.getState()&&c.cancel();this.b=new Ki(a,this.f,!0,A,b);return this};Hm.prototype.setBitmap=Hm.prototype.bl;Hm.prototype.f=function(a,b){this.b=b;1===a&&this.Ga(ug.VISUAL)};Hm.prototype.Zc=function(){return this.g};Hm.prototype.getOpacity=Hm.prototype.Zc;
Hm.prototype.oc=function(a){var b=this.g,c=2>b;if(0<=a&&1>=a)a!==b&&(this.g=a,c&&this.Ga(ug.VISUAL));else throw new C(this.oc,0);return this};Hm.prototype.setOpacity=Hm.prototype.oc;Hm.prototype.W=function(){var a=Hm.l.W.call(this);a.geometry=$g(this.N).W();a.properties.overlay=!0;return a};Hm.prototype.forWorkerMessage=Hm.prototype.W;function Im(a){if(!a||!wa(a.requestData))throw new C(Im,0,"options.requestData");Im.l.constructor.call(this,a);this.J=a.requestData;this.I=!!a.providesDomMarkers}u(Im,P);r("H.map.provider.MarkerTileProvider",Im);Im.prototype.Nd=function(a){return a?a.length+1:1};Im.prototype.getEntryWeight=Im.prototype.Nd;
Im.prototype.Za=function(a,b,c,d,e){var f=this;return this.J(a,b,c,function(e){for(var g=[],k,l,m=e.length;m--;)l=e[m],l.xo=f.getTileKey(a,b,c),l.ba(f),k=l.yb(),(B(l,zh)||1===k.getState())&&g.push(e[m]);d(g)},e)};Im.prototype.requestInternal=Im.prototype.Za;Im.prototype.Xd=function(a,b){b===ug.VISUAL&&(a=this.Pb().get(a.xo))&&(a.valid=!1,oj(this,a))};Im.prototype.invalidateObject=Im.prototype.Xd;Im.prototype.Vb=function(){return this.I};Im.prototype.providesDomMarkers=Im.prototype.Vb;
Im.prototype.Wb=Qe;Im.prototype.providesMarkers=Im.prototype.Wb;function Jm(a,b){Jm.l.constructor.call(this,a,b)}u(Jm,yk);r("H.map.layer.MarkerTileLayer",Jm);var Km={markers:[],total:0,requested:0};function Lm(a,b,c,d,e){var f=Lc(c);a.pixelProjection.Ba(f);b=a.Vd(a.He(b),f);c=a.Pe(b,b.left>b.right,~~c,d,e);a=c.tiles;c=c.total;d=a.length;e=[];var g;for(g=0;g<d;g++)for(b=a[g],f=b.data.length;f--;)e.push(b.data[f]);return{markers:e,total:a.length,requested:c}}Jm.prototype.Jc=function(a,b,c,d){return this.a.providesDomMarkers()?Km:Lm(this,a,b,c,d)};
Jm.prototype.requestMarkers=Jm.prototype.Jc;Jm.prototype.Ic=function(a,b,c,d){return this.a.providesDomMarkers()?Lm(this,a,b,c,d):Km};Jm.prototype.requestDomMarkers=Jm.prototype.Ic;function Mm(a,b,c){var d,e=6;if(b){for(d=' expected close to: "'+b;e--;)b=a.a.next(),-1!==b&&(d+=String.fromCharCode(b));d+='"'}throw new C(Nm,0,"- Malformed WKT: "+(d?c+d:"unexpected end of stream"));}var Om={Hl:" ",El:"(",Fl:")",Al:",",Cl:""};Object.keys(Om).reduce(function(a,b){a[Om[b]]=!0;return a},Gb());function Pm(a,b){var c=a.next();b=b?")":"(";c!==b&&Mm(a,c,'"'+b+'"')}function Qm(a){return","===Rm(a)?(a.next(),!0):!1}
function Sm(a,b,c,d,e){var f,g,h=2+b+c;for(g=1;g<=h;g++)(c=a.next())?(f=+c)!==f?Mm(a,c,"number"):1===g?d[e+1]=f:2===g?d[e]=f:3===g&&(d[e+2]=f):Mm(a,c);b||(d[e+2]=0)}var Tm=[];function Um(a,b,c,d){d||Pm(a,0);Sm(a,b,c,Tm,0);d||Pm(a,1);return new H(Tm[0],Tm[1],b?Tm[2]:A)}function Vm(a,b,c){var d=[];Pm(a,0);do Sm(a,b,c,d,d.length);while(Qm(a));Pm(a,1);return new J(d)}function Wm(a,b,c){Pm(a,0);var d=Vm(a,b,c);if(Qm(a)){var e=[];do e.push(Vm(a,b,c));while(Qm(a))}Pm(a,1);return new M(d,e)}
var Xm=[],Ym=[Wm],Zm=[Um],$m={POINT:Zm,LINESTRING:[Vm],POLYGON:Ym,MULTIPOINT:[Um,sh],MULTILINESTRING:[Vm,Ug],MULTIPOLYGON:[Wm,ch],GEOMETRY:Xm,GEOMETRYCOLLECTION:Xm,CIRCULARSTRING:Xm,COMPOUNDCURVE:Xm,CURVEPOLYGON:Xm,MULTICURVE:Xm,MULTISURFACE:Xm,CURVE:Xm,SURFACE:Xm,POLYHEDRALSURFACE:Xm,TIN:Xm,TRIANGLE:Xm},an={Z:1,M:2,ZM:3};
function Nm(a){a=new bn(a);var b;var c=a.next();(b=$m[c.toUpperCase()])||Mm(a,c,"type name");if(b!==Xm){c=Rm(a);c=an[c.toUpperCase()];var d=c&1;var e=c>>1;d|e&&a.next();c=Rm(a);if("EMPTY"===c)if(a.next(),d=b[1])var f=new d([]);else b!==Zm&&(f=new J([]),b===Ym&&(f=new M(f)));else if("("===c){f=b[0];b=b[1];if(b){var g=[];Pm(a,0);if(f===Um){var h="("!==Rm(a);do g.push(f(a,d,e,h));while(Qm(a))}else{do g.push(f(a,d,e));while(Qm(a))}Pm(a,1);d=new b(g)}else d=f(a,d,e);f=d}else Mm(a,c,'"Z", "M", "ZM", "(" or "EMPTY"');
a.next()&&Mm(a,c,"end of stream")}return f||x}function bn(a){this.a=a}function Rm(a){var b=a.b;if(b===A){for(b=a.a;b.a()===cn;)b.next();if(dn[b.a()])b=b.next(),b=b===en?"":String.fromCharCode(b);else{b.f();do b.next();while(!dn[b.a()]);b=String.fromCharCode.apply(null,b.b())}a.b=b}return b}bn.prototype.next=function(){var a=Rm(this);""!==a&&delete this.b;return a};var cn=32,en=-1,fn={Hl:cn,El:40,Fl:41,Al:44,Cl:en},dn=Object.keys(fn).reduce(function(a,b){a[fn[b]]=!0;return a},Gb());function gn(){}r("H.util.ICharStream",gn);gn.prototype.next=function(){};gn.prototype.f=function(){};gn.prototype.b=function(){};gn.prototype.a=function(){};function hn(a){this.i=String(a);this.j=0;this.c=[];this.g=!1}r("H.util.CharStream",hn);hn.prototype.next=function(){var a=this.i.charCodeAt(this.j++);a=isNaN(a)?-1:a;this.g&&this.c.push(a);return a};hn.prototype.f=function(){this.g=!0;this.c=[]};hn.prototype.b=function(){var a=this.c.slice();this.g=!1;this.c=[];return a};hn.prototype.a=function(){var a=this.i.charCodeAt(this.j);return isNaN(a)?-1:a};r("H.util.wkt.toGeometry",function(a){return Nm(new hn(a))});function jn(){return of("mapsjs-core","1.2.0","e28bf82")}r("H.buildInfo",jn);var kn=function(){var a="maps"+eval('"js-"');var b=w.document.querySelector('script[src*="'+a+'"]');if(!b){var c=w.document.getElementsByTagName("script");var d=new RegExp("^.*"+a);var e=0;for(a=c.length;e<a;e++)if(d.test(c[e].src)){b=c[e];break}}return b?b.src.replace(/\/[^\/]*$/,"/"):""}();r("H.getScriptPath",function(){return kn});
}).call(window);
H.__bootstrap__="var l,p=this;function aa(a){return\"string\"==typeof a}function ca(a,b,c){a=a.split(\".\");c=c||p;a[0]in c||!c.execScript||c.execScript(\"var \"+a[0]);for(var d;a.length&&(d=a.shift());)a.length||void 0===b?c[d]&&c[d]!==Object.prototype[d]?c=c[d]:c=c[d]={}:c[d]=b}function da(){}\nfunction ea(a){var b=typeof a;if(\"object\"==b)if(a){if(a instanceof Array)return\"array\";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if(\"[object Window]\"==c)return\"object\";if(\"[object Array]\"==c||\"number\"==typeof a.length&&\"undefined\"!=typeof a.splice&&\"undefined\"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable(\"splice\"))return\"array\";if(\"[object Function]\"==c||\"undefined\"!=typeof a.call&&\"undefined\"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable(\"call\"))return\"function\"}else return\"null\";\nelse if(\"function\"==b&&\"undefined\"==typeof a.call)return\"object\";return b}function r(a){return\"function\"==ea(a)}function fa(a){var b=typeof a;return\"object\"==b&&null!=a||\"function\"==b}var ia=\"closure_uid_\"+(1E9*Math.random()>>>0),ja=0;function ka(a,b,c){return a.call.apply(a.bind,arguments)}\nfunction ma(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function na(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf(\"native code\")?na=ka:na=ma;return na.apply(null,arguments)}\nfunction pa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}function t(a,b){ca(a,b,void 0)}function qa(a,b){function c(){}c.prototype=b.prototype;a.V=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Zb=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};function x(){}t(\"H.util.ICache\",x);x.prototype.add=function(){};x.prototype.add=x.prototype.add;x.prototype.get=function(){};x.prototype.get=x.prototype.get;x.prototype.ra=function(){};x.prototype.drop=x.prototype.ra;x.prototype.forEach=function(){};x.prototype.forEach=x.prototype.forEach;x.prototype.T=function(){};x.prototype.removeAll=x.prototype.T;x.prototype.aa=function(){};x.prototype.registerOnDrop=x.prototype.aa;x.prototype.pa=function(){};x.prototype.deRegisterOnDrop=x.prototype.pa;function ra(a){for(var b in a)return!1;return!0}function sa(a){var b={},c;for(c in a)b[c]=a[c];return b}var ta=\"constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function ua(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<ta.length;f++)c=ta[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var z=this;function va(a){if(Error.captureStackTrace)Error.captureStackTrace(this,va);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}qa(va,Error);va.prototype.name=\"CustomError\";var wa=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(aa(a))return aa(b)&&1==b.length?a.indexOf(b,0):-1;for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var xa=na,ya=String,za=z.Object.freeze||function(a){return a},A=self.eval(\"undefined\"),Aa=self.eval(\"null\");function Ba(a){return ya(a).split(\",\"!==A?\",\":\" \")}var Ca=\"prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");function Da(a,b,c,d){if(!(b=a instanceof b)&&c)throw new B(c,d,void 0!==A?void 0:a);return b}t(\"H.lang.isObject\",fa);t(\"H.lang.isEmptyObject\",ra);\nfunction Ea(a,b,c,d){var e;if(!(e=\"Array\"===Ha(a))&&b)throw new B(b,c,d!==A?d:a);return e}t(\"H.lang.isArray\",function(a,b,c,d){return Ea(a,b,c,d)});t(\"H.lang.isString\",aa);var Ia=isNaN;function Ja(a){return a===+a}t(\"H.lang.isNumber\",Ja);function Ha(a){var b=Object[Ca[0]][Ca[6]].call(a).match(/^\\[object (\\w+)\\]$/);return b?b[1]:typeof a}var Ka=[];0>Ka.indexOf(Ka)&&Ka.push(Ka);\nfunction La(a,b,c,d){var e=\"\",f=2>arguments.length,g;f&&(b={H:z.H},c=\"\",d=Ka.slice());Ma(b,!0,function(b,f){try{if(g=b[f],f=Na(b,g),!(fa(g)&&g.window===g&&g.self===g||fa(g)&&0<g.nodeType&&r(g.cloneNode))&&fa(g)){if(g===a)return e=c+\".\"+f,!0;if(0>d.indexOf(g)&&(d.push(g),e=La(a,g,c+\".\"+f,d)))return!0}}catch(m){}});f&&(e=e?e.substr(1).replace(\".\"+Ca[0]+\".\",\"#\"):\"~\"+(r(a)?Oa(a)+\"()\":Ha(a)));return e}\nfunction Na(a,b){var c=[];Ma(a,!1,function(a,e){a[e]===b&&c.push(e)});return c.sort(Pa)[0]}function Pa(a,b){return b.length-a.length}var Qa=Object[Ca[0]][Ca[2]];function Ma(a,b,c){var d;if(a){for(e in a)if((!b||Qa.call(a,e))&&c(a,e,!0))return;for(d=Ca.length;d--;){var e=Ca[d];if((!b||Qa.call(a,e))&&c(a,e,!1))break}}}function Oa(a){return(a=/^\\s*function ([^\\( ]+)/.exec(a))?a[1]:\"anonymous\"}function Ra(a,b,c){c[b]=\"#\"+b};function D(a,b,c){this.g=[];b&&this.aa(b);if(c&&!r(c))throw new B(D,2,c);this.b=0;this.filter=c;this.a={};this.f=this.c=null;this.Ea(a)}t(\"H.util.Cache\",D);D.prototype.add=function(a,b,c){c=+c;if(!Ja(c)||0>c)throw new B(this.add,2,c);a=String(a);var d=this.a[a];var e=!0;this.filter&&(e=this.filter(a,b,c));d?e?(this.b+=c-d.size,d.size=c,d.data=b,Sa(this,d)):Ta(this,d,!0):e&&(this.a[a]=Ua(this,{id:a,data:b,size:c,A:null,D:null},this.c));Va(this);return e};D.prototype.add=D.prototype.add;\nD.prototype.aa=function(a){if(!r(a))throw new B(this.aa,0,a);this.g.push(a)};D.prototype.registerOnDrop=D.prototype.aa;D.prototype.pa=function(a){this.g=this.g.filter(function(b){return b!==a})};D.prototype.deRegisterOnDrop=D.prototype.pa;D.prototype.get=function(a,b){return(a=b?this.a[a]:Sa(this,this.a[a]))&&a.data};D.prototype.get=D.prototype.get;D.prototype.ra=function(a){var b;(b=this.a[a])&&Ta(this,b,!0)};D.prototype.drop=D.prototype.ra;\nD.prototype.forEach=function(a,b,c){var d;for(d in this.a){var e=this.a[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};D.prototype.forEach=D.prototype.forEach;D.prototype.T=function(a){var b;for(b in this.a){var c=this.a[b];(a?a(b,c.data,c.size):1)&&Ta(this,this.a[b],!0)}};D.prototype.removeAll=D.prototype.T;D.prototype.Ea=function(a){if(!(0<+a))throw new B(D.prototype.Ea,0,a);this.i=+a;Va(this);return this};D.prototype.setMaxSize=D.prototype.Ea;D.prototype.qb=function(){return this.i};\nD.prototype.getMaxSize=D.prototype.qb;D.prototype.mb=function(){return this.b};D.prototype.getCurrentSize=D.prototype.mb;function Sa(a,b){b&&(a.c=Ua(a,b,a.c));return b}function Va(a){for(;a.b>a.i&&a.f;)Ta(a,a.f,!0)}function Ua(a,b,c){if(c!==b){(b.A||b.D)&&Ta(a,b);if(b.A=c)b.D=c.D,c.D=b;b.D||(a.c=b);b.A||(a.f=b);a.b+=b.size}return b}\nfunction Ta(a,b,c){var d=b.D,e=b.A;if(d||e||b==a.c&&b==a.f)if(d?d.A=e:a.c=e,e?e.D=d:a.f=d,a.b-=b.size,c){for(c=a.g.length;c--;)a.g[c].call(a,b.id,b.data,b.size);delete a.a[b.id]}b.A=b.D=null};function E(){}t(\"H.service.extension.dataView.ITable\",E);E.prototype.ua=function(){};E.prototype.getMeta=E.prototype.ua;E.prototype.va=function(){};E.prototype.getRowCount=E.prototype.va;E.prototype.ia=function(){};E.prototype.getRow=E.prototype.ia;E.prototype.C=function(){};E.prototype.getColumnNames=E.prototype.C;E.prototype.ta=function(){};E.prototype.getColumn=E.prototype.ta;E.prototype.s=function(){};E.prototype.getCell=E.prototype.s;E.prototype.concat=function(){};E.prototype.concat=E.prototype.concat;function Wa(){}t(\"H.service.extension.dataView.IRow\",Wa);Wa.prototype.C=function(){};Wa.prototype.getColumnNames=Wa.prototype.C;Wa.prototype.s=function(){};Wa.prototype.getCell=Wa.prototype.s;Wa.prototype.wa=function(){};Wa.prototype.getTable=Wa.prototype.wa;function $a(a,b){this.a=a;this.b=b}t(\"H.service.extension.dataView.ObjRow\",$a);$a.prototype.C=function(){return this.a.C()};$a.prototype.getColumnNames=$a.prototype.C;$a.prototype.s=function(a){return this.a.s(this.b,a)};$a.prototype.getCell=$a.prototype.s;$a.prototype.wa=function(){return this.a};$a.prototype.getTable=$a.prototype.wa;function ab(){}t(\"H.service.extension.dataView.IColumn\",ab);ab.prototype.s=function(){};ab.prototype.getCell=ab.prototype.s;function bb(a,b){this.b=a;this.a=b}t(\"H.service.extension.dataView.ObjColumn\",bb);bb.prototype.s=function(a){return this.b.s(a,this.a)};bb.prototype.getCell=bb.prototype.s;function B(a,b,c){var d=arguments.length;b=1<d?+b:b;d=2<d?ya(c):\"\";if(b!==A){var e=(e=/^.*?\\(([^\\)]+)/.exec((\"\"+a).replace(/(\\/\\*([\\s\\S]*?)\\*\\/)|(\\/\\/(.*)$)/gm,\"\")))?Ba(e[1].replace(/\\s+/g,\"\")):[];e.forEach(Ra);e=e[b]||\"#\"+b}this.message=(a?La(a):\"\")+(e||d?\" (\":\"\")+(e?\"Argument \"+e:\"\")+(d?(e?\" \":\"\")+d:\"\")+(e||d?\")\":\"\");this.stack=Error().stack}t(\"H.lang.InvalidArgumentError\",B);B.prototype=Error();B.prototype.name=\"InvalidArgumentError\";function F(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):A);this.F=a;if(b)for(this.N=b,this.oa=a=Object.create(Aa,void 0),d=b.length;d--;)a[b[d]]=!0;c!==A&&(this.za=c)}t(\"H.service.extension.dataView.ObjTable\",F);l=F.prototype;l.za=A;l.F=A;l.N=A;l.oa=A;l.ua=function(){return this.za};F.prototype.getMeta=F.prototype.ua;F.prototype.va=function(){return this.F?this.F.length:0};F.prototype.getRowCount=F.prototype.va;F.prototype.ia=function(a){var b=this.F;return b&&b[a]?new $a(this,a):A};\nF.prototype.getRow=F.prototype.ia;F.prototype.C=function(){return this.N||cb};F.prototype.getColumnNames=F.prototype.C;F.prototype.ta=function(a){return this.oa[a]?new bb(this,a):A};F.prototype.getColumn=F.prototype.ta;F.prototype.s=function(a,b){var c=this.F;return(a=c&&this.oa[b]&&c[a])&&a[b]};F.prototype.getCell=F.prototype.s;\nF.prototype.concat=function(){var a=arguments.length,b,c=this.N,d=\"\"+this.N,e=(this.F||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof F))throw new B(this.concat,b);if(f.F){if(c&&\"\"+f.N!==d)throw new B(this.concat,b,\"Incompatible columns!\");e=e.concat(f.F)}}return new F(e,this.N,this.za)};F.prototype.concat=F.prototype.concat;function G(a,b){this.x=+a;this.y=+b}t(\"H.math.Point\",G);G.prototype.set=G;G.prototype.set=G.prototype.set;G.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new G(this.x,this.y);return a};G.prototype.clone=G.prototype.clone;G.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};G.prototype.add=G.prototype.add;G.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};G.prototype.sub=G.prototype.sub;G.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};\nG.prototype.scale=G.prototype.scale;G.prototype.round=function(){this.x=db(this.x);this.y=db(this.y);return this};G.prototype.round=G.prototype.round;G.prototype.floor=function(){this.x=eb(this.x);this.y=eb(this.y);return this};G.prototype.floor=G.prototype.floor;G.prototype.ceil=function(){this.x=fb(this.x);this.y=fb(this.y);return this};G.prototype.ceil=G.prototype.ceil;G.prototype.G=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};G.prototype.equals=G.prototype.G;\nG.prototype.rb=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=a;if(c||d){var f=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d);0>=f?e=a:1<=f?e=b:e=new G(a.x+f*c,a.y+f*d)}return e};G.prototype.getNearest=G.prototype.rb;G.prototype.qa=function(a){return gb(hb(this.x-a.x,2)+hb(this.y-a.y,2))};G.prototype.distance=G.prototype.qa;G.fromIPoint=function(a){if(!a)throw Error(\"invalid argument\");return a instanceof G?a:new G(a.x,a.y)};var H=Math,ib=H.min,jb=H.max,db=H.round,eb=H.floor,fb=H.ceil,kb=H.abs,lb=H.log,gb=H.sqrt,hb=H.pow,mb=H.exp,nb=H.sin,ob=H.asin,pb=H.cos,qb=H.tan,rb=H.atan,sb=H.atan2,tb=H.LN2,J=H.PI,ub=J/2,vb=J/4,wb=2*J,yb=3*J,zb=J/180,Ab=180/J,Bb=1/0;hb(-2,53);function Cb(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}t(\"H.math.normalize\",function(a,b,c){b-=c=c||0;a-=c;return a-eb(a/b)*b+c});function Db(a,b,c){return a>c?c:a<b?b:a}t(\"H.math.clamp\",Db);\nfunction Eb(a,b,c,d){d||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}function Fb(a,b,c,d,e,f){return gb(hb((a-e)*(d-f)-(b-f)*(c-e),2)/(hb(c-e,2)+hb(d-f,2)))}var Gb={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};t(\"H.math.CoverType\",Gb);\nfunction Hb(a,b,c,d,e){for(var f=c.length,g=f,h,k,m,q=c[0],n=0,u=0,C=0,y=d/2||0,v=e?1:3;1!=n&&g>v;){h=c[--g];d=c[--g];m=c[g?g-1:(f+(g-1))%f];k=c[g?g-2:(f+(g-2))%f];if(d>=a-y&&d<=a+y&&h>=b-y&&h<=b+y||k>=a-y&&k<=a+y&&m>=b-y&&m<=b+y)n=1;else if(!n&&d===a)k===a&&(h<b&&m>b||h>b&&m<b)||(q<=a&&k>a||q>=a&&k<a)&&(h>=b?++u:++C),n=Eb(b,h,m,y)&&Fb(a,b,d,h,k,m)<=y?2:0;else if(!n&&Eb(a,d,k,y)){if(d<a&&k>a||d>a&&k<a)q=h+(a-d)/(k-d)*(m-h),u+=q>b,C+=q<b;n=Eb(b,h,m,y)&&Fb(a,b,d,h,k,m)<=y?2:0}q=d}!n&&e&&0!==C&&0!==\nu%2&&(n=3);return n}t(\"H.math.isCoveredBy\",Hb);function Ib(a,b,c,d,e,f){var g,h,k=a.length,m,q;if(k)for(g=[];k--;){var n=a[k];var u=n.length;var C=0;for(m=1;m<u;m++)if(q=Jb(n[m-1],n[m],c,b,d,e)){var y=q[0];var v=q[1];C&&C.G(y)?h.push(v):g.push(h=q);C=v;f&&(m=u,k=0)}}else g=a;return g}t(\"H.math.clipping.clipStrips\",Ib);\nfunction Jb(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var m=a;g=h;a=b;h=k;b=m;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var q=1;a=-a;b=-b;m=f;f=-c;c=-m}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);q&&(a=-a,b=-b);return k?[new G(h,-b),new G(g,-a)]:[new G(g,-a),new G(h,-b)]}\nfunction Kb(a,b,c){a=Lb(a,!0);b=Lb(b,!1);var d,e;var f={};var g=d=1;switch(~~(c||0)){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.fa=Mb(b.x,b.y,null,Nb(b));a.fa=Mb(a.x,a.y,null,Nb(a));for(g=b;g.next;g=g.next)if(!g.B)for(d=a;d.next;d=d.next)if(!d.B){var k=Ob(g.next);var m=Ob(d.next);if(e=Pb(g,k,d,m,f)){e=f.ab;var q=f.bb;var n=f.Tb;var u=f.Ub;e=Mb(n,u,null,null,null,null,!0,0,0,e);Qb(e,g,k);k=Mb(n,u,null,null,null,null,!0,0,0,q);Qb(k,d,m);e.Aa=k;k.Aa=e}}f=Rb(b,a);c&&\n(f=!f);for(g=b;g;g=g.next)g.B&&(g.sa=f,f=!f);f=Rb(a,b);h&&(f=!f);for(d=a;d.next;d=d.next)d.B&&(d.sa=f,f=!f);Sb(b);for(Sb(a);(a=Tb(b))!=b;){for(c=null;!a.na;a=a.Aa){for(f=a.sa;;){c=Mb(a.x,a.y,c);c.artificial=a.B||a.Cb;a.na=1;a=f?a.next:a.u;if(!a)break;if(a.B){a.na=1;break}}if(!a)break}c.Ta=C;var C=c}return C}}t(\"H.math.clipping.clipPolygon\",Kb);\nfunction Mb(a,b,c,d,e,f,g,h,k,m){a={x:a,y:b,next:c||null,u:d||null,Ta:e||null,Aa:f||null,B:!!g,sa:h||0,na:k||0,alpha:m||0};d&&(a.u.next=a);c&&(a.next.u=a);return a}function Ob(a){for(;a&&a.B;)a=a.next;return a}function Nb(a){if(a)for(;a.next;)a=a.next;return a}function Tb(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.B||b.B&&b.na))}return b}function Sb(a){var b=Nb(a);b.u.next=a;a.u=b.u}\nfunction Pb(a,b,c,d,e){var f,g=b.x-a.x,h=b.y-a.y;var k=d.x-c.x;var m=d.y-c.y;var q=g*m-h*k;if(!q)return 0;k=((c.x-a.x)*m-(c.y-a.y)*k)/q;q=(h*(c.x-a.x)-g*(c.y-a.y))/q;if(0>k||1<k||0>q||1<q)return 0;0===k?f=a:1===k?f=b:0===q?f=c:1===q&&(f=d);if(f)return f.x+=2.480549651603763E-5,f.y+=7.321997314118067E-5,f.fa&&(f.fa.x=f.x,f.fa.y=f.y),Pb(a,b,c,d,e);e.Tb=a.x+k*g;e.Ub=a.y+k*h;e.ab=k;e.bb=q;return 1}\nfunction Rb(a,b){var c=[];if(Array.isArray(b))c=b.reduce(function(a,b){a.push(b.x,b.y);return a},c);else for(;b;)c.push(b.x,b.y),b=b.next;return Hb(a.x,a.y,c,0,!0)!==Gb.NONE}function Qb(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.u=b.u;a.next.u=a;a.u.next=a}function Lb(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=Mb(a[e].x,a[e].y,d);c.Cb=b;if(c.next=d)d.u=c;d=c}return d};function Ub(a,b){var c=[];a&&c.push(La(a));1<arguments.length&&c.push(b);this.message=c.join(\" \");this.stack=Error().stack}qa(Ub,Error);t(\"H.lang.IllegalOperationError\",Ub);Ub.prototype=Error();Ub.prototype.name=\"IllegalOperationError\";function Vb(){if(!aa(\"STATIC_DB\"))throw new B(this.constructor,0);this.i=z.indexedDB||z.webkitIndexedDB||z.mozIndexedDB||z.msIndexedDB;if(!this.i)throw new Ub(this.constructor,\"This browser does not support IndexedDB\");this.a=[];this.c=[];this.g=xa(this.g,this)}var Wb,Xb;Vb.prototype.get=function(a,b,c){var d;if(!aa(a)&&!Ja(a))throw new B(this.get,0);if(!r(b))throw new B(this.get,1);Yb(this,function(e){d=e.get(a);Zb(d,b,c)},c);return{cancel:function(){d&&(d.onsuccess=$b)}}};\nVb.prototype.g=function(){var a=this.b.result;a.objectStoreNames.contains(\"data\")||a.createObjectStore(\"data\")};\nfunction ac(a,b,c){if(a.b)a.a?(a.a.push(b),c&&a.c.push(c)):a.f?c&&c(a.f):b(a.b.result);else{a.b=a.i.open(bc+\"STATIC_DB\",1);a.b.onupgradeneeded=a.g;var d=a.b.onerror=function(){clearTimeout(a.v);a.f=this.error;a.c.forEach(function(b){b(a.f)});a.a=a.c=null};a.v=setTimeout(function(){d.call({error:Error(\"DbOpenTimeoutError\")})},500);a.b.onsuccess=function(){clearTimeout(a.v);a.a?(a.a.forEach(function(a){a(this.result)},this),a.a=a.c=null):(a.b=a.f=null,a.a=[],a.c=[])};a.a.push(b);c&&a.c.push(c)}}\nfunction Yb(a,b,c){ac(a,function(a){a=a.transaction([\"data\"],\"readwrite\");b(a.objectStore(\"data\"))},c)}function Zb(a,b,c){b&&(a.onsuccess=function(){b(this.result)});c&&(a.onerror=function(){c(this.error)})}t(\"H.util.IndexedDBStorage.getInstance\",function(){Wb||(Wb=new Vb);return Wb});var bc=\"H_\";\nt(\"H.util.IndexedDBStorage.isSupported\",function(){if(Xb===A)if(\"file:\"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf(\"firefox\")&&128<=window.location.href.length)Xb=!1;else{var a=z.indexedDB||z.webkitIndexedDB||z.mozIndexedDB||z.msIndexedDB;var b=bc+\"TEST_DB\";try{var c=a&&a.open(b,1)}catch(d){}Xb=!!c&&null===c.onupgradeneeded;c&&a.deleteDatabase&&a.deleteDatabase(b)}return Xb});function K(){0!=cc&&(dc[this[ia]||(this[ia]=++ja)]=this);this.c=this.c;this.a=this.a}var cc=0,dc={};K.prototype.c=!1;K.prototype.O=function(){if(!this.c&&(this.c=!0,this.ga(),0!=cc)){var a=this[ia]||(this[ia]=++ja);if(0!=cc&&this.a&&0<this.a.length)throw Error(this+\" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.\");delete dc[a]}};\nK.prototype.M=function(a,b){this.c?void 0!==b?a.call(b):a():(this.a||(this.a=[]),this.a.push(void 0!==b?na(a,b):a))};K.prototype.ga=function(){if(this.a)for(;this.a.length;)this.a.shift()()};function L(a,b){this.type=a;this.currentTarget=this.target=b;this.a=!1;this.Va=!0}L.prototype.stopPropagation=function(){this.a=!0};L.prototype.c=function(){this.Va=!1};t(\"H.util.Event\",L);L.prototype.stopPropagation=L.prototype.stopPropagation;L.prototype.stopPropagation=L.prototype.stopPropagation;L.prototype.CAPTURING_PHASE=1;L.prototype.CAPTURING_PHASE=L.prototype.CAPTURING_PHASE;L.prototype.AT_TARGET=2;L.prototype.AT_TARGET=L.prototype.AT_TARGET;L.prototype.BUBBLING_PHASE=3;L.prototype.BUBBLING_PHASE=L.prototype.BUBBLING_PHASE;L.prototype.eventPhase=0;L.prototype.eventPhase=L.prototype.eventPhase;function ec(a,b,c){ec.V.constructor.call(this,a,c);this.data=b}qa(ec,L);t(\"H.util.DataEvent\",ec);function fc(a,b,c){fc.V.constructor.call(this,a,c);this.message=b}qa(fc,L);t(\"H.util.ErrorEvent\",fc);function gc(a,b){this.c=a;this.f=b;this.b=0;this.a=null}gc.prototype.get=function(){if(0<this.b){this.b--;var a=this.a;this.a=a.next;a.next=null}else a=this.c();return a};function hc(a,b){a.f(b);100>a.b&&(a.b++,b.next=a.a,a.a=b)};function ic(){this.b=this.a=null}var kc=new gc(function(){return new jc},function(a){a.reset()});ic.prototype.add=function(a,b){var c=kc.get();c.set(a,b);this.b?this.b.next=c:this.a=c;this.b=c};function nc(){var a=oc,b=null;a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null);return b}function jc(){this.next=this.b=this.a=null}jc.prototype.set=function(a,b){this.a=a;this.b=b;this.next=null};jc.prototype.reset=function(){this.next=this.b=this.a=null};var pc=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\\s\\xa0]*([\\s\\S]*?)[\\s\\xa0]*$/.exec(a)[1]};function qc(a,b){return a<b?-1:a>b?1:0};var rc;a:{var sc=p.navigator;if(sc){var tc=sc.userAgent;if(tc){rc=tc;break a}}rc=\"\"}function M(a){return-1!=rc.indexOf(a)};function uc(a){p.setTimeout(function(){throw a;},0)}var vc;\nfunction wc(){var a=p.MessageChannel;\"undefined\"===typeof a&&\"undefined\"!==typeof window&&window.postMessage&&window.addEventListener&&!M(\"Presto\")&&(a=function(){var a=document.createElement(\"IFRAME\");a.style.display=\"none\";a.src=\"\";document.documentElement.appendChild(a);var b=a.contentWindow;a=b.document;a.open();a.write(\"\");a.close();var c=\"callImmediate\"+Math.random(),d=\"file:\"==b.location.protocol?\"*\":b.location.protocol+\"//\"+b.location.host;a=na(function(a){if((\"*\"==d||a.origin==d)&&a.data==\nc)this.port1.onmessage()},this);b.addEventListener(\"message\",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if(\"undefined\"!==typeof a&&!M(\"Trident\")&&!M(\"MSIE\")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var a=c.Ja;c.Ja=null;a()}};return function(a){d.next={Ja:a};d=d.next;b.port2.postMessage(0)}}return\"undefined\"!==typeof document&&\"onreadystatechange\"in document.createElement(\"SCRIPT\")?function(a){var b=document.createElement(\"SCRIPT\");\nb.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){p.setTimeout(a,0)}};function xc(a,b){yc||zc();Ac||(yc(),Ac=!0);oc.add(a,b)}var yc;function zc(){if(-1!=String(p.Promise).indexOf(\"[native code]\")){var a=p.Promise.resolve(void 0);yc=function(){a.then(Bc)}}else yc=function(){var a=Bc;!r(p.setImmediate)||p.Window&&p.Window.prototype&&!M(\"Edge\")&&p.Window.prototype.setImmediate==p.setImmediate?(vc||(vc=wc()),vc(a)):p.setImmediate(a)}}var Ac=!1,oc=new ic;function Bc(){for(var a;a=nc();){try{a.a.call(a.b)}catch(b){uc(b)}hc(kc,a)}Ac=!1};function O(a){this.a=Cc;this.v=void 0;this.f=this.b=this.c=null;this.g=this.i=!1;if(a!=da)try{var b=this;a.call(void 0,function(a){Dc(b,Ec,a)},function(a){Dc(b,Fc,a)})}catch(c){Dc(this,Fc,c)}}var Cc=0,Ec=2,Fc=3;function Gc(){this.next=this.c=this.b=this.f=this.a=null;this.g=!1}Gc.prototype.reset=function(){this.c=this.b=this.f=this.a=null;this.g=!1};var Hc=new gc(function(){return new Gc},function(a){a.reset()});function Ic(a,b,c){var d=Hc.get();d.f=a;d.b=b;d.c=c;return d}\nfunction Jc(a,b,c){Kc(a,b,c,null)||xc(pa(b,a))}function Lc(a){return new O(function(b,c){var d=a.length,e=[];if(d)for(var f=function(a,c){d--;e[a]=c;0==d&&b(e)},g=function(a){c(a)},h=0,k;h<a.length;h++)k=a[h],Jc(k,pa(f,h),g);else b(e)})}function Mc(){var a,b,c=new O(function(c,e){a=c;b=e});return new Nc(c,a,b)}O.prototype.then=function(a,b,c){return Oc(this,r(a)?a:null,r(b)?b:null,c)};O.prototype.then=O.prototype.then;O.prototype.$goog_Thenable=!0;\nO.prototype.cancel=function(a){this.a==Cc&&xc(function(){var b=new Pc(a);Qc(this,b)},this)};function Qc(a,b){if(a.a==Cc)if(a.c){var c=a.c;if(c.b){for(var d=0,e=null,f=null,g=c.b;g&&(g.g||(d++,g.a==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.a==Cc&&1==d?Qc(c,b):(f?(d=f,d.next==c.f&&(c.f=d),d.next=d.next.next):Rc(c),Sc(c,e,Fc,b)))}a.c=null}else Dc(a,Fc,b)}function Tc(a,b){a.b||a.a!=Ec&&a.a!=Fc||Uc(a);a.f?a.f.next=b:a.b=b;a.f=b}\nfunction Oc(a,b,c,d){var e=Ic(null,null,null);e.a=new O(function(a,g){e.f=b?function(c){try{var e=b.call(d,c);a(e)}catch(m){g(m)}}:a;e.b=c?function(b){try{var e=c.call(d,b);void 0===e&&b instanceof Pc?g(b):a(e)}catch(m){g(m)}}:g});e.a.c=a;Tc(a,e);return e.a}O.prototype.ya=function(a){this.a=Cc;Dc(this,Ec,a)};O.prototype.Ba=function(a){this.a=Cc;Dc(this,Fc,a)};\nfunction Dc(a,b,c){a.a==Cc&&(a===c&&(b=Fc,c=new TypeError(\"Promise cannot resolve to itself\")),a.a=1,Kc(c,a.ya,a.Ba,a)||(a.v=c,a.a=b,a.c=null,Uc(a),b!=Fc||c instanceof Pc||Vc(a,c)))}function Kc(a,b,c,d){if(a instanceof O)return Tc(a,Ic(b||da,c||null,d)),!0;if(a)try{var e=!!a.$goog_Thenable}catch(g){e=!1}else e=!1;if(e)return a.then(b,c,d),!0;if(fa(a))try{var f=a.then;if(r(f))return Wc(a,f,b,c,d),!0}catch(g){return c.call(d,g),!0}return!1}\nfunction Wc(a,b,c,d,e){function f(a){h||(h=!0,d.call(e,a))}function g(a){h||(h=!0,c.call(e,a))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function Uc(a){a.i||(a.i=!0,xc(a.S,a))}function Rc(a){var b=null;a.b&&(b=a.b,a.b=b.next,b.next=null);a.b||(a.f=null);return b}O.prototype.S=function(){for(var a;a=Rc(this);)Sc(this,a,this.a,this.v);this.i=!1};\nfunction Sc(a,b,c,d){if(c==Fc&&b.b&&!b.g)for(;a&&a.g;a=a.c)a.g=!1;if(b.a)b.a.c=null,Xc(b,c,d);else try{b.g?b.f.call(b.c):Xc(b,c,d)}catch(e){Yc.call(null,e)}hc(Hc,b)}function Xc(a,b,c){b==Ec?a.f.call(a.c,c):a.b&&a.b.call(a.c,c)}function Vc(a,b){a.g=!0;xc(function(){a.g&&Yc.call(null,b)})}var Yc=uc;function Pc(a){va.call(this,a)}qa(Pc,va);Pc.prototype.name=\"cancel\";function Nc(a,b,c){this.a=a;this.b=b;this.reject=c};function Zc(a,b,c){this.type=a;this.data=b;this.a=Mc();this.Ra=xa(this.Ra,this);this.reject=xa(this.reject,this);this.b=$c;c!==A&&(this.b=c);this.c().add(this)}var $c=1,ad={Wb:0,Xb:$c,Vb:2};l=Zc.prototype;l.then=function(a,b,c){return this.a.a.then(a,b,c)};l.Ra=function(a){this.Y=3;this.a.b(a)};l.reject=function(a){this.Y=5;this.a.reject(a)};l.Y=0;l.cancel=function(){this.a.a.cancel();3>this.Y&&(this.f(),this.c().a(this),this.Y=4)};function bd(a){var b;this.L={};for(b in ad)this.L[ad[b]]=[];this.ma=a;this.ma.addEventListener(\"allocatable\",xa(this.La,this))}t(\"H.util.JobManager\",bd);var cd=Object.keys(ad).map(function(a){return ad[a]}).sort().reverse();\nua(bd.prototype,{add:function(a){Da(a,Zc,this.add,0);this.L[a.b].push(a);this.La()},contains:function(a){return-1<this.L[a.b].indexOf(a)},a:function(a){var b=a.b;a=this.L[b].indexOf(a);return-1<a?(this.L[b].splice(a,1),!0):!1},La:function(){cd.forEach(function(a){this.L[a]=this.L[a].filter(function(a){var b;if((b=this.ma.Yb(a))!==Aa){var d=xa(this.ma.$b,this.ma,b,a);a.then(d,d);a.Y=a.ac(b)?1:5}else return!0},this)},this)}});function dd(a,b,c){var d=[];1<arguments.length&&d.push(b);2<arguments.length&&d.push(\"out of [\"+c[0]+\"...\"+c[1]+\"]\");this.message=(a?La(a):\"\")+(d.length?\" (\"+d.join(\" \")+\")\":\"\");this.stack=Error().stack}t(\"H.lang.OutOfRangeError\",dd);dd.prototype=Error();dd.prototype.name=\"OutOfRangeError\";var ed=\"closure_listenable_\"+(1E6*Math.random()|0),fd=0;function gd(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.ja=e;this.key=++fd;this.U=this.ca=!1}function hd(a){a.U=!0;a.listener=null;a.proxy=null;a.src=null;a.ja=null};function id(a){this.src=a;this.a={};this.b=0}id.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var g=jd(a,b,d,e);-1<g?(b=a[g],c||(b.ca=!1)):(b=new gd(b,this.src,f,!!d,e),b.ca=c,a.push(b));return b};function kd(a,b){var c=b.type;if(c in a.a){var d=a.a[c],e=wa(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(hd(b),0==a.a[c].length&&(delete a.a[c],a.b--))}}\nid.prototype.T=function(a){a=a&&a.toString();var b=0,c;for(c in this.a)if(!a||c==a){for(var d=this.a[c],e=0;e<d.length;e++)++b,hd(d[e]);delete this.a[c];this.b--}return b};function jd(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.U&&f.listener==b&&f.capture==!!c&&f.ja==d)return e}return-1};function ld(a){ld[\" \"](a);return a}ld[\" \"]=da;var md=M(\"Opera\"),nd=M(\"Trident\")||M(\"MSIE\"),od=M(\"Edge\"),pd=M(\"Gecko\")&&!(-1!=rc.toLowerCase().indexOf(\"webkit\")&&!M(\"Edge\"))&&!(M(\"Trident\")||M(\"MSIE\"))&&!M(\"Edge\"),qd=-1!=rc.toLowerCase().indexOf(\"webkit\")&&!M(\"Edge\");function rd(){var a=p.document;return a?a.documentMode:void 0}var sd;\na:{var td=\"\",ud=function(){var a=rc;if(pd)return/rv:([^\\);]+)(\\)|;)/.exec(a);if(od)return/Edge\\/([\\d\\.]+)/.exec(a);if(nd)return/\\b(?:MSIE|rv)[: ]([^\\);]+)(\\)|;)/.exec(a);if(qd)return/WebKit\\/(\\S+)/.exec(a);if(md)return/(?:Version)[ \\/]?(\\S+)/.exec(a)}();ud&&(td=ud?ud[1]:\"\");if(nd){var vd=rd();if(null!=vd&&vd>parseFloat(td)){sd=String(vd);break a}}sd=td}var wd={},xd;var yd=p.document;xd=yd&&nd?rd()||(\"CSS1Compat\"==yd.compatMode?parseInt(sd,10):5):void 0;var zd;(zd=!nd)||(zd=9<=Number(xd));var Ad=zd,Bd;\nif(Bd=nd){var Cd;if(Object.prototype.hasOwnProperty.call(wd,\"9\"))Cd=wd[\"9\"];else{for(var Dd=0,Ed=pc(String(sd)).split(\".\"),Fd=pc(\"9\").split(\".\"),Gd=Math.max(Ed.length,Fd.length),Hd=0;0==Dd&&Hd<Gd;Hd++){var Id=Ed[Hd]||\"\",Jd=Fd[Hd]||\"\";do{var Kd=/(\\d*)(\\D*)(.*)/.exec(Id)||[\"\",\"\",\"\",\"\"],Ld=/(\\d*)(\\D*)(.*)/.exec(Jd)||[\"\",\"\",\"\",\"\"];if(0==Kd[0].length&&0==Ld[0].length)break;Dd=qc(0==Kd[1].length?0:parseInt(Kd[1],10),0==Ld[1].length?0:parseInt(Ld[1],10))||qc(0==Kd[2].length,0==Ld[2].length)||qc(Kd[2],Ld[2]);\nId=Kd[3];Jd=Ld[3]}while(0==Dd)}Cd=wd[\"9\"]=0<=Dd}Bd=!Cd}var Md=Bd,Nd=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},\"passive\",{get:function(){a=!0}});p.addEventListener(\"test\",da,b);p.removeEventListener(\"test\",da,b);return a}();function Od(a,b){L.call(this,a?a.type:\"\");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key=\"\";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType=\"\";this.b=null;if(a){var c=this.type=a.type,d=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=b;if(b=a.relatedTarget){if(pd){a:{try{ld(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else\"mouseover\"==\nc?b=a.fromElement:\"mouseout\"==c&&(b=a.toElement);this.relatedTarget=b;null===d?(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0);this.button=a.button;this.key=a.key||\"\";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=\na.metaKey;this.pointerId=a.pointerId||0;this.pointerType=aa(a.pointerType)?a.pointerType:Pd[a.pointerType]||\"\";this.b=a;a.defaultPrevented&&this.c()}}qa(Od,L);var Pd={2:\"touch\",3:\"pen\",4:\"mouse\"};Od.prototype.stopPropagation=function(){Od.V.stopPropagation.call(this);this.b.stopPropagation?this.b.stopPropagation():this.b.cancelBubble=!0};\nOd.prototype.c=function(){Od.V.c.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Md)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Qd=\"closure_lm_\"+(1E6*Math.random()|0),Rd={},Sd=0;function Td(a,b,c,d,e){if(d&&d.once)Ud(a,b,c,d,e);else if(\"array\"==ea(b))for(var f=0;f<b.length;f++)Td(a,b[f],c,d,e);else c=Vd(c),a&&a[ed]?a.b.add(String(b),c,!1,fa(d)?!!d.capture:!!d,e):Wd(a,b,c,!1,d,e)}\nfunction Wd(a,b,c,d,e,f){if(!b)throw Error(\"Invalid event type\");var g=fa(e)?!!e.capture:!!e,h=Xd(a);h||(a[Qd]=h=new id(a));c=h.add(b,c,d,g,f);if(!c.proxy){d=Yd();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)Nd||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(Zd(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error(\"addEventListener and attachEvent are unavailable.\");Sd++}}\nfunction Yd(){var a=$d,b=Ad?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function Ud(a,b,c,d,e){if(\"array\"==ea(b))for(var f=0;f<b.length;f++)Ud(a,b[f],c,d,e);else c=Vd(c),a&&a[ed]?a.b.add(String(b),c,!0,fa(d)?!!d.capture:!!d,e):Wd(a,b,c,!0,d,e)}\nfunction ae(a,b,c,d,e){if(\"array\"==ea(b))for(var f=0;f<b.length;f++)ae(a,b[f],c,d,e);else(d=fa(d)?!!d.capture:!!d,c=Vd(c),a&&a[ed])?(a=a.b,b=String(b).toString(),b in a.a&&(f=a.a[b],c=jd(f,c,d,e),-1<c&&(hd(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&&(delete a.a[b],a.b--)))):a&&(a=Xd(a))&&(b=a.a[b.toString()],a=-1,b&&(a=jd(b,c,d,e)),(c=-1<a?b[a]:null)&&be(c))}\nfunction be(a){if(\"number\"!=typeof a&&a&&!a.U){var b=a.src;if(b&&b[ed])kd(b.b,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(Zd(c),d):b.addListener&&b.removeListener&&b.removeListener(d);Sd--;(c=Xd(b))?(kd(c,a),0==c.b&&(c.src=null,b[Qd]=null)):hd(a)}}}function Zd(a){return a in Rd?Rd[a]:Rd[a]=\"on\"+a}\nfunction ce(a,b,c,d){var e=!0;if(a=Xd(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.U&&(f=de(f,d),e=e&&!1!==f)}return e}function de(a,b){var c=a.listener,d=a.ja||a.src;a.ca&&be(a);return c.call(d,b)}\nfunction $d(a,b){if(a.U)return!0;if(!Ad){if(!b)a:{b=[\"window\",\"event\"];for(var c=p,d=0;d<b.length;d++)if(c=c[b[d]],null==c){b=null;break a}b=c}d=b;b=new Od(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.currentTarget;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;!b.a&&0<=e;e--){b.currentTarget=d[e];var f=ce(d[e],a,!0,b);c=c&&f}for(e=0;!b.a&&e<d.length;e++)b.currentTarget=\nd[e],f=ce(d[e],a,!1,b),c=c&&f}return c}return de(a,new Od(b,this))}function Xd(a){a=a[Qd];return a instanceof id?a:null}var ee=\"__closure_events_fn_\"+(1E9*Math.random()>>>0);function Vd(a){if(r(a))return a;a[ee]||(a[ee]=function(b){return a.handleEvent(b)});return a[ee]};function Q(){K.call(this);this.b=new id(this);this.v=this;this.i=null}qa(Q,K);Q.prototype[ed]=!0;l=Q.prototype;l.I=function(){return this.i};l.Fa=function(a){this.i=a};l.addEventListener=function(a,b,c,d){Td(this,a,b,c,d)};l.removeEventListener=function(a,b,c,d){ae(this,a,b,c,d)};\nl.dispatchEvent=function(a){var b,c=this.I();if(c)for(b=[];c;c=c.I())b.push(c);c=this.v;var d=a.type||a;if(aa(a))a=new L(a,c);else if(a instanceof L)a.target=a.target||c;else{var e=a;a=new L(d,c);ua(a,e)}e=!0;if(b)for(var f=b.length-1;!a.a&&0<=f;f--){var g=a.currentTarget=b[f];e=g.P(d,!0,a)&&e}a.a||(g=a.currentTarget=c,e=g.P(d,!0,a)&&e,a.a||(e=g.P(d,!1,a)&&e));if(b)for(f=0;!a.a&&f<b.length;f++)g=a.currentTarget=b[f],e=g.P(d,!1,a)&&e;return e};\nl.ga=function(){Q.V.ga.call(this);this.b&&this.b.T(void 0);this.i=null};l.P=function(a,b,c){a=this.b.a[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.U&&f.capture==b){var g=f.listener,h=f.ja||f.src;f.ca&&kd(this.b,f);d=!1!==g.call(h,c)&&d}}return d&&0!=c.Va};t(\"H.util.EventTarget\",Q);Q.prototype.Fa=Q.prototype.Fa;Q.prototype.setParentEventTarget=Q.prototype.Fa;Q.prototype.I=Q.prototype.I;Q.prototype.getParentEventTarget=Q.prototype.I;Q.prototype.addEventListener=Q.prototype.addEventListener;Q.prototype.addEventListener=Q.prototype.addEventListener;Q.prototype.removeEventListener=Q.prototype.removeEventListener;Q.prototype.removeEventListener=Q.prototype.removeEventListener;Q.prototype.dispatchEvent=Q.prototype.dispatchEvent;\nQ.prototype.dispatchEvent=Q.prototype.dispatchEvent;Q.prototype.O=Q.prototype.O;Q.prototype.dispose=Q.prototype.O;Q.prototype.M=Q.prototype.M;Q.prototype.addOnDisposeCallback=Q.prototype.M;Q.prototype.S=Q.prototype.P;\nQ.prototype.P=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?\"AT_TARGET\":b?\"CAPTURING_PHASE\":(d=!0,\"BUBBLING_PHASE\")];if(!d||\"pointerenter\"!==(e=c.type)&&\"pointerleave\"!==e)c.eventPhase=g,f=Q.prototype.S.apply(this,arguments),d&&this.I&&null===this.I()&&delete c.eventPhase;return f};function T(a){a=a||{};var b=a.callback;this.g=a.label;r(b)&&(this.callback=b);this.f=!!a.disabled;T.V.constructor.call(this)}qa(T,Q);t(\"H.util.ContextItem\",T);T.prototype.ob=function(){return this.g};T.prototype.getLabel=T.prototype.ob;T.prototype.Pb=function(a){this.g!==a&&(this.g=a,this.dispatchEvent(\"update\"));return this};T.prototype.setLabel=T.prototype.Pb;T.prototype.Db=function(){return this.f};T.prototype.isDisabled=T.prototype.Db;\nT.prototype.Ob=function(a){a^this.f&&(this.f=a,this.dispatchEvent(\"update\"));return this};T.prototype.setDisabled=T.prototype.Ob;var fe=new T;T.SEPARATOR=fe;function ge(){if(z.document){var a=document.createElement(\"canvas\");a.width=a.height=1;a.getContext(\"2d\")}}Object.create(Aa,void 0);t(\"H.util.eval\",function(a){return eval(a)});t(\"H.util.provide\",function(a){ca(a,void 0)});function he(){this.A=0}he.prototype.next=function(a){if(9007199254740992===this.A)throw new dd(a,this.A,[0,9007199254740991]);return this.A++};var je=new he;xa(je.next,je);function $b(){}var cb=za([]);za({});ge();ge();var ke={undefined:\"GL\",GL:\"GL\",OL:\"OL\",SL:\"SL\",SB:\"SB\",WE:\"WE\",WG:\"WG\"};t(\"H.geo.AltitudeContext\",ke);function le(a,b,c){var d=Db(+a,-90,90);if(b&&Ia(d))throw new B(b,c,a);return d}function me(a,b,c){var d=+a;if(-180>d||180<d)d=Cb(d+180,360)-180;if(b&&Ia(d))throw new B(b,c,a);return d}function ne(a,b,c){var d;if(a!==A&&Ia(d=+a)&&b)throw new B(b,c,a);return d}function oe(a,b,c){var d=!ke[a];if(b&&d)throw new B(b,c,a);return!d}t(\"H.geo.isDBC\",function(a,b){return 0!==(0>a^0>b)&&180<kb(b-a)});function pe(){var a=pe;if(!0===(Da(this,a)&&this.constructor===a))throw new TypeError(\"Illegal constructor \"+La(a));}t(\"H.geo.AbstractGeometry\",pe);pe.prototype.getBoundingBox=pe.prototype.ha;pe.prototype.equals=pe.prototype.G;pe.prototype.f=\"\";pe.prototype.toString=function(){return this.g([this.f.toUpperCase(),\" \"]).join(\"\")};pe.prototype.toString=pe.prototype.toString;function U(a,b,c,d){this.lat=le(a,U,0);this.lng=me(b,U,1);c!==A&&(this.alt=ne(c,U,2));d!==A&&oe(d,U,3)&&(this.ctx=d)}qa(U,pe);t(\"H.geo.Point\",U);U.prototype.G=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&ke[this.ctx]===ke[a.ctx]&&(this.alt||0)===(a.alt||0)};U.prototype.equals=U.prototype.G;\nU.prototype.qa=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*zb;var c=a.lat*zb;a=1.274200158E7*ob(ib(1,gb(hb(nb((b-c)/2),2)+pb(b)*pb(c)*hb(nb((this.lng*zb-a.lng*zb)/2),2))))}return a};U.prototype.distance=U.prototype.qa;\nU.prototype.Sb=function(a,b,c){if(c){if(b/=6371000.79){a*=zb;var d=zb*this.lat;var e=nb(d);var f=nb(b);var g=pb(b);var h=zb*this.lng;var k=pb(d);d=ob(k*pb(a)*f+e*g);a=sb(nb(a)*k*f,g-e*nb(d));a=(h+a+J)%(2*J)-J;k=a*Ab}return b?new U(d*Ab,(k+540)%360-180):this}a=(a%360+360)%360;if(0===(a+90)%180)return d=this.lng+b/(6371000.79*wb*pb(this.lat*zb))*(270===a?-360:360),new U(this.lat,(d+540)%360-180);if(b/=6371000.79){a*=zb;h=this.lat*zb;e=this.lng*zb;f=h+b*pb(a);g=f-h;d=lb(qb(f/2+vb)/qb(h/2+vb));d=Ia(g/\nd)?pb(h):g/d;var m=b*nb(a)/d;kb(f)>ub&&(f=0<f?J-f:-(J+f))}return b?new U(f*Ab,((e+m+yb+(kb(h+g)>ub?J:0))%wb-J)*Ab):this};U.prototype.walk=U.prototype.Sb;U.prototype.ha=function(){return new V(this.lat,this.lng,this.lat,this.lng)};U.prototype.getBoundingBox=U.prototype.ha;function qe(a,b,c){var d=!!a&&!(Ia(a.lat=le(a.lat))||Ia(a.lng=me(a.lng))||a.alt!==A&&Ia(a.alt=ne(a.alt))||a.ctx!==A&&!oe(a.ctx));if(!d&&b)throw new B(b,c,a);return d}U.validate=qe;\nfunction re(a){if(!a)throw new B(re,0,a);return new U(a.lat,a.lng,a.alt,a.ctx)}U.fromIPoint=re;U.prototype.f=\"Point\";U.prototype.g=function(a){a.push(\"(\",this.lng,\" \",this.lat,\")\");return a};var W={};t(\"H.geo.mercator\",W);W.a=function(a){return ib(1,jb(0,.5-lb(qb(vb+ub*a/180))/J/2))};W.b=function(a){return a/360+.5};W.ka=function(a,b,c){c?(c.x=W.b(b),c.y=W.a(a)):c=new G(W.b(b),W.a(a));return c};W.latLngToPoint=W.ka;W.jb=function(a,b){return W.ka(a.lat,a.lng,b)};W.geoToPoint=W.jb;W.f=function(a){return 0>=a?90:1<=a?-90:Ab*(2*rb(mb(J*(1-2*a)))-ub)};W.c=function(a){return 360*(1===a?1:Cb(a,1))-180};W.W=function(a,b,c){c?(c.lat=W.f(b),c.lng=W.c(a)):c=new U(W.f(b),W.c(a));return c};\nW.xyToGeo=W.W;W.Ib=function(a,b){return W.W(a.x,a.y,b)};W.pointToGeo=W.Ib;t(\"H.util.constants.DEFAULT_MIN_ZOOM_LEVEL\",0);t(\"H.util.constants.DEFAULT_MAX_ZOOM_LEVEL\",22);function Y(a,b){this.projection=a||W;this.b=0;this.a=this.exp=lb(b||256)/tb;se(this);this.y=this.x=0}t(\"H.geo.PixelProjection\",Y);var te=kb(24)+kb(-8);Y.prototype.ba=function(a){if(Ia(a))throw new B(this.ba,0,a);var b=this.x/this.w;var c=this.y/this.h;this.b=a;this.a=this.exp+a;se(this);this.x=b*this.w;this.y=c*this.h};Y.prototype.rescale=Y.prototype.ba;function se(a){a.a>te&&(a.a=te);a.w=hb(2,a.a);a.h=hb(2,a.a)}Y.prototype.Oa=function(){return this.b||0};Y.prototype.getZoomScale=Y.prototype.Oa;\nY.prototype.ib=function(a,b){a=this.projection.ka(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Y.prototype.geoToPixel=Y.prototype.ib;Y.prototype.Ca=function(a,b){return this.projection.W((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};Y.prototype.pixelToGeo=Y.prototype.Ca;Y.prototype.W=function(a,b,c){return this.projection.W((a+this.x)/this.w,(b+this.y)/this.h,c)};Y.prototype.xyToGeo=Y.prototype.W;\nY.prototype.xa=function(a,b,c){a=this.projection.ka(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};Y.prototype.latLngToPixel=Y.prototype.xa;Y.prototype.Jb=function(a){return new G(a.x*this.w-this.x,a.y*this.h-this.y)};Y.prototype.pointToPixel=Y.prototype.Jb;t(\"H.util.Disposable\",K);K.prototype.M=K.prototype.M;K.prototype.addOnDisposeCallback=K.prototype.M;t(\"H.util.dispose\",function(a){a&&\"function\"==typeof a.O&&a.O()});function ue(a,b,c,d){this.key=\"\";this.x=a;this.y=b;this.b=c;this.X=d;this.a=Mc()}ue.prototype.then=function(a,b,c){return this.a.a.then(a,b,c)};ue.prototype.reject=function(a){this.a.reject(a)};ue.prototype.cancel=function(){this.a.a.cancel()};function Z(a,b,c,d,e,f){if(a&&b)this.Ya(a),this.Da(b),this.Ga(c),this.Xa(e),this.Wa(f),this.Ha(d);else throw Error('Parameters \"scheme\" and \"host\" must be specified');}t(\"H.service.Url\",Z);\nfunction ve(a,b){var c=z.document,d,e=c&&c.createElement(\"a\"),f=\"\";if(c){if(b){var g=(d=c.getElementsByTagName(\"base\")[0])&&d.href;var h=c.head;var k=d||h.appendChild(c.createElement(\"base\"));k.href=b}e.href=a;f=e.href;b&&(d?d.href=g:h.removeChild(k))}else/[\\w]+:\\/\\//.test(a)&&(f=a);g=/(?:(\\w+):\\/\\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\\/[^?#]*)?(\\?[^#]+)?(#.*)?/.exec(f);a=g[1];k=g[4];b=g[5];h=g[6];c=g[7];d=g[8];!g[2]&&k&&/@/.test(k)&&(k=k.split(\"@\")[1]);g=k;h=h&&0<h.length?h.substr(1):\n\"\";k={};if(c)for(e=/([?&]?([^=&+]+))(=([^&]+))?/g;f=e.exec(c);)k[decodeURIComponent(f[2])]=f[4]?decodeURIComponent(f[4]):void 0;return new Z(a,g,h,k,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):\"\")}Z.parse=ve;var we=0;Z.prototype.clone=function(){we++;var a={},b;for(b in this.a)a[b]=this.a[b];return new Z(this.i,this.f,this.b,a,this.g,this.c)};Z.prototype.clone=Z.prototype.clone;\nZ.prototype.Ya=function(a){if(!a||\"string\"!==typeof a)throw Error('The \"scheme\" parameter must be a non-empty string.');this.i=a;return this};Z.prototype.setScheme=Z.prototype.Ya;Z.prototype.wb=function(){return this.i};Z.prototype.getScheme=Z.prototype.wb;Z.prototype.Da=function(a){if(!a||\"string\"!==typeof a||\"-\"===a.charAt(0)||\".\"===a.charAt(0)||\".\"===a.charAt(a.length-1))throw Error('The \"host\" parameter is not a valid host name.');this.f=a;return this};Z.prototype.setHost=Z.prototype.Da;\nZ.prototype.nb=function(){return this.f};Z.prototype.getHost=Z.prototype.nb;Z.prototype.Ga=function(a){this.b=a||void 0;return this};Z.prototype.setPath=Z.prototype.Ga;Z.prototype.sb=function(){return this.b};Z.prototype.getPath=Z.prototype.sb;Z.prototype.Ha=function(a){if(a)if(\"object\"==typeof a)this.a=a;else throw Error('Parameter \"params\" must be an object.');else this.a={};return this};Z.prototype.setQuery=Z.prototype.Ha;Z.prototype.yb=function(){return!xe(this)};Z.prototype.hasQuery=Z.prototype.yb;\nZ.prototype.ub=function(){return this.a};Z.prototype.getQuery=Z.prototype.ub;Z.prototype.Xa=function(a){if(a&&isNaN(parseInt(a,10)))throw Error('Parameter \"port\" must be a number or undefined');this.g=+a||void 0;return this};Z.prototype.setPort=Z.prototype.Xa;Z.prototype.tb=function(){return this.g};Z.prototype.getPort=Z.prototype.tb;Z.prototype.Wa=function(a){this.c=a||void 0;return this};Z.prototype.setAnchor=Z.prototype.Wa;Z.prototype.kb=function(){return this.c};Z.prototype.getAnchor=Z.prototype.kb;\nZ.prototype.Z=function(a){if(\"object\"!==typeof a)throw Error('Parameter \"other\" must be an object.');var b=this.a,c;for(c in a)a.hasOwnProperty(c)&&\"function\"!==typeof a[c]&&(b[c]=a[c]);return this};Z.prototype.mergeQuery=Z.prototype.Z;Z.prototype.Za=function(a){if(!a||\"string\"!==typeof a)throw Error('Parameter \"subDomain\" must be a non-empty string');\".\"===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Da(a+\".\"+this.f)};Z.prototype.addSubDomain=Z.prototype.Za;\nZ.prototype.$a=function(a){if(!a||\"string\"!==typeof a)throw Error('Parameter \"subPath\" must be a non-empty string');return this.Ga((this.b?this.b+\"/\":\"\")+a)};Z.prototype.addSubPath=Z.prototype.$a;Z.prototype.toString=function(){return[this.i+\"://\",this.f,this.g?\":\"+this.g:\"\",this.b||!xe(this)||this.c?\"/\":\"\",this.b?encodeURI(this.b):\"\",ye(this),this.c?\"#\"+encodeURIComponent(this.c):\"\"].join(\"\")};Z.prototype.toString=Z.prototype.toString;\nfunction ye(a){var b=[],c,d=a.a;for(c in d)if(d.hasOwnProperty(c)&&\"function\"!==typeof d[c]){var e=a.a[c];b.push(encodeURIComponent(c)+(void 0===e?\"\":\"=\"+encodeURIComponent(e)))}return 0<b.length?\"?\"+b.join(\"&\"):\"\"}function xe(a){var b,c=0;for(b in a.a)if(a.a.hasOwnProperty(b)&&\"function\"!==typeof a.a[b]&&(c++,0<c))break;return!c};var ze={};function Ae(a){try{importScripts.apply(self,arguments)}catch(b){this.postError(\"invalid_script\")}}function Be(a){ze[a]=null;this.postMessage(a)}function Ce(a,b,c){if(r(b))var d=b;else try{d=self.eval(\"(\"+b+\")\"),r(d)||(d=null)}catch(e){}d?(ze[a]=d,c||this.postMessage(a)):this.postError(\"invalid_processor\")}function De(a){this.b=a&&a[0];this.a=a&&a[1];this.c=a&&a[2]||[]}De.prototype.postError=function(a){this.postMessage(a,A,0)};\nDe.prototype.postMessage=function(a,b,c){self.postMessage({processor:this.b,taskId:this.a,type:c===A?1:c,data:a},b||A)};function Ee(a,b,c){if(!aa(a))throw new B(Ee,0,\"InvalidArgument\");if(!r(b))throw new B(Ee,1,\"InvalidArgument\");var d=Fe++;Ge[d]={mimeType:c||He,cb:b};(new De([\"3\",d,[]])).postMessage(a,[],2)}var Ge={},Fe=0;\nfunction Ie(a,b){var c=a;if(Ge[this.a]){var d=Ge[this.a];var e=d.cb;delete Ge[this.a];if(b)e(null,b);else{if(d.mimeType===Je){a=new Uint8Array(a);b=a.byteLength;d=\"\";c=0;for(var f,g,h,k;c<b;)f=a[c++],192>f||(g=a[c++],224>f?f=(f&31)<<6|g&63:(h=a[c++],240>f?f=(f&15)<<12|(g&63)<<6|h&63:(k=a[c++],f=(f&7)<<18|(g&63)<<12|(h&63)<<6|k&63))),65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode((f>>10)+55296,(f&1023)+56320));c=d}e(c)}}}var He=0,Je=1;function V(a,b,c,d){Ke(this,le(a,V,0),me(b,V,1),le(c,V,2),me(d,V,3))}qa(V,pe);t(\"H.geo.Rect\",V);V.prototype.f=\"Polygon\";V.prototype.g=function(a){var b=this.o,c=this.j,d=this.m,e=this.l;a.push(\"(\",\"(\",c,\" \",b,\",\",e,\" \",b,\",\",e,\" \",d,\",\",c,\" \",d,\",\",c,\" \",b,\")\",\")\");return a};V.prototype.G=function(a){return this===a||!!a&&this.o===a.o&&this.j===a.j&&this.m===a.m&&this.l===a.l};V.prototype.equals=V.prototype.G;V.prototype.clone=function(){return new V(this.o,this.j,this.m,this.l)};\nV.prototype.clone=V.prototype.clone;function Ke(a,b,c,d,e){a.j=c;a.l=e;b<d&&(c=b,b=d,d=c);a.o=b;a.m=d;a.c=a.a=a.b=null;return a}V.prototype.Na=function(){this.c||(this.c=new U(this.o,this.j));return this.c};V.prototype.getTopLeft=V.prototype.Na;V.prototype.Ma=function(){this.a||(this.a=new U(this.m,this.l));return this.a};V.prototype.getBottomRight=V.prototype.Ma;V.prototype.xb=function(){return this.o};V.prototype.getTop=V.prototype.xb;V.prototype.lb=function(){return this.m};\nV.prototype.getBottom=V.prototype.lb;V.prototype.pb=function(){return this.j};V.prototype.getLeft=V.prototype.pb;V.prototype.vb=function(){return this.l};V.prototype.getRight=V.prototype.vb;V.prototype.H=function(){this.b||(this.b=new U(this.m+(this.o-this.m)/2,Le(this.j,this.J())));return this.b};V.prototype.getCenter=V.prototype.H;V.prototype.J=function(){return Me(this.j,this.l)};V.prototype.getWidth=V.prototype.J;V.prototype.R=function(){return this.o-this.m};V.prototype.getHeight=V.prototype.R;\nV.prototype.Bb=function(){return this.j>this.l};V.prototype.isCDB=V.prototype.Bb;V.prototype.Eb=function(){return!this.J()&&!this.R()};V.prototype.isEmpty=V.prototype.Eb;V.prototype.ha=function(){return new V(this.o,this.j,this.m,this.l)};V.prototype.getBoundingBox=V.prototype.ha;V.prototype.da=function(a,b,c){var d=this.H();c||(a=le(a,this.da,0),b=me(b,this.da,1));b=this.K(a,b,c);a=b.H();return a.lat===d.lat&&a.lng===d.lng&&this.R()===b.R()&&this.J()===b.J()};V.prototype.containsLatLng=V.prototype.da;\nV.prototype.ea=function(a,b){b||qe(a,this.ea,0);return this.da(a.lat,a.lng,b)};V.prototype.containsPoint=V.prototype.ea;V.prototype.Ka=function(a,b){var c=this.H();if(!b&&!Da(a,V))throw new B(this.Ka,0,a);b=this.la(a,b);a=b.H();return a.lat===c.lat&&a.lng===c.lng&&this.R()===b.R()&&this.J()===b.J()};V.prototype.containsRect=V.prototype.Ka;\nV.prototype.K=function(a,b,c,d){if(!c){if(Ia(a=le(a)))throw new B(this.K,0,a);if(Ia(b=me(b)))throw new B(this.K,1,b);}return Ne(this.o,this.j,this.m,this.l,a,b,a,b,d)};V.prototype.mergeLatLng=V.prototype.K;V.prototype.Sa=function(a,b,c){b||qe(a,this.Sa,0);return this.K(a.lat,a.lng,b,c)};V.prototype.mergePoint=V.prototype.Sa;V.prototype.la=function(a,b,c){if(!b&&!Da(a,V))throw new B(this.la,0,a);return Ne(this.o,this.j,this.m,this.l,a.o,a.j,a.m,a.l,c)};V.prototype.mergeRect=V.prototype.la;\nV.prototype.$=function(a,b,c,d,e,f){e||(a=le(a,this.$,0),b=me(b,this.$,1),c=le(c,this.$,2),d=me(d,this.$,3));return Ne(this.o,this.j,this.m,this.l,a,b,c,d,f)};V.prototype.mergeTopLeftBottomRight=V.prototype.$;V.prototype.Qa=function(a,b){var c=this.j<=this.l,d=a.j<=a.l,e=this.j<a.l,f=a.j<this.l;if(!b&&!Da(a,V))throw new B(this.Qa,0,a);return this.m<=a.o&&a.m<=this.o&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};V.prototype.intersects=V.prototype.Qa;function Me(a,b){a=b-a;return a+(0>a?360:0)}\nfunction Le(a,b){a+=b/2;return a-(180<a?360:0)}function Ne(a,b,c,d,e,f,g,h,k){c=ib(c,g);a=jb(a,e);e=Me(b,d);var m=Le(b,e);g=Me(f,h);var q=Le(f,g)-m;q+=0>q-1E-6?360:0;if(180>q-1E-6){m=b;var n=h}else q=360-q,m=f,n=d;q=q+e/2+g/2;360<=q+5E-7?(m=-180,n=180):q-5E-7<e?(m=b,n=d):q-5E-7<g&&(m=f,n=h);return k?Ke(k,a,m,c,n):new V(a,m,c,n)}V.merge=Ne;function Oe(a,b,c){c||(qe(a,Oe,0),qe(b,Oe,1));return new V(a.lat,a.lng,b.lat,b.lng)}V.fromPoints=Oe;\nfunction Pe(a,b){var c=1,d=a.length,e=null;var f=ea(a);if(\"array\"!=f&&(\"object\"!=f||\"number\"!=typeof a.length))throw new B(Pe,0,a);if(0<d)for(f=a[0],e=Oe(f,f,b);c<d;c++)f=a[c],e.K(f.lat,f.lng,b,e);return e}V.coverPoints=Pe;function Qe(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new B(Qe,0,a);if(0<d)for(e=new V(a[0],a[1],a[0],a[1]);c<d;c+=3)e.K(a[c],a[c+1],b,e);return e}V.coverLatLngAlts=Qe;\nfunction Re(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new B(Re,0,a);if(0<d)for(e=new V(a[0].o,a[0].j,a[0].m,a[0].l);c<d;c++)e.la(a[c],b,e);return e}V.coverRects=Re;\nV.prototype.Ua=function(a,b){var c=this.j,d=this.o,e=this.l,f=this.m,g=this.H().lng;qe(a,this.Ua,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?Ke(b,d,a,f,e):new V(d,a,f,e)};V.prototype.resizeToCenter=V.prototype.Ua;function Se(a,b,c,d){var e=!!c,f,g=0,h=0,k=0,m=0,q=0,n,u=-1;var C=z.Float32Array;var y,v=[];if(b){b=Ba(b);a=Ba(a);e&&(f=Ba(c));c=b.length;d=d?1E-7:1E-5;for(y=new C(3*c);g<c;){C=b[g];var I=+C;var la=+a[g];e&&(n=+f[g]);Te.test(C)?0<=u&&(0<g-u&&v.push(u,g+1),u=-1):0>u&&(u=g);g++;m=y[h++]=m+la*d;k=y[h++]=k+I*d;e&&(q=y[h]=q+n);h++}0<=u&&1<c-u&&v.push(u,c)}else y=new C(0);return{path:y,outlineIndices:v}}var Te=/^-?0\\d/;\nfunction Ue(a,b){for(var c=0,d=a.length/3,e=new z.Array(d),f=0;c<d;)e[c++]=b.xa(a[f],a[++f]),f+=2;return e};function Ve(a,b){b=180/(1<<b);var c=a.lat+90;a=(a.lng+180)%360;var d=0;180==c&&d--;d+=Math.floor(c/b);return[d,Math.floor(a/b)]}var We=1/Math.pow(10,10);function Xe(a,b){var c=[],d=a.Na();a=a.Ma();var e;180==a.lng&&(a.lng-=We);d=Ve(d,b);a=Ve(a,b);for(e=d[0];e>=a[0];e--)for(b=d[1];b<=a[1];b++)c.push(e,b);return c};function Ye(a,b){var c=a.tileSize||256;this.b={};this.v=ve(a.serverUrl);this.g=b;this.Ba=a.layerConfigs||[];this.i=a.projected;this.S=c;this.ya=!1!==a.batchTiles;this.Nb=a.onlyOutline;this.Rb=new Y(Aa,c);this.f=new Y(Aa,c);this.f.ba(22-Math.log(c)/Math.LN2+8)}qa(Ye,K);l=Ye.prototype;l.Mb=function(a,b,c){var d=this.S,e={x:a*d,y:b*d};d={x:a*d+(d-1),y:b*d+(d-1)};var f=this.Rb;f.ba(c);e=f.Ca(e);d=f.Ca(d);return Ze(this,new V(e.lat,e.lng,d.lat,d.lng),this.Ba,{x:a,y:b,z:c})};\nl.Lb=function(a,b,c,d,e){return Ze(this,new V(a,b,c,d),e)};\nfunction Ze(a,b,c,d){var e=$e(c),f=e.length,g={},h,k=a.b,m=[],q=[];for(c=0;c<f;c++){var n=e[c];var u=n.layerId;var C=n.level;g[u]=n.columns;n=Xe(b,C);var y=n.length-1;for(h=0;h<y;h+=2){var v=[u,n[h+1],n[h],C].join(\"_\");var I=k[v]||a.g.get(v);I||(I=new ue(n[h+1],n[h],C,u),I.key=v,k[v]=I,q.push(I));m.push(I)}}q.length&&(a.ya?af(a,q):bf(a,q));return Lc(m.map(function(a){return a.then(xa(this.gb,this,a.X,cf(e))).then(xa(this.Kb,this,a,d||{})).then(xa(this.hb,this,g[a.X]))},a))}\nl.gb=function(a,b,c){var d=c.Rows,e=d.length,f,g;if(e&&(f=b[a])){b=new F(c.Rows);var h=[];for(g=0;g<e;g++){var k=d[g];f(b.ia(g),a)&&h.push(k)}a={Rows:h};if(c=c.Meta)a.Meta=c}else a=c;return a};function bf(a,b){function c(b,c,d){d?(delete a.b[b.key],b.reject(d)):df(a,b,c)}var d,e=b.length,f=a.v;for(d=0;d<e;d++){var g=b[d];var h=f.clone().Z({tilex:g.x}).Z({tiley:g.y}).Z({level:g.b}).Z({layer:g.X});new Ee(h.toString(),xa(c,null,g),Je)}}\nfunction af(a,b){var c=b.length,d;for(d=0;d<c;d+=15){var e=b.slice(d,d+15);ef(a,e)}}function ef(a,b){var c=a.v.clone(),d=[],e=[],f=[],g=c.a;b.length&&(b.forEach(function(a){d.push(a.x,a.y);e.push(a.b);f.push(a.X)}),g.tilexy=d.join(\",\"),g.layers=f.join(\",\"),g.levels=e.join(\",\"),c.Ha(g),new Ee(c.toString(),function(c,d){d?b.forEach(function(b){delete a.b[b.key];b.reject(\"error\")}):df(a,b,c)},Je))}\nfunction df(a,b,c){var d=b.length,e;if(Ea(b,void 0,void 0,void 0)){var f=c.indexOf(\"[\")+1;for(e=0;e<d;e++){var g=c.indexOf(\"]},{\",f+3)+2;g<f&&(g=c.lastIndexOf(\"]}\"));var h=c.substr(f,g-f);f=g+1;ff(a,b[e],h)}}else ff(a,b,c)}function ff(a,b,c){try{var d=c.length;var e=b.key;delete a.b[e];a.g.add(e,b,2*d);var f=JSON.parse(c);b.a.b(f)}catch(g){b.reject(g.message)}}\nfunction cf(a){var b={},c,d=a.length;for(c=0;c<d;c++){var e=a[c];if(e.rowFilter){var f=e.layerId;f=f!==A?f:e.layer;b[f]=xa(e.rowFilter,e.rowFilterContext)}}return b}function gf(a,b,c,d,e){return e?[new G(a,b),new G(c,b),new G(c,d),new G(a,d),new G(a,b)]:[a,b,c,b,c,d,a,d]}\nl.Kb=function(a,b,c){var d=this.f.Oa()-b.z,e=this.S<<d,f=50<<d,g=b.x*e;b=b.y*e;var h=g+e;e=b+e;var k=g-f,m=b-f,q=h+f;f=e+f;var n,u,C=c.Rows,y=C.length,v,I=/^ADAS/.test(a.X),la=this.f,oa=this.Nb,P,Xa=[],Fa=[],Ga=[],Ya=[];for(a=0;a<y;a++){var w=v=C[a];var N=(P=I)?\"HPY\":\"LAT\";var R=P?\"HPX\":\"LON\";var ba=P?\"HPZ\":\"ZLEVEL\";if(w[N]){var S=Se(w[N],w[R],w[ba],P);w.geometry=S;delete w[N];delete w[R];delete w[ba];if(w.INNER_LAT)for(N=w.INNER_LAT.split(\";\"),S=w.INNER_LON.split(\";\"),delete w.INNER_LAT,delete w.INNER_LON,\nw.interiors=ba=[],R=N.length,w=0;w<R;w++)ba.push(Se(N[w],S[w],\"\",P))}if(this.i){P=void 0;R=v;S=la;N=R.$$projected$$;if(!N){var X=R.geometry;w=Ue(X.path,S);v=[w];R.$$projected$$=N={Hb:v};R=(ba=R.interiors)?ba.length:0;v.length+=R;P|=hf(v,w,X.outlineIndices);if(R)for(N.zb=1,n=0;n<R;n++)X=ba[n],w=Ue(X.path,S),v[1+n]=w,P|=hf(v,w,X.outlineIndices);P&&(N.Fb=1+R)}w=N;P=w.Hb;v=w.zb;var lc=w.Fb;S=[];N=R=Bb;var Za=ba=A;w=P[0];if(1===w.length){var mc=mc||(mc=gf(g,b,h,e,!1));v=w[0];Hb(v.x,v.y,mc,0,!0)&&S.push(jf(w,\ng,b,d))}else{var ie=P.length;for(X=oa?lc:0;X<ie&&(oa||!X||S.length);X++)if(w=P[X],X>=lc){X===lc&&(N=S.length);var ha=Ib([w],k,m,q,f,!1);kf(ha,g,b,d,S)}else{var xb=xb||(xb=gf(k,m,q,f,!0));if(X>=v)if(X===v&&(R=S.length),Za)for(n=Za.length;n--;){if(ha=lf(Za[n],w),u=ha.length){for(ba=ba||[];u--;)ba.push(n);kf(ha,g,b,d,S)}}else ha=lf(xb,w),kf(ha,g,b,d,S);else if(ha=lf(xb,w),kf(ha,g,b,d,S),1<ha.length&&v<ie)for(Za=[],n=ha.length;n--;)Za[n]=ha[n]}}S.length&&(Xa[a]=S,Fa[a]=R,Ga[a]=ba,Ya[a]=N)}}return{Qb:c,\neb:Xa,Ab:Fa,fb:Ga,Gb:Ya}};function hf(a,b,c){for(var d=c.length,e=0,f,g,h=b.length;e<d;)f=c[e++],g=c[e++],a.push(g-f===h?b:b.slice(f,g));return 0<c.length}function lf(a,b){var c,d=[];if(c=Kb(a,b)){do{a=[];b=c;do a.push(b);while(b=b.next);d.push(a)}while(c=c.Ta)}else mf(b[0],a)?d.push(b):mf(a[0],b)&&d.push(a);return d}function mf(a,b){for(var c=b.length,d=new Int32Array(2*c),e,f;c--;)e=b[c],f=c<<1,d[f]=e.x,d[f+1]=e.y;return Hb(a.x,a.y,d,0,!0)!=Gb.NONE}\nfunction kf(a,b,c,d,e){for(var f=0,g=a.length;f<g;f++)e.push(jf(a[f],b,c,d))}function jf(a,b,c,d){var e,f=a.length,g=new Int32Array(2*f),h=0;for(e=0;e<f;e++){var k=a[e];g[h++]=k.x-b>>d;g[h++]=k.y-c>>d}return g}\nl.hb=function(a,b){var c=b.Qb,d=b.eb,e=b.Ab,f=b.Gb;b=b.fb;for(var g=[],h,k={Rows:g},m,q=a?a.length:0,n=0,u,C=c.Rows,y=C.length,v;n<y;n+=1)if(d[n]||!this.i){h={};u=C[n];if(q)for(m=0;m<q;m++)u.hasOwnProperty(a[m])&&(h[a[m]]=u[a[m]]);else for(v in u)\"$$projected$$\"!==v&&(h[v]=u[v]);u.geometry&&(h.geometry=u.geometry);m=void 0;var I,la=h,oa=d[n],P=e[n],Xa=b[n],Fa=f[n],Ga=g;if(oa){var Ya=oa.length;if(Xa)for(I=P;I--;){if(I){var w={};for(m in la)w[m]=la[m]}else w=la;u=[oa[I]];var N=ib(Ya,Fa)-P;for(h=0;h<\nN;h++)Xa[h]===I&&u.push(oa[P+h]);N=u.length;if(!I)for(h=Fa;h<Ya;h++)u.push(oa[h]);w.$HProjGeometry={paths:u,interiorsIndex:1,outlinesIndex:N};Ga.push(w)}else la.$HProjGeometry={paths:oa,interiorsIndex:P,outlinesIndex:Fa},Ga.push(la)}else Ga.push(la)}c.Meta&&(k.Meta=c.Meta);return k};l.ga=function(){var a,b=this.b;for(a in b)b.hasOwnProperty(a)&&(b[a].reject(\"disposed\"),delete b[a])};\nfunction $e(a){for(var b=[],c,d=a.length,e=0;e<d;e++){c=sa(a[e]);if(c.rowFilter&&(c.rowFilter=eval(\"(\"+c.rowFilter+\")\"),!r(c.rowFilter)))throw Error(\"Invalid row filter for layer \"+c.layerId);b.push(c)}return b};t(\"H.service.extension.worker.processor\",function(a,b,c){function d(a){e.postMessage(a)}var e=this,f=nf[a];var g=function(a){e.postError(a.toString())};if(0===b)f||(nf[a]=new Ye(c,of)),this.postMessage();else if(f)switch(b){case 1:try{f.Mb.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 2:try{f.Lb.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 3:f.O();delete nf[a];ra(nf)&&of.T();break;default:e.postError(\"Unsupported command\")}else e.postError(\"TileProvider is not initialized\")});\nvar of=new D(26214400),nf=Object.create(Aa,void 0);function pf(a,b,c){var d=a[b];a=a[b+1];this.Pa=[];this.Ia=0;this.b=b;this.a=[a-c,d-c,a+c,d+c]}pf.prototype.ea=function(a,b){var c=a[b];a=a[b+1];b=this.a;return b[1]<=c&&c<=b[3]&&b[0]<=a&&a<=b[2]};pf.prototype.H=function(){return this.b};var qf=new G(0,0);function rf(a,b,c,d,e){d[e]=b;d[e+1]=a}var sf=new Y;function tf(a,b,c,d,e){sf.xa(a,b,qf);d[e]=qf.x;d[e+1]=qf.y}\nt(\"H.clustering.dynamicgrid.worker\",function(a,b,c,d,e){var f=e?rf:tf,g=0;e=!!self.ArrayBuffer;var h=a.byteLength?new Float64Array(a):a,k=h.length/3;a=[];var m=[],q=[],n=e?new Float64Array(2*k):[];k=0;var u=0;for(sf.ba(d);g<h.length;){var C=h[g++];var y=h[g++];var v=h[g++];f(v,y,d,n,u);for(v=a.length;v--;)if(y=a[v],y.ea(n,u)){var I=y;break}I||(I=new pf(n,u,b),a.push(I));v=u/2;I.Ia+=C||1;I.Pa.push(v);I=null;u+=2}for(v=a.length;v--;)y=a[v],b=y.Ia>=c,f=y.Pa,d=f.length,b?(m.push(d),m=m.concat(f)):\n(k+=d,q=q.concat(f));c=[k].concat(q).concat(m);c=e?(new Uint32Array(c)).buffer:c;this.postMessage(c,[c])});self.addEventListener(\"message\",function(a){a=new De(a.data);var b=ze[a.b];if(b)try{b.apply(a,a.c)}catch(c){a.postError(c.message)}else a.postError(\"processor_not_found\")});(function(){var a=new De;var b=function(b,d){Ce.apply(a,[b,d,!0])};b(\"0\",Ae);b(\"1\",Ce);b(\"2\",Be);b(\"3\",Ie)})();\n";
!function(){var e=function(){if(("undefined"==typeof self||!("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope))&&("undefined"!=typeof module&&module.exports||"undefined"!=typeof window))var ap=e.toString(),lp="",up="undefined"!=typeof document&&document.currentScript instanceof HTMLScriptElement?document.currentScript.src:"";!function(){"use strict";function n(e){return t.call(e).slice(8,-1)}var t={}.toString,e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e,t){return e(t={exports:{}},t.exports),t.exports}function r(e){return e&&e.Math==Math&&e}function o(e){try{return!!e()}catch(e){return!0}}function s(e){return"object"==typeof e?null!==e:"function"==typeof e}function a(e){return y?g.createElement(e):{}}function f(e){if(!s(e))throw TypeError(String(e)+" is not an object");return e}function l(e,t){if(!s(e))return e;var i,r;if(t&&"function"==typeof(i=e.toString)&&!s(r=i.call(e)))return r;if("function"==typeof(i=e.valueOf)&&!s(r=i.call(e)))return r;if(!t&&"function"==typeof(i=e.toString)&&!s(r=i.call(e)))return r;throw TypeError("Can't convert object to primitive value")}function m(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function c(t,i){try{A(p,t,i)}catch(e){p[t]=i}return i}function u(e){return"Symbol(".concat(void 0===e?"":e,")_",(++k+E).toString(36))}function h(e){return R[e]||(R[e]=M&&S[e]||(M?S:u)("Symbol."+e))}function d(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),z))?i:P?n(t):"Object"==(r=n(t))&&"function"==typeof t.callee?"Arguments":r}var _="object",p=r(typeof globalThis==_&&globalThis)||r(typeof window==_&&window)||r(typeof self==_&&self)||r(typeof e==_&&e)||Function("return this")(),v=!o(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),g=p.document,y=s(g)&&s(g.createElement),x=!v&&!o(function(){return 7!=Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}),b=Object.defineProperty,w={f:v?b:function(e,t,i){if(f(e),t=l(t,!0),f(i),x)try{return b(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(e[t]=i.value),e}},A=v?function(e,t,i){return w.f(e,t,m(1,i))}:function(e,t,i){return e[t]=i,e},T=i(function(e){var t="__core-js_shared__",i=p[t]||c(t,{});(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.1.0",mode:"global",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})}),k=0,E=Math.random(),M=!o(function(){return!String(Symbol())}),R=T("wks"),S=p.Symbol,z=h("toStringTag"),P="Arguments"==n(function(){return arguments}()),N={};N[h("toStringTag")]="z";function O(e,t){return U.call(e,t)}function L(e){return V[e]||(V[e]=u(e))}var I,C,F,D="[object z]"!==String(N)?function(){return"[object "+d(this)+"]"}:N.toString,U={}.hasOwnProperty,j=T("native-function-to-string",Function.toString),G=p.WeakMap,B="function"==typeof G&&/native code/.test(j.call(G)),V=T("keys"),q={},Y=p.WeakMap;if(B){var X=new Y,W=X.get,Z=X.has,J=X.set;I=function(e,t){return J.call(X,e,t),t},C=function(e){return W.call(X,e)||{}},F=function(e){return Z.call(X,e)}}else{var K=L("state");q[K]=!0,I=function(e,t){return A(e,K,t),t},C=function(e){return O(e,K)?e[K]:{}},F=function(e){return O(e,K)}}var $={set:I,get:C,has:F,enforce:function(e){return F(e)?C(e):I(e,{})},getterFor:function(i){return function(e){var t;if(!s(e)||(t=C(e)).type!==i)throw TypeError("Incompatible receiver, "+i+" required");return t}}},Q=i(function(e){var t=$.get,a=$.enforce,l=String(j).split("toString");T("inspectSource",function(e){return j.call(e)}),(e.exports=function(e,t,i,r){var n=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,s=!!r&&!!r.noTargetGet;"function"==typeof i&&("string"!=typeof t||O(i,"name")||A(i,"name",t),a(i).source=l.join("string"==typeof t?t:"")),e!==p?(n?!s&&e[t]&&(o=!0):delete e[t],o?e[t]=i:A(e,t,i)):o?e[t]=i:c(t,i)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||j.call(this)})}),ee=Object.prototype;D!==ee.toString&&Q(ee,"toString",D,{unsafe:!0});function te(e){return isNaN(e=+e)?0:(0<e?_e:de)(e)}function ie(e){if(null==e)throw TypeError("Can't call method on "+e);return e}function re(e){return ye(ie(e))}function ne(e){return 0<e?we(te(e),9007199254740991):0}function oe(e,t){var i,r=re(e),n=0,o=[];for(i in r)!O(q,i)&&O(r,i)&&o.push(i);for(;t.length>n;)O(r,i=t[n++])&&(~ke(o,i)||o.push(i));return o}function se(e,t){for(var i=Pe(t),r=w.f,n=be.f,o=0;o<i.length;o++){var s=i[o];O(e,s)||r(e,s,n(t,s))}}function ae(e,t){var i=Le[Oe(e)];return i==Ce||i!=Ie&&("function"==typeof t?o(t):!!t)}function le(e,t){var i,r,n,o,s,a=e.target,l=e.global,u=e.stat;if(i=l?p:u?p[a]||c(a,{}):(p[a]||{}).prototype)for(r in t){if(o=t[r],n=e.noTargetGet?(s=De(i,r))&&s.value:i[r],!Fe(l?r:a+(u?".":"#")+r,e.forced)&&void 0!==n){if(typeof o==typeof n)continue;se(o,n)}(e.sham||n&&n.sham)&&A(o,"sham",!0),Q(i,r,o,e)}}var ue,ce,he,fe,de=Math.ceil,_e=Math.floor,pe={}.propertyIsEnumerable,ve=Object.getOwnPropertyDescriptor,me={f:ve&&!pe.call({1:2},1)?function(e){var t=ve(this,e);return!!t&&t.enumerable}:pe},ge="".split,ye=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==n(e)?ge.call(e,""):Object(e)}:Object,xe=Object.getOwnPropertyDescriptor,be={f:v?xe:function(e,t){if(e=re(e),t=l(t,!0),x)try{return xe(e,t)}catch(e){}if(O(e,t))return m(!me.f.call(e,t),e[t])}},we=Math.min,Ae=Math.max,Te=Math.min,ke=(ue=!1,function(e,t,i){var r,n=re(e),o=ne(n.length),s=function(e,t){var i=te(e);return i<0?Ae(i+t,0):Te(i,t)}(i,o);if(ue&&t!=t){for(;s<o;)if((r=n[s++])!=r)return!0}else for(;s<o;s++)if((ue||s in n)&&n[s]===t)return ue||s||0;return!ue&&-1}),Ee=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Me=Ee.concat("length","prototype"),Re={f:Object.getOwnPropertyNames||function(e){return oe(e,Me)}},Se={f:Object.getOwnPropertySymbols},ze=p.Reflect,Pe=ze&&ze.ownKeys||function(e){var t=Re.f(f(e)),i=Se.f;return i?t.concat(i(e)):t},Ne=/#|\.prototype\./,Oe=ae.normalize=function(e){return String(e).replace(Ne,".").toLowerCase()},Le=ae.data={},Ie=ae.NATIVE="N",Ce=ae.POLYFILL="P",Fe=ae,De=be.f,Ue=!o(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),je=L("IE_PROTO"),Ge=Object.prototype,Be=Ue?Object.getPrototypeOf:function(e){return e=function(e){return Object(ie(e))}(e),O(e,je)?e[je]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Ge:null},Ve=h("iterator"),qe=!1;[].keys&&("next"in(fe=[].keys())?(he=Be(Be(fe)))!==Object.prototype&&(ce=he):qe=!0),null==ce&&(ce={}),O(ce,Ve)||A(ce,Ve,function(){return this});function He(){}var Ye={IteratorPrototype:ce,BUGGY_SAFARI_ITERATORS:qe},Xe=Object.keys||function(e){return oe(e,Ee)},We=v?Object.defineProperties:function(e,t){f(e);for(var i,r=Xe(t),n=r.length,o=0;o<n;)w.f(e,i=r[o++],t[i]);return e},Ze=p.document,Je=Ze&&Ze.documentElement,Ke=L("IE_PROTO"),$e="prototype",Qe=function(){var e,t=a("iframe"),i=Ee.length,r="script";for(t.style.display="none",Je.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write("<script>document.F=Object</"+r+">"),e.close(),Qe=e.F;i--;)delete Qe[$e][Ee[i]];return Qe()},et=Object.create||function(e,t){var i;return null!==e?(He[$e]=f(e),i=new He,He[$e]=null,i[Ke]=e):i=Qe(),void 0===t?i:We(i,t)};q[Ke]=!0;function tt(e,t,i){e&&!O(e=i?e:e.prototype,st)&&ot(e,st,{configurable:!0,value:t})}function it(){return this}function rt(){return this}function nt(e,t,i,r,n,o,s){function a(e){if(e===n&&p)return p;if(!ft&&e in d)return d[e];switch(e){case"keys":case dt:case _t:return function(){return new i(this,e)}}return function(){return new i(this)}}!function(e,t,i){var r=t+" Iterator";e.prototype=et(lt,{next:m(1,i)}),tt(e,r,!1),at[r]=it}(i,t,r);var l,u,c,h=t+" Iterator",f=!1,d=e.prototype,_=d[ct]||d["@@iterator"]||n&&d[n],p=!ft&&_||a(n),v="Array"==t&&d.entries||_;if(v&&(l=Be(v.call(new e)),ht!==Object.prototype&&l.next&&(Be(l)!==ht&&(ut?ut(l,ht):"function"!=typeof l[ct]&&A(l,ct,rt)),tt(l,h,!0))),n==dt&&_&&_.name!==dt&&(f=!0,p=function(){return _.call(this)}),d[ct]!==p&&A(d,ct,p),at[t]=p,n)if(u={values:a(dt),keys:o?p:a("keys"),entries:a(_t)},s)for(c in u)!ft&&!f&&c in d||Q(d,c,u[c]);else le({target:t,proto:!0,forced:ft||f},u);return u}var ot=w.f,st=h("toStringTag"),at={},lt=Ye.IteratorPrototype,ut=Object.setPrototypeOf||("__proto__"in{}?function(){var i,r=!1,e={};try{(i=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return function(e,t){if(f(e),!s(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e,t),r?i.call(e,t):e.__proto__=t,e}}():void 0),ct=h("iterator"),ht=Ye.IteratorPrototype,ft=Ye.BUGGY_SAFARI_ITERATORS,dt="values",_t="entries",pt="String Iterator",vt=$.set,mt=$.getterFor(pt);nt(String,"String",function(e){vt(this,{type:pt,string:String(e),index:0})},function(){var e,t=mt(this),i=t.string,r=t.index;return r>=i.length?{value:void 0,done:!0}:(e=function(e,t,i){var r,n,o=String(ie(e)),s=te(t),a=o.length;return s<0||a<=s?i?"":void 0:(r=o.charCodeAt(s))<55296||56319<r||s+1===a||(n=o.charCodeAt(s+1))<56320||57343<n?i?o.charAt(s):r:i?o.slice(s,s+2):n-56320+(r-55296<<10)+65536}(i,r,!0),t.index+=e.length,{value:e,done:!1})});var gt={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},yt=h("unscopables"),xt=Array.prototype;null==xt[yt]&&A(xt,yt,et(null));function bt(e){xt[yt][e]=!0}var wt="Array Iterator",At=$.set,Tt=$.getterFor(wt),kt=nt(Array,"Array",function(e,t){At(this,{type:wt,target:re(e),index:0,kind:t})},function(){var e=Tt(this),t=e.target,i=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==i?{value:r,done:!1}:"values"==i?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");at.Arguments=at.Array,bt("keys"),bt("values"),bt("entries");var Et=h("iterator"),Mt=h("toStringTag"),Rt=kt.values;for(var St in gt){var zt=p[St],Pt=zt&&zt.prototype;if(Pt){if(Pt[Et]!==Rt)try{A(Pt,Et,Rt)}catch(e){Pt[Et]=Rt}if(Pt[Mt]||A(Pt,Mt,St),gt[St])for(var Nt in kt)if(Pt[Nt]!==kt[Nt])try{A(Pt,Nt,kt[Nt])}catch(e){Pt[Nt]=kt[Nt]}}}function Ot(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}function Lt(r,n,e){if(Ot(r),void 0===n)return r;switch(e){case 0:return function(){return r.call(n)};case 1:return function(e){return r.call(n,e)};case 2:return function(e,t){return r.call(n,e,t)};case 3:return function(e,t,i){return r.call(n,e,t,i)}}return function(){return r.apply(n,arguments)}}function It(t,e,i,r){try{return r?e(f(i)[0],i[1]):e(i)}catch(e){var n=t.return;throw void 0!==n&&f(n.call(t)),e}}var Ct=h("iterator"),Ft=Array.prototype,Dt=h("iterator"),Ut=i(function(e){var h={};(e.exports=function(e,t,i,r,n){var o,s,a,l,u,c=Lt(t,i,r?2:1);if(n)o=e;else{if("function"!=typeof(s=function(e){if(null!=e)return e[Dt]||e["@@iterator"]||at[d(e)]}(e)))throw TypeError("Target is not iterable");if(function(e){return void 0!==e&&(at.Array===e||Ft[Ct]===e)}(s)){for(a=0,l=ne(e.length);a<l;a++)if((r?c(f(u=e[a])[0],u[1]):c(e[a]))===h)return h;return}o=s.call(e)}for(;!(u=o.next()).done;)if(It(o,c,u.value,r)===h)return h}).BREAK=h}),jt=h("iterator"),Gt=!1;try{var Bt=0;({next:function(){return{done:!!Bt++}},return:function(){Gt=!0}})[jt]=function(){return this}}catch(e){}function Vt(e,t){var i,r=f(e).constructor;return void 0===r||null==(i=f(r)[Kt])?t:Ot(i)}function qt(e){if(oi.hasOwnProperty(e)){var t=oi[e];delete oi[e],t()}}function Ht(e){return function(){qt(e)}}function Yt(e){qt(e.data)}function Xt(e){p.postMessage(e+"",$t.protocol+"//"+$t.host)}var Wt,Zt,Jt,Kt=h("species"),$t=p.location,Qt=p.setImmediate,ei=p.clearImmediate,ti=p.process,ii=p.MessageChannel,ri=p.Dispatch,ni=0,oi={},si="onreadystatechange";Qt&&ei||(Qt=function(e){for(var t=[],i=1;i<arguments.length;)t.push(arguments[i++]);return oi[++ni]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Wt(ni),ni},ei=function(e){delete oi[e]},"process"==n(ti)?Wt=function(e){ti.nextTick(Ht(e))}:ri&&ri.now?Wt=function(e){ri.now(Ht(e))}:ii?(Jt=(Zt=new ii).port2,Zt.port1.onmessage=Yt,Wt=Lt(Jt.postMessage,Jt,1)):!p.addEventListener||"function"!=typeof postMessage||p.importScripts||o(Xt)?Wt=si in a("script")?function(e){Je.appendChild(a("script"))[si]=function(){Je.removeChild(this),qt(e)}}:function(e){setTimeout(Ht(e),0)}:(Wt=Xt,p.addEventListener("message",Yt,!1)));var ai,li,ui,ci,hi,fi,di,_i={set:Qt,clear:ei},pi=p.navigator,vi=pi&&pi.userAgent||"",mi=be.f,gi=_i.set,yi=p.MutationObserver||p.WebKitMutationObserver,xi=p.process,bi=p.Promise,wi="process"==n(xi),Ai=mi(p,"queueMicrotask"),Ti=Ai&&Ai.value;Ti||(ai=function(){var e,t;for(wi&&(e=xi.domain)&&e.exit();li;){t=li.fn,li=li.next;try{t()}catch(e){throw li?ci():ui=void 0,e}}ui=void 0,e&&e.enter()},ci=wi?function(){xi.nextTick(ai)}:yi&&!/(iphone|ipod|ipad).*applewebkit/i.test(vi)?(hi=!0,fi=document.createTextNode(""),new yi(ai).observe(fi,{characterData:!0}),function(){fi.data=hi=!hi}):bi&&bi.resolve?(di=bi.resolve(void 0),function(){di.then(ai)}):function(){gi.call(p,ai)});function ki(e){var i,r;this.promise=new e(function(e,t){if(void 0!==i||void 0!==r)throw TypeError("Bad Promise constructor");i=e,r=t}),this.resolve=Ot(i),this.reject=Ot(r)}function Ei(e,t){if(f(e),s(t)&&t.constructor===e)return t;var i=Gi.f(e);return(0,i.resolve)(t),i.promise}function Mi(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}function Ri(e){return"function"==typeof e?e:void 0}function Si(e,t){return arguments.length<2?Ri(Bi[e])||Ri(p[e]):Bi[e]&&Bi[e][t]||p[e]&&p[e][t]}function zi(e){var t;return!(!s(e)||"function"!=typeof(t=e.then))&&t}function Pi(c,h,i){if(!h.notified){h.notified=!0;var r=h.reactions;ji(function(){for(var l=h.value,u=1==h.state,e=0,t=function(e){var t,i,r,n=u?e.ok:e.fail,o=e.resolve,s=e.reject,a=e.domain;try{n?(u||(2===h.rejection&&fr(c,h),h.rejection=1),!0===n?t=l:(a&&a.enter(),t=n(l),a&&(a.exit(),r=!0)),t===e.promise?s(Ki("Promise-chain cycle")):(i=zi(t))?i.call(t,o,s):o(t)):s(l)}catch(e){a&&!r&&a.exit(),s(e)}};r.length>e;)t(r[e++]);h.reactions=[],h.notified=!1,i&&!h.rejection&&cr(c,h)})}}function Ni(e,t,i){var r,n;sr?((r=$i.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),p.dispatchEvent(r)):r={promise:t,reason:i},(n=p["on"+e])?n(r):e===ar&&function(e,t){var i=p.console;i&&i.error&&(1===arguments.length?i.error(e):i.error(e,t))}("Unhandled promise rejection",i)}function Oi(t,i,r,n){return function(e){t(i,r,e,n)}}function Li(e,t,i,r){t.done||(t.done=!0,r&&(t=r),t.value=i,t.state=2,Pi(e,t,!0))}var Ii,Ci,Fi,Di,Ui,ji=Ti||function(e){var t={fn:e,next:void 0};ui&&(ui.next=t),li||(li=t,ci()),ui=t},Gi={f:function(e){return new ki(e)}},Bi=p,Vi=h("species"),qi="Promise",Hi=_i.set,Yi=h("species"),Xi=$.get,Wi=$.set,Zi=$.getterFor(qi),Ji=p[qi],Ki=p.TypeError,$i=p.document,Qi=p.process,er=p.fetch,tr=Qi&&Qi.versions,ir=tr&&tr.v8||"",rr=Gi.f,nr=rr,or="process"==n(Qi),sr=!!($i&&$i.createEvent&&p.dispatchEvent),ar="unhandledrejection",lr=Fe(qi,function(){function t(){}var e=Ji.resolve(1),i=(e.constructor={})[Yi]=function(e){e(t,t)};return!((or||"function"==typeof PromiseRejectionEvent)&&e.then(t)instanceof i&&0!==ir.indexOf("6.6")&&-1===vi.indexOf("Chrome/66"))}),ur=lr||!function(e,t){if(!t&&!Gt)return!1;var i=!1;try{var r={};r[jt]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch(e){}return i}(function(e){Ji.all(e).catch(function(){})}),cr=function(i,r){Hi.call(p,function(){var e,t=r.value;if(hr(r)&&(e=Mi(function(){or?Qi.emit("unhandledRejection",t,i):Ni(ar,i,t)}),r.rejection=or||hr(r)?2:1,e.error))throw e.value})},hr=function(e){return 1!==e.rejection&&!e.parent},fr=function(e,t){Hi.call(p,function(){or?Qi.emit("rejectionHandled",e):Ni("rejectionhandled",e,t.value)})},dr=function(i,r,e,t){if(!r.done){r.done=!0,t&&(r=t);try{if(i===e)throw Ki("Promise can't be resolved itself");var n=zi(e);n?ji(function(){var t={done:!1};try{n.call(e,Oi(dr,i,t,r),Oi(Li,i,t,r))}catch(e){Li(i,t,e,r)}}):(r.value=e,r.state=1,Pi(i,r,!1))}catch(e){Li(i,{done:!1},e,r)}}};lr&&(Ji=function(e){!function(e,t,i){if(!(e instanceof t))throw TypeError("Incorrect "+(i?i+" ":"")+"invocation")}(this,Ji,qi),Ot(e),Ii.call(this);var t=Xi(this);try{e(Oi(dr,this,t),Oi(Li,this,t))}catch(e){Li(this,t,e)}},(Ii=function(e){Wi(this,{type:qi,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=function(e,t,i){for(var r in t)Q(e,r,t[r],i);return e}(Ji.prototype,{then:function(e,t){var i=Zi(this),r=rr(Vt(this,Ji));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=or?Qi.domain:void 0,i.parent=!0,i.reactions.push(r),0!=i.state&&Pi(this,i,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Ci=function(){var e=new Ii,t=Xi(e);this.promise=e,this.resolve=Oi(dr,e,t),this.reject=Oi(Li,e,t)},Gi.f=rr=function(e){return e===Ji||e===Fi?new Ci(e):nr(e)},"function"==typeof er&&le({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Ei(Ji,er.apply(p,arguments))}})),le({global:!0,wrap:!0,forced:lr},{Promise:Ji}),tt(Ji,qi,!1),Di=Si(qi),Ui=w.f,v&&Di&&!Di[Vi]&&Ui(Di,Vi,{configurable:!0,get:function(){return this}}),Fi=Bi[qi],le({target:qi,stat:!0,forced:lr},{reject:function(e){var t=rr(this);return t.reject.call(void 0,e),t.promise}}),le({target:qi,stat:!0,forced:lr},{resolve:function(e){return Ei(this,e)}}),le({target:qi,stat:!0,forced:ur},{all:function(e){var a=this,t=rr(a),l=t.resolve,u=t.reject,i=Mi(function(){var r=Ot(a.resolve),n=[],o=0,s=1;Ut(e,function(e){var t=o++,i=!1;n.push(void 0),s++,r.call(a,e).then(function(e){i||(i=!0,n[t]=e,--s||l(n))},u)}),--s||l(n)});return i.error&&u(i.value),t.promise},race:function(e){var i=this,r=rr(i),n=r.reject,t=Mi(function(){var t=Ot(i.resolve);Ut(e,function(e){t.call(i,e).then(r.resolve,n)})});return t.error&&n(t.value),r.promise}}),le({target:"Promise",proto:!0,real:!0},{finally:function(t){var i=Vt(this,Si("Promise")),e="function"==typeof t;return this.then(e?function(e){return Ei(i,t()).then(function(){return e})}:t,e?function(e){return Ei(i,t()).then(function(){throw e})}:t)}});var _r;Bi.Promise;if("function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}return t}),Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,i=0;i<t;i++){if(arguments[i]===1/0||arguments[i]===-1/0)return 1/0;e+=arguments[i]*arguments[i]}return Math.sqrt(e)},Math.log2=Math.log2||function(e){return Math.log(e)*Math.LOG2E},"undefined"!=typeof window?("performance"in window==!1&&(window.performance={}),_r=window.performance):"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&("performance"in self==!1&&(self.performance={}),_r=self.performance),_r&&"function"!=typeof _r.now){var pr=+new Date;_r.now=function(){return+new Date-pr}}function vr(e){return(vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gr(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yr(e,t,i){return t&&gr(e.prototype,t),i&&gr(e,i),e}function xr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function br(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ar(e,t)}function wr(e){return(wr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ar(e,t){return(Ar=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Tr(e,t,i){return(Tr=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,i){var r=[null];r.push.apply(r,t);var n=new(Function.bind.apply(e,r));return i&&Ar(n,i.prototype),n}).apply(null,arguments)}function kr(e){var i="function"==typeof Map?new Map:void 0;return(kr=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,t)}function t(){return Tr(e,arguments,wr(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Ar(t,e)})(e)}function Er(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mr(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Er(e):t}function Rr(e,t,i){return(Rr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wr(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(i):n.value}})(e,t,i||e)}function Sr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function zr(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Pr,Nr,Or=!1,Lr=!1;try{window.document!==HTMLDocument&&(Lr=!0)}catch(e){void 0!==self&&(Or=!0,self.window={document:{}},self.document=self.window.document)}var Ir={get is_fake_worker(){return self.is_fake_worker},get is_worker(){return void 0!==Nr?Nr:Or||self.is_fake_worker},set is_worker(e){Nr=e},get is_main(){return void 0!==Pr?Pr:Lr&&!self.is_fake_worker},set is_main(e){Pr=e},is_native_worker:Or},Cr={},Fr=0,Dr={},Ur={},jr={};function Gr(e,t,i){var r=2<arguments.length&&void 0!==i?i:Ur,n=[];if("string"==typeof e&&(e=(n=e.split(".")).pop()),Ir.is_main&&t&&1===n.length&&"self"===n[0])r=t;else for(var o=0;o<n.length;o++){if(!r[n[o]])return[];r=r[n[o]]}return[e,r]}Cr.addTarget=function(e,t){Ir.is_fake_worker?jr[e]=t:Ur[e]=t},Cr.removeTarget=function(e){delete Ur[e],delete jr[e]};var Br=" No object with that name is registered on main thread.",Vr=" Object has no method with that name.",qr="_worker_broker_error_not_set_";function Hr(e){Array.isArray(e)&&e.filter(function(e){return e.parent&&e.property}).forEach(function(e){return delete e.parent[e.property]})}Cr.withTransferables=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(this instanceof Cr.withTransferables))return Tr(Cr.withTransferables,t);this.value=t,this.transferables=function i(r){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];if(!r)return n;if(Array.isArray(r))r.forEach(function(e,t){return i(e,r,t,n)});else if("object"===vr(r))if(r instanceof ArrayBuffer)n.push({object:r,parent:e,property:t});else if(r.buffer instanceof ArrayBuffer)n.push({object:r.buffer,parent:e,property:t});else for(var o in r)i(r[o],r,o,n);return n}(this.value)},Ir.is_main&&(Cr.postMessage=function(e,i){for(var t=arguments.length,r=new Array(2<t?t-2:0),n=2;n<t;n++)r[n-2]=arguments[n];if(Array.isArray(e))return Promise.all(e.map(function(e){return Cr.postMessage.apply(Cr,[e,i].concat(zr(r)))}));var o,s={};"object"===vr(i)&&(i=(s=i).method);var a="main_send";"string"==typeof e?(i=e,r=Array.prototype.slice.call(arguments,1),o=!0,a="worker_send"):e.init&&(o=!0);var l,u=[];if(r&&1===r.length&&r[0]instanceof Cr.withTransferables&&(u=r[0].transferables,r=r[0].value),l={type:a,message_id:++Fr,method:i,message:r},o)return function(r,e){var t=r.type,i=Sr(Gr(r.method,e,"main_send"===t?jr:Ur),2),n=i[0],o=i[1],s="Worker broker could not dispatch message type ".concat(r.method," on target ").concat(r.target,".");if(!o)throw Error(s+Br);var a="function"==typeof o[n]&&o[n];if(!a)throw Error(s+Vr);return new Promise(function(t,i){var e;try{e=a.apply(o,r.message)}catch(e){return void i(e)}e instanceof Promise?e.then(function(e){e instanceof Cr.withTransferables&&(e=e.value[0]),t(e)},function(e){i(e instanceof Error?"".concat(e.message,": ").concat(e.stack):e)}):(e instanceof Cr.withTransferables&&(e=e.value[0]),t(e))})}(l,e&&e.init?e:void 0);var c=new Promise(function(e,t){Dr[Fr]={method:i,message:r,resolve:e,reject:t}});return s.stringify&&(l=JSON.stringify(l)),e.postMessage(l,u.map(function(e){return e.object})),Hr(u),c},Cr.addWorker=function(f){if(!(f instanceof Worker))throw Error("Worker broker could not add non-Worker object",f);f.addEventListener("message",function(e){var t="string"==typeof e.data?JSON.parse(e.data):e.data,i=t.message_id;if("worker_reply"===t.type)Dr[i]&&(t.error?Dr[i].reject(t.error):Dr[i].resolve(t.message),delete Dr[i]);else if("worker_send"===t.type&&null!=i){var r=Sr(Gr(t.method),2),n=r[0],o=r[1],s="Worker broker could not dispatch message type ".concat(t.method," on target ").concat(t.target,".");if(!o)throw Error(s+Br);var a="function"==typeof o[n]&&o[n];if(!a)throw Error(s+Vr);var l,u=qr;try{l=a.apply(o,t.message)}catch(e){u=e}var c,h=[];l&&"function"==typeof l.then?l.then(function(e){e instanceof Cr.withTransferables&&(h=e.transferables,e=e.value[0]),c={type:"main_reply",message_id:i,message:e},f.postMessage(c,h.map(function(e){return e.object})),Hr(h)},function(e){f.postMessage({type:"main_reply",message_id:i,error:e instanceof Error?"".concat(e.message,": ").concat(e.stack):e})}):(l instanceof Cr.withTransferables&&(h=l.transferables,l=l.value[0]),c={type:"main_reply",message_id:i,message:l,error:u instanceof Error?"".concat(u.message,": ").concat(u.stack):u},f.postMessage(c,h.map(function(e){return e.object})),Hr(h))}})},Cr.getMessages=function(){return Dr},Cr.getMessageId=function(){return Fr}),Ir.is_worker&&(Cr.postMessage=function(i){for(var e=arguments.length,r=new Array(1<e?e-1:0),t=1;t<e;t++)r[t-1]=arguments[t];var n={};"object"===vr(i)&&(i=(n=i).method);var o,s=new Promise(function(e,t){Dr[Fr]={method:i,message:r,resolve:e,reject:t}}),a=[];return r&&1===r.length&&r[0]instanceof Cr.withTransferables&&(a=r[0].transferables,r=r[0].value),o={type:"worker_send",message_id:Fr,method:i,message:r},n.stringify&&(o=JSON.stringify(o)),self.postMessage(o,a.map(function(e){return e.object})),Hr(a),Fr++,s},self.addEventListener("message",function(e){var t="string"==typeof e.data?JSON.parse(e.data):e.data,i=t.message_id;if("main_reply"===t.type)Dr[i]&&(t.hasOwnProperty("error")&&t.error!==qr?Dr[i].reject(t.error):Dr[i].resolve(t.message),delete Dr[i]);else if("main_send"===t.type&&null!=i){var r=Sr(Gr(t.method),2),n=r[0],o=r[1],s="Worker broker could not dispatch message type ".concat(t.method," on target ").concat(t.target,".");if(!o)throw Error(s+Br);var a,l,u="function"==typeof o[n]&&o[n];if(!u)throw Error(s+Vr);try{a=u.apply(o,t.message)}catch(e){l=e}var c,h=[];a instanceof Promise?a.then(function(e){e instanceof Cr.withTransferables&&(h=e.transferables,e=e.value[0]),c={type:"worker_reply",message_id:i,message:e},self.postMessage(c,h.map(function(e){return e.object})),Hr(h)},function(e){self.postMessage({type:"worker_reply",message_id:i,error:e instanceof Error?"".concat(e.message,": ").concat(e.stack):e})}):(a instanceof Cr.withTransferables&&(h=a.transferables,a=a.value[0]),c={type:"worker_reply",message_id:i,message:a,error:l instanceof Error?"".concat(l.message,": ").concat(l.stack):l},self.postMessage(c,h.map(function(e){return e.object})),Hr(h))}}));var Yr,Xr={silent:-1,error:0,warn:1,info:2,debug:3,trace:4},Wr={},Zr={};function Jr(e){var t="object"===vr(e)?e.level:e;if(Xr[t]<=Xr[Jr.level]){for(var i=arguments.length,r=new Array(1<i?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];if(Ir.is_native_worker)Cr.postMessage.apply(Cr,[{method:"_logProxy",stringify:!0},e].concat(r));else{if("object"===vr(e)&&!0===e.once){if(Zr[JSON.stringify(r)])return;Zr[JSON.stringify(r)]=!0}var o=function(e){return Wr[e]=Wr[e]||(console[e]?console[e]:console.log).bind(console),Wr[e]}(t);1<r.length?o.apply(void 0,["Tangram [".concat(t,"]: ").concat(r[0])].concat(zr(r.slice(1)))):o("Tangram [".concat(t,"]: ").concat(r[0]))}}}Jr.level="info",Jr.workers=null,Jr.setLevel=function(e){Jr.level=e,Ir.is_main&&Array.isArray(Jr.workers)&&Cr.postMessage(Jr.workers,"_logSetLevelProxy",e)},Ir.is_main&&(Jr.setWorkers=function(e){Jr.workers=e},Jr.reset=function(){Zr={}}),Cr.addTarget("_logProxy",Jr),Cr.addTarget("_logSetLevelProxy",Jr.setLevel);var Kr=Yr={};Yr.default_source_max_zoom=18,Yr.default_view_max_zoom=20,Yr.tile_size=256,Yr.half_circumference_meters=20037508.342789244,Yr.circumference_meters=2*Yr.half_circumference_meters,Yr.min_zoom_meters_per_pixel=Yr.circumference_meters/Yr.tile_size;var $r=[];Yr.metersPerPixel=function(e){return $r[e]=$r[e]||Yr.min_zoom_meters_per_pixel/Math.pow(2,e),$r[e]};var Qr=[];Yr.metersPerTile=function(e){return Qr[e]=Qr[e]||Yr.circumference_meters/Math.pow(2,e),Qr[e]},Yr.tile_scale=4096,Yr.units_per_pixel=Yr.tile_scale/Yr.tile_size,Yr.height_scale=16;var en=[];Yr.unitsPerMeter=function(e){return en[e]=en[e]||Yr.tile_scale/(Yr.tile_size*Yr.metersPerPixel(e)),en[e]},Yr.metersForTile=function(e){return{x:e.x*Yr.circumference_meters/Math.pow(2,e.z)-Yr.half_circumference_meters,y:-(e.y*Yr.circumference_meters/Math.pow(2,e.z)-Yr.half_circumference_meters)}},Yr.tileForMeters=function(e,t){var i=Sr(e,2),r=i[0],n=i[1];return{x:Math.floor((r+Yr.half_circumference_meters)/(Yr.circumference_meters/Math.pow(2,t))),y:Math.floor((-n+Yr.half_circumference_meters)/(Yr.circumference_meters/Math.pow(2,t))),z:t}},Yr.metersToExactTileCoords=function(e,t){var i=Sr(e,2),r=i[0],n=i[1];return{x:Math.pow(2,t-1)*(1+r/Yr.half_circumference_meters),y:Math.pow(2,t-1)*(1-n/Yr.half_circumference_meters),z:t}},Yr.wrapTile=function(e){var t=e.x,i=e.y,r=e.z,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{x:!0,y:!1},o=(1<<r)-1;return n.x&&(t&=o),n.y&&(i&=o),{x:t,y:i,z:r}},Yr.metersToLatLng=function(e){var t=Sr(e,2),i=t[0],r=t[1];return i/=Yr.half_circumference_meters,r/=Yr.half_circumference_meters,r=(2*Math.atan(Math.exp(r*Math.PI))-Math.PI/2)/Math.PI,[i*=180,r*=180]},Yr.latLngToMeters=function(e){var t=Sr(e,2),i=t[0],r=t[1];return r=Math.log(Math.tan(r*Math.PI/360+Math.PI/4))/Math.PI,r*=Yr.half_circumference_meters,r=Math.min(Math.max(r,-Yr.half_circumference_meters),Yr.half_circumference_meters),[i*=Yr.half_circumference_meters/180,r]},Yr.tileSpaceToMeters=function(e,t,i){var r=Sr(e,2),n=r[0],o=r[1],s=Yr.unitsPerMeter(t);return[n/s+i.x,o/s+i.y]},Yr.tileSpaceToLatlng=function(e,t,n){var o=Yr.unitsPerMeter(t);return Yr.transformGeometry(e,function(e){e[0]=e[0]/o+n.x,e[1]=e[1]/o+n.y;var t=Sr(Yr.metersToLatLng(e),2),i=t[0],r=t[1];e[0]=i,e[1]=r}),e},Yr.copyGeometry=function(e){if(null!=e){var t={type:e.type};return"Point"===e.type?t.coordinates=[e.coordinates[0],e.coordinates[1]]:"LineString"===e.type||"MultiPoint"===e.type?t.coordinates=e.coordinates.map(function(e){return[e[0],e[1]]}):"Polygon"===e.type||"MultiLineString"===e.type?t.coordinates=e.coordinates.map(function(e){return e.map(function(e){return[e[0],e[1]]})}):"MultiPolygon"===e.type&&(t.coordinates=e.coordinates.map(function(e){return e.map(function(e){return e.map(function(e){return[e[0],e[1]]})})})),t}},Yr.transformGeometry=function(e,t){null!=e&&("Point"===e.type?t(e.coordinates):"LineString"===e.type||"MultiPoint"===e.type?e.coordinates.forEach(t):"Polygon"===e.type||"MultiLineString"===e.type?e.coordinates.forEach(function(e){return e.forEach(t)}):"MultiPolygon"===e.type&&e.coordinates.forEach(function(e){e.forEach(function(e){return e.forEach(t)})}))},Yr.boxIntersect=function(e,t){return!(t.sw.x>e.ne.x||t.ne.x<e.sw.x||t.sw.y>e.ne.y||t.ne.y<e.sw.y)},Yr.findBoundingBox=function(e){for(var t=1/0,i=-1/0,r=1/0,n=-1/0,o=e[0].length,s=0;s<o;s++){var a=e[0][s];a[0]<t&&(t=a[0]),a[1]<r&&(r=a[1]),a[0]>i&&(i=a[0]),a[1]>n&&(n=a[1])}return[t,r,i,n]},Yr.geometryType=function(e){return"Polygon"===e||"MultiPolygon"===e?"polygon":"LineString"===e||"MultiLineString"===e?"line":"Point"===e||"MultiPoint"===e?"point":void 0},Yr.centroid=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(e&&0!==e.length){var i,r=0,n=0,o=0,s=e[0],a=s.length;t&&(i=s[0],s=s.map(function(e){return[e[0]-i[0],e[1]-i[1]]}));for(var l=0,u=a-1;l<a;u=l,l++){var c=s[l],h=s[u],f=c[1]*h[0]-h[1]*c[0];r+=(c[0]+h[0])*f,n+=(c[1]+h[1])*f,o+=3*f}var d=[r/o,n/o];return t&&(d[0]+=i[0],d[1]+=i[1]),d}},Yr.multiCentroid=function(e){for(var t=e.length,i=[0,0],r=0;r<e.length;r++){var n=Yr.centroid(e[r]);i[0]+=n[0],i[1]+=n[1]}return i[0]/=t,i[1]/=t,i},Yr.signedPolygonRingAreaSum=function(e){for(var t=0,i=e.length,r=0;r<i-1;r++){var n=e[r],o=e[r+1];t+=n[0]*o[1]-o[0]*n[1]}return t+=e[i-1][0]*e[0][1]-e[0][0]*e[i-1][1]},Yr.polygonRingArea=function(e){return Math.abs(Yr.signedPolygonRingAreaSum(e))/2},Yr.polygonArea=function(e){if(e)return Yr.polygonRingArea(e[0])},Yr.multiPolygonArea=function(e){for(var t=0,i=0;i<e.length;i++)t+=Yr.polygonArea(e[i]);return t},Yr.ringWinding=function(e){var t=Yr.signedPolygonRingAreaSum(e);return 0<t?"CW":t<0?"CCW":void 0};var tn,rn=function(){function i(e){var t;return mr(this,i),(t=Mr(this,wr(i).call(this))).name="MethodNotImplemented",t.message="Method "+e+" must be implemented in subclass",t}return br(i,kr(Error)),i}();function nn(r,n,o){var s,a;return o=o||0,function(){var e=this,t=arguments;function i(){a=0,r.apply(e,t)}clearTimeout(s),a&&o&&Date.now()-a>=o?i():(a||(a=Date.now()),s=setTimeout(function(){i()},n))}}var on=tn={};Cr.addTarget("Utils",tn),tn.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},tn.isMicrosoft=function(){return/(Trident\/7.0|Edge[ /](\d+[\.\d]+))/i.test(navigator.userAgent)},tn._requests={},tn._proxy_requests={},tn.io=function(i){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6e4,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"text",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"GET",e=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},t=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,s=6<arguments.length&&void 0!==arguments[6]&&arguments[6];if(Ir.is_worker&&tn.isMicrosoft())return Jr("debug","Proxying request for URL to worker",i),t&&(tn._proxy_requests[t]=!0),Cr.postMessage("Utils.io",i,r,n,o,e,t,!0);var a=new XMLHttpRequest,l=new Promise(function(e,t){a.open(o,i,!0),a.timeout=r,a.responseType=n,a.onload=function(){200===a.status?-1<["text","json"].indexOf(a.responseType)?e(a.responseText):e(a.response):t(Error("Request error with a status of "+a.statusText))},a.onerror=function(e){t(Error("There was a network error"+e.toString()))},a.ontimeout=function(e){t(Error("timeout "+e.toString()))},a.send()});return l=l.then(function(e){return t&&delete tn._requests[t],s?Cr.withTransferables(e):e}),t&&(tn._requests[t]=a),l},tn.cancelRequest=function(e){if(Ir.is_worker&&tn._proxy_requests[e])return Cr.postMessage("Utils.cancelRequest",e);tn._requests[e]?(Jr("trace","Cancelling network request key '".concat(e,"'")),tn._requests[e].abort(),delete tn._requests[e]):Jr("trace","Could not find network request key '".concat(e,"'"))},tn.requestAnimationFramePolyfill=function(){"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)})},tn.serializeWithFunctions=function(e){return"function"==typeof e?e.toString():JSON.stringify(e,function(e,t){return"function"==typeof t?t.toString():t})},tn.stringsToFunctions=function(e,t){if("string"==typeof e)e=tn.stringToFunction(e,t);else if(null!=e&&"object"===vr(e))for(var i in e)e[i]=tn.stringsToFunctions(e[i],t);return e},tn._use_count=0,tn._function_cache={};var sn,an,ln=nn(function(){Jr("trace","Cleared cached ".concat(Object.keys(tn._function_cache).length," functions (reused ").concat(tn._use_count," times)")),tn._use_count=0,tn._function_cache={}},1e4),un=/^\s*function[^(]*\(([^)]*)\)\s*?\{([\s\S]*)\}$/m;function cn(e){if("string"!=typeof e||-1!==e.search(/^(data|blob):/))return"";var t=e.indexOf("?");-1<t&&(e=e.substr(0,t));var i=e.indexOf("#");return-1<i&&(e=e.substr(0,i)),e.substr(0,e.lastIndexOf("/")+1)||""}function hn(e){if("string"==typeof e)return!(-1<e.search(/^(http|https|data|blob):/)||"//"===e.substr(0,2))}function fn(e){return void 0===sn&&"function"!=typeof(sn=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL)&&(sn=null,Jr("warn","window.URL.createObjectURL (or vendor prefix) not found, unable to create local blob URLs")),sn?sn(e):e}function dn(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}tn.stringToFunction=function(t,e){var i=t;e&&(i+=e.toString());var r=tn._function_cache[i];if(ln(),r)return tn._use_count++,r;var n="string"==typeof t&&t.match(un);if(n&&2<n.length)try{var o=n[2],s=0<n[1].length&&n[1].split(",").map(function(e){return e.trim()}).filter(function(e){return e});s=0<s.length?s:["context"];var a=new Function(s.toString(),"function"==typeof e?e(o):o);return tn._function_cache[i]=a}catch(e){return t}return t},tn.device_pixel_ratio=1,tn.isPowerOf2=function(e){return 0==(e&e-1)},tn.interpolate=function(e,t,i){if(!Array.isArray(t)||!Array.isArray(t[0]))return t;if(t.length<1)return t;var r,n,o,s,a;if(e<=t[0][0])s=t[0][1],"function"==typeof i&&(s=i(s));else if(e>=t[t.length-1][0])s=t[t.length-1][1],"function"==typeof i&&(s=i(s));else for(var l=0;l<t.length-1;l++)if(e>=t[l][0]&&e<t[l+1][0]){if(r=t[l][0],n=t[l+1][0],Array.isArray(t[l][1])){s=[];for(var u=0;u<t[l][1].length;u++)"function"==typeof i?(a=i(t[l][1][u]),o=i(t[l+1][1][u])-a,s[u]=o*(e-r)/(n-r)+a):(o=t[l+1][1][u]-t[l][1][u],s[u]=o*(e-r)/(n-r)+t[l][1][u])}else s="function"==typeof i?(a=i(t[l][1]),(o=i(t[l+1][1])-a)*(e-r)/(n-r)+a):(o=t[l+1][1]-t[l][1])*(e-r)/(n-r)+t[l][1];break}return s},tn.toCSSColor=function(e){return 1===e[3]?"rgb(".concat(e.slice(0,3).map(function(e){return Math.round(255*e)}).join(", "),")"):"rgba(".concat(e.map(function(e,t){return t<3&&Math.round(255*e)||e}).join(", "),")")},tn.pointInTile=function(e){return 0<=e[0]&&e[1]>-Kr.tile_scale&&e[0]<Kr.tile_scale&&e[1]<=0},tn.zoomToTileLevel=function(e){return Math.floor(e)};var _n=function(){function r(e,t){var i=this;mr(this,r),this.config=e,this.sources=t,this.id=e.id,this.name=e.name,this.pad_scale=e.pad_scale||1e-4,this.default_winding=null,this.rasters=[],Array.isArray(e.rasters)&&e.rasters.forEach(function(e){-1===i.rasters.indexOf(e)&&i.rasters.push(e)}),this.preprocess=e.preprocess,"function"==typeof this.preprocess&&this.preprocess.bind(this),this.transform=e.transform,"function"==typeof this.transform&&this.transform.bind(this),this.extra_data=e.extra_data,this.scripts=e.scripts,this.max_zoom=null!=e.max_zoom?e.max_zoom:Kr.default_source_max_zoom,this.setTileSize(e.tile_size),this.max_coord_zoom=this.max_zoom+this.zoom_bias,this.min_display_zoom=null!=e.min_display_zoom?e.min_display_zoom:0,this.max_display_zoom=null!=e.max_display_zoom?e.max_display_zoom:null,this._has_volatile_data=!!e.has_volatile_data}return yr(r,[{key:"load",value:function(e){var r=this;e.source_data={},e.source_data.layers={},e.pad_scale=this.pad_scale,e.rasters=zr(this.rasters);return this._load(e,function(e){for(var t in e.source_data.layers){var i=e.source_data.layers[t];i&&i.features&&i.features.forEach(function(e){Kr.transformGeometry(e.geometry,function(e){e[1]=-e[1],r.pad_scale&&(e[0]=Math.round(e[0]*(1+r.pad_scale)-Kr.tile_scale*r.pad_scale/2),e[1]=Math.round(e[1]*(1+r.pad_scale)-Kr.tile_scale*r.pad_scale/2))}),r.updateDefaultWinding(e.geometry)})}return e.default_winding=r.default_winding||"CCW",e})}},{key:"_load",value:function(e,t){throw new rn("_load")}},{key:"setTileSize",value:function(e){this.tile_size=e||256,("number"!=typeof this.tile_size||this.tile_size<256||!on.isPowerOf2(this.tile_size))&&(Jr({level:"warn",once:!0},"Data source '".concat(this.name,"': 'tile_size' parameter must be a number that is a power of 2 greater than or equal to 256, but was '").concat(e,"'")),this.tile_size=256),this.zoom_bias=Math.log2(this.tile_size)-8}},{key:"updateDefaultWinding",value:function(e){return null==this.default_winding&&("Polygon"===e.type?this.default_winding=Kr.ringWinding(e.coordinates[0]):"MultiPolygon"===e.type&&(this.default_winding=Kr.ringWinding(e.coordinates[0][0]))),this.default_winding}},{key:"includesTile",value:function(e,t){if(e.z<this.min_display_zoom||null!=this.max_display_zoom&&t>this.max_display_zoom)return!1;for(var i=0;i<this.rasters.length;i++){var r=this.rasters[i];if(this.sources[r]&&this.sources[r]!==this&&!this.sources[r].includesTile(e,e.z))return!1}return!0}},{key:"has_volatile_data",get:function(){return this._has_volatile_data},set:function(e){var t=0<arguments.length&&void 0!==e&&e;this._has_volatile_data=t}}],[{key:"create",value:function(e,t){for(var i in t)if(!r.changed(t[i],{config:e}))return t[i];if(r.types[e.type])return new r.types[e.type](e,t)}},{key:"changed",value:function(e,t){if(!e||!t)return!0;var i=Object.assign({},e.config,{id:null}),r=Object.assign({},t.config,{id:null});return JSON.stringify(i)!==JSON.stringify(r)}},{key:"projectData",value:function(e){for(var t in e.layers)for(var i=e.layers[t].features.length,r=0;r<i;r++){var n=e.layers[t].features[r];Kr.transformGeometry(n.geometry,function(e){var t=Sr(Kr.latLngToMeters(e),2),i=t[0],r=t[1];e[0]=i,e[1]=r})}}},{key:"scaleData",value:function(e,t){var i=t.coords.z,r=t.min,n=(t.max,Kr.unitsPerMeter(i));for(var o in e.layers)for(var s=e.layers[o].features.length,a=0;a<s;a++){var l=e.layers[o].features[a];Kr.transformGeometry(l.geometry,function(e){e[0]=(e[0]-r.x)*n,e[1]=(e[1]-r.y)*n*-1})}}},{key:"register",value:function(e,t){e&&t&&(r.types[t]=e)}}]),r}();_n.types={};var pn=0,vn=function(){function s(n,e){var o;mr(this,s),(o=Mr(this,wr(s).call(this,n,e))).response_type="";var t=Sr(function(e,t){if(!t||0===Object.keys(t).length)return[e,[]];var i=e.indexOf("?"),r=e.indexOf("#"),n="";-1<r&&(n=e.slice(r),e=e.slice(0,r)),-1===i&&(i=e.length,e+="?"),i++;var o="",s=[];for(var a in t)""===dn(a,e)?o+="".concat(a,"=").concat(t[a],"&"):s.push([a,t[a]]);return[e=e.slice(0,i)+o+e.slice(i)+n,s]}(n.url,n.url_params),2),i=t[0],r=t[1];if(o.url=i,r.forEach(function(e){var t=Sr(e,2),i=t[0],r=t[1];Jr({level:"warn",once:!0},"Data source '".concat(o.name,"': parameter '").concat(i,"' already present in URL '").concat(n.url,"', ")+"skipping value '".concat(i,"=").concat(r,"' specified in 'url_params'"))}),"string"!=typeof o.url)throw Error("Network data source must provide a string `url` property");return o}return br(s,_n),yr(s,[{key:"_load",value:function(n,o){var s=this,a=this.formatUrl(this.url,n),l=n.source_data;return l.url=a,new Promise(function(t,e){l.error=null;var i=pn+++"-"+a,r=on.io(a,6e4,s.response_type,"GET",{},i);l.request_id=i,r.then(function(e){"function"==typeof s.preprocess&&(e=s.preprocess(e)),(e=e instanceof Promise?e:Promise.resolve(e)).then(function(e){s.parseSourceData(n,l,e),o(n),t(n)})},function(e){l.error=e.stack,o(n),t(n)})})}},{key:"formatUrl",value:function(e,t){throw new rn("formatUrl")}},{key:"parseSourceData",value:function(e,t,i){throw new rn("parseSourceData")}}]),s}(),mn=function(){function r(e,t){var i;return mr(this,r),(i=Mr(this,wr(r).call(this,e,t))).tiled=!0,i.parseBounds(e),i.builds_geometry_tiles=!1,i.tms=!0===e.tms,-1<i.url.search("{s}")&&(Array.isArray(e.url_subdomains)&&0<e.url_subdomains.length?(i.url_subdomains=e.url_subdomains,i.next_url_subdomain=0):Jr({level:"warn",once:!0},"Data source '".concat(i.name,"': source URL includes '{s}' subdomain marker ('").concat(i.url,"'), but no subdomains ")+"were specified in 'url_subdomains' parameter")),i}return br(r,vn),yr(r,[{key:"parseBounds",value:function(e){if(Array.isArray(e.bounds)&&4===e.bounds.length){this.bounds=e.bounds;var t=Sr(this.bounds,4),i=t[0],r=t[1],n=t[2],o=t[3];this.bounds_meters={min:Kr.latLngToMeters([i,o]),max:Kr.latLngToMeters([n,r])},this.bounds_tiles={min:{},max:{}}}}},{key:"checkBounds",value:function(e){if(this.bounds){e=Kr.wrapTile(e,{x:!0});var t=this.bounds_tiles.min[e.z];t||(t=this.bounds_tiles.min[e.z]=Kr.tileForMeters(this.bounds_meters.min,e.z));var i=this.bounds_tiles.max[e.z];if(i||(i=this.bounds_tiles.max[e.z]=Kr.tileForMeters(this.bounds_meters.max,e.z)),e.x<t.x||e.x>i.x||e.y<t.y||e.y>i.y)return!1}return!0}},{key:"includesTile",value:function(e,t){return!!Rr(wr(r.prototype),"includesTile",this).call(this,e,t)&&!!this.checkBounds(e)}},{key:"formatUrl",value:function(e,t){var i=Kr.wrapTile(t.coords,{x:!0});this.tms&&(i.y=Math.pow(2,i.z)-1-i.y);var r=e.replace("{x}",i.x).replace("{y}",i.y).replace("{z}",i.z);return null!=this.url_subdomains&&(r=r.replace("{s}",this.url_subdomains[this.next_url_subdomain]),this.next_url_subdomain=(this.next_url_subdomain+1)%this.url_subdomains.length),r}},{key:"urlHasTilePattern",value:function(e){return e&&-1<e.search("{x}")&&-1<e.search("{y}")&&-1<e.search("{z}")}}]),r}(),gn=yn;function yn(e,t){this.x=e,this.y=t}yn.prototype={clone:function(){return new yn(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,i=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=t*this.x-i*this.y,n=i*this.x+t*this.y;return this.x=r,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.x+i*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yn.convert=function(e){return e instanceof yn?e:Array.isArray(e)?new yn(e[0],e[1]):e};var xn=bn;function bn(e,t,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=n,e.readFields(wn,this,t)}function wn(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){var i=e.readVarint()+e.pos;for(;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function An(e){for(var t,i,r=0,n=0,o=e.length,s=o-1;n<o;s=n++)t=e[n],r+=((i=e[s]).x-t.x)*(t.y+i.y);return r}bn.types=["Unknown","Point","LineString","Polygon"],bn.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,r=1,n=0,o=0,s=0,a=[];e.pos<i;){if(!n){var l=e.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)o+=e.readSVarint(),s+=e.readSVarint(),1===r&&(t&&a.push(t),t=[]),t.push(new gn(o,s));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&a.push(t),a},bn.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,u=-1/0;e.pos<t;){if(!r){var c=e.readVarint();i=7&c,r=c>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<s&&(s=n),a<n&&(a=n),(o+=e.readSVarint())<l&&(l=o),u<o&&(u=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,u]},bn.prototype.toGeoJSON=function(e,t,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),u=bn.types[this.type];function c(e){for(var t=0;t<e.length;t++){var i=e[t],r=180-360*(i.y+a)/o;e[t]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];c(l=h);break;case 2:for(r=0;r<l.length;r++)c(l[r]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,r,n=[],o=0;o<t;o++){var s=An(e[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[e[o]]):i.push(e[o]))}i&&n.push(i);return n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)c(l[r][n])}1===l.length?l=l[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(f.id=this.id),f};var Tn=kn;function kn(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(En,this,t),this.length=this._features.length}function En(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){var t=null,i=e.readVarint()+e.pos;for(;e.pos<i;){var r=e.readVarint()>>3;t=1==r?e.readString():2==r?e.readFloat():3==r?e.readDouble():4==r?e.readVarint64():5==r?e.readVarint():6==r?e.readSVarint():7==r?e.readBoolean():null}return t}(i))}function Mn(e,t,i){if(3===e){var r=new Tn(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}kn.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new xn(this._pbf,t,this.extent,this._keys,this._values)};var Rn=function(e,t){this.layers=e.readFields(Mn,{},t)},Sn=xn;Sn.prototype.loadGeometry=function(e){var t=this._pbf;t.pos=this._geometry;for(var i,r=t.readVarint()+t.pos,n=1,o=0,s=0,a=0,l=[];t.pos<r;){if(o<=0){var u=t.readVarint();n=7&u,o=u>>3}if(o--,1===n||2===n)s+=t.readSVarint(),a+=t.readSVarint(),1===n&&(i&&l.push(i),i=[]),i.push([s*e,a*e]);else{if(7!==n)throw new Error("unknown command "+n);i&&i.push(i[0].slice())}}return i&&l.push(i),l};var zn={UNKNOWN:0,POINT:1,LINESTRING:2,POLYGON:3};function Pn(e){var t=[],i=e&&e.features;if(i)for(var r=0,n=i.length;r<n;r++){var o=i[r],s=o.type,a=void 0;switch(s){case zn.POINT:a={type:"MultiPoint",coordinates:o.geometry.map(function(e){return e.slice()})};break;case zn.LINESTRING:case zn.POLYGON:if(a={type:"MultiLineString",coordinates:o.geometry.map(function(e){return e.map(function(e){return e.slice()})})},s===zn.POLYGON&&null==(a=Nn(a)))continue;break;default:continue}t.push({id:o.id,type:"Feature",geometry:a,properties:o.tags})}return{type:"FeatureCollection",features:t}}function Nn(e){for(var t,i=[],r=[],n=0,o=e.coordinates.length;n<o;n++){var s=e.coordinates[n],a=Kr.ringWinding(s);null!=a&&(a===(t=t||a)&&r.length&&(i.push(r),r=[]),r.push(s))}return 0<r.length&&i.push(r),1===i.length?(e.type="Polygon",e.coordinates=i[0]):1<i.length?(e.type="MultiPolygon",e.coordinates=i):e=null,e}function On(e,t,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var l=((e-i)*s+(t-r)*a)/(s*s+a*a);1<l?(i=n,r=o):0<l&&(i+=s*l,r+=a*l)}return(s=e-i)*s+(a=t-r)*a}function Ln(e,t,i,r){var n={id:void 0===e?null:e,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)In(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<t.length;r++)In(e,t[r]);else if("MultiPolygon"===i)for(r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)In(e,t[r][n])}(n),n}function In(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function Cn(e,t,i,r){if(t.geometry){var n=t.geometry.coordinates,o=t.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)Fn(n,a);else if("MultiPoint"===o)for(var u=0;u<n.length;u++)Fn(n[u],a);else if("LineString"===o)Dn(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(u=0;u<n.length;u++)a=[],Dn(n[u],a,s,!1),e.push(Ln(l,"LineString",a,t.properties));return}Un(n,a,s,!1)}else if("Polygon"===o)Un(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"!==o)throw new Error("Input data is not a valid GeoJSON object.");for(u=0;u<t.geometry.geometries.length;u++)Cn(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},i,r);return}for(u=0;u<n.length;u++){var c=[];Un(n[u],c,s,!0),a.push(c)}}e.push(Ln(l,o,a,t.properties))}}function Fn(e,t){t.push(jn(e[0])),t.push(Gn(e[1])),t.push(0)}function Dn(e,t,i,r){for(var n,o,s=0,a=0;a<e.length;a++){var l=jn(e[a][0]),u=Gn(e[a][1]);t.push(l),t.push(u),t.push(0),0<a&&(s+=r?(n*u-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(u-o,2))),n=l,o=u}var c=t.length-3;t[2]=1,function e(t,i,r,n){for(var o,s=n,a=r-i>>1,l=r-i,u=t[i],c=t[i+1],h=t[r],f=t[r+1],d=i+3;d<r;d+=3){var _=On(t[d],t[d+1],u,c,h,f);if(s<_)o=d,s=_;else if(_===s){var p=Math.abs(d-a);p<l&&(o=d,l=p)}}n<s&&(3<o-i&&e(t,i,o,n),t[o+2]=s,3<r-o&&e(t,o,r,n))}(t,0,c,i),t[2+c]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function Un(e,t,i,r){for(var n=0;n<e.length;n++){var o=[];Dn(e[n],o,i,r),t.push(o)}}function jn(e){return e/360+.5}function Gn(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:1<i?1:i}function Bn(e,t,i,r,n,o,s,a){if(r/=t,(i/=t)<=o&&s<r)return e;if(s<i||r<=o)return null;for(var l=[],u=0;u<e.length;u++){var c=e[u],h=c.geometry,f=c.type,d=0===n?c.minX:c.minY,_=0===n?c.maxX:c.maxY;if(i<=d&&_<r)l.push(c);else if(!(_<i||r<=d)){var p=[];if("Point"===f||"MultiPoint"===f)Vn(h,p,i,r,n);else if("LineString"===f)qn(h,p,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===f)Yn(h,p,i,r,n,!1);else if("Polygon"===f)Yn(h,p,i,r,n,!0);else if("MultiPolygon"===f)for(var v=0;v<h.length;v++){var m=[];Yn(h[v],m,i,r,n,!0),m.length&&p.push(m)}if(p.length){if(a.lineMetrics&&"LineString"===f){for(v=0;v<p.length;v++)l.push(Ln(c.id,f,p[v],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===p.length?(f="LineString",p=p[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===p.length?"Point":"MultiPoint"),l.push(Ln(c.id,f,p,c.tags))}}}return l.length?l:null}function Vn(e,t,i,r,n){for(var o=0;o<e.length;o+=3){var s=e[o+n];i<=s&&s<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function qn(e,t,i,r,n,o,s){for(var a,l,u=Hn(e),c=0===n?Wn:Zn,h=e.start,f=0;f<e.length-3;f+=3){var d=e[f],_=e[f+1],p=e[f+2],v=e[f+3],m=e[f+4],g=0===n?d:_,y=0===n?v:m,x=!1;s&&(a=Math.sqrt(Math.pow(d-v,2)+Math.pow(_-m,2))),g<i?i<y&&(l=c(u,d,_,v,m,i),s&&(u.start=h+a*l)):r<g?y<r&&(l=c(u,d,_,v,m,r),s&&(u.start=h+a*l)):Xn(u,d,_,p),y<i&&i<=g&&(l=c(u,d,_,v,m,i),x=!0),r<y&&g<=r&&(l=c(u,d,_,v,m,r),x=!0),!o&&x&&(s&&(u.end=h+a*l),t.push(u),u=Hn(e)),s&&(h+=a)}var b=e.length-3;d=e[b],_=e[b+1],p=e[b+2],i<=(g=0===n?d:_)&&g<=r&&Xn(u,d,_,p),b=u.length-3,o&&3<=b&&(u[b]!==u[0]||u[b+1]!==u[1])&&Xn(u,u[0],u[1],u[2]),u.length&&t.push(u)}function Hn(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function Yn(e,t,i,r,n,o){for(var s=0;s<e.length;s++)qn(e[s],t,i,r,n,o,!1)}function Xn(e,t,i,r){e.push(t),e.push(i),e.push(r)}function Wn(e,t,i,r,n,o){var s=(o-t)/(r-t);return e.push(o),e.push(i+(n-i)*s),e.push(1),s}function Zn(e,t,i,r,n,o){var s=(o-i)/(n-i);return e.push(t+(r-t)*s),e.push(o),e.push(1),s}function Jn(e,t){for(var i=[],r=0;r<e.length;r++){var n,o=e[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)n=Kn(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){n=[];for(var a=0;a<o.geometry.length;a++)n.push(Kn(o.geometry[a],t))}else if("MultiPolygon"===s)for(n=[],a=0;a<o.geometry.length;a++){for(var l=[],u=0;u<o.geometry[a].length;u++)l.push(Kn(o.geometry[a][u],t));n.push(l)}i.push(Ln(o.id,s,n,o.tags))}return i}function Kn(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function $n(e,t){if(e.transformed)return e;var i,r,n,o=1<<e.z,s=e.x,a=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(r=0;r<u.length;r+=2)l.geometry.push(Qn(u[r],u[r+1],t,o,s,a));else for(r=0;r<u.length;r++){var h=[];for(n=0;n<u[r].length;n+=2)h.push(Qn(u[r][n],u[r][n+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function Qn(e,t,i,r,n,o){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-o))]}function eo(e,t,i,r,n){for(var o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,to(s,e[a],o,n);var l=e[a].minX,u=e[a].minY,c=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),u<s.minY&&(s.minY=u),c>s.maxX&&(s.maxX=c),h>s.maxY&&(s.maxY=h)}return s}function to(e,t,i,r){var n=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)io(s,n,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)io(s,n[a],e,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var u=n[l];for(a=0;a<u.length;a++)io(s,u[a],e,i,!0,0===a)}if(s.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=n.start/n.size,c.mapbox_clip_end=n.end/n.size}var f={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(f.id=t.id),e.features.push(f)}}function io(e,t,i,r,n,o){var s=r*r;if(0<r&&t.size<(n?s:r))i.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>s)&&(i.numSimplified++,a.push(t[l]),a.push(t[l+1])),i.numPoints++;n&&function(e,t){for(var i=0,r=0,n=e.length,o=n-2;r<n;o=r,r+=2)i+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(0<i===t)for(r=0,n=e.length;r<n/2;r+=2){var s=e[r],a=e[r+1];e[r]=e[n-2-r],e[r+1]=e[n-1-r],e[n-2-r]=s,e[n-1-r]=a}}(a,o),e.push(a)}}function ro(e,t){return new no(e,t)}function no(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||24<t.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)Cn(i,e.features[r],t,r);else"Feature"===e.type?Cn(i,e,t):Cn(i,{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var i=t.buffer/t.extent,r=e,n=Bn(e,1,-1-i,i,0,-1,2,t),o=Bn(e,1,1-i,2+i,0,-1,2,t);return(n||o)&&(r=Bn(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=Jn(n,1).concat(r)),o&&(r=r.concat(Jn(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function oo(e,t,i){return 32*((1<<e)*i+t)+e}no.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},no.prototype.splitTile=function(e,t,i,r,n,o,s){for(var a=[e,t,i,r],l=this.options,u=l.debug;a.length;){r=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();var c=1<<t,h=oo(t,i,r),f=this.tiles[h];if(!f&&(1<u&&console.time("creation"),f=this.tiles[h]=eo(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),u)){1<u&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var d="z"+t;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(f.source=e,n){if(t===l.maxZoom||t===n)continue;var _=1<<n-t;if(i!==Math.floor(o/_)||r!==Math.floor(s/_))continue}else if(t===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==e.length){1<u&&console.time("clipping");var p,v,m,g,y,x,b=.5*l.buffer/l.extent,w=.5-b,A=.5+b,T=1+b;p=v=m=g=null,y=Bn(e,c,i-b,i+A,0,f.minX,f.maxX,l),x=Bn(e,c,i+w,i+T,0,f.minX,f.maxX,l),e=null,y&&(p=Bn(y,c,r-b,r+A,1,f.minY,f.maxY,l),v=Bn(y,c,r+w,r+T,1,f.minY,f.maxY,l),y=null),x&&(m=Bn(x,c,r-b,r+A,1,f.minY,f.maxY,l),g=Bn(x,c,r+w,r+T,1,f.minY,f.maxY,l),x=null),1<u&&console.timeEnd("clipping"),a.push(p||[],t+1,2*i,2*r),a.push(v||[],t+1,2*i,2*r+1),a.push(m||[],t+1,2*i+1,2*r),a.push(g||[],t+1,2*i+1,2*r+1)}}},no.prototype.getTile=function(e,t,i){var r=this.options,n=r.extent,o=r.debug;if(e<0||24<e)return null;var s=1<<e,a=oo(e,t=(t%s+s)%s,i);if(this.tiles[a])return $n(this.tiles[a],n);1<o&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,u=e,c=t,h=i;!l&&0<u;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[oo(u,c,h)];return l&&l.source?(1<o&&console.log("found parent tile z%d-%d-%d",u,c,h),1<o&&console.time("drilling down"),this.splitTile(l.source,u,c,h,e,t,i),1<o&&console.timeEnd("drilling down"),this.tiles[a]?$n(this.tiles[a],n):null):null};var so=function(){function n(e,t){var i;return mr(this,n),(i=Mr(this,wr(n).call(this,e,t))).load_data=null,i.tile_indexes={},i.max_zoom=Math.max(i.max_zoom||0,15),i.setTileSize(512),i.pad_scale=0,i}return br(n,vn),yr(n,[{key:"_load",value:function(t){var r=this;return this.load_data||(this.load_data=Rr(wr(n.prototype),"_load",this).call(this,{source_data:{layers:{}}}).then(function(e){e.source_data.error&&Jr("warn","data source load error(s) for source '".concat(r.name,"', URL '").concat(r.url,"': ").concat(e.source_data.error));var t=e.source_data.layers;for(var i in t)r.tile_indexes[i]=ro(t[i],{maxZoom:r.max_zoom,tolerance:1.5,extent:Kr.tile_scale,buffer:1e-4});return r.loaded=!0,e})),this.load_data.then(function(){for(var e in r.tile_indexes)t.source_data.layers[e]=r.getTileFeatures(t,e);return t})}},{key:"getTileFeatures",value:function(e,t){var i,r=Kr.wrapTile(e.coords,{x:!0}),n=this.tile_indexes[t].getTile(r.z,r.x,r.y);if(n&&n.features){i={type:"FeatureCollection",features:[]};for(var o=0;o<n.features.length;o++){var s=n.features[o],a={type:"Feature",geometry:{},properties:s.tags};if(1===s.type)a.geometry.coordinates=s.geometry.map(function(e){return[e[0],e[1]]}),a.geometry.type="MultiPoint";else{if(2!==s.type&&3!==s.type)continue;if(a.geometry.coordinates=s.geometry.map(function(e){return e.map(function(e){return[e[0],e[1]]})}),2===s.type)a.geometry.type="MultiLineString";else if(a.geometry=Nn(a.geometry),null==a.geometry)continue}i.features.push(a)}}return i}},{key:"formatUrl",value:function(e){return this.url}},{key:"parseSourceData",value:function(e,t,i){var r="string"==typeof i?JSON.parse(i):i,n=this.getLayers(r);t.layers=this.preprocessLayers(n)}},{key:"preprocessLayers",value:function(e){for(var t in e){var i=e[t];i.features=this.preprocessFeatures(i.features)}return"function"==typeof this.transform&&(1===Object.keys(e).length&&e._default?e._default=this.transform(e._default,this.extra_data):e=this.transform(e,this.extra_data)),e}},{key:"preprocessFeatures",value:function(e){if(e=e.filter(function(e){return null!=e.geometry}),this.config.generate_label_centroids){var a=[],l={label_placement:!0};e.forEach(function(e){var t,i;switch(e.geometry.type){case"Polygon":i=lo(t=e.geometry.coordinates,e.properties,l),a.push(i);break;case"MultiPolygon":t=e.geometry.coordinates;for(var r=-1/0,n=0,o=0;o<t.length;o++){var s=Kr.polygonArea(t[o]);r<s&&(r=s,n=o)}i=lo(t[n],e.properties,l),a.push(i)}}),a=a.filter(function(e){return e}),Array.prototype.push.apply(e,a)}return e}},{key:"getLayers",value:function(e){return"Feature"===e.type?{_default:{type:"FeatureCollection",features:[e]}}:"FeatureCollection"===e.type?{_default:e}:e}}]),n}(),ao=function(){function r(e,t){var i;return mr(this,r),(i=Mr(this,wr(r).call(this,e,t))).urlHasTilePattern(i.url)?Mr(i,Er(i)):"GeoJSON"===e.type?Mr(i,new so(e)):Mr(i,null)}return br(r,mn),yr(r,[{key:"parseSourceData",value:function(e,t,i){var r="string"==typeof i?JSON.parse(i):i;this.prepareGeoJSON(r,e,t)}},{key:"prepareGeoJSON",value:function(e,t,i){"function"==typeof this.transform&&(e=this.transform(e,this.extra_data)),i.layers=so.prototype.getLayers(e);var r={coords:t.coords,min:Kr.metersForTile(Kr.wrapTile(t.coords,{x:!0}))};_n.projectData(i),_n.scaleData(i,r)}}]),r}();function lo(e,t,i){var r=Kr.centroid(e);if(r){var n={};return Object.assign(n,t,i),{type:"Feature",properties:n,geometry:{type:"Point",coordinates:r}}}}_n.register(ao,"GeoJSON");var uo=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,u=l>>1,c=-7,h=i?n-1:0,f=i?-1:1,d=e[t+h];for(h+=f,o=d&(1<<-c)-1,d>>=-c,c+=a;0<c;o=256*o+e[t+h],h+=f,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;0<c;s=256*s+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=u}return(d?-1:1)*s*Math.pow(2,o-r)},co=function(e,t,i,r,n,o){var s,a,l,u=8*o-n-1,c=(1<<u)-1,h=c>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,_=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),2<=(t+=1<=s+h?f/l:f*Math.pow(2,1-h))*l&&(s++,l/=2),c<=s+h?(a=0,s=c):1<=s+h?(a=(t*l-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));8<=n;e[i+d]=255&a,d+=_,a/=256,n-=8);for(s=s<<n|a,u+=n;0<u;e[i+d]=255&s,d+=_,s/=256,u-=8);e[i+d-_]|=128*p},ho=fo;function fo(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}fo.Varint=0,fo.Fixed64=1,fo.Bytes=2,fo.Fixed32=5;var _o=4294967296,po=1/_o;function vo(e){return e.type===fo.Bytes?e.readVarint()+e.pos:e.pos+1}function mo(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function go(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;e<=n;n--)i.buf[n+r]=i.buf[n]}function yo(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function xo(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function bo(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function wo(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Ao(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function To(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function ko(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Eo(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Mo(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Ro(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function So(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function zo(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}fo.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,e(n,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Ro(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=zo(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ro(this.buf,this.pos)+Ro(this.buf,this.pos+4)*_o;return this.pos+=8,e},readSFixed64:function(){var e=Ro(this.buf,this.pos)+zo(this.buf,this.pos+4)*_o;return this.pos+=8,e},readFloat:function(){var e=uo(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=uo(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,o=i.buf;if(n=o[i.pos++],r=(112&n)>>4,n<128)return mo(e,r,t);if(n=o[i.pos++],r|=(127&n)<<3,n<128)return mo(e,r,t);if(n=o[i.pos++],r|=(127&n)<<10,n<128)return mo(e,r,t);if(n=o[i.pos++],r|=(127&n)<<17,n<128)return mo(e,r,t);if(n=o[i.pos++],r|=(127&n)<<24,n<128)return mo(e,r,t);if(n=o[i.pos++],r|=(1&n)<<31,n<128)return mo(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,i){var r="",n=t;for(;n<i;){var o,s,a,l=e[n],u=null,c=239<l?4:223<l?3:191<l?2:1;if(i<n+c)break;1===c?l<128&&(u=l):2===c?128==(192&(o=e[n+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(o=e[n+1],s=e[n+2],128==(192&o)&&128==(192&s)&&((u=(15&l)<<12|(63&o)<<6|63&s)<=2047||55296<=u&&u<=57343)&&(u=null)):4===c&&(o=e[n+1],s=e[n+2],a=e[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((u=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||1114112<=u)&&(u=null)),null===u?(u=65533,c=1):65535<u&&(u-=65536,r+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),r+=String.fromCharCode(u),n+=c}return r}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var i=vo(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=vo(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=vo(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=vo(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=vo(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=vo(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=vo(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=vo(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=vo(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===fo.Varint)for(;127<this.buf[this.pos++];);else if(t===fo.Bytes)this.pos=this.readVarint()+this.pos;else if(t===fo.Fixed32)this.pos+=4;else{if(t!==fo.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),So(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),So(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),So(this.buf,-1&e,this.pos),So(this.buf,Math.floor(e*po),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),So(this.buf,-1&e,this.pos),So(this.buf,Math.floor(e*po),this.pos+4),this.pos+=8},writeVarint:function(e){268435455<(e=+e||0)||e<0?function(e,t){var i,r;0<=e?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:r=r+1|(i=0));if(0x10000000000000000<=e||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos]=127&e}(i,0,t),function(e,t){var i=(7&e)<<4;if(t.buf[t.pos++]|=i|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,o=0;o<t.length;o++){if(55295<(r=t.charCodeAt(o))&&r<57344){if(!n){56319<r||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;128<=i&&go(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),co(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),co(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;128<=r&&go(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,fo.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){this.writeMessage(e,yo,t)},writePackedSVarint:function(e,t){this.writeMessage(e,xo,t)},writePackedBoolean:function(e,t){this.writeMessage(e,Ao,t)},writePackedFloat:function(e,t){this.writeMessage(e,bo,t)},writePackedDouble:function(e,t){this.writeMessage(e,wo,t)},writePackedFixed32:function(e,t){this.writeMessage(e,To,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,ko,t)},writePackedFixed64:function(e,t){this.writeMessage(e,Eo,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,Mo,t)},writeBytesField:function(e,t){this.writeTag(e,fo.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,fo.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,fo.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,fo.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,fo.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,fo.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,fo.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,fo.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,fo.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,fo.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Po=function(){function r(e,t){var i;return mr(this,r),(i=Mr(this,wr(r).call(this,e,t))).response_type="arraybuffer",i}return br(r,mn),yr(r,[{key:"parseSourceData",value:function(e,t,i){var r=new Uint8Array(i),n=new ho(r);t.layers=function(e){var t={};for(var i in e.layers){for(var r=e.layers[i],n=[],o=Kr.tile_scale/r.extent,s=0,a=r.length;s<a;s++){var l,u=r.feature(s),c=Sn.types[u.type];l=u.loadGeometry(o);var h=null;switch(c){case"Point":h={type:c,coordinates:l[0][0]};break;case"LineString":h=1===l.length?{type:c,coordinates:l[0]}:{type:"MultiLineString",coordinates:l};break;case"Polygon":h=Nn({coordinates:l})}h&&h.coordinates&&n.push({type:"Feature",geometry:h,properties:u.properties})}t[i]={type:"FeatureCollection",features:n}}return t}(new Rn(n)),"function"==typeof this.transform&&(t.layers=this.transform(t.layers,this.extra_data))}}]),r}();_n.register(Po,"MVT");function No(e){return Math.max(e,0)}function Oo(e){return isNaN(e)?0:e}function Lo(e){return Array.isArray(e)?e.map(parseFloat).map(Oo):Oo(parseFloat(e))}function Io(e){return Array.isArray(e)?e.map(Lo).map(No):No(Lo(e))}var Co=i(function(e,t){var d={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function _(e){return(e=Math.round(e))<0?0:255<e?255:e}function i(e){return e<0?0:1<e?1:e}function p(e){return"%"===e[e.length-1]?_(parseFloat(e)/100*255):_(parseInt(e))}function v(e){return"%"===e[e.length-1]?i(parseFloat(e)/100):i(parseFloat(e))}function m(e,t,i){return i<0?i+=1:1<i&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in d)return d[i].slice();if("#"===i[0])return 4===i.length?0<=(t=parseInt(i.substr(1),16))&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===i.length&&0<=(t=parseInt(i.substr(1),16))&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var r=i.indexOf("("),n=i.indexOf(")");if(-1!==r&&n+1===i.length){var o=i.substr(0,r),s=i.substr(r+1,n-(r+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=v(s.pop());case"rgb":return 3!==s.length?null:[p(s[0]),p(s[1]),p(s[2]),a];case"hsla":if(4!==s.length)return null;a=v(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,u=v(s[1]),c=v(s[2]),h=c<=.5?c*(u+1):c+u-c*u,f=2*c-h;return[_(255*m(f,h,l+1/3)),_(255*m(f,h,l)),_(255*m(f,h,l-1/3)),a];default:return null}}return null}}catch(e){}}),Fo=(Co.parseCSSColor,{});Object.assign(Fo,{clampPositive:No,noNaN:Oo,parseNumber:Lo,parsePositiveNumber:Io}),Fo.wrapFunction=function(e){return"\n        var feature = context.feature.properties;\n        var global = context.global;\n        var $zoom = context.zoom;\n        var $layer = context.layer;\n        var $source = context.source;\n        var sources = context.sources;\n        var $geometry = context.geometry;\n        var $meters_per_pixel = context.meters_per_pixel;\n\n        var val = (function(){ ".concat(e," }());\n\n        if (typeof val === 'number' && isNaN(val)) {\n            val = null; // convert NaNs to nulls\n        }\n\n        return val;\n    ")},Fo.zeroPair=Object.freeze([0,0]),Fo.defaults={color:[1,1,1,1],width:1,size:1,extrude:!1,height:20,min_height:0,order:0,z:0,outline:{color:[0,0,0,0],width:0},material:{ambient:1,diffuse:1}},Fo.macros={"Style.color.pseudoRandomColor":function(){return[parseInt(feature.id,16)/100%1*.7,parseInt(feature.id,16)/1e4%1*.7,parseInt(feature.id,16)/1e6%1*.7,1]},"Style.color.randomColor":function(){return[.7*Math.random(),.7*Math.random(),.7*Math.random(),1]}},Fo.getFeatureParseContext=function(e,t,i,r){return{feature:e,tile:t,global:i,sources:r,zoom:t.style_zoom,geometry:Kr.geometryType(e.geometry.type),meters_per_pixel:t.meters_per_pixel,meters_per_pixel_sq:t.meters_per_pixel_sq,units_per_meter_overzoom:t.units_per_meter_overzoom}};var Do={STATIC:0,DYNAMIC:1,ZOOM:2};Fo.CACHE_TYPE=Do,Fo.createPropertyCache=function(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(null!=e){if(e.value)return{value:e.value,zoom:e.zoom?{}:null,type:e.type};var t={value:e,type:Do.STATIC};return Array.isArray(t.value)&&Array.isArray(t.value[0])?(t.zoom={},t.type=Do.ZOOM):"function"==typeof t.value&&(t.type=Do.DYNAMIC),"function"==typeof i&&(t.zoom?t.value=t.value.map(function(e,t){return[e[0],i(e[1],t)]}):"function"!=typeof t.value&&(t.value=i(t.value,0))),t}},Fo.createColorPropertyCache=function(e){return Fo.createPropertyCache(e,function(e){return"Style.color.pseudoRandomColor"===e?on.stringToFunction(Fo.wrapFunction(Fo.macros["Style.color.pseudoRandomColor"])):"Style.color.randomColor"===e?Fo.macros["Style.color.randomColor"]:e})};function Uo(e){return"string"==typeof e&&"%"===e[e.length-1]}function jo(e){return"auto"===e}function Go(e){return Uo(e)||jo(e)}var Bo="'size' can specify either width or height as derived from aspect ratio, but not both";Fo.createPointSizePropertyCache=function(e){var t=null,i=null;if(Uo(e))t=[!0];else if(Array.isArray(e))if(Array.isArray(e[0])){if(e.some(function(e){return Array.isArray(e[1])?e[1].some(function(e){return Go(e)}):Uo(e[1])})&&(t=e.map(function(e){return Array.isArray(e[1])?e[1].map(function(e){return Uo(e)}):Uo(e[1])}),(i=e.map(function(e){return Array.isArray(e[1])&&e[1].map(function(e){return jo(e)})})).some(function(e){return Array.isArray(e)&&e.every(function(e){return e})})))throw Bo}else if(e.some(Go)&&(t=[e.map(Uo)],(i=[e.map(jo)])[0].every(function(e){return e})))throw Bo;return t?((e={value:e}).has_pct=t,e.has_ratio=i,e.sprites={}):e=Fo.createPropertyCache(e,Io),e},Fo.evalCachedPointSizeProperty=function(r,n,e){return r.has_pct||r.has_ratio?n?(r.sprites[n.sprite]||(r.sprites[n.sprite]=Fo.createPropertyCache(r.value,function(t,i){return Array.isArray(t)?(t=t.map(function(e,t){return r.has_ratio[i][t]?e:Io(e)}).map(function(e,t){return r.has_pct[i][t]?n.css_size[t]*e/100:e}),r.has_ratio[i][0]?t[0]=t[1]*n.aspect:r.has_ratio[i][1]&&(t[1]=t[0]/n.aspect)):(t=Io(t),t=r.has_pct[i]?n.css_size.map(function(e){return e*t/100}):[t,t]),t})),Fo.evalCachedProperty(r.sprites[n.sprite],e)):void 0:Fo.evalCachedProperty(r,e)},Fo.evalCachedProperty=function(e,t){if(null!=e)return e.dynamic?e.dynamic(t):e.static?e.static:e.zoom&&e.zoom[t.zoom]?e.zoom[t.zoom]:"function"!=typeof e.value?Array.isArray(e.value)&&Array.isArray(e.value[0])?(e.zoom=e.zoom||{},e.zoom[t.zoom]=on.interpolate(t.zoom,e.value),e.zoom[t.zoom]):(e.static=e.value,e.static):(e.dynamic=e.value,e.dynamic(t))},Fo.convertUnits=function(e,t){if(null!=e.val)return"px"===e.units?e.val*Kr.metersPerPixel(t.zoom):e.val;if("string"==typeof e)"px"===e.trim().slice(-2)?(e=Lo(e),e*=Kr.metersPerPixel(t.zoom)):e=Lo(e);else if(Array.isArray(e))return Array.isArray(e[0])?e.map(function(e){return[e[0],Fo.convertUnits(e[1],t)]}):e.map(function(e){return Fo.convertUnits(e,t)});return e},Fo.parseUnits=function(e){var t={val:Lo(e)};return 0!==t.val&&"string"==typeof e&&"px"===e.trim().slice(-2)&&(t.units="px"),t},Fo.evalCachedDistanceProperty=function(e,t){return e.dynamic?e.dynamic(t):e.zoom&&e.zoom[t.zoom]?e.zoom[t.zoom]:"function"!=typeof e.value?e.zoom?(e.zoom[t.zoom]=on.interpolate(t.zoom,e.value,function(e){return Fo.convertUnits(e,t)}),e.zoom[t.zoom]):Fo.convertUnits(e.value,t):(e.dynamic=e.value,e.dynamic(t))},Fo.string_colors={},Fo.colorForString=function(e){if(Fo.string_colors[e])return Fo.string_colors[e];var t=null;return"none"!==e&&((t=Co.parseCSSColor(e))&&4===t.length?(t[0]/=255,t[1]/=255,t[2]/=255):t=Fo.defaults.color),Fo.string_colors[e]=t},Fo.evalCachedColorProperty=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(e.dynamic){var i=e.dynamic(t);return"string"==typeof i&&(i=Fo.colorForString(i)),i&&null==i[3]&&(i[3]=1),i}if(e.static)return e.static;if(e.zoom&&e.zoom[t.zoom])return e.zoom[t.zoom];if("function"==typeof e.value){e.dynamic=e.value;var r=e.dynamic(t);return"string"==typeof r&&(r=Fo.colorForString(r)),r&&null==r[3]&&(r[3]=1),r}if("string"==typeof e.value)return e.static=Fo.colorForString(e.value),e.static;if(e.zoom){if(!e.zoom_preprocessed){for(var n=0;n<e.value.length;n++){var o=e.value[n];o&&"string"==typeof o[1]&&(o[1]=Fo.colorForString(o[1]))}e.zoom_preprocessed=!0}return e.zoom[t.zoom]=on.interpolate(t.zoom,e.value),e.zoom[t.zoom][3]=e.zoom[t.zoom][3]||1,e.zoom[t.zoom]}return e.static=e.value.map(function(e){return e}),e.static&&null==e.static[3]&&(e.static[3]=1),e.static},Fo.parseColor=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("function"==typeof e&&(e=e(t)),"string"==typeof e)e=Fo.colorForString(e);else if(Array.isArray(e)&&Array.isArray(e[0])){for(var i=0;i<e.length;i++){var r=e[i];"string"==typeof r[1]&&(r[1]=Fo.colorForString(r[1]))}t.zoom&&(e=on.interpolate(t.zoom,e))}return Array.isArray(e)?null==(e=e.map(function(e){return e}))[3]&&(e[3]=1):e=[0,0,0,1],e},Fo.calculateOrder=function(e,t){return"function"==typeof e?e=e(t):"string"==typeof e&&(e=t.feature.properties[e]?t.feature.properties[e]:Io(e)),e},Fo.evalProperty=function(e,t){return"function"==typeof e?e(t):e};var Vo=function(){function r(e,t){mr(this,r),this.key=e,this.repeat_dist=t,this.repeat_dist_sq=this.repeat_dist*this.repeat_dist,this.positions=[]}return yr(r,[{key:"check",value:function(e){for(var t=e.position,i=0;i<this.positions.length;i++){var r=this.positions[i],n=t[0]-r[0],o=t[1]-r[1],s=n*n+o*o;if(s<this.repeat_dist_sq)return{dist_sq:s,repeat_dist_sq:this.repeat_dist_sq}}}},{key:"add",value:function(e){e&&e.position&&this.positions.push(e.position)}}],[{key:"clear",value:function(e){this.groups[e]={}}},{key:"check",value:function(e,t,i){if(t.repeat_distance&&t.repeat_group&&this.groups[i][t.repeat_group])return this.groups[i][t.repeat_group].check(e)}},{key:"add",value:function(e,t,i){t.repeat_distance&&t.repeat_group&&(null==this.groups[i][t.repeat_group]&&(this.groups[i][t.repeat_group]=new r(t.repeat_group,t.repeat_distance*t.repeat_scale)),this.groups[i][t.repeat_group].add(e))}}]),r}();Vo.groups={};var qo=function(){function s(e,t,i){mr(this,s);var r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}return yr(s,[{key:"keysLength",value:function(){return this.boxKeys.length+this.circleKeys.length}},{key:"insert",value:function(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}},{key:"insertCircle",value:function(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}},{key:"insertCircleList",value:function(e,t){for(var i=0;i<t.length-2;i+=3)this.insertCircle("".concat(e,"/").concat(i),t[i],t[i+1],t[i+2])}},{key:"_insertBoxCell",value:function(e,t,i,r,n,o){this.boxCells[n].push(o)}},{key:"_insertCircleCell",value:function(e,t,i,r,n,o){this.circleCells[n].push(o)}},{key:"_query",value:function(e,t,i,r,n,o){if(i<0||e>this.width||r<0||t>this.height)return!n&&[];var s=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(var a=0;a<this.boxKeys.length;a++)s.push({key:this.boxKeys[a],x1:this.bboxes[4*a],y1:this.bboxes[4*a+1],x2:this.bboxes[4*a+2],y2:this.bboxes[4*a+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],h=this.circles[3*l+2];s.push({key:this.circleKeys[l],x1:u-h,y1:c-h,x2:u+h,y2:c+h})}return o?s.filter(o):s}var f={hitTest:n,seenUids:{box:{},circle:{}}};return this._forEachCell(e,t,i,r,this._queryCell,s,f,o),n?0<s.length:s}},{key:"_queryCircle",value:function(e,t,i,r,n){var o=e-i,s=e+i,a=t-i,l=t+i;if(s<0||o>this.width||l<0||a>this.height)return!r&&[];var u=[],c={hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}};return this._forEachCell(o,a,s,l,this._queryCellCircle,u,c,n),r?0<u.length:u}},{key:"query",value:function(e,t,i,r,n){return this._query(e,t,i,r,!1,n)}},{key:"hitTest",value:function(e,t,i,r,n){return this._query(e,t,i,r,!0,n)}},{key:"hitTestCircle",value:function(e,t,i,r){return this._queryCircle(e,t,i,!0,r)}},{key:"hitTestCircleList",value:function(e,t){for(var i=0;i<e.length-2;i+=3)if(this.hitTestCircle(e[i],e[i+1],e[i+2],t))return!0;return!1}},{key:"_queryCell",value:function(e,t,i,r,n,o,s,a){var l=s.seenUids,u=this.boxCells[n];if(null!==u){var c=this.bboxes,h=!0,f=!1,d=void 0;try{for(var _,p=u[Symbol.iterator]();!(h=(_=p.next()).done);h=!0){var v=_.value;if(!l.box[v]){l.box[v]=!0;var m=4*v;if(e<=c[2+m]&&t<=c[3+m]&&i>=c[0+m]&&r>=c[1+m]&&(!a||a(this.boxKeys[v]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[v],x1:c[m],y1:c[1+m],x2:c[2+m],y2:c[3+m]})}}}}catch(e){f=!0,d=e}finally{try{h||null==p.return||p.return()}finally{if(f)throw d}}}var g=this.circleCells[n];if(null!==g){var y=this.circles,x=!0,b=!1,w=void 0;try{for(var A,T=g[Symbol.iterator]();!(x=(A=T.next()).done);x=!0){var k=A.value;if(!l.circle[k]){l.circle[k]=!0;var E=3*k;if(this._circleAndRectCollide(y[E],y[1+E],y[2+E],e,t,i,r)&&(!a||a(this.circleKeys[k]))){if(s.hitTest)return o.push(!0),!0;var M=y[E],R=y[1+E],S=y[2+E];o.push({key:this.circleKeys[k],x1:M-S,y1:R-S,x2:M+S,y2:R+S})}}}}catch(e){b=!0,w=e}finally{try{x||null==T.return||T.return()}finally{if(b)throw w}}}}},{key:"_queryCellCircle",value:function(e,t,i,r,n,o,s,a){var l=s.circle,u=s.seenUids,c=this.boxCells[n];if(null!==c){var h=this.bboxes,f=!0,d=!1,_=void 0;try{for(var p,v=c[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var m=p.value;if(!u.box[m]){u.box[m]=!0;var g=4*m;if(this._circleAndRectCollide(l.x,l.y,l.radius,h[0+g],h[1+g],h[2+g],h[3+g])&&(!a||a(this.boxKeys[m])))return o.push(!0),!0}}}catch(e){d=!0,_=e}finally{try{f||null==v.return||v.return()}finally{if(d)throw _}}}var y=this.circleCells[n];if(null!==y){var x=this.circles,b=!0,w=!1,A=void 0;try{for(var T,k=y[Symbol.iterator]();!(b=(T=k.next()).done);b=!0){var E=T.value;if(!u.circle[E]){u.circle[E]=!0;var M=3*E;if(this._circlesCollide(x[M],x[1+M],x[2+M],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[E])))return o.push(!0),!0}}}catch(e){w=!0,A=e}finally{try{b||null==k.return||k.return()}finally{if(w)throw A}}}}},{key:"_forEachCell",value:function(e,t,i,r,n,o,s,a){for(var l=this._convertToXCellCoord(e),u=this._convertToYCellCoord(t),c=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r),f=l;f<=c;f++)for(var d=u;d<=h;d++){var _=this.xCellCount*d+f;if(n.call(this,e,t,i,r,_,o,s,a))return}}},{key:"_convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"_convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}},{key:"_circlesCollide",value:function(e,t,i,r,n,o){var s=r-e,a=n-t,l=i+o;return s*s+a*a<l*l}},{key:"_circleAndRectCollide",value:function(e,t,i,r,n,o,s){var a=(o-r)/2,l=Math.abs(e-(r+a));if(a+i<l)return!1;var u=(s-n)/2,c=Math.abs(t-(n+u));if(u+i<c)return!1;if(l<=a||c<=u)return!0;var h=l-a,f=c-u;return h*h+f*f<=i*i}}]),s}(),Ho=function(e,t,i,r){var n;if(r&&(n=function(e){return e!==r.id}),!t){if("point"===e.type&&!e.angle){var o=e.getAABB(),s=o.left,a=o.top,l=o.right,u=o.bottom;if(i.hitTest(s,-a,l,-u,n)){if(Array.isArray(e.layout.anchor))for(var c=1;c<e.layout.anchor.length;c++){e.setAnchor(e.layout.anchor[c]);var h=e.getAABB(),f=h.left,d=h.top,_=h.right,p=h.bottom;if(!i.hitTest(f,-d,_,-p,n))return!1}return!0}return!1}var v=e.getBoundingCircles();return i.hitTestCircleList(v,n)}if(t){if("point"===e.type&&!e.isFlat()){var m=e.getScreenSpaceBoundingBox(),g=m.left,y=m.top,x=m.right,b=m.bottom;return i.hitTest(g,y,x,b,n)}var w=e.getBoundingCircles();return i.hitTestCircleList(w,n)}return!1},Yo=function(e,t,i){var r=e.id;if(e.placed=!0,!t)if("point"!==e.type||e.angle){var n=e.getBoundingCircles();i.insertCircleList(r,n)}else{var o=e.getAABB(),s=o.left,a=o.top,l=o.right,u=o.bottom;i.insert(r,s,-a,l,-u)}if(t)if("point"!==e.type||e.isFlat()){var c=e.getBoundingCircles();i.insertCircleList(r,c)}else{var h=e.getScreenSpaceBoundingBox(),f=h.left,d=h.top,_=h.right,p=h.bottom;i.insert(r,f,d,_,p)}},Xo={tiles:{},startTile:function(e,t){var i=1<arguments.length&&void 0!==t?t:{},r=i.apply_repeat_groups,n=void 0===r||r,o=i.return_hidden,s=void 0!==o&&o,a=i.grid_index,l=void 0===a?null:a,u=this.tiles[e]={grid_index:l||new qo(Kr.tile_scale,Kr.tile_scale,240),objects:{},labels:{},styles:{},repeat:n,return_hidden:s};null==u.complete&&(u.complete=new Promise(function(e,t){u.resolve=e,u.reject=t}))},resetTile:function(e){delete this.tiles[e]},abortTile:function(e){this.tiles[e]&&this.tiles[e].resolve&&this.tiles[e].resolve([]),this.resetTile(e)},addStyle:function(e,t){this.tiles[t].styles[e]=!0},collide:function(e,t,i){var r=this.tiles[i];if(!r)return Promise.resolve([]);for(var n=r.objects,o=0;o<e.length;o++){var s=e[o],a=s.label.layout.priority;n[a]=n[a]||{},n[a][t]=n[a][t]||[],n[a][t].push(s)}return delete r.styles[t],0===Object.keys(r.styles).length&&this.endTile(i),r.complete.then(function(){return r.resolve=null,r.labels[t]||[]})},endTile:function(e){var t=this.tiles[e],i=t.labels;t.repeat&&Vo.clear(e);for(var r=Object.keys(t.objects).sort(function(e,t){return e-t}),n=0;n<r.length;n++){var o=t.objects[r[n]];if(o)for(var s in o){var a=o[s];i[s]=i[s]||[];for(var l=0;l<a.length;l++){var u=a[l];this.canBePlaced(u,e,u.linked,t)?u.linked?this.canBePlaced(u.linked,e,u,t)?(u.show=!0,(u.label.breach||u.linked.label.breach)&&(u.label.breach=!0,u.linked.label.breach=!0),i[s].push(u),this.place(u,e,t),this.place(u.linked,e,t)):t.return_hidden&&(u.show=!1,i[s].push(u)):(u.show=!0,i[s].push(u),this.place(u,e,t)):t.return_hidden&&(u.show=!1,i[s].push(u))}}}delete this.tiles[e],t.resolve()},canBePlaced:function(e,t,i,r){var n=2<arguments.length&&void 0!==i?i:null,o=(3<arguments.length&&void 0!==r?r:{}).repeat,s=void 0===o||o,a=e.label,l=e.label.layout;if(null!==a.placed)return a.placed;var u=this.tiles[t].grid_index;if(l.collide&&Ho(a,"main"===t,u,n&&n.label))l.collide&&(a.placed=!1);else{if(!(s&&Vo.check(a,l,t)))return!0;a.placed=!1}return a.placed},place:function(e,t,i){var r=e.label,n=i.repeat,o=void 0===n||n;null===r.placed&&(o&&Vo.add(r,r.layout,t),Yo(r,"main"===t,this.tiles[t].grid_index))}},Wo={id:0,queue:[],max_time:20,start_time:null,state:{},add:function(i){i.id=Wo.id++,i.max_time=i.max_time||Wo.max_time,i.pause_factor=i.pause_factor||1;var e=new Promise(function(e,t){i.resolve=e,i.reject=t});return i.promise=e,i.total_elapsed=0,i.stats={calls:0},this.queue.push(i),this.start_time=this.start_time||performance.now(),this.elapsed=performance.now()-this.start_time,this.elapsed<Wo.max_time&&this.process(i),i.promise},remove:function(e){var t=this.queue.indexOf(e);-1<t&&this.queue.splice(t,1)},process:function(e){if(!this.state.user_moving_view||!1!==e.user_moving_view)return e.pause?(e.pause--,!0):(e.stats.calls++,e.start_time=performance.now(),e.run(e))},processAll:function(){this.start_time=this.start_time||performance.now();for(var e=0;e<this.queue.length;e++){var t=this.queue[e];if(!0!==this.process(t)&&(t.pause||(t.pause=t.elapsed>t.max_time?t.pause_factor:0),t.total_elapsed+=t.elapsed),this.elapsed=performance.now()-this.start_time,this.elapsed>=Wo.max_time){this.start_time=null;break}}},finish:function(e,t){return e.elapsed=performance.now()-e.start_time,e.total_elapsed+=e.elapsed,this.remove(e),e.resolve(t),e.promise},cancel:function(e){var t;e.cancel instanceof Function&&(t=e.cancel(e)),e.resolve(t||{})},shouldContinue:function(e){return e.elapsed=performance.now()-e.start_time,this.elapsed=performance.now()-this.start_time,e.elapsed<e.max_time&&this.elapsed<Wo.max_time},removeForTile:function(e){for(var t=this.queue.length-1;0<=t;t--)this.queue[t].tile_id===e&&(this.cancel(this.queue[t]),this.queue.splice(t,1))},setState:function(e){this.state=e}};function Zo(e){var n=[];return Object.assign(e,{subscribe:function(e){-1===n.indexOf(e)&&n.push(e)},unsubscribe:function(e){var t=n.indexOf(e);-1<t&&n.splice(t,1)},unsubscribeAll:function(){n=[]},trigger:function(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];n.forEach(function(e){if("function"==typeof e[t])try{e[t].apply(e,i)}catch(e){Jr("warn","Caught exception in listener for event '".concat(t,"':"),e)}})},hasSubscribersFor:function(t){var i=!1;return n.forEach(function(e){"function"==typeof e[t]&&(i=!0)}),i}})}var Jo=function(){function o(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};mr(this,o),i=o.sliceOptions(i),this.gl=e,this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.bind(),this.name=t,this.retain_count=0,this.config_type=null,this.loading=null,this.loaded=!1,this.filtering=i.filtering,this.density=i.density||1,this.sprites=i.sprites,this.texcoords={},this.sizes={},this.css_sizes={},this.aspects={},this.setData(1,1,new Uint8Array([0,0,0,0]),{filtering:"nearest"}),this.loaded=!1,o.textures[this.name]&&(this.retain_count=o.textures[this.name].retain_count,o.textures[this.name].retain_count=0,o.textures[this.name].destroy()),o.textures[this.name]=this,o.texture_configs[this.name]=JSON.stringify(Object.assign({name:t},i)),this.load(i),Jr("trace","creating Texture ".concat(this.name))}return yr(o,[{key:"destroy",value:function(e){var t=(0<arguments.length&&void 0!==e?e:{}).force;0<this.retain_count&&!t?Jr("error","Texture '".concat(this.name,"': destroying texture with retain count of '").concat(this.retain_count,"'")):this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,delete o.textures[this.name],delete o.texture_configs[this.name],this.valid=!1,Jr("trace","destroying Texture ".concat(this.name)))}},{key:"retain",value:function(){this.retain_count++}},{key:"release",value:function(){this.retain_count<=0&&Jr("error","Texture '".concat(this.name,"': releasing texture with retain count of '").concat(this.retain_count,"'")),this.retain_count--,this.retain_count<=0&&this.destroy()}},{key:"bind",value:function(e){var t=0<arguments.length&&void 0!==e?e:0;this.valid&&(o.activeUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),o.activeUnit=t,o.boundTexture=null),o.boundTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),o.boundTexture=this.texture))}},{key:"load",value:function(e){var t=this;return e?(this.loading=null,"string"==typeof e.url?(this.config_type="url",this.setUrl(e.url,e)):e.element?(this.config_type="element",this.setElement(e.element,e)):e.data&&e.width&&e.height&&(this.config_type="data",this.setData(e.width,e.height,e.data,e)),this.loading=this.loading&&this.loading.then(function(){return t.calculateSprites(),t})||Promise.resolve(this),this.loading):this.loading||Promise.resolve(this)}},{key:"setUrl",value:function(e,t){var r=this,n=1<arguments.length&&void 0!==t?t:{};if(this.valid)return this.url=e,this.loading=new Promise(function(t,e){var i=new Image;i.onload=function(){try{r.setElement(i,n)}catch(e){r.loaded=!1,Jr("warn","Texture '".concat(r.name,"': failed to load url: '").concat(r.url,"'"),e,n),o.trigger("warning",{message:"Failed to load texture from ".concat(r.url),error:e,texture:n})}r.loaded=!0,t(r)},i.onerror=function(e){r.loaded=!1,Jr("warn","Texture '".concat(r.name,"': failed to load url: '").concat(r.url,"'"),e,n),o.trigger("warning",{message:"Failed to load texture from ".concat(r.url),error:e,texture:n}),t(r)},on.isSafari()&&"data:"===r.url.slice(0,5)||(i.crossOrigin="anonymous"),i.src=r.url}),this.loading}},{key:"setData",value:function(e,t,i,r){var n=3<arguments.length&&void 0!==r?r:{};return this.width=e,this.height=t,Array.isArray(i)&&(i=new Uint8Array(i)),this.update(i,n),this.setFiltering(n),this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(e,t){var i=e;if("string"==typeof e&&(e=document.querySelector(e)),e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement)this.update(e,t),this.setFiltering(t);else{this.loaded=!1;var r="the 'element' parameter (`element: ".concat(JSON.stringify(i),"`) must be a CSS ");r+="selector string, or a <canvas>, <image> or <video> object",Jr("warn","Texture '".concat(this.name,"': ").concat(r),t),o.trigger("warning",{message:"Failed to load texture because ".concat(r),texture:t})}return this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:{};this.valid&&(this.bind(),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==i.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof HTMLImageElement&&e.complete?(this.width=e.width,this.height=e.height,this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e)):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),o.trigger("update",this))}},{key:"setFiltering",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};if(this.valid){t.filtering=t.filtering||"linear";var i=this.gl;this.bind(),on.isPowerOf2(this.width)&&on.isPowerOf2(this.height)?(this.power_of_2=!0,i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t.TEXTURE_WRAP_S||t.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t.TEXTURE_WRAP_T||t.repeat&&i.REPEAT||i.CLAMP_TO_EDGE),"mipmap"===t.filtering?(this.filtering="mipmap",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.generateMipmap(i.TEXTURE_2D)):"linear"===t.filtering?(this.filtering="linear",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):"nearest"===t.filtering&&(this.filtering="nearest",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST))):(this.power_of_2=!1,i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),"nearest"===t.filtering?(this.filtering="nearest",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)):(this.filtering="linear",i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR))),o.trigger("update",this)}}},{key:"calculateSprites",value:function(){if(this.sprites)for(var e in this.sprites){var t=this.sprites[e];this.texcoords[e]=o.getTexcoordsForSprite([t[0],t[1]],[t[2],t[3]],[this.width,this.height]),this.sizes[e]=[t[2],t[3]],this.css_sizes[e]=[t[2]/this.density,t[3]/this.density],this.aspects[e]=t[2]/t[3]}}}]),o}();Jo.matchers_=[],Jo.register=function(e,t){var i=Jo.matchers_;if(!(e instanceof Function&&t instanceof Function))throw"Invalid texture constructor or matcher";Jo.deRegister(e),i.push([e,t])},Jo.deRegister=function(e){for(var t=Jo.matchers_,i=0;i<t.length;i++)t[i][0]===e&&t.splice(i,1)},Jo.create=function(e,t,i){for(var r in Jo.matchers_){var n=Sr(Jo.matchers_[r],2),o=n[0],s=n[1];if(s&&s(i))return new o(e,t,i)}return new Jo(e,t,i)},Jo.retain=function(e){Jo.textures[e]&&Jo.textures[e].retain()},Jo.release=function(e){Jo.textures[e]&&Jo.textures[e].release()},Jo.destroy=function(i){Object.keys(Jo.textures).forEach(function(e){var t=Jo.textures[e];e!==Jo.default&&t.gl===i&&t.destroy({force:!0})})},Jo.getSpriteInfo=function(e,t){var i=Jo.textures[e];return i&&{size:i.sizes[t],css_size:i.css_sizes[t],aspect:i.aspects[t],texcoords:i.texcoords[t]}},Jo.getTexcoordsForSprite=function(e,t,i){var r=i[1]-e[1]-t[1];return[e[0]/i[0],r/i[1],(t[0]+e[0])/i[0],(t[1]+r)/i[1]]},Jo.createFromObject=function(e,t){var i=[];if(t)for(var r in t){var n=t[r];if(Jo.changed(r,n)){var o=Jo.create(e,r,n);i.push(o.loading)}}return Promise.all(i)},Jo.default="__default",Jo.createDefault=function(e){return Jo.create(e,Jo.default)},Jo.sliceOptions=function(e){return{coords:e.coords,uid:e.uid,filtering:e.filtering,sprites:e.sprites,url:e.url,element:e.element,data:e.data,width:e.width,height:e.height,density:e.density,repeat:e.repeat,TEXTURE_WRAP_S:e.TEXTURE_WRAP_S,TEXTURE_WRAP_T:e.TEXTURE_WRAP_T,UNPACK_FLIP_Y_WEBGL:e.UNPACK_FLIP_Y_WEBGL,UNPACK_PREMULTIPLY_ALPHA_WEBGL:e.UNPACK_PREMULTIPLY_ALPHA_WEBGL}},Jo.changed=function(e,t){var i=Jo.textures[e];if(i){if("element"===i.config_type||null!=t.element)return!0;if(t=Jo.sliceOptions(t),Jo.texture_configs[e]===JSON.stringify(Object.assign({name:e},t)))return!1}return!0},Jo.getInfo=function(e){if(e||(e=Object.keys(Jo.textures)),Array.isArray(e))return Promise.all(e.map(function(e){return Jo.getInfo(e)}));var t=Jo.textures[e];return t?(t.loading||Promise.resolve(t)).then(function(){return{name:t.name,width:t.width,height:t.height,density:t.density,sprites:t.sprites,texcoords:t.texcoords,sizes:t.sizes,css_sizes:t.css_sizes,aspects:t.aspects,filtering:t.filtering,power_of_2:t.power_of_2,valid:t.valid}}):Promise.resolve(null)},Jo.syncTexturesToWorker=function(e){return Ir.is_main?Promise.all(e.map(function(e){var t=Jo.textures[e];return t&&t.loading||Promise.resolve()})).then(function(){return Jo.textures}):Cr.postMessage("Texture.getInfo",e).then(function(e){return e.forEach(function(e){Jo.textures[e.name]=e}),Jo.textures})},Jo.getMaxTextureSize=function(e){return e.getParameter(e.MAX_TEXTURE_SIZE)},Jo.textures={},Jo.texture_configs={},Jo.boundTexture=null,Jo.activeUnit=null,Cr.addTarget("Texture",Jo),Zo(Jo);var Ko=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var $o={fromValues:function(e,t,i){var r=new Float64Array(3);return r[0]=e,r[1]=t,r[2]=i,r},transformMat4:function(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[3]*r+i[7]*n+i[11]*o+i[15];return s=s||1,e[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/s,e[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/s,e[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/s,e}},Qo={normalFromMat4:function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],p=t[13],v=t[14],m=t[15],g=i*a-r*s,y=i*l-n*s,x=i*u-o*s,b=r*l-n*a,w=r*u-o*a,A=n*u-o*l,T=c*p-h*_,k=c*v-f*_,E=c*m-d*_,M=h*v-f*p,R=h*m-d*p,S=f*m-d*v,z=g*S-y*R+x*M+b*E-w*k+A*T;return z?(z=1/z,e[0]=(a*S-l*R+u*M)*z,e[1]=(l*E-s*S-u*k)*z,e[2]=(s*R-a*E+u*T)*z,e[3]=(n*R-r*S-o*M)*z,e[4]=(i*S-n*E+o*k)*z,e[5]=(r*E-i*R-o*T)*z,e[6]=(p*A-v*w+m*b)*z,e[7]=(v*x-_*A-m*y)*z,e[8]=(_*w-p*x+m*g)*z,e):null},invert:function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=c*s-a*u,f=-c*o+a*l,d=u*o-s*l,_=i*h+r*f+n*d;return _?(_=1/_,e[0]=h*_,e[1]=(-c*r+n*u)*_,e[2]=(a*r-n*s)*_,e[3]=f*_,e[4]=(c*i-n*l)*_,e[5]=(-a*i+n*o)*_,e[6]=d*_,e[7]=(-u*i+r*l)*_,e[8]=(s*i-r*o)*_,e):null},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}},es={multiply:function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],_=t[11],p=t[12],v=t[13],m=t[14],g=t[15],y=i[0],x=i[1],b=i[2],w=i[3];return e[0]=y*r+x*a+b*h+w*p,e[1]=y*n+x*l+b*f+w*v,e[2]=y*o+x*u+b*d+w*m,e[3]=y*s+x*c+b*_+w*g,y=i[4],x=i[5],b=i[6],w=i[7],e[4]=y*r+x*a+b*h+w*p,e[5]=y*n+x*l+b*f+w*v,e[6]=y*o+x*u+b*d+w*m,e[7]=y*s+x*c+b*_+w*g,y=i[8],x=i[9],b=i[10],w=i[11],e[8]=y*r+x*a+b*h+w*p,e[9]=y*n+x*l+b*f+w*v,e[10]=y*o+x*u+b*d+w*m,e[11]=y*s+x*c+b*_+w*g,y=i[12],x=i[13],b=i[14],w=i[15],e[12]=y*r+x*a+b*h+w*p,e[13]=y*n+x*l+b*f+w*v,e[14]=y*o+x*u+b*d+w*m,e[15]=y*s+x*c+b*_+w*g,e},translate:function(e,t,i){var r,n,o,s,a,l,u,c,h,f,d,_,p=i[0],v=i[1],m=i[2];t===e?(e[12]=t[0]*p+t[4]*v+t[8]*m+t[12],e[13]=t[1]*p+t[5]*v+t[9]*m+t[13],e[14]=t[2]*p+t[6]*v+t[10]*m+t[14],e[15]=t[3]*p+t[7]*v+t[11]*m+t[15]):(r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],_=t[11],e[0]=r,e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=f,e[10]=d,e[11]=_,e[12]=r*p+a*v+h*m+t[12],e[13]=n*p+l*v+f*m+t[13],e[14]=o*p+u*v+d*m+t[14],e[15]=s*p+c*v+_*m+t[15]);return e},scale:function(e,t,i){var r=i[0],n=i[1],o=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},perspective:function(e,t,i,r,n){var o=1/Math.tan(t/2),s=1/(r-n);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+r)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*r*s,e[15]=0,e},lookAt:function(e,t,i,r){var n,o,s,a,l,u,c,h,f,d,_=t[0],p=t[1],v=t[2],m=r[0],g=r[1],y=r[2],x=i[0],b=i[1],w=i[2];if(Math.abs(_-x)<1e-6&&Math.abs(p-b)<1e-6&&Math.abs(v-w)<1e-6)return Ko(e);c=_-x,h=p-b,f=v-w,d=1/Math.sqrt(c*c+h*h+f*f),n=g*(f*=d)-y*(h*=d),o=y*(c*=d)-m*f,s=m*h-g*c,(d=Math.sqrt(n*n+o*o+s*s))?(n*=d=1/d,o*=d,s*=d):s=o=n=0;a=h*s-f*o,l=f*n-c*s,u=c*o-h*n,(d=Math.sqrt(a*a+l*l+u*u))?(a*=d=1/d,l*=d,u*=d):u=l=a=0;return e[0]=n,e[1]=a,e[2]=c,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=u,e[10]=f,e[11]=0,e[12]=-(n*_+o*p+s*v),e[13]=-(a*_+l*p+u*v),e[14]=-(c*_+h*p+f*v),e[15]=1,e},identity:Ko,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},invert:function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],p=t[13],v=t[14],m=t[15],g=i*a-r*s,y=i*l-n*s,x=i*u-o*s,b=r*l-n*a,w=r*u-o*a,A=n*u-o*l,T=c*p-h*_,k=c*v-f*_,E=c*m-d*_,M=h*v-f*p,R=h*m-d*p,S=f*m-d*v,z=g*S-y*R+x*M+b*E-w*k+A*T;return z?(z=1/z,e[0]=(a*S-l*R+u*M)*z,e[1]=(n*R-r*S-o*M)*z,e[2]=(p*A-v*w+m*b)*z,e[3]=(f*w-h*A-d*b)*z,e[4]=(l*E-s*S-u*k)*z,e[5]=(i*S-n*E+o*k)*z,e[6]=(v*x-_*A-m*y)*z,e[7]=(c*A-f*x+d*y)*z,e[8]=(s*R-a*E+u*T)*z,e[9]=(r*E-i*R-o*T)*z,e[10]=(_*w-p*x+m*g)*z,e[11]=(h*x-c*w-d*g)*z,e[12]=(a*k-s*M-l*T)*z,e[13]=(i*M-r*k+n*T)*z,e[14]=(p*y-_*b-v*g)*z,e[15]=(c*b-h*y+f*g)*z,e):null}},ts={transformMat4:function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,e[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,e[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,e[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,e},normalize:function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i*i+r*r+n*n+o*o;0<s&&(s=1/Math.sqrt(s),e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=o*s);return e},scale:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}},is=0,rs=0,ns=function(){function A(e){var t=e.coords,i=e.style_zoom,r=e.source,n=e.worker,o=e.view;mr(this,A),this.id=is++,this.worker=n,this.view=o,this.source=r,this.generation=null,this.valid=!0,this.visible=!1,this.proxy_for=null,this.proxy_depth=0,this.proxied_as=null,this.fade_in=!0,this.loading=!1,this.loaded=!1,this.built=!1,this.labeled=!1,this.error=null,this.style_zoom=i,this.coords=A.normalizedCoordinate(t,this.source,this.style_zoom),this.key=A.key(this.coords,this.source,this.style_zoom),this.overzoom=Math.max(this.style_zoom-this.coords.z,0),this.overzoom2=Math.pow(2,this.overzoom),this.min=Kr.metersForTile(this.coords),this.max=Kr.metersForTile({x:this.coords.x+1,y:this.coords.y+1,z:this.coords.z}),this.span={x:this.max.x-this.min.x,y:this.max.y-this.min.y},this.bounds={sw:{x:this.min.x,y:this.max.y},ne:{x:this.max.x,y:this.min.y}},this.center_dist=0,this.meters_per_pixel=Kr.metersPerPixel(this.style_zoom),this.meters_per_pixel_sq=this.meters_per_pixel*this.meters_per_pixel,this.units_per_pixel=Kr.units_per_pixel/this.overzoom2,this.units_per_meter_overzoom=Kr.unitsPerMeter(this.coords.z)*this.overzoom2,this.meshes={},this.new_mesh_styles=[]}return yr(A,[{key:"freeResources",value:function(){for(var e in this.meshes)this.meshes[e].forEach(function(e){return e.destroy()});this.meshes={}}},{key:"destroy",value:function(){Wo.removeForTile(this.id),this.workerMessage("self.removeTile",this.id),this.freeResources(),this.worker=null,this.valid=!1}},{key:"buildAsMessage",value:function(){return{id:this.id,key:this.key,source:this.source.name,coords:this.coords,min:this.min,max:this.max,units_per_pixel:this.units_per_pixel,meters_per_pixel:this.meters_per_pixel,meters_per_pixel_sq:this.meters_per_pixel_sq,units_per_meter_overzoom:this.units_per_meter_overzoom,style_zoom:this.style_zoom,overzoom:this.overzoom,overzoom2:this.overzoom2,generation:this.generation}}},{key:"workerMessage",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return Cr.postMessage.apply(Cr,[this.worker].concat(t))}},{key:"build",value:function(e,t){var i=(1<arguments.length&&void 0!==t?t:{}).fade_in,r=void 0===i||i;return this.generation=e,this.fade_in=r,this.loaded||(this.loading=!0,this.built=!1,this.labeled=!1),this.workerMessage("self.buildTile",{tile:this.buildAsMessage()})}},{key:"buildMeshes",value:function(e,t){if(!this.error){this.build_id=rs++;var i={},r=this.mesh_data;if(r)for(var n in r){for(var o in r[n].meshes){var s=r[n].meshes[o];if(s.vertex_data){if(!e[n]){Jr("warn","Could not create mesh because style '".concat(n,"' not found, for tile ").concat(this.key,", aborting tile"));break}var a=Object.assign({},r[n]);a.uniforms=Object.assign({},a.uniforms,s.uniforms),a.variant=s.variant,s.textures&&(a.textures=s.textures),s.labels&&(a.retain=!0);var l=e[n].makeMesh(s.vertex_data,s.vertex_elements,a);l.variant=a.variant,l.labels=s.labels,i[n]=i[n]||[],i[n].push(l),null==l.variant.order&&(l.variant.order=i[n].length-1)}}i[n]&&i[n].sort(function(e,t){var i=e.variant.order,r=t.variant.order;return null==i?1:null==r?-1:i<r?-1:1})}for(var u in delete this.mesh_data,i)this.meshes[u]&&this.meshes[u].forEach(function(e){return e.destroy()}),this.meshes[u]=i[u],this.new_mesh_styles.push(u);if(t.done){for(var c in this.meshes)-1===this.new_mesh_styles.indexOf(c)&&(this.meshes[c].forEach(function(e){return e.destroy()}),delete this.meshes[c]);this.new_mesh_styles=[]}}}},{key:"setProxyFor",value:function(e){e?(this.visible=!0,this.proxy_for=this.proxy_for||[],this.proxy_for.push(e),this.proxy_depth=1,e.proxied_as=e.style_zoom>this.style_zoom?"child":"parent"):(this.proxy_for=null,this.proxy_depth=0)}},{key:"isProxy",value:function(){return null!=this.proxy_for}},{key:"shouldProxyForStyle",value:function(t){return!this.proxy_for||this.proxy_for.some(function(e){return null==e.meshes[t]})}},{key:"setupProgram",value:function(e,t){var i=e.model,r=e.model32;t.uniform("4fv","u_tile_origin",[this.min.x,this.min.y,this.style_zoom,this.coords.z]),t.uniform("1f","u_tile_proxy_depth",this.proxy_depth),es.identity(i),es.translate(i,i,$o.fromValues(this.min.x,this.min.y,0)),es.scale(i,i,$o.fromValues(this.span.x/Kr.tile_scale,-1*this.span.y/Kr.tile_scale,1)),es.copy(r,i),t.uniform("Matrix4fv","u_model",r),t.uniform("1i","u_tile_fade_in",this.fade_in&&"child"!==this.proxied_as)}},{key:"merge",value:function(e){return this.loading=e.loading,this.loaded=e.loaded,this.generation=e.generation,this.error=e.error,this.mesh_data=e.mesh_data,this.selection_data?Object.assign(this.selection_data,e.selection_data):this.selection_data=e.selection_data,this}}],[{key:"coord",value:function(e){return{x:e.x,y:e.y,z:e.z,key:A.coordKey(e)}}},{key:"coordKey",value:function(e){return e.x+"/"+e.y+"/"+e.z}},{key:"key",value:function(e,t,i){if(!(e.y<0||e.y>=1<<e.z||e.z<0))return[t.name,i,e.x,e.y,e.z].join("/")}},{key:"normalizedKey",value:function(e,t,i){return A.key(A.normalizedCoordinate(e,t,i),t,i)}},{key:"normalizedCoordinate",value:function(e,t,i){return t.zoom_bias&&(e=A.coordinateAtZoom(e,Math.max(0,e.z-t.zoom_bias))),A.coordinateWithMaxZoom(e,t.max_zoom)}},{key:"coordinateAtZoom",value:function(e,t){var i=e.x,r=e.y,n=e.z;if(n!==t){var o=Math.pow(2,n-t);i=Math.floor(i/o),r=Math.floor(r/o),n=t}return A.coord({x:i,y:r,z:n})}},{key:"coordinateWithMaxZoom",value:function(e,t){var i=e.x,r=e.y,n=e.z;return void 0!==t&&t<n?A.coordinateAtZoom({x:i,y:r,z:n},t):A.coord({x:i,y:r,z:n})}},{key:"childrenForCoordinate",value:function(e){var t=e.x,i=e.y,r=e.z,n=e.key;return A.coord_children[n]||(r++,t*=2,i*=2,A.coord_children[n]=[A.coord({x:t,y:i,z:r}),A.coord({x:t+1,y:i,z:r}),A.coord({x:t,y:i+1,z:r}),A.coord({x:t+1,y:i+1,z:r})]),A.coord_children[n]}},{key:"isDescendant",value:function(e,t){if(t.z>e.z){var i=A.coordinateAtZoom(t,e.z),r=i.x,n=i.y;return e.x===r&&e.y===n}return!1}},{key:"cancel",value:function(e){e&&(e.canceled=!0,e.source_data&&e.source_data.request_id&&(on.cancelRequest(e.source_data.request_id),e.source_data.request_id=null),A.abortBuild(e))}},{key:"buildGeometry",value:function(e,t){var i=t.scene_id,r=t.layers,n=t.styles,o=t.global,s=t.sources,a=e.source_data;for(var l in Xo.startTile(e.id,{apply_repeat_groups:!0}),r){var u=r[l];if(u&&u.config_data){if(u.config_data.source===e.source)for(var c=A._getDataForSource(a,u.config_data,l),h=0;h<c.length;h++){var f=c[h],d=f.geom;if(d)for(var _=0;_<d.features.length;_++){var p=d.features[_];if(null!=p.geometry){var v=Fo.getFeatureParseContext(p,e,o,s);v.winding=e.default_winding,v.source=e.source,v.layer=f.layer;var m=u.buildDrawGroups(v,!0);if(m)for(var g in m){var y=m[g],x=y.style||g,b=n[x];b?null!=(y=b.preprocess(y,e.source))&&!1!==y.visible&&(v.layers=y.layers,b.addFeature(p,y,v)):Jr("warn","Style '".concat(x,"' not found, skipping layer '").concat(l,"':"),y,p)}}}}}else Jr("warn","Layer ".concat(l," was defined without a geometry data source and will not be rendered."))}var w=A._stylesForTile(e,n);A._sendStyleGroups(e,w,{scene_id:i},function(e){return e.collision?"collision":"non-collision"})}},{key:"_stylesForTile",value:function(e,t){var i=[];for(var r in t)t[r].hasDataForTile(e)&&i.push(t[r]);return i}},{key:"_sendStyleGroups",value:function(r,e,t,i){var n=t.scene_id,o={};e.forEach(function(e){var t=i(e);o[t]=o[t]||[],o[t].push(e)}),0<Object.keys(o).length?function(){var i={start:!0};r.mesh_data={};function e(t){var e=o[t];Promise.all(e.map(function(e){return e.endData(r)})).then(function(){Jr("trace","Finished style group '".concat(t,"' for tile ").concat(r.key)),o[t]=[],Object.keys(o).every(function(e){return 0===o[e].length})&&(i.done=!0),Cr.postMessage("TileManager_".concat(n,".buildTileStylesCompleted"),Cr.withTransferables({tile:A.slice(r,["mesh_data","selection_data"]),progress:i})),i.start=null,r.mesh_data={},r.selection_data={},i.done&&Xo.resetTile(r.id)},function(e){Jr("error","Error for style group '".concat(t,"' for tile ").concat(r.key),e)})}for(var t in o)e(t)}():(Cr.postMessage("TileManager_".concat(n,".buildTileStylesCompleted"),Cr.withTransferables({tile:A.slice(r),progress:{start:!0,done:!0}})),Xo.resetTile(r.id))}},{key:"_getDataForSource",value:function(t,e,i){var r=2<arguments.length&&void 0!==i?i:null,n=[];return null!=e&&null!=t&&null!=t.layers&&(!e.layer&&t.layers._default?n.push({geom:t.layers._default}):"string"==typeof e.layer&&!t.layers[e.layer]&&new RegExp("^\\d+_"+e.layer+"$").test(r)&&t.layers._default?n.push({geom:t.layers._default}):!e.layer&&r?n.push({layer:r,geom:t.layers[r]}):"string"==typeof e.layer?n.push({layer:e.layer,geom:t.layers[e.layer]}):Array.isArray(e.layer)&&e.layer.forEach(function(e){t.layers[e]&&t.layers[e].features&&n.push({layer:e,geom:t.layers[e]})})),n}},{key:"abortBuild",value:function(i){if(Wo.removeForTile(i.id),Xo.abortTile(i.id),i.mesh_data)for(var e in i.mesh_data){var t=i.mesh_data[e].textures;t&&t.forEach(function(e){var t=Jo.textures[e];t&&(Jr("trace","releasing texture ".concat(e," for tile ").concat(i.key)),t.release())})}}},{key:"slice",value:function(e,t){var i=["id","key","loading","loaded","generation","error","debug"];Array.isArray(t)&&i.push.apply(i,zr(t));for(var r={},n=0;n<i.length;n++){var o=i[n];r[o]=e[o]}return r}}]),A}();ns.coord_children={};var os=function(){function r(e,t){var i;return mr(this,r),-1===(i=Mr(this,wr(r).call(this,e,t))).rasters.indexOf(i.name)&&i.rasters.unshift(i.name),i.filtering=e.filtering,i.textures={},i}return br(r,mn),yr(r,[{key:"load",value:function(e){e.source_data={},e.source_data.layers={},e.pad_scale=this.pad_scale,e.rasters=zr(this.rasters);var t=Kr.tile_scale;return e.source_data.layers={_default:{type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[[0,0],[t,0],[t,-t],[0,-t],[0,0]]]},properties:{}}]}},e.default_winding="CW",Promise.resolve(e)}},{key:"tileTexture",value:function(e){var t=e.coords.key;if(!this.textures[t]){var i=ns.coordinateWithMaxZoom(e.coords,this.max_zoom),r=this.formatUrl(this.url,{coords:i});this.textures[t]={url:r,filtering:this.filtering,coords:i}}return this.textures[t]}}]),r}();function ss(e){return e}function as(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return ls(t,e)})}:ls(t,e)}function ls(e,t){var i=t.id,r=t.bbox,n=null==t.properties?{}:t.properties,o=function(e,t){var o=function(e){if(null==(t=e.transform))return ss;var t,i,r,n=t.scale[0],o=t.scale[1],s=t.translate[0],a=t.translate[1];return function(e,t){return t||(i=r=0),e[0]=(i+=e[0])*n+s,e[1]=(r+=e[1])*o+a,e}}(e),s=e.arcs;function n(e,t){t.length&&t.pop();for(var i=s[e<0?~e:e],r=0,n=i.length;r<n;++r)t.push(o(i[r].slice(),r));e<0&&function(e,t){for(var i,r=e.length,n=r-t;n<--r;)i=e[n],e[n++]=e[r],e[r]=i}(t,n)}function a(e){return o(e.slice())}function l(e){for(var t=[],i=0,r=e.length;i<r;++i)n(e[i],t);return t.length<2&&t.push(t[0].slice()),t}function i(e){for(var t=l(e);t.length<4;)t.push(t[0].slice());return t}function u(e){return e.map(i)}return function e(t){var i,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":i=a(t.coordinates);break;case"MultiPoint":i=t.coordinates.map(a);break;case"LineString":i=l(t.arcs);break;case"MultiLineString":i=t.arcs.map(l);break;case"Polygon":i=u(t.arcs);break;case"MultiPolygon":i=t.arcs.map(u);break;default:return null}return{type:r,coordinates:i}}(t)}(e,t);return null==i&&null==r?{type:"Feature",properties:n,geometry:o}:null==r?{type:"Feature",id:i,properties:n,geometry:o}:{type:"Feature",id:i,bbox:r,properties:n,geometry:o}}_n.register(os,"Raster");var us=function(){function o(){return mr(this,o),Mr(this,wr(o).apply(this,arguments))}return br(o,so),yr(o,[{key:"parseSourceData",value:function(e,t,i){var r="string"==typeof i?JSON.parse(i):i;r=this.toGeoJSON(r);var n=this.getLayers(r);Rr(wr(o.prototype),"preprocessLayers",this).call(this,n),t.layers=n}},{key:"toGeoJSON",value:function(e){if(e.objects&&1===Object.keys(e.objects).length){var t=Object.keys(e.objects)[0];e=cs(e,e.objects[t])}else{var i={};for(var r in e.objects)i[r]=cs(e,e.objects[r]);e=i}return e}}]),o}();function cs(e,t){var i=as(e,t);return"Feature"===i.type&&(i={type:"FeatureCollection",features:[i]}),i}var hs,fs=function(){function r(e,t){var i;return mr(this,r),(i=Mr(this,wr(r).call(this,e,t))).urlHasTilePattern(i.url)?i:Mr(i,new us(e))}return br(r,ao),yr(r,[{key:"parseSourceData",value:function(e,t,i){var r="string"==typeof i?JSON.parse(i):i;r=us.prototype.toGeoJSON(r),this.prepareGeoJSON(r,e,t)}}]),r}();_n.register(fs,"TopoJSON");var ds=hs={};hs.deepClone=function(e){return Array.isArray(e)?e.map(hs.deepClone):e};var _s=function(){function r(e,t){var i;return mr(this,r),(i=Mr(this,wr(r).call(this,e,t))).target_name="MapsJsSource"+e.uid,i.tiled=!!e.tiled,Cr.addTarget(i.target_name,Er(i)),Ir.is_worker&&Cr.postMessage(i.target_name+".onWorkerInitialized"),Ir.is_main&&(i._workers_left=0),i}return br(r,_n),yr(r,[{key:"initialize",value:function(e,t,i,r){this._main_initialized||(this.provider=e,this.worker=r,this._workers_left+=i,this._on_update=t,this._main_initialized=!0,this._onProviderUpdate=this._onProviderUpdate.bind(this),e.addEventListener("update",this._onProviderUpdate),this._isReady()&&this.onReady())}},{key:"onWorkerInitialized",value:function(){--this._workers_left,this._isReady()&&this.onReady()}},{key:"onReady",value:function(){}},{key:"_isReady",value:function(){return this._main_initialized&&!this._workers_left}},{key:"_onProviderUpdate",value:function(e){this._isReady()&&this.onProviderUpdate(e)}},{key:"onProviderUpdate",value:function(e){this.dispatchUpdate()}},{key:"dispatchUpdate",value:function(e){this._on_update(this.name,e)}},{key:"dispose",value:function(){Cr.removeTarget(this.target_name),this.provider.removeEventListener("update",this._onProviderUpdate)}},{key:"isVisible",value:function(e,t){return!0}}]),r}();function ps(e,t){this.items=[],this.algorithm=e;var i=void 0===(t=t||{}).sort||t.sort;this.sort=i}ps.prototype={addItem:function(e){this.items.push(e)},normalizeCoordinates:function(){var e=this.items,i=1/0,r=1/0;e.forEach(function(e){var t=e;i=Math.min(i,t.x),r=Math.min(r,t.y)}),e.forEach(function(e){var t=e;t.x-=i,t.y-=r})},getStats:function(){var e=this.items.map(function(e){return e}),t=e.map(function(e){return e.x}),i=e.map(function(e){return e.y}),r=e.map(function(e){return e.x+e.width}),n=e.map(function(e){return e.y+e.height});return{minX:Math.max.apply(Math,t),minY:Math.max.apply(Math,i),maxX:Math.max.apply(Math,r),maxY:Math.max.apply(Math,n)}},getItems:function(){return this.items},processItems:function(){var e=this.items;return this.sort&&(e=this.algorithm.sort(e)),e=this.algorithm.placeItems(e),this.items=e},exportItems:function(){return this.processItems(),this.normalizeCoordinates(),this.items},export:function(){var e=this.exportItems(),t=this.getStats();return{height:t.maxY,width:t.maxX,items:e}}};var vs=ps,ms="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},gs=[],ys=[],xs="undefined"!=typeof Uint8Array?Uint8Array:Array,bs=!1;function ws(){bs=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,i=e.length;t<i;++t)gs[t]=e[t],ys[e.charCodeAt(t)]=t;ys["-".charCodeAt(0)]=62,ys["_".charCodeAt(0)]=63}function As(e){var t,i,r,n,o;bs||ws();var s=e.length;if(0<s%4)throw new Error("Invalid string. Length must be a multiple of 4");n="="===e[s-2]?2:"="===e[s-1]?1:0,o=new xs(3*s/4-n),i=0<n?s-4:s;var a=0;for(t=0;t<i;t+=4,3)r=ys[e.charCodeAt(t)]<<18|ys[e.charCodeAt(t+1)]<<12|ys[e.charCodeAt(t+2)]<<6|ys[e.charCodeAt(t+3)],o[a++]=r>>16&255,o[a++]=r>>8&255,o[a++]=255&r;return 2==n?(r=ys[e.charCodeAt(t)]<<2|ys[e.charCodeAt(t+1)]>>4,o[a++]=255&r):1==n&&(r=ys[e.charCodeAt(t)]<<10|ys[e.charCodeAt(t+1)]<<4|ys[e.charCodeAt(t+2)]>>2,o[a++]=r>>8&255,o[a++]=255&r),o}function Ts(e,t,i){for(var r,n,o=[],s=t;s<i;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(gs[(n=r)>>18&63]+gs[n>>12&63]+gs[n>>6&63]+gs[63&n]);return o.join("")}function ks(e){var t;bs||ws();for(var i=e.length,r=i%3,n="",o=[],s=0,a=i-r;s<a;s+=16383)o.push(Ts(e,s,a<s+16383?a:s+16383));return 1==r?(t=e[i-1],n+=gs[t>>2],n+=gs[t<<4&63],n+="=="):2==r&&(t=(e[i-2]<<8)+e[i-1],n+=gs[t>>10],n+=gs[t>>4&63],n+=gs[t<<2&63],n+="="),o.push(n),o.join("")}function Es(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,u=l>>1,c=-7,h=i?n-1:0,f=i?-1:1,d=e[t+h];for(h+=f,o=d&(1<<-c)-1,d>>=-c,c+=a;0<c;o=256*o+e[t+h],h+=f,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;0<c;s=256*s+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=u}return(d?-1:1)*s*Math.pow(2,o-r)}function Ms(e,t,i,r,n,o){var s,a,l,u=8*o-n-1,c=(1<<u)-1,h=c>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,_=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),2<=(t+=1<=s+h?f/l:f*Math.pow(2,1-h))*l&&(s++,l/=2),c<=s+h?(a=0,s=c):1<=s+h?(a=(t*l-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));8<=n;e[i+d]=255&a,d+=_,a/=256,n-=8);for(s=s<<n|a,u+=n;0<u;e[i+d]=255&s,d+=_,s/=256,u-=8);e[i+d-_]|=128*p}var Rs={}.toString,Ss=Array.isArray||function(e){return"[object Array]"==Rs.call(e)};Os.TYPED_ARRAY_SUPPORT=void 0===ms.TYPED_ARRAY_SUPPORT||ms.TYPED_ARRAY_SUPPORT;var zs=Ps();function Ps(){return Os.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Ns(e,t){if(Ps()<t)throw new RangeError("Invalid typed array length");return Os.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Os.prototype:(null===e&&(e=new Os(t)),e.length=t),e}function Os(e,t,i){if(!(Os.TYPED_ARRAY_SUPPORT||this instanceof Os))return new Os(e,t,i);if("number"!=typeof e)return Ls(this,e,t,i);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Cs(this,e)}function Ls(e,t,i,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,r){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===i&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,i):new Uint8Array(t,i,r);Os.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Os.prototype:e=Fs(e,t);return e}(e,t,i,r):"string"==typeof t?function(e,t,i){"string"==typeof i&&""!==i||(i="utf8");if(!Os.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|js(t,i),n=(e=Ns(e,r)).write(t,i);n!==r&&(e=e.slice(0,n));return e}(e,t,i):function(e,t){if(Us(t)){var i=0|Ds(t.length);return 0===(e=Ns(e,i)).length||t.copy(e,0,0,i),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?Ns(e,0):Fs(e,t);if("Buffer"===t.type&&Ss(t.data))return Fs(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Is(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Cs(e,t){if(Is(t),e=Ns(e,t<0?0:0|Ds(t)),!Os.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function Fs(e,t){var i=t.length<0?0:0|Ds(t.length);e=Ns(e,i);for(var r=0;r<i;r+=1)e[r]=255&t[r];return e}function Ds(e){if(e>=Ps())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Ps().toString(16)+" bytes");return 0|e}function Us(e){return!(null==e||!e._isBuffer)}function js(e,t){if(Us(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return la(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return ua(e).length;default:if(r)return la(e).length;t=(""+t).toLowerCase(),r=!0}}function Gs(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function Bs(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=Os.from(t,r)),Us(t))return 0===t.length?-1:Vs(e,t,i,r,n);if("number"==typeof t)return t&=255,Os.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):Vs(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function Vs(e,t,i,r,n){var o,s=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a/=s=2,l/=2,i/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(n){var c=-1;for(o=i;o<a;o++)if(u(e,o)===u(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(a<i+l&&(i=a-l),o=i;0<=o;o--){for(var h=!0,f=0;f<l;f++)if(u(e,o+f)!==u(t,f)){h=!1;break}if(h)return o}return-1}function qs(e,t,i,r){i=Number(i)||0;var n=e.length-i;r?n<(r=Number(r))&&(r=n):r=n;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");o/2<r&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[i+s]=a}return s}function Hs(e,t,i,r){return ca(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function Ys(e,t,i){return 0===t&&i===e.length?ks(e):ks(e.slice(t,i))}function Xs(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var o,s,a,l,u=e[n],c=null,h=239<u?4:223<u?3:191<u?2:1;if(n+h<=i)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[n+1]))&&127<(l=(31&u)<<6|63&o)&&(c=l);break;case 3:o=e[n+1],s=e[n+2],128==(192&o)&&128==(192&s)&&2047<(l=(15&u)<<12|(63&o)<<6|63&s)&&(l<55296||57343<l)&&(c=l);break;case 4:o=e[n+1],s=e[n+2],a=e[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&65535<(l=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)&&l<1114112&&(c=l)}null===c?(c=65533,h=1):65535<c&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),n+=h}return function(e){var t=e.length;if(t<=Ws)return String.fromCharCode.apply(String,e);var i="",r=0;for(;r<t;)i+=String.fromCharCode.apply(String,e.slice(r,r+=Ws));return i}(r)}Os.poolSize=8192,Os._augment=function(e){return e.__proto__=Os.prototype,e},Os.from=function(e,t,i){return Ls(null,e,t,i)},Os.TYPED_ARRAY_SUPPORT&&(Os.prototype.__proto__=Uint8Array.prototype,Os.__proto__=Uint8Array),Os.alloc=function(e,t,i){return function(e,t,i,r){return Is(t),t<=0?Ns(e,t):void 0!==i?"string"==typeof r?Ns(e,t).fill(i,r):Ns(e,t).fill(i):Ns(e,t)}(null,e,t,i)},Os.allocUnsafe=function(e){return Cs(null,e)},Os.allocUnsafeSlow=function(e){return Cs(null,e)},Os.isBuffer=ha,Os.compare=function(e,t){if(!Us(e)||!Us(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,r=t.length,n=0,o=Math.min(i,r);n<o;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0},Os.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Os.concat=function(e,t){if(!Ss(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Os.alloc(0);var i;if(void 0===t)for(i=t=0;i<e.length;++i)t+=e[i].length;var r=Os.allocUnsafe(t),n=0;for(i=0;i<e.length;++i){var o=e[i];if(!Us(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},Os.byteLength=js,Os.prototype._isBuffer=!0,Os.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Gs(this,t,t+1);return this},Os.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Gs(this,t,t+3),Gs(this,t+1,t+2);return this},Os.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Gs(this,t,t+7),Gs(this,t+1,t+6),Gs(this,t+2,t+5),Gs(this,t+3,t+4);return this},Os.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?Xs(this,0,e):function(e,t,i){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Ks(this,t,i);case"utf8":case"utf-8":return Xs(this,t,i);case"ascii":return Zs(this,t,i);case"latin1":case"binary":return Js(this,t,i);case"base64":return Ys(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $s(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},Os.prototype.equals=function(e){if(!Us(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Os.compare(this,e)},Os.prototype.inspect=function(){var e="";return 0<this.length&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(e+=" ... ")),"<Buffer "+e+">"},Os.prototype.compare=function(e,t,i,r,n){if(!Us(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),t<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(n<=r&&i<=t)return 0;if(n<=r)return-1;if(i<=t)return 1;if(this===e)return 0;for(var o=(n>>>=0)-(r>>>=0),s=(i>>>=0)-(t>>>=0),a=Math.min(o,s),l=this.slice(r,n),u=e.slice(t,i),c=0;c<a;++c)if(l[c]!==u[c]){o=l[c],s=u[c];break}return o<s?-1:s<o?1:0},Os.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},Os.prototype.indexOf=function(e,t,i){return Bs(this,e,t,i,!0)},Os.prototype.lastIndexOf=function(e,t,i){return Bs(this,e,t,i,!1)},Os.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||n<i)&&(i=n),0<e.length&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o,s,a,l,u,c,h,f,d,_=!1;;)switch(r){case"hex":return qs(this,e,t,i);case"utf8":case"utf-8":return f=t,d=i,ca(la(e,(h=this).length-f),h,f,d);case"ascii":return Hs(this,e,t,i);case"latin1":case"binary":return Hs(this,e,t,i);case"base64":return l=this,u=t,c=i,ca(ua(e),l,u,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=t,a=i,ca(function(e,t){for(var i,r,n,o=[],s=0;s<e.length&&!((t-=2)<0);++s)i=e.charCodeAt(s),r=i>>8,n=i%256,o.push(n),o.push(r);return o}(e,(o=this).length-s),o,s,a);default:if(_)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),_=!0}},Os.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Ws=4096;function Zs(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(127&e[n]);return r}function Js(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(e[n]);return r}function Ks(e,t,i){var r=e.length;(!t||t<0)&&(t=0),(!i||i<0||r<i)&&(i=r);for(var n="",o=t;o<i;++o)n+=aa(e[o]);return n}function $s(e,t,i){for(var r=e.slice(t,i),n="",o=0;o<r.length;o+=2)n+=String.fromCharCode(r[o]+256*r[o+1]);return n}function Qs(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function ea(e,t,i,r,n,o){if(!Us(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<t||t<o)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function ta(e,t,i,r){t<0&&(t=65535+t+1);for(var n=0,o=Math.min(e.length-i,2);n<o;++n)e[i+n]=(t&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function ia(e,t,i,r){t<0&&(t=4294967295+t+1);for(var n=0,o=Math.min(e.length-i,4);n<o;++n)e[i+n]=t>>>8*(r?n:3-n)&255}function ra(e,t,i,r){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function na(e,t,i,r,n){return n||ra(e,0,i,4),Ms(e,t,i,r,23,4),i+4}function oa(e,t,i,r,n){return n||ra(e,0,i,8),Ms(e,t,i,r,52,8),i+8}Os.prototype.slice=function(e,t){var i,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),Os.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=Os.prototype;else{var n=t-e;i=new Os(n,void 0);for(var o=0;o<n;++o)i[o]=this[o+e]}return i},Os.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||Qs(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return r},Os.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||Qs(e,t,this.length);for(var r=this[e+--t],n=1;0<t&&(n*=256);)r+=this[e+--t]*n;return r},Os.prototype.readUInt8=function(e,t){return t||Qs(e,1,this.length),this[e]},Os.prototype.readUInt16LE=function(e,t){return t||Qs(e,2,this.length),this[e]|this[e+1]<<8},Os.prototype.readUInt16BE=function(e,t){return t||Qs(e,2,this.length),this[e]<<8|this[e+1]},Os.prototype.readUInt32LE=function(e,t){return t||Qs(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Os.prototype.readUInt32BE=function(e,t){return t||Qs(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Os.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||Qs(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return(n*=128)<=r&&(r-=Math.pow(2,8*t)),r},Os.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||Qs(e,t,this.length);for(var r=t,n=1,o=this[e+--r];0<r&&(n*=256);)o+=this[e+--r]*n;return(n*=128)<=o&&(o-=Math.pow(2,8*t)),o},Os.prototype.readInt8=function(e,t){return t||Qs(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Os.prototype.readInt16LE=function(e,t){t||Qs(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},Os.prototype.readInt16BE=function(e,t){t||Qs(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},Os.prototype.readInt32LE=function(e,t){return t||Qs(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Os.prototype.readInt32BE=function(e,t){return t||Qs(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Os.prototype.readFloatLE=function(e,t){return t||Qs(e,4,this.length),Es(this,e,!0,23,4)},Os.prototype.readFloatBE=function(e,t){return t||Qs(e,4,this.length),Es(this,e,!1,23,4)},Os.prototype.readDoubleLE=function(e,t){return t||Qs(e,8,this.length),Es(this,e,!0,52,8)},Os.prototype.readDoubleBE=function(e,t){return t||Qs(e,8,this.length),Es(this,e,!1,52,8)},Os.prototype.writeUIntLE=function(e,t,i,r){e=+e,t|=0,i|=0,r||ea(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,o=0;for(this[t]=255&e;++o<i&&(n*=256);)this[t+o]=e/n&255;return t+i},Os.prototype.writeUIntBE=function(e,t,i,r){e=+e,t|=0,i|=0,r||ea(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,o=1;for(this[t+n]=255&e;0<=--n&&(o*=256);)this[t+n]=e/o&255;return t+i},Os.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,1,255,0),Os.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Os.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,2,65535,0),Os.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):ta(this,e,t,!0),t+2},Os.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,2,65535,0),Os.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):ta(this,e,t,!1),t+2},Os.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,4,4294967295,0),Os.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):ia(this,e,t,!0),t+4},Os.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,4,4294967295,0),Os.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ia(this,e,t,!1),t+4},Os.prototype.writeIntLE=function(e,t,i,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*i-1);ea(this,e,t,i,n-1,-n)}var o=0,s=1,a=0;for(this[t]=255&e;++o<i&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+i},Os.prototype.writeIntBE=function(e,t,i,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*i-1);ea(this,e,t,i,n-1,-n)}var o=i-1,s=1,a=0;for(this[t+o]=255&e;0<=--o&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+i},Os.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,1,127,-128),Os.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Os.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,2,32767,-32768),Os.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):ta(this,e,t,!0),t+2},Os.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,2,32767,-32768),Os.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):ta(this,e,t,!1),t+2},Os.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,4,2147483647,-2147483648),Os.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):ia(this,e,t,!0),t+4},Os.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||ea(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Os.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):ia(this,e,t,!1),t+4},Os.prototype.writeFloatLE=function(e,t,i){return na(this,e,t,!0,i)},Os.prototype.writeFloatBE=function(e,t,i){return na(this,e,t,!1,i)},Os.prototype.writeDoubleLE=function(e,t,i){return oa(this,e,t,!0,i)},Os.prototype.writeDoubleBE=function(e,t,i){return oa(this,e,t,!1,i)},Os.prototype.copy=function(e,t,i,r){if(i||(i=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),0<r&&r<i&&(r=i),r===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-i&&(r=e.length-t+i);var n,o=r-i;if(this===e&&i<t&&t<r)for(n=o-1;0<=n;--n)e[n+t]=this[n+i];else if(o<1e3||!Os.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)e[n+t]=this[n+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+o),t);return o},Os.prototype.fill=function(e,t,i,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Os.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var o;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(o=t;o<i;++o)this[o]=e;else{var s=Us(e)?e:la(new Os(e,r).toString()),a=s.length;for(o=0;o<i-t;++o)this[o+t]=s[o%a]}return this};var sa=/[^+\/0-9A-Za-z-_]/g;function aa(e){return e<16?"0"+e.toString(16):e.toString(16)}function la(e,t){var i;t=t||1/0;for(var r=e.length,n=null,o=[],s=0;s<r;++s){if(55295<(i=e.charCodeAt(s))&&i<57344){if(!n){if(56319<i){-1<(t-=3)&&o.push(239,191,189);continue}if(s+1===r){-1<(t-=3)&&o.push(239,191,189);continue}n=i;continue}if(i<56320){-1<(t-=3)&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&-1<(t-=3)&&o.push(239,191,189);if(n=null,i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function ua(e){return As(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(sa,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function ca(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}function ha(e){return null!=e&&(!!e._isBuffer||fa(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&fa(e.slice(0,0))}(e))}function fa(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var da=Object.freeze({INSPECT_MAX_BYTES:50,kMaxLength:zs,Buffer:Os,SlowBuffer:function(e){return+e!=e&&(e=0),Os.alloc(+e)},isBuffer:ha});ms.setTimeout,ms.clearTimeout;var _a=ms.performance||{},pa=(_a.now||_a.mozNow||_a.msNow||_a.oNow||_a.webkitNow,"function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e});function va(e,t){var i={seen:[],stylize:ga};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),wa(t)?i.showHidden=t:t&&function(e,t){if(!t||!Ma(t))return;var i=Object.keys(t),r=i.length;for(;r--;)e[i[r]]=t[i[r]]}(i,t),ka(i.showHidden)&&(i.showHidden=!1),ka(i.depth)&&(i.depth=2),ka(i.colors)&&(i.colors=!1),ka(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=ma),ya(i,e,i.depth)}function ma(e,t){var i=va.styles[t];return i?"\x1b["+va.colors[i][0]+"m"+e+"\x1b["+va.colors[i][1]+"m":e}function ga(e,t){return e}function ya(t,i,r){if(t.customInspect&&i&&za(i.inspect)&&i.inspect!==va&&(!i.constructor||i.constructor.prototype!==i)){var e=i.inspect(r,t);return Ta(e)||(e=ya(t,e,r)),e}var n=function(e,t){if(ka(t))return e.stylize("undefined","undefined");if(Ta(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}if(function(e){return"number"==typeof e}(t))return e.stylize(""+t,"number");if(wa(t))return e.stylize(""+t,"boolean");if(Aa(t))return e.stylize("null","null")}(t,i);if(n)return n;var o=Object.keys(i),s=function(e){var t={};return e.forEach(function(e){t[e]=!0}),t}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(i)),Sa(i)&&(0<=o.indexOf("message")||0<=o.indexOf("description")))return xa(i);if(0===o.length){if(za(i)){var a=i.name?": "+i.name:"";return t.stylize("[Function"+a+"]","special")}if(Ea(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(Ra(i))return t.stylize(Date.prototype.toString.call(i),"date");if(Sa(i))return xa(i)}var l,u="",c=!1,h=["{","}"];!function(e){return Array.isArray(e)}(i)||(c=!0,h=["[","]"]),za(i)&&(u=" [Function"+(i.name?": "+i.name:"")+"]");return Ea(i)&&(u=" "+RegExp.prototype.toString.call(i)),Ra(i)&&(u=" "+Date.prototype.toUTCString.call(i)),Sa(i)&&(u=" "+xa(i)),0!==o.length||c&&0!=i.length?r<0?Ea(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),l=c?function(t,i,r,n,e){for(var o=[],s=0,a=i.length;s<a;++s)Oa(i,String(s))?o.push(ba(t,i,r,n,String(s),!0)):o.push("");return e.forEach(function(e){e.match(/^\d+$/)||o.push(ba(t,i,r,n,e,!0))}),o}(t,i,r,s,o):o.map(function(e){return ba(t,i,r,s,e,c)}),t.seen.pop(),function(e,t,i){if(60<e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0))return i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1];return i[0]+t+" "+e.join(", ")+" "+i[1]}(l,u,h)):h[0]+u+h[1]}function xa(e){return"["+Error.prototype.toString.call(e)+"]"}function ba(e,t,i,r,n,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),Oa(r,n)||(s="["+n+"]"),a||(e.seen.indexOf(l.value)<0?-1<(a=Aa(i)?ya(e,l.value,null):ya(e,l.value,i-1)).indexOf("\n")&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),ka(s)){if(o&&n.match(/^\d+$/))return a;s=(s=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(s,"string"))}return s+": "+a}function wa(e){return"boolean"==typeof e}function Aa(e){return null===e}function Ta(e){return"string"==typeof e}function ka(e){return void 0===e}function Ea(e){return Ma(e)&&"[object RegExp]"===Na(e)}function Ma(e){return"object"==typeof e&&null!==e}function Ra(e){return Ma(e)&&"[object Date]"===Na(e)}function Sa(e){return Ma(e)&&("[object Error]"===Na(e)||e instanceof Error)}function za(e){return"function"==typeof e}function Pa(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function Na(e){return Object.prototype.toString.call(e)}function Oa(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function La(e,t){if(e===t)return 0;for(var i=e.length,r=t.length,n=0,o=Math.min(i,r);n<o;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0}va.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},va.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var Ia,Ca=Object.prototype.hasOwnProperty,Fa=Object.keys||function(e){var t=[];for(var i in e)Ca.call(e,i)&&t.push(i);return t},Da=Array.prototype.slice;function Ua(){return void 0!==Ia?Ia:Ia="foo"===function(){}.name}function ja(e){return Object.prototype.toString.call(e)}function Ga(e){return!ha(e)&&("function"==typeof ms.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}function Ba(e,t){e||Wa(e,!0,t,"==",Za)}var Va=/\s*function\s+([^\(\s]*)\s*/;function qa(e){if(za(e)){if(Ua())return e.name;var t=e.toString().match(Va);return t&&t[1]}}function Ha(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return Ya(Xa(e.actual),128)+" "+e.operator+" "+Ya(Xa(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||Wa;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var i=new Error;if(i.stack){var r=i.stack,n=qa(t),o=r.indexOf("\n"+n);if(0<=o){var s=r.indexOf("\n",o+1);r=r.substring(s+1)}this.stack=r}}}function Ya(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function Xa(e){if(Ua()||!za(e))return va(e);var t=qa(e);return"[Function"+(t?": "+t:"")+"]"}function Wa(e,t,i,r,n){throw new Ha({message:i,actual:e,expected:t,operator:r,stackStartFunction:n})}function Za(e,t){e||Wa(e,!0,t,"==",Za)}function Ja(e,t,i,r){if(e===t)return!0;if(ha(e)&&ha(t))return 0===La(e,t);if(Ra(e)&&Ra(t))return e.getTime()===t.getTime();if(Ea(e)&&Ea(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(Ga(e)&&Ga(t)&&ja(e)===ja(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===La(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(ha(e)!==ha(t))return!1;var n=(r=r||{actual:[],expected:[]}).actual.indexOf(e);return-1!==n&&n===r.expected.indexOf(t)||(r.actual.push(e),r.expected.push(t),function(e,t,i,r){if(null==e||null==t)return!1;if(Pa(e)||Pa(t))return e===t;if(i&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var n=Ka(e),o=Ka(t);if(n&&!o||!n&&o)return!1;if(n)return e=Da.call(e),t=Da.call(t),Ja(e,t,i);var s,a,l=Fa(e),u=Fa(t);if(l.length!==u.length)return!1;for(l.sort(),u.sort(),a=l.length-1;0<=a;a--)if(l[a]!==u[a])return!1;for(a=l.length-1;0<=a;a--)if(s=l[a],!Ja(e[s],t[s],i,r))return!1;return!0}(e,t,i,r))}return i?e===t:e==t}function Ka(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function $a(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function Qa(e,t,i,r){var n;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(r=i,i=null),n=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(i&&i.name?" ("+i.name+").":".")+(r?" "+r:"."),e&&!n&&Wa(n,i,"Missing expected exception"+r);var o="string"==typeof r,s=!e&&n&&!i;if((!e&&Sa(n)&&o&&$a(n,i)||s)&&Wa(n,i,"Got unwanted exception"+r),e&&n&&i&&!$a(n,i)||!e&&n)throw n}pa(Ba.AssertionError=Ha,Error),Ba.fail=Wa,Ba.ok=Za,Ba.equal=function e(t,i,r){t!=i&&Wa(t,i,r,"==",e)},Ba.notEqual=function e(t,i,r){t==i&&Wa(t,i,r,"!=",e)},Ba.deepEqual=function e(t,i,r){Ja(t,i,!1)||Wa(t,i,r,"deepEqual",e)},Ba.deepStrictEqual=function e(t,i,r){Ja(t,i,!0)||Wa(t,i,r,"deepStrictEqual",e)},Ba.notDeepEqual=function e(t,i,r){Ja(t,i,!1)&&Wa(t,i,r,"notDeepEqual",e)},Ba.notDeepStrictEqual=function e(t,i,r){Ja(t,i,!0)&&Wa(t,i,r,"notDeepStrictEqual",e)},Ba.strictEqual=function e(t,i,r){t!==i&&Wa(t,i,r,"===",e)},Ba.notStrictEqual=function e(t,i,r){t===i&&Wa(t,i,r,"!==",e)},Ba.throws=function(e,t,i){Qa(!0,e,t,i)},Ba.doesNotThrow=function(e,t,i){Qa(!1,e,t,i)},Ba.ifError=function(e){if(e)throw e};function el(){}var tl={sort:function(e){return e.sort(function(e,t){return e.height-t.height}),e},placeItems:function(e){var t=0;return e.forEach(function(e){e.x=0,e.y=t,t+=e.height}),e}},il={sort:function(e){return e.sort(function(e,t){return e.width-t.width}),e},placeItems:function(e){var t=0;return e.forEach(function(e){e.x=t,e.y=0,t+=e.width}),e}},rl={sort:function(e){return e.sort(function(e,t){return Math.sqrt(Math.pow(e.height,2)+Math.pow(e.width,2))-Math.sqrt(Math.pow(t.height,2)+Math.pow(t.width,2))}),e},placeItems:function(e){var t=0,i=0;return e.forEach(function(e){e.x=t,e.y=i,t+=e.width,i+=e.height}),e}},nl={sort:function(e){return e.sort(function(e,t){return Math.sqrt(Math.pow(e.height,2)+Math.pow(e.width,2))-Math.sqrt(Math.pow(t.height,2)+Math.pow(t.width,2))}),e},placeItems:function(e){var i=0,r=0;return e.forEach(function(e){var t=e.width;e.x=i-t,e.y=r,i-=t,r+=e.height}),e}};el.prototype={fit:function(e){var t,i,r,n,o=e.length,s=0<o?e[0].width:0,a=0<o?e[0].height:0;for(this.root={x:0,y:0,width:s,height:a},t=0;t<o;t++)r=e[t],n=(i=this.findNode(this.root,r.width,r.height))?this.splitNode(i,r.width,r.height):this.growNode(r.width,r.height),r.x=n.x,r.y=n.y},findNode:function(e,t,i){return e.used?this.findNode(e.right,t,i)||this.findNode(e.down,t,i):t<=e.width&&i<=e.height?e:null},splitNode:function(e,t,i){return e.used=!0,e.down={x:e.x,y:e.y+i,width:e.width,height:e.height-i},e.right={x:e.x+t,y:e.y,width:e.width-t,height:i},e},growNode:function(e,t){var i=e<=this.root.width,r=t<=this.root.height,n=r&&this.root.height>=this.root.width+e,o=i&&this.root.width>=this.root.height+t;return n?this.growRight(e,t):o?this.growDown(e,t):r?this.growRight(e,t):i?this.growDown(e,t):null},growRight:function(e,t){var i;return this.root={used:!0,x:0,y:0,width:this.root.width+e,height:this.root.height,down:this.root,right:{x:this.root.width,y:0,width:e,height:this.root.height}},(i=this.findNode(this.root,e,t))?this.splitNode(i,e,t):null},growDown:function(e,t){var i;return this.root={used:!0,x:0,y:0,width:this.root.width,height:this.root.height+t,down:{x:0,y:this.root.height,width:this.root.width,height:t},right:this.root},(i=this.findNode(this.root,e,t))?this.splitNode(i,e,t):null}};var ol=el,sl={sort:function(e){return e},placeItems:function(e){return function(e,t){t=t||{};var i=new ol,r=t.inPlace||!1,n=e.map(function(e){return r?e:{width:e.width,height:e.height,item:e}});n=n.sort(function(e,t){return t.width*t.height-e.width*e.height}),i.fit(n);var o={width:n.reduce(function(e,t){return Math.max(e,t.x+t.width)},0),height:n.reduce(function(e,t){return Math.max(e,t.y+t.height)},0)};r||(o.items=n)}(e,{inPlace:!0}),e}},al={};function ll(e,t){var i=e||"top-down";return"string"==typeof i&&Ba(i=al[e],"Sorry, the '"+e+"' algorithm could not be loaded."),new vs(i,t)}function ul(e,t){al[e]=t}ll.PackingSmith=vs,ll.addAlgorithm=ul,ll.algorithms=al,ul("top-down",tl),ul("left-right",il),ul("diagonal",rl),ul("alt-diagonal",nl),ul("binary-tree",sl);var cl=ll;function hl(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++){var i=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if(i)for(var r in i){var n=i[r];null===n||"object"!==vr(n)||Array.isArray(n)?void 0!==n&&(e[r]=n):null===e[r]||"object"!==vr(e[r])||Array.isArray(e[r])?e[r]=hl({},n):e[r]=hl(e[r],n)}}return e}function fl(e){var t;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=e.message}return t}function dl(e,t,i){if(e instanceof HTMLImageElement){var r=e.ownerDocument.createElement("canvas");r.width=t,r.height=i,r.getContext("2d").drawImage(e,0,0,t,i),e=r}return e}var _l,pl={};(function(){var n=this;function a(e){var t=vr(e);if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var i=Object.prototype.toString.call(e);if("[object Window]"==i)return"object";if("[object Array]"==i||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==i||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t}function l(e){var t=vr(e);return"object"==t&&null!=e||"function"==t}function e(e,t){e=e.split(".");var i,r=n;e[0]in r||!r.execScript||r.execScript("var "+e[0]);for(;e.length&&(i=e.shift());)e.length||void 0===t?r=r[i]&&r[i]!==Object.prototype[i]?r[i]:r[i]={}:r[i]=t}function t(e,o){function t(){}t.prototype=o.prototype,e.ma=o.prototype,e.prototype=new t,(e.prototype.constructor=e).ta=function(e,t,i){for(var r=Array(arguments.length-2),n=2;n<arguments.length;n++)r[n-2]=arguments[n];return o.prototype[t].apply(e,r)}}var i=Math,f=i.min,d=i.max,r=i.round,o=i.floor,s=i.ceil,c=i.abs,h=i.log,u=i.sqrt,_=i.pow,p=i.sin,v=i.asin,m=i.cos,g=i.tan,y=i.atan2,x=i.PI,b=x/2,w=x/4,A=2*x,T=3*x,k=x/180,E=180/x;function M(e,t,i){return i<e?i:e<t?t:e}function R(e,t,i,r){return r||(r=0),t<i?t-r<=e&&e<=i+r:i-r<=e&&e<=t+r}function S(e,t,i,r,n,o){return u(_((e-n)*(r-o)-(t-o)*(i-n),2)/(_(i-n,2)+_(r-o,2)))}function z(e,t,i,r,n){for(var o,s,a,l=i.length,u=l,c=i[0],h=0,f=0,d=0,_=r/2||0,p=n?1:3;1!=h&&p<u;)o=i[--u],r=i[--u],a=i[u?u-1:(l+(u-1))%l],s=i[u?u-2:(l+(u-2))%l],e-_<=r&&r<=e+_&&t-_<=o&&o<=t+_||e-_<=s&&s<=e+_&&t-_<=a&&a<=t+_?h=1:h||r!==e?!h&&R(e,r,s,_)&&((r<e&&e<s||e<r&&s<e)&&(f+=t<(c=o+(e-r)/(s-r)*(a-o)),d+=c<t),h=R(t,o,a,_)&&S(e,t,r,o,s,a)<=_?2:0):(s===e&&(o<t&&t<a||t<o&&a<t)||(c<=e&&e<s||e<=c&&s<e)&&(t<=o?++f:++d),h=R(t,o,a,_)&&S(e,t,r,o,s,a)<=_?2:0),c=r;return!h&&n&&0!==d&&0!=f%2&&(h=3),h}function P(e,t){this.x=+e,this.y=+t}function N(e,t,i,r,n,o,s,a,l,u){return e={x:e,y:t,next:i||null,m:r||null,la:n||null,O:o||null,l:s||0,L:a||0,J:l||0,alpha:u||0},r&&(e.m.next=e),i&&(e.next.m=e),e}function O(e){for(;e&&e.l;)e=e.next;return e}function L(e){if(e)for(;e.next;)e=e.next;return e}function I(e){var t=e;if(t)for(;(t=t.next)!=e&&(!t.l||t.l&&t.J););return t}function C(e){var t=L(e);(t.m.next=e).m=t.m}function F(e,t,i,r,n){var o,s=t.x-e.x,a=t.y-e.y,l=r.x-i.x,u=r.y-i.y,c=s*u-a*l;return c?(l=((i.x-e.x)*u-(i.y-e.y)*l)/c,c=(a*(i.x-e.x)-s*(i.y-e.y))/c,l<0||1<l||c<0||1<c?0:(0===l?o=e:1===l?o=t:0===c?o=i:1===c&&(o=r),o?(o.x+=2480549651603763e-20,o.y+=7321997314118067e-20,o.H&&(o.H.x=o.x,o.H.y=o.y),F(e,t,i,r,n)):(n.oa=e.x+l*s,n.pa=e.y+l*a,n.aa=l,n.ba=c,1))):0}function D(e,t){var i=[];if(Array.isArray(t))i=t.reduce(function(e,t){return e.push(t.x,t.y),e},i);else for(;t;)i.push(t.x,t.y),t=t.next;return 0===z(e.x,e.y,i,0,!0)?0:1}function U(e,t,i){for(t=t.next;t!==i&&t.alpha<=e.alpha;)t=t.next;e.next=t,e.m=t.m,(e.next.m=e).m.next=e}function j(e){for(var t,i=null,r=0,n=e.length;r<n;r++)((t=N(e[r].x,e[r].y,i)).next=i)&&(i.m=t),i=t;return i}function G(e,t,i,r){return(e-=i)*e+(t-=r)*t}e("H.math.normalize",function(e,t,i){return t-=i=i||0,(e-=i)-o(e/t)*t+i}),e("H.math.clamp",M),e("H.math.CoverType",{NONE:0,sa:1,qa:2,ra:3}),e("H.math.isCoveredBy",z),e("H.math.Point",P),P.prototype.set=P.prototype.set=P,P.prototype.clone=P.prototype.clone=function(e){return e?(e.x=this.x,e.y=this.y):e=new P(this.x,this.y),e},P.prototype.add=P.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},P.prototype.sub=P.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},P.prototype.scale=P.prototype.scale=function(e,t){return this.x*=e,this.y*=void 0===t?e:t,this},P.prototype.round=P.prototype.round=function(){return this.x=r(this.x),this.y=r(this.y),this},P.prototype.floor=P.prototype.floor=function(){return this.x=o(this.x),this.y=o(this.y),this},P.prototype.ceil=P.prototype.ceil=function(){return this.x=s(this.x),this.y=s(this.y),this},P.prototype.equals=P.prototype.w=function(e){return!(!e||this.x!==e.x||this.y!==e.y)},P.prototype.getNearest=P.prototype.ea=function(e,t){var i=t.x-e.x,r=t.y-e.y,n=e;if(i||r){var o=((this.x-e.x)*i+(this.y-e.y)*r)/(i*i+r*r);n=o<=0?e:1<=o?t:new P(e.x+o*i,e.y+o*r)}return n},P.prototype.distance=P.prototype.K=function(e){return u(_(this.x-e.x,2)+_(this.y-e.y,2))},P.fromIPoint=function(e){if(!e)throw Error("invalid argument");return e instanceof P?e:new P(e.x,e.y)},e("H.math.clipping.clipPolygon",function(e,t,i){var r,n;e=j(e),t=j(t);var o={},s=r=1;switch(~~(i||0)){case 1:s=r=0;break;case 2:r=0,s=1;break;case 3:r=1,s=0}i=r;var a=s;if(t&&e){for(t.H=N(t.x,t.y,null,L(t)),e.H=N(e.x,e.y,null,L(e)),s=t;s.next;s=s.next)if(!s.l)for(r=e;r.next;r=r.next)if(!r.l){var l=O(s.next),u=O(r.next);if(n=F(s,l,r,u,o)){n=o.aa;var c=o.ba,h=o.oa,f=o.pa;U(n=N(h,f,null,null,null,null,1,0,0,n),s,l),U(l=N(h,f,null,null,null,null,1,0,0,c),r,u),(n.O=l).O=n}}for(o=D(t,e),i&&(o=1-o),s=t;s;s=s.next)s.l&&(o=1-(s.L=o));for(o=D(e,t),a&&(o=1-o),r=e;r.next;r=r.next)r.l&&(o=1-(r.L=o));for(C(t),C(e);(e=I(t))!=t;){for(i=null;!e.J;e=e.O){for(o=e.L;i=N(e.x,e.y,i),e.J=1,e=o?e.next:e.m;)if(e.l){e.J=1;break}if(!e)break}i.la=d;var d=i}return d}}),e("H.math.simplifyDP",function(e,t,i){return function e(t,i,r,n,o){var s=0,a=n,l=t[n].x,u=t[n].y,c=t[o].x,h=t[o].y,f=n+1,d=G(l,u,c,h);if(d)for(;f<o;){var _=t[f++],p=_.x;_=_.y;var v=((p-l)*(c-l)+(_-u)*(h-u))/d;p=v<0?G(p,_,l,u):1<v?G(p,_,c,h):G(p,_,l+v*(c-l),u+v*(h-u)),s<p&&(s=p,a=f-1)}else for(;f<o;)_=t[f++],p=_.x,_=_.y,p=G(p,_,l,u),s<p&&(s=p,a=f-1);n=i<=s||0<r&&a-n?(--r,1<a-n?(n=e(t,i,r,n,a),n.splice(n.length-1,1)):n=[t[n]],1<o-a?n.concat(e(t,i,r,a,o)):n.concat(t.slice(a,o+1))):[t[n],t[o]];return n}(e,t*t,i||0,0,e.length-1)});var B=this,V=String,H=self.eval("undefined"),q=self.eval("null"),Y="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function X(e,t){if(!0==(e instanceof t&&e.constructor===t))throw new TypeError("Illegal constructor "+K(t))}e("H.lang.isObject",l),e("H.lang.isEmptyObject",function(e){for(var t in e)return!1;return!0}),e("H.lang.isArray",function(e,t,i,r){var n;if(!(n="Array"===Z(e))&&t)throw new ie(t,i,r!==H?r:e);return n}),e("H.lang.isString",function(e){return"string"==typeof e});var W=isNaN;function Z(e){var t=Object[Y[0]][Y[6]].call(e).match(/^\[object (\w+)\]$/);return t?t[1]:vr(e)}e("H.lang.isNumber",function(e){return e===+e});var J=[];function K(i,e,r,n){var o,s="",t=arguments.length<2;return t&&(e={H:B.H},r="",n=J.slice()),ee(e,!0,function(e,t){try{if(t=function(e,i){var r=[];return ee(e,!1,function(e,t){e[t]===i&&r.push(t)}),r.sort($)[0]}(e,o=e[t]),!(l(o)&&o.window===o&&o.self===o||l(o)&&0<o.nodeType&&"function"==a(o.cloneNode))&&l(o)){if(o===i)return s=r+"."+t,!0;if(n.indexOf(o)<0&&(n.push(o),s=K(i,o,r+"."+t,n)))return!0}}catch(e){}}),t&&(s=s?s.substr(1).replace("."+Y[0]+".","#"):"~"+("function"==a(i)?function(e){return(e=/^\s*function ([^\( ]+)/.exec(e))?e[1]:"anonymous"}(i)+"()":Z(i))),s}function $(e,t){return t.length-e.length}J.indexOf(J)<0&&J.push(J);var Q=Object[Y[0]][Y[2]];function ee(e,t,i){var r;if(e){for(n in e)if((!t||Q.call(e,n))&&i(e,n,!0))return;for(r=Y.length;r--;){var n=Y[r];if((!t||Q.call(e,n))&&i(e,n,!1))break}}}function te(e,t,i){i[t]="#"+t}function ie(e,t,i){var r,n=arguments.length;t=1<n?+t:t,n=2<n?V(i):"",t!==H&&((r=(r=/^.*?\(([^\)]+)/.exec((""+e).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?(r=r[1].replace(/\s+/g,""),V(r).split(","!==H?",":" ")):[]).forEach(te),r=r[t]||"#"+t),this.message=(e?K(e):"")+(r||n?" (":"")+(r?"Argument "+r:"")+(n?(r?" ":"")+n:"")+(r||n?")":""),this.stack=Error().stack}e("H.lang.InvalidArgumentError",ie),(ie.prototype=Error()).name="InvalidArgumentError";var re={undefined:"GL",GL:"GL",OL:"OL",SL:"SL",SB:"SB",WE:"WE",WG:"WG"};function ne(e,t,i){var r=M(+e,-90,90);if(t&&W(r))throw new ie(t,i,e);return r}function oe(e,t,i){var r,n=+e;(n<-180||180<n)&&(n=(!1==(r=(n+180)%360)<0?r:360+r)-180);if(t&&W(n))throw new ie(t,i,e);return n}function se(e,t,i){var r;if(e!==H&&W(r=+e)&&t)throw new ie(t,i,e);return r}function ae(e,t,i){var r=!re[e];if(t&&r)throw new ie(t,i,e);return!r}function le(){X(this,le)}function ue(e,t,i,r){this.lat=ne(e,ue,0),this.lng=oe(t,ue,1),i!==H&&(this.alt=se(i,ue,2)),r!==H&&ae(r,ue,3)&&(this.ctx=r)}function ce(e,t,i){var r=!!e&&!(W(e.lat=ne(e.lat))||W(e.lng=oe(e.lng))||e.alt!==H&&W(e.alt=se(e.alt))||e.ctx!==H&&!ae(e.ctx));if(!r&&t)throw new ie(t,i,e);return r}function he(e,t,i,r){fe(this,ne(e,he,0),oe(t,he,1),ne(i,he,2),oe(r,he,3))}function fe(e,t,i,r,n){return e.c=i,e.g=n,t<r&&(i=t,t=r,r=i),e.i=t,e.h=r,e.f=e.a=e.b=null,e}function de(e,t){return(e=t-e)+(e<0?360:0)}function _e(e,t){return(e+=t/2)-(180<e?360:0)}function pe(e,t,i,r,n,o,s,a,l){i=f(i,s),e=d(e,n);var u=_e(t,n=de(t,r)),c=_e(o,s=de(o,a))-u;if((c+=c-1e-6<0?360:0)-1e-6<180){u=t;var h=a}else c=360-c,u=o,h=r;return 360<=(c=c+n/2+s/2)+5e-7?(u=-180,h=180):c-5e-7<n?(u=t,h=r):c-5e-7<s&&(u=o,h=a),l?fe(l,e,u,i,h):new he(e,u,i,h)}function ve(e,t,i){return i||(ce(e,ve,0),ce(t,ve,1)),new he(e.lat,e.lng,t.lat,t.lng)}function me(e,t,i,r,n,o){X(this,me),this.ka=e||10,this.f=this.b=null,this.j=r||0,this.o=n||0,this.C=t||1,this.S=i||1,this.U=!!o,((e=new we(null,NaN,this.j-this.C,this.o-this.S,this.j+this.C,this.o+this.S)).b=this).a=this.b=e,this.f=null}e("H.geo.AltitudeContext",re),e("H.geo.isDBC",function(e,t){return 0!=(e<0^t<0)&&180<c(t-e)}),e("H.geo.AbstractGeometry",le),le.prototype.getBoundingBox=le.prototype.D,le.prototype.equals=le.prototype.w,le.prototype.j="",le.prototype.toString=le.prototype.toString=function(){return this.o([this.j.toUpperCase()," "]).join("")},t(ue,le),e("H.geo.Point",ue),ue.prototype.equals=ue.prototype.w=function(e){return this===e||!!e&&this.lat===e.lat&&this.lng===e.lng&&re[this.ctx]===re[e.ctx]&&(this.alt||0)===(e.alt||0)},ue.prototype.distance=ue.prototype.K=function(e){if(this===e||this.lat===e.lat&&this.lng===e.lng)e=0;else{var t=this.lat*k,i=e.lat*k;e=12742001.58*v(f(1,u(_(p((t-i)/2),2)+m(t)*m(i)*_(p((this.lng*k-e.lng*k)/2),2))))}return e},ue.prototype.walk=ue.prototype.na=function(e,t,i){if(i){if(t/=6371000.79){e*=k;var r=k*this.lat,n=p(r),o=p(t),s=m(t),a=k*this.lng,l=m(r);r=v(l*m(e)*o+n*s),l=(e=(a+(e=y(p(e)*l*o,s-n*p(r)))+x)%(2*x)-x)*E}return t?new ue(r*E,(l+540)%360-180):this}if(0==((e=(e%360+360)%360)+90)%180)return r=this.lng+t/(6371000.79*A*m(this.lat*k))*(270===e?-360:360),new ue(this.lat,(r+540)%360-180);if(t/=6371000.79){e*=k,a=this.lat*k,n=this.lng*k,s=(o=a+t*m(e))-a,r=h(g(o/2+w)/g(a/2+w)),r=W(s/r)?m(a):s/r;var u=t*p(e)/r;c(o)>b&&(o=0<o?x-o:-(x+o))}return t?new ue(o*E,((n+u+T+(c(a+s)>b?x:0))%A-x)*E):this},ue.prototype.getBoundingBox=ue.prototype.D=function(){return new he(this.lat,this.lng,this.lat,this.lng)},ue.validate=ce,ue.fromIPoint=function e(t){if(!t)throw new ie(e,0,t);return new ue(t.lat,t.lng,t.alt,t.ctx)},ue.prototype.j="Point",ue.prototype.o=function(e){return e.push("(",this.lng," ",this.lat,")"),e},t(he,le),e("H.geo.Rect",he),he.prototype.j="Polygon",he.prototype.o=function(e){var t=this.i,i=this.c,r=this.h,n=this.g;return e.push("(","(",i," ",t,",",n," ",t,",",n," ",r,",",i," ",r,",",i," ",t,")",")"),e},he.prototype.equals=he.prototype.w=function(e){return this===e||!!e&&this.i===e.i&&this.c===e.c&&this.h===e.h&&this.g===e.g},he.prototype.clone=he.prototype.clone=function(){return new he(this.i,this.c,this.h,this.g)},he.prototype.getTopLeft=he.prototype.N=function(){return this.f||(this.f=new ue(this.i,this.c)),this.f},he.prototype.getBottomRight=he.prototype.M=function(){return this.a||(this.a=new ue(this.h,this.g)),this.a},he.prototype.getTop=he.prototype.ga=function(){return this.i},he.prototype.getBottom=he.prototype.ca=function(){return this.h},he.prototype.getLeft=he.prototype.da=function(){return this.c},he.prototype.getRight=he.prototype.fa=function(){return this.g},he.prototype.getCenter=he.prototype.A=function(){return this.b||(this.b=new ue(this.h+(this.i-this.h)/2,_e(this.c,this.s()))),this.b},he.prototype.getWidth=he.prototype.s=function(){return de(this.c,this.g)},he.prototype.getHeight=he.prototype.B=function(){return this.i-this.h},he.prototype.isCDB=he.prototype.I=function(){return this.c>this.g},he.prototype.isEmpty=he.prototype.ja=function(){return!this.s()&&!this.B()},he.prototype.getBoundingBox=he.prototype.D=function(){return new he(this.i,this.c,this.h,this.g)},he.prototype.containsLatLng=he.prototype.G=function(e,t,i){var r=this.A();return i||(e=ne(e,this.G,0),t=oe(t,this.G,1)),(e=(t=this.u(e,t,i)).A()).lat===r.lat&&e.lng===r.lng&&this.B()===t.B()&&this.s()===t.s()},he.prototype.containsPoint=he.prototype.P=function(e,t){return t||ce(e,this.P,0),this.G(e.lat,e.lng,t)},he.prototype.containsRect=he.prototype.R=function(e,t){var i=this.A();if(!(t||e instanceof he))throw new ie(this.R,0,e);return(e=(t=this.F(e,t)).A()).lat===i.lat&&e.lng===i.lng&&this.B()===t.B()&&this.s()===t.s()},he.prototype.mergeLatLng=he.prototype.u=function(e,t,i,r){if(!i){if(W(e=ne(e)))throw new ie(this.u,0,e);if(W(t=oe(t)))throw new ie(this.u,1,t)}return pe(this.i,this.c,this.h,this.g,e,t,e,t,r)},he.prototype.mergePoint=he.prototype.V=function(e,t,i){return t||ce(e,this.V,0),this.u(e.lat,e.lng,t,i)},he.prototype.mergeRect=he.prototype.F=function(e,t,i){if(!(t||e instanceof he))throw new ie(this.F,0,e);return pe(this.i,this.c,this.h,this.g,e.i,e.c,e.h,e.g,i)},he.prototype.mergeTopLeftBottomRight=he.prototype.v=function(e,t,i,r,n,o){return n||(e=ne(e,this.v,0),t=oe(t,this.v,1),i=ne(i,this.v,2),r=oe(r,this.v,3)),pe(this.i,this.c,this.h,this.g,e,t,i,r,o)},he.prototype.intersects=he.prototype.T=function(e,t){var i=this.c<=this.g,r=e.c<=e.g,n=this.c<e.g,o=e.c<this.g;if(!(t||e instanceof he))throw new ie(this.T,0,e);return this.h<=e.i&&e.h<=this.i&&(!i&&(!r||n||o)||!r&&(n||o)||n&&o)},he.merge=pe,he.fromPoints=ve,he.coverPoints=function e(t,i){var r=1,n=t.length,o=null,s=a(t);if("array"!=s&&("object"!=s||"number"!=typeof t.length))throw new ie(e,0,t);if(0<n)for(o=ve(s=t[0],s,i);r<n;r++)s=t[r],o.u(s.lat,s.lng,i,o);return o},he.coverLatLngAlts=function e(t,i){var r,n=3,o=t.length;if(!(i||t&&null!=t.length))throw new ie(e,0,t);if(0<o)for(r=new he(t[0],t[1],t[0],t[1]);n<o;n+=3)r.u(t[n],t[n+1],i,r);return r},he.coverRects=function e(t,i){var r,n=1,o=t.length;if(i&&(!t||null==t.length))throw new ie(e,0,t);if(0<o)for(r=new he(t[0].i,t[0].c,t[0].h,t[0].g);n<o;n++)r.F(t[n],i,r);return r},he.prototype.resizeToCenter=he.prototype.W=function(e,t){var i=this.c,r=this.i,n=this.g,o=this.h,s=this.A().lng;ce(e,this.W,0);var a=e.lat-o-(r-o)/2,l=e.lng-s;return e=(e=i+((l=180<l||l<-180?-(s+e.lng):l)<0?2*l:0))<-180?360+e:e,n=180<(n+=0<l?2*l:0)?n-360:n,90<=(r=0<a?r+2*a:r)&&(r=90),(o=a<0?o+2*a:o)<=-90&&(o=-90),t?fe(t,r,e,o,n):new he(r,e,o,n)};var ge={Z:0,$:1,X:2,Y:3};function ye(e,t,i){var r,n;if(e.U&&(r=e.f))for(n=3;0<=n;n--){var o=t[n];if(n%3?o>=r[n]:o<=r[n]){if(!i){e.f=null;break}r[n]=o}}}function xe(e,t){var i,r=e.a;if(t){var n=t;if(n!==r)for(r=n;n=n.f;)(n.entries||1<n.a)&&(r=n)}else for(;!r.entries&&(i=r.a)<2&&i;)r=n;e.a=r}me.prototype.remove=function(e){var t,i,r,n=!1;if(e&&(t=e.b)&&t.b===this&&(i=t.entries)&&0<=(r=i.indexOf(e))){var o,s;for(i.splice(r,1),i=this.a;t;)if((o=t.entries)&&o.length||(o&&delete t.entries,t.a||!(s=t.f)))t=q;else{r=s;var a=(n=t).j;r[a]===n&&(delete r[a],delete n.f,--r.a),i===t&&(i=s),t=s}this.a!==i&&(this.a=i,xe(this)),ye(this,e,!1),n=!0}return n},me.prototype.l=function(e,t,i,r){var n=[],o=this.a,s=this.b;return e<=o[5]&&t<=o[6]&&i>o[7]&&r>o[4]&&function e(t,i,r,n,o,s,a,l,u){var c,h=i.entries,f=i[7],d=i[4],_=i[5],p=i[6],v=i[8],m=i[9];if(h){var g=h.length;if(d<o||f<n||a<p||s<_)for(;g--;){f=h[g],d=f[3],_=f[0],p=f[1];var y=f[2];o<=y&&n<=p&&(_<a||l&&_==a)&&(d<s||u&&d==s)&&r.push(f)}else for(;g--;)r.push(h[g])}v<s&&(o<m&&(c=i[ge.$])&&e(t,c,r,n,o,s,a,l,u),m<a&&(c=i[ge.Y])&&e(t,c,r,n,o,s,a,l,u));n<v&&(o<m&&(c=i[ge.Z])&&e(t,c,r,n,o,s,a,l,u),m<a&&(c=i[ge.X])&&e(t,c,r,n,o,s,a,l,u))}(this,o,n,e,t,i,r,r>=s[6],i>=s[5]),n};var be=0;function we(e,t,i,r,n,o){this.j=t,e&&(this.f=e,this.b=e.b,n=1&t?(i=e[8],e[5]):(i=e[7],e[8]),o=2&t?(r=e[9],e[6]):(r=e[4],e[9])),this[7]=i,this[5]=n,this[8]=(i+n)/2,this[4]=r,this[6]=o,this[9]=(r+o)/2}function Ae(e,t,i,r,n,o){Ae.ma.constructor.apply(this,arguments)}function Te(e,t,i,r,n,o,s){var a,l,u=t[8],c=t[9];return s&&(n<u||(a=u<=i))&&(o<c||(l=c<=r))?i=(u=Te)(e,t=t[a|=l<<1]||(++t.a,t[a]=new we(t,a)),i,r,n,o,s-1):(r=i=new ke(i,r,n,o),(t.entries||(t.entries=[])).push(r),r.b=t,ye(e,i,!0),xe(e,t)),i}function ke(e,t,i,r){this.a=be++,this[0]=t,this[1]=i,this[2]=r,this[3]=e}function Ee(e){this.o=new Ae(+e||10,180,90,0,0,!0),this.j=[],this.C=!1,this.a=this.b=this.f=null}function Me(e,t,i,r,n,o){if(o)o=new ke(n,-t,i+360,-r),e.j.push(o),e.C=!0,e.a&&e.a.v(t,i,r,n,!0,e.a);else{var s=-t,a=-r,l=(o=e.o).b,u=l[5],c=l[6];if(!(l[7]<=i&&l[4]<=s&&(n<u||u===n&&u===l.b.b[5])&&(a<c||c===a&&c===l.b.b[6])))throw Error("Coordinates out of bounds");o=Te(o,o.b,i,s,n,a,o.ka),e.b&&e.b.v(t,i,r,n,!0,e.b)}return e.f=null,o}function Re(e,t,i,r,n){var o,s=(e=e.j).length,a=[];if(s){var l=i+360;for(o=n+360;s--;){var u=e[s];Se(u,t,i,r,n)?a.push(u):Se(u,t,l,r,o)&&a.push(u)}}return a}function Se(e,t,i,r,n){var o=e[3],s=e[1],a=e[2];return e[0]<r&&o<n&&t<=a&&i<=s}function ze(e,t){var i,r,n;if(i=t.length){var o=e.length;for(r={};o--;)r[e[o].a]=1;for(;i--;)(n=t[i]).a in r||e.push(n)}}we.prototype.a=0,t(Ae,me),e("H.geo.QuadTree",Ee),Ee.prototype.I=function(){return this.C},Ee.prototype.D=function(){var e;if(!this.f){var t,i,r,n,o=[];if(t=!this.b){var s=this.o,a=s.f;s.U&&!a&&((t=s.a).entries||t[0]||t[1]||t[2]||t[3])&&(a=function e(t,i){var r,n,o,s,a=0;for(r=3;0<=r;r--){var l=r+4,u=0<r%3,c=[],h=i[r],f=t[r];for(n=f.length;n--;){var d=f[n];if(o=d.entries)for(s=o.length;s--;){var _=o[s][r];(u?h<_:_<h)&&(h=_)}for(s=4;s--;)(o=d[s])&&(u?o[l]>h:o[l]<h)&&c.push(o)}a+=c.length,i[r]=h,t[r]=c}return a&&(i=e(t,i)),i}([a=[t],a,a,a],[t[6],t[7],t[4],t[5]]),s.f=a),t=s=a}if(t&&(this.b=new he(-s[0],s[3],-s[2],s[1])),(e=this.b)&&o.push(e),!this.a&&(n=(r=this.j).length)){for(t=360,a=-(s=90),i=0;n--;){var l=r[n];s=f(s,l[0]),t=f(t,l[3]),a=d(a,l[2]),i=d(i,l[1])}this.a=new he(-s,t,-a,i-360)}(e=this.a)&&o.push(e),(e=o[0])&&(o[1]&&(e=e.F(o[1],!0)),this.f=e)}return this.f},Ee.prototype.insertBoundingBox=Ee.prototype.ha=function(e){var t=e.N(),i=e.M();return(e=e.I())?Me(this,t.lat,i.lng,i.lat,t.lng,e):Me(this,t.lat,t.lng,i.lat,i.lng,e)},Ee.prototype.remove=Ee.prototype.remove=function(e){var t;if(e.b){var i=this.o.remove(e);this.b=null}else(i=0<=(e=(t=this.j).indexOf(e)))&&(t.splice(e,1),this.C=0<t.length,this.a=null);return i&&(this.f=null),i},Ee.prototype.intersectBoundingBox=Ee.prototype.ia=function(e){var t=this.o,i=e.N(),r=e.M(),n=-i.lat;i=i.lng;var o=-r.lat;return r=r.lng,n==o||i===r?e=[]:e.I()?(ze(e=t.l(-180,n,r,o),t.l(i,n,180,o)),ze(e,Re(this,n,r,o,i+360))):ze(e=t.l(i,n,r,o),Re(this,n,i,o,r)),e}}).call(pl);var vl=_l={};function ml(e){return Tr(pl.H.math.Point,zr(e))}_l.clipPolygon=function(e,t){var i,r,n,o,s=[];if(i=pl.H.math.clipping.clipPolygon(e.map(ml),t.map(ml)))do{for(r=[],n=i;r.push([(o=n).x,o.y]),n=n.next;);s.push(r)}while(i=i.nextPoly);else _l.isPointInsidePolygon(t[0],e)?s.push(t):_l.isPointInsidePolygon(e[0],t)&&s.push(e);return s},_l.isPointInsidePolygon=function(e,t){for(var i,r,n=t.length,o=new Int32Array(2*n);n--;)i=t[n],o[r=n<<1]=i[0],o[1+r]=i[1];return pl.H.math.isCoveredBy(e[0],e[1],o,0,!0)!==pl.H.math.CoverType.NONE},_l.clamp=function(e,t,i){return(e-=0)>i?i:e<t?t:e},_l.splitLegs=function(e,t){var i=[];e.push(e[0]);for(var r=0;r<e.length-1;r++){var n=e[r],o=e[r+1];if(i.push(n),Math.abs(o[0]-n[0])>=t){var s=[(n[0]+o[0])/2,(n[1]+o[1])/2];i.push(s)}}return i.length!==e.length-1?_l.splitLegs(i,t):i},_l.getBBox=function(e){var t=1/0,i=1/0,r=-1/0,n=-1/0;return e.forEach(function(e){e[0]<t&&(t=e[0]),e[1]<i&&(i=e[1]),e[0]>r&&(r=e[0]),e[1]>n&&(n=e[1])}),[t,i,r,n]},_l.getBBoxCenter=function(e){var t=Sr(e,4),i=t[0],r=t[1];return[i+(t[2]-i)/2,r+(t[3]-r)/2]},_l.getLineLength=function(e,t,i,r){return Math.sqrt(Math.pow(e-i,2)+Math.pow(t-r,2))};var gl=Kr.metersToLatLng([Kr.half_circumference_meters,Kr.half_circumference_meters]),yl=Math.log(Kr.tile_size)/Math.LN2,xl=function(){function g(e,t){var i;return mr(this,g),i=Mr(this,wr(g).call(this,e,t)),Ir.is_worker&&(i._quad_tree=new pl.H.geo.QuadTree,i._tree_entries_by_object_id={},i._groups_by_id={}),Ir.is_main&&(i._objects_by_id={},i._commands=[],i.has_volatile_data||(i._sendCommands=nn(i._sendCommands,100,200))),i}return br(g,_s),yr(g,[{key:"onReady",value:function(){var e=this;this._synced_at=this.provider.getInvalidations().getMark();var t,i,r=this.provider.getRootGroup(),n=r.getObjects(!0),o=[];for(n.push(r),t=n.length;t--;)i=n[t],this._isObjectSupported(i)&&this._shouldBeStored(i)&&(this._objects_by_id[i.getId()]=i,o.push(i.forWorkerMessage()));Cr.postMessage(this.worker,this.target_name+".addObjects",o).then(function(){return e.dispatchUpdate()})}},{key:"onProviderUpdate",value:function(e){var t=e.target,i=e.currentTarget.getInvalidations(t.type);if(this._isObjectSupported(t)){var r=this._synced_at,n=t.getId();i.isRemove(r)?(delete this._objects_by_id[n],this._commands.push({method_name:"removeObjectsByIds",arguments:[[n]]})):i.isAdd(r)?this._shouldBeStored(t)&&(this._objects_by_id[n]=t,this._commands.push({method_name:"addObjects",arguments:[[t.forWorkerMessage()]]})):i.isSpatial(r)||i.isVisual(r)||i.isZOrder(r)?this._shouldBeStored(t)&&(delete this._objects_by_id[n],this._commands.push({method_name:"removeObjectsByIds",arguments:[[n]]}),this._objects_by_id[n]=t,this._commands.push({method_name:"addObjects",arguments:[[t.forWorkerMessage()]]})):i.isVolatility(r)&&(delete this._objects_by_id[n],this._commands.push({method_name:"removeObjectsByIds",arguments:[[n]]}),this._shouldBeStored(t)&&(this._objects_by_id[n]=t,this._commands.push({method_name:"addObjects",arguments:[[t.forWorkerMessage()]]}))),this._commands.length&&this._sendCommands()}this._synced_at=i.getMark()}},{key:"_shouldBeStored",value:function(e){if(5===e.type)return!0;var t=e.getVolatility(!0);return(!e.getIcon||1===e.getIcon().getState())&&(t&&this.has_volatile_data||!t&&!this.has_volatile_data)}},{key:"hasPendingCommands",value:function(){return 0<this._commands.length}},{key:"_sendCommands",value:function(){var e=this;Cr.postMessage(this.worker,this.target_name+".executeCommands",this._commands).then(function(){e.dispatchUpdate()}),this._commands=[]}},{key:"_isObjectSupported",value:function(e){return e.forWorkerMessage&&4!==e.type}},{key:"getSyncedAt",value:function(){return this._synced_at}},{key:"getMapObjectById",value:function(e){return this._objects_by_id[e]}},{key:"getIconBitmapByObjectId",value:function(e,t){var i=this.getMapObjectById(e);if(i){var r=i.getIcon();if(r.uid===t&&1===r.getState()){var n=r.getSize();return dl(r.getBitmap(),n.w,n.h)}}}},{key:"fetchFeaturesForTile",value:function(e){var t=Kr.wrapTile(e.coords,{x:!0}),i=Kr.metersForTile(t),r=Kr.metersPerPixel(t.z),n=Kr.metersToLatLng([i.x-100*r,i.y+100*r]),o=Kr.metersToLatLng([i.x+(this.tile_size+100)*r,i.y-(this.tile_size+100)*r]),s=[],a=[],l=[],u=[],c=[],h=this._quad_tree.intersectBoundingBox(new pl.H.geo.Rect(vl.clamp(n[1],-90,90),vl.clamp(n[0],-180,180),vl.clamp(o[1],-90,90),vl.clamp(o[0],-180,180)));e.source_data.error=null;for(var f={},d=cl("binary-tree"),_=0;_<h.length;_++){var p=hl({},h[_].$feature$);if(p.geometry.coordinates=ds.deepClone(h[_].$geoCoordinates$),p.properties.zInfo=this._getZInfo([],p),p.properties.overlay)a.push(p);else if(p.geometry.type.includes("Point")){s.push(p);var v=p.properties.icon;f[v.id]||(d.addItem({width:v.size.w,height:v.size.h,meta:{objectId:p.id,id:v.id}}),f[v.id]=!0)}else if(p.geometry.type.includes("LineString"))l.push(p);else if(p.geometry.type.includes("Polygon")){u.push(p);var m=hl({},p);c.push(m)}}e.rasters=d.export(),l.sort(g._compareZInfo),u.sort(g._compareZInfo),c.sort(g._compareZInfo),a.sort(g._compareZInfo),e.source_data.layers.markers={type:"FeatureCollection",features:s},e.source_data.layers.polylines={type:"FeatureCollection",features:l},e.source_data.layers.polygons={type:"FeatureCollection",features:u},e.source_data.layers.outlines={type:"FeatureCollection",features:c},e.source_data.layers.overlays={type:"FeatureCollection",features:a}}},{key:"tileTexture",value:function(e){var t=e.source_data.layers.overlays;if(t){var i=this.name+"_"+e.coords.key,r=ns.coordinateWithMaxZoom(e.coords,this.max_zoom),n=t.features[0].properties.overlays_config;return{name:i,filtering:this.filtering,coords:r,width:Kr.tile_size,height:Kr.tile_size,overlays_config:n,source:this.name}}}},{key:"_load",value:function(e,t){this.fetchFeaturesForTile(e);var i={indexMaxZoom:0,maxZoom:this.max_zoom,tolerance:1.5,extent:Kr.tile_scale},r=Kr.wrapTile(e.coords,{x:!0}),n=e.source_data.layers.overlays;for(var o in n.features.length&&delete e.source_data.layers.overlays,e.source_data.layers){var s=e.source_data.layers[o];if(s.features.length){i.buffer=o.includes("lines")?100*Kr.units_per_pixel:0;var a=ro(s,i).getTile(r.z,r.x,r.y);e.source_data.layers[o]=Pn(a)}}return this._processOverlays(e,n),t(e),Promise.resolve(e)}},{key:"_processOverlays",value:function(t,e){var i=this;if(e.features.length){var r={coords:t.coords,min:Kr.metersForTile(Kr.wrapTile(t.coords,{x:!0}))},n={coords:t.coords,source_data:{layers:{_default:{type:"FeatureCollection",features:e.features}}}},h=Math.pow(2,t.coords.z+yl);_s.projectData(n.source_data),_s.scaleData(n.source_data,r);var o=e.features.map(function(e){var t=e.geometry.coordinates[0],i=t[0],r=t[5===t.length?2:3],n=Math.floor(i[0]/Kr.tile_scale*Kr.tile_size),o=Math.floor(i[1]/Kr.tile_scale*Kr.tile_size),s=Math.floor(r[0]/Kr.tile_scale*Kr.tile_size),a=Math.floor(r[1]/Kr.tile_scale*Kr.tile_size)-o,l=s<=n,u=l?h-(n-s):s-n,c=[];return n<=Kr.tile_size&&c.push([n,o,u,a]),l&&0<s&&c.push([n-h,o,u,a]),{id:e.id,properties:e.properties,texcoords:c}}).filter(function(e){return i.isVisible(e.properties,t.style_zoom)}),s=Kr.tile_scale;t.pad_scale=this.pad_scale,t.default_winding="CW",e.features=o.length?[{geometry:{type:"Polygon",coordinates:[[[0,0],[s,0],[s,s],[0,s],[0,0]]]},properties:{overlays_config:o}}]:o,t.source_data.layers.overlays=e}}},{key:"executeCommands",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this[i.method_name].apply(this,i.arguments)}}},{key:"addObjects",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];if("Group"===i.type)i.$children_ids$={},this._groups_by_id[i.id]=i;else{var r=i.geometry.boundingBox;g._preprocessGeometry(i.geometry);var n=this._quad_tree.insertBoundingBox(new pl.H.geo.Rect(Math.min(Math.max(r[0],-gl[1]),gl[1]),r[1],Math.min(Math.max(r[2],-gl[1]),gl[1]),r[3]));n.$geoCoordinates$=ds.deepClone(i.geometry.coordinates),n.$feature$=i,this._tree_entries_by_object_id[i.id]=n}}for(var o=0;o<e.length;o++){var s=e[o];if(s.properties.parent)this._groups_by_id[s.properties.parent].$children_ids$[s.id]=s.id}}},{key:"removeObjectsByIds",value:function(e,t){for(var i=!(1<arguments.length&&void 0!==t)||t,r=0;r<e.length;r++){var n,o=e[r],s=void 0;(n=this._tree_entries_by_object_id[o])?(delete this._groups_by_id[n.$feature$.properties.parent].$children_ids$[o],this._quad_tree.remove(n),delete this._tree_entries_by_object_id[o]):(s=this._groups_by_id[o])&&(s.properties.parent&&delete this._groups_by_id[s.properties.parent].$children_ids$[o],i&&this.removeObjectsByIds(Object.keys(s.$children_ids$)),delete this._groups_by_id[o])}}},{key:"updateObjects",value:function(e){this.removeObjectsByIds(e.map(g._getObjectId),!1),this.addObjects(e)}},{key:"_getZInfo",value:function(e,t){var i=t.properties.zIdx,r=t.properties.sIdx;return e[0]|=void 0!==i,e.splice(1,0,i||0,r<0?t.id:r),0===t.properties.parent?e:this._getZInfo(e,this._groups_by_id[t.properties.parent])}},{key:"isVisible",value:function(e,t){if(e.overlays_config)return!0;var i=e.visible,r=e.min<=t&&e.max>=t,n=!e.parent||this.isVisible(this._groups_by_id[e.parent].properties,t);return i&&r&&n}}],[{key:"_getObjectId",value:function(e){return e.id}},{key:"_compareZInfo",value:function(e,t){for(var i,r=e.properties.zInfo,n=t.properties.zInfo,o=r.length,s=n.length,a=Math.min(o,s),l=1;l<a;l++)if(i=r[l]-n[l])return i;return o-s}},{key:"_preprocessGeometry",value:function(e){var t=e.type;e.coordinates="Point"===t?g._processPointCoordinates(e.coordinates):"MultiPoint"===t?e.coordinates.map(g._processPointCoordinates):"LineString"===t?g._processLineStringCoordinates(e.coordinates):"MultiLineString"===t?e.coordinates.map(g._processLineStringCoordinates):"Polygon"===t?e.coordinates.map(g._processPolygonCoordinates):"MultiPolygon"===t?e.coordinates.map(g._processMultiPolygonCoordinates):[],delete e.boundingBox}},{key:"_processPointCoordinates",value:function(e){return[e[1],e[0]]}},{key:"_processLineStringCoordinates",value:function(e){return g._latLngAltArrayToLineString(e,!1)}},{key:"_processPolygonCoordinates",value:function(e){return g._latLngAltArrayToLineString(e,!0)}},{key:"_processMultiPolygonCoordinates",value:function(e){return e.map(g._processPolygonCoordinates)}},{key:"_latLngAltArrayToLineString",value:function(e,t){for(var i=[],r=e.length,n=0;n<r;n+=3)i.push([e[n+1],e[n]]);return t&&i.push([e[1],e[0]]),i}}]),g}();_s.register(xl,"ObjectSource");var bl=1,wl=2,Al=3,Tl=function(){function e(){mr(this,e),this._map={}}return yr(e,[{key:"set",value:function(e,t,i){if(this._map[e])this._map[e].accumulator.add(i);else{var r=new Set;r.add(i),this._map[e]={value:t,accumulator:r}}}},{key:"get",value:function(e){return this._map[e]&&this._map[e].value}},{key:"delete",value:function(e,t){var i=this._map[e];i&&i.accumulator&&(i.accumulator.delete(t),0===i.accumulator.size&&delete this._map[e])}}]),e}(),kl=function(){function r(e,t){var i;return mr(this,r),i=Mr(this,wr(r).call(this,e,t)),Ir.is_worker?i._loading={}:i._icons=new Tl,i}return br(r,_s),yr(r,[{key:"onProviderUpdate",value:function(e){e.target instanceof H.map.provider.Tile?this.dispatchUpdate(e.target):this.dispatchUpdate()}},{key:"onReady",value:function(){var e=this.provider;e.setTileCanvasRendering&&e.setTileCanvasRendering(!1),e.providesMarkers()&&(this._onCacheDrop=this._onCacheDrop.bind(this),e.getCache().registerOnDrop(this._onCacheDrop)),this.dispatchUpdate()}},{key:"dispose",value:function(){Rr(wr(r.prototype),"dispose",this).call(this);var e=this.provider;e.providesMarkers()&&e.getCache().deRegisterOnDrop(this._onCacheDrop)}},{key:"_onCacheDrop",value:function(e,t,i){this.provider.cacheFilter(e)&&this._deleteIcons(e,t.data)}},{key:"_deleteIcons",value:function(e,t){for(var i=0,r=t.length;i<r;i++){var n=t[i].getIcon();this._icons.delete(n.uid,e)}}},{key:"getIconBitmapByObjectId",value:function(e,t){var i=this._icons.get(t);return i&&i.getBitmap()}},{key:"requestMarkerTile",value:function(t){var a=this;return new Promise(function(s,e){a.provider?a.provider.requestTileAsPromise(t.x,t.y,t.z,!1).then(function(e){var t,i,r=[];if(e.data)for(i=(t=e.data).length;i--;){var n=t[i],o=n.getIcon();a._icons.set(o.uid,o,e.key),r.push(n.forWorkerMessage())}s(r)}):s([])})}},{key:"requestSpatialTile",value:function(t){var i=this;return new Promise(function(o,e){i.provider?i.provider.requestTileAsPromise(t.x,t.y,t.z,!1).then(function(e){var t,i=[];if(e.getObjects){t=e.getObjects();for(var r=0;r<t.length;r++){var n=t[r];i.push({id:n.getId(),geometries:n.getGeometriesForTile(e),isClosed:n.isClosed(),style:n.getStyle().forWorkerMessage()})}}o(i)}):o([])})}},{key:"_pointToArray",value:function(e){var t=Kr.tile_scale/this.tile_size;return[e.x*t,e.y*t]}},{key:"_getGeoJsonMultiPolygon",value:function(e){for(var t=e.geometries,i=t.length,r=[],n={coordinates:r,type:"MultiPolygon"},o=0;o<i;o++){var s=t[o],a=s.paths,l=a.length,u=s.interiorsIndex,c=s.outlinesIndex,h=Math.min(u,c,l),f=void 0,d=void 0;for(d=0;d<h;d++)f=[a[d].map(this._pointToArray,this)],r.push(f);if(1===h)for(h=Math.min(c,l),d=u;d<h;d++)f.push(a[d].map(this._pointToArray,this))}return n}},{key:"_getGeoJsonMultiLineString",value:function(e,t){for(var i=1<arguments.length&&void 0!==t&&t,r={coordinates:[],type:"MultiLineString"},n=e.geometries,o=0;o<n.length;o++)for(var s=n[o],a=i?s.outlinesIndex:0,l=i?s.paths.length:Math.min(s.interiorsIndex,s.outlinesIndex,s.paths.length),u=a;u<l;u++){var c=s.paths[u].map(this._pointToArray,this);r.coordinates.push(c)}return r}},{key:"_getGeoJsonGeometry",value:function(e,t){var i;return(i=t===bl?this._getGeoJsonMultiPolygon(e):this._getGeoJsonMultiLineString(e,t===Al)).coordinates.length?i:null}},{key:"_load",value:function(h,n){var f=this,o=h.coords;return new Promise(function(e,t){var i=f._loading[o.x+"_"+o.y+"_"+o.z];i||(i=Cr.postMessage(f.target_name+".requestMarkerTile",h.coords).then(f._prepareTileData.bind(f,h)),f._loading[o.x+"_"+o.y+"_"+o.z]=i);var r=new Promise(function(c,e){Cr.postMessage(f.target_name+".requestSpatialTile",h.coords).then(function(e){for(var t=[],i=[],r=[],n=0;n<e.length;n++){var o=e[n],s=void 0,a=void 0;a=o.isClosed?(s=i,bl):(s=t,wl);var l=f._getGeoJsonGeometry(o,a);l&&s.push({id:o.id,type:"Feature",properties:{style:o.style},geometry:l});var u=f._getGeoJsonGeometry(o,Al);u&&r.push({id:o.id,type:"Feature",properties:{style:o.style},geometry:u})}h.source_data.layers.polylines={type:"FeatureCollection",features:t},h.source_data.layers.polygons={type:"FeatureCollection",features:i},h.source_data.layers.outlines={type:"FeatureCollection",features:r},c(h)})});Promise.all([i,r]).then(function(){n(h),e(h)})})}},{key:"_prepareTileData",value:function(e,t){var i=e.coords;delete this._loading[i.x+"_"+i.y+"_"+i.z];var r=Kr.wrapTile(e.coords,{x:!0,y:!0}),n=Kr.metersForTile(r);e.source_data.layers={markers:{features:t,type:"FeatureCollection"}};var o={coords:r,min:n},s=e.source_data,a=cl("binary-tree"),l={};for(var u in s.layers)for(var c=s.layers[u].features.length,h=0;h<c;h++){var f=s.layers[u].features[h],d=f.properties.icon;l[d.id]||(a.addItem({width:d.size.w,height:d.size.h,meta:{objectId:f.id,id:d.id}}),l[d.id]=!0),Kr.transformGeometry(f.geometry,function(e){var t=e[0];e[0]=e[1],e[1]=t})}return e.rasters=a.export(),_s.projectData(e.source_data),_s.scaleData(e.source_data,o),e}}]),r}();_s.register(kl,"ObjectTileSource");var El={type:"FeatureCollection",features:[]},Ml=function(){function r(e,t){var i;return mr(this,r),i=Mr(this,wr(r).call(this,e,t)),Ir.is_worker&&(i.mvtSource_=new Po(Object.assign({},e,{url:""}),t)),i}return br(r,_s),yr(r,[{key:"fetchTile",value:function(e,t,i){return this.provider?this.provider.requestTileAsPromise(e,t,i).then(function(e){return e.data}):Promise.resolve()}},{key:"_load",value:function(t,i){var r=this,e=Kr.wrapTile(t.coords,{x:!0,y:!0});return Cr.postMessage(this.target_name+".fetchTile",e.x,e.y,e.z).then(function(e){return e instanceof ArrayBuffer?r.mvtSource_.parseSourceData(t,t.source_data,e):e?t.source_data.error=e:t.source_data.layers={_default:El},i(t),t})}},{key:"onReady",value:function(){this.dispatchUpdate()}}]),r}();_n.register(Ml,"OMV");var Rl=function(){function r(e,t){var i;return mr(this,r),(i=Mr(this,wr(r).call(this,e,t))).uid_=e.uid,i}return br(r,os),yr(r,[{key:"initialize",value:function(e,t,i,r){this.provider=e,this._on_update=t,this._onProviderUpdate=this._onProviderUpdate.bind(this),e.addEventListener("update",this._onProviderUpdate)}},{key:"_onProviderUpdate",value:function(e){this._on_update(this.name)}},{key:"tileTexture",value:function(e){return Object.assign(Rr(wr(r.prototype),"tileTexture",this).call(this,e),{uid:this.uid_,url:this.uid_+"_"+e.coords.key,coords:e.coords})}},{key:"dispose",value:function(){this.provider.removeEventListener("update",this._onProviderUpdate)}}]),r}();_n.register(Rl,"RemoteRasterTileSource");var Sl={type:"FeatureCollection",features:[]},zl=function(){function i(e,t){return mr(this,i),e.tiled=!0,e.url="",Mr(this,wr(i).call(this,e,t))}return br(i,_s),yr(i,[{key:"fetchTile",value:function(e,t,i){return this.provider?this.provider.requestTileAsPromise(e,t,i).then(function(e){return e.data}):Promise.resolve(Sl)}},{key:"_load",value:function(r,n){var o=Kr.wrapTile(r.coords,{x:!0,y:!0}),s={indexMaxZoom:0,maxZoom:this.max_zoom,tolerance:1.5,extent:Kr.tile_scale};return Cr.postMessage(this.target_name+".fetchTile",o.x,o.y,o.z).then(function(e){for(var t in r.source_data.layers="FeatureCollection"===e.type?{_default:e}:e,r.source_data.layers){var i=ro(r.source_data.layers[t],s).getTile(o.z,o.x,o.y);r.source_data.layers[t]=Pn(i)}return n(r),r})}},{key:"onReady",value:function(){this.dispatchUpdate()}}]),i}();_n.register(zl,"GeoJSONTileSource");var Pl,Nl={layers:{_default:{type:"FeatureCollection",features:[{type:"Point",geometry:{}}]}}},Ol=function(){function i(e,t){return mr(this,i),e.max_zoom=0,Mr(this,wr(i).call(this,e,t))}return br(i,_n),yr(i,[{key:"load",value:function(e){return e.source_data="0/0/0"===e.coords.key?Nl:void 0,Promise.resolve(e)}}]),i}();_n.register(Ol,"SkyBox");var Ll=Pl={draw_label_collision_boxes:!1,draw_label_texture_boxes:!1,suppress_label_fade_in:!1,suppress_label_snap_animation:!1,show_hidden_labels:!1,layer_stats:!1};var Il,Cl=0,Fl=1;function Dl(t,e){var i={};return e.forEach(function(e){return i[e]=t[e]}),i}var Ul=Il={},jl=0;Il.getContext=function(e,t){var i=!1;null==e&&((e=document.createElement("canvas")).style.position="absolute",e.style.top=0,e.style.left=0,e.style.zIndex=-1,document.body.appendChild(e),i=!0);var r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);if(!r)throw new Error("Couldn't create WebGL context.");return r._tangram_id=jl++,i?(Il.resize(r,window.innerWidth,window.innerHeight,t.device_pixel_ratio),window.addEventListener("resize",function(){Il.resize(r,window.innerWidth,window.innerHeight,t.device_pixel_ratio)})):Il.resize(r,parseFloat(e.style.width),parseFloat(e.style.height),t.device_pixel_ratio),r},Il.resize=function(e,t,i,r){e.canvas.style.width=t+"px",e.canvas.style.height=i+"px",e.canvas.width=Math.round(t*r),e.canvas.height=Math.round(i*r),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height)};var Gl={parseUniforms:function(e){var t=[];for(var i in e){var r,n=i,o=e[i];if("number"==typeof o)t.push({type:"float",method:"1f",name:i,value:o,key:n,uniforms:e});else if(Array.isArray(o)){if("number"==typeof o[0])2<=o.length&&o.length<=4?t.push({type:"vec"+o.length,method:o.length+"fv",name:i,value:o,key:n,uniforms:e}):4<o.length&&t.push({type:"float[]",method:"1fv",name:i+"[0]",value:o,key:n,uniforms:e});else if("string"==typeof o[0])for(r=0;r<o.length;r++)t.push({type:"sampler2D",method:"1i",name:i+"["+r+"]",value:o[r],key:r,uniforms:o});else if(Array.isArray(o[0])&&"number"==typeof o[0][0]&&2<=o[0].length&&o[0].length<=4)for(r=0;r<o.length;r++)t.push({type:"vec"+o[0].length,method:o[r].length+"fv",name:i+"["+r+"]",value:o[r],key:r,uniforms:o})}else"boolean"==typeof o?t.push({type:"bool",method:"1i",name:i,value:o,key:n,uniforms:e}):"string"==typeof o&&t.push({type:"sampler2D",method:"1i",name:i,value:o,key:n,uniforms:e})}return t},defineVariable:function(e,t){var i,r;if("number"==typeof t)i="float";else if(Array.isArray(t))"number"==typeof t[0]?2<=t.length&&t.length<=4?i="vec"+t.length:(i="float",r=t.length):"string"==typeof t[0]&&(i="sampler2D",r=t.length);else if("boolean"==typeof t)i="bool";else{if("string"!=typeof t)return;i="sampler2D"}var n="";return n+="".concat(i," ").concat(e),r&&(n+="[".concat(r,"]")),n+=";\n"},defineUniform:function(e,t){var i=Gl.defineVariable(e,t);if(i)return"uniform "+i},isUniformDefined:function(e,t){var i=new RegExp("uniform[^;]+(?:{[\\s\\S]*})?[^;]*\\b"+e+"\\b","g");return!!t.match(i)},isSymbolReferenced:function(e,t){var i=new RegExp("\\b"+e+"\\b","g");return 0<=t.search(i)},expandVec3:function(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;if(Array.isArray(e)){if(2!==e.length)return e;t=[].concat(zr(e),[i]).map(parseFloat)}else t=[e,e,e].map(parseFloat);if(t&&t.every(function(e){return"number"==typeof e&&!isNaN(e)}))return t},expandVec4:function(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;if(Array.isArray(e)){if(3!==e.length)return e;t=[].concat(zr(e),[i]).map(parseFloat)}else t=[e,e,e,i].map(parseFloat);if(t&&t.every(function(e){return"number"==typeof e&&!isNaN(e)}))return t}},Bl=[];function Vl(t,e){var i=Bl.filter(function(e){return e[0]===t})[0];return(i=i&&i[1])||(Bl.push([t,{}]),i=Bl[Bl.length-1][1]),i[e]||(i[e]=t.getExtension(e)),i[e]}function ql(e){var t,i,r=0;if(0===e.length)return r;for(t=0,i=e.length;t<i;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r}var Hl=i(function(e){var r="(.|[\\r\\n]|\\n)*?\\*\\/\\n?\\n?",n=/(^|[^\S\n])(?:\/\/)([\s\S]+?)$/gm,o=/(^|[^\S\n])(?:\/\/[^!])([\s\S]+?)$/gm,i=e.exports=function(e,t){return e?i.block(i.line(e,t),t):""};i.block=function(e,t){t=t||{};var i=new RegExp("\\/\\*"+r,"gm");return t.safe&&(i=new RegExp("\\/\\*(?!\\*?\\!)"+r,"gm")),e?e.replace(i,""):""},i.line=function(e,t){var i=n;return(t=t||{}).safe&&(i=o),e?e.replace(i,""):""}}),Yl=function(e){e=String(e);var t,i=[];for(;t=e.match(/ERROR\:([^\n]+)/);){e=e.slice(t.index+1);var r=(s=t[1].trim()).split(":"),n=r.slice(2).join(":").trim(),o=parseInt(r[0],10),s=parseInt(r[1],10);i.push({message:n,file:o,line:s})}return i};var Xl=/^\s*#pragma.*$/gm,Wl=/\\\s*\n/gm,Zl=function(){function f(e,t,i,r){mr(this,f),r=r||{},this.gl=e,this.program=null,this.compiled=!1,this.compiling=!1,this.error=null,this.defines=Object.assign({},r.defines||{}),this.blocks=Object.assign({},r.blocks||{}),this.block_scopes=Object.assign({},r.block_scopes||{}),this.extensions=r.extensions||[],this.dependent_uniforms=r.uniforms,this.uniforms={},this.attribs={},this.vertex_source=t,this.fragment_source=i,this.id=f.id++,this.name=r.name}return yr(f,[{key:"destroy",value:function(){this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.uniforms={},this.attribs={},this.compiled=!1}},{key:"use",value:function(){this.compiled&&(f.current!==this&&this.gl.useProgram(this.program),f.current=this)}},{key:"compile",value:function(){var i=this;if(this.compiling)throw new Error("ShaderProgram.compile(): skipping for ".concat(this.id," (").concat(this.name,") because already compiling"));this.compiling=!0,this.compiled=!1,this.error=null,this.computed_vertex_source=this.vertex_source,this.computed_fragment_source=this.fragment_source;var e,t=this.checkExtensions(),r=this.buildDefineList(),n=this.buildShaderBlockList();for(var o in n){var s=n[o];if(s&&(!Array.isArray(s)||0!==s.length)){e=new RegExp("^\\s*#pragma\\s+tangram:\\s+"+o+"\\s*$","m");var a=this.computed_vertex_source.match(e),l=this.computed_fragment_source.match(e);if(null!=a||null!=l){var u="";s.forEach(function(e){var t="".concat(e.scope,", ").concat(e.key,", ").concat(e.num);u+="\n// tangram-block-start: ".concat(t,"\n"),u+=e.source,u+="\n// tangram-block-end: ".concat(t,"\n")}),null!=a&&(this.computed_vertex_source=this.computed_vertex_source.replace(e,u)),null!=l&&(this.computed_fragment_source=this.computed_fragment_source.replace(e,u)),r["TANGRAM_BLOCK_"+o.replace(/[\s-]+/g,"_").toUpperCase()]=!0}}}this.computed_vertex_source=this.computed_vertex_source.replace(Xl,""),this.computed_fragment_source=this.computed_fragment_source.replace(Xl,""),this.ensureUniforms(this.dependent_uniforms);var c="",h=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT);c=h&&0<h.precision?"precision highp float;\n":"precision mediump float;\n",r.TANGRAM_VERTEX_SHADER=!0,r.TANGRAM_FRAGMENT_SHADER=!1,this.computed_vertex_source=c+f.buildDefineString(r)+this.computed_vertex_source,r.TANGRAM_VERTEX_SHADER=!1,r.TANGRAM_FRAGMENT_SHADER=!0,this.computed_fragment_source=f.buildExtensionString(t)+c+f.buildDefineString(r)+this.computed_fragment_source,this.computed_vertex_source=this.computed_vertex_source.replace(Wl,""),this.computed_fragment_source=this.computed_fragment_source.replace(Wl,"");try{this.program=f.updateProgram(this.gl,this.program,this.computed_vertex_source,this.computed_fragment_source),this.compiled=!0,this.compiling=!1}catch(t){throw this.program=null,this.compiled=!1,this.compiling=!1,"vertex"!==(this.error=t).type&&"fragment"!==t.type||(this.shader_errors=t.errors,this.shader_errors.forEach(function(e){e.type=t.type,e.block=i.block(t.type,e.line)})),t}this.computed_vertex_source=null,this.computed_fragment_source=null,this.use(),this.refreshUniforms(),this.refreshAttributes()}},{key:"buildDefineList",value:function(){var e,t={};for(e in f.defines)t[e]=f.defines[e];for(e in this.defines)t[e]=this.defines[e];return t}},{key:"buildShaderBlockList",value:function(){var i,e={};for(i in f.blocks){var t;if(e[i]=[],Array.isArray(f.blocks[i]))(t=e[i]).push.apply(t,zr(f.blocks[i].map(function(e,t){return{key:i,source:e,num:t,scope:"ShaderProgram"}})));else e[i]=[{key:i,source:f.blocks[i],num:0,scope:"ShaderProgram"}]}for(i in this.blocks)if(e[i]=e[i]||[],Array.isArray(this.blocks[i]))for(var r=this.block_scopes&&this.block_scopes[i]||[],n=null,o=0,s=0;s<this.blocks[i].length;s++)r[s]!==n&&(n=r[s],o=0),e[i].push({key:i,source:this.blocks[i][s],num:o,scope:n||this.name}),o++;else e[i].push({key:i,source:this.blocks[i],num:0,scope:this.name});return e}},{key:"ensureUniforms",value:function(e){if(e){var t,i=Hl(this.computed_vertex_source),r=Hl(this.computed_fragment_source),n=[],o=[];for(var s in e){var a=Gl.isUniformDefined(s,i),l=Gl.isUniformDefined(s,r);if(!a||!l){if(!(t=Gl.defineUniform(s,e[s])))continue;a||(Jr("trace","Program ".concat(this.name,": ").concat(s," not defined in vertex shader, injecting: '").concat(t,"'")),n.push(t)),l||(Jr("trace","Program ".concat(this.name,": ").concat(s," not defined in fragment shader, injecting: '").concat(t,"'")),o.push(t))}}0<n.length&&(this.computed_vertex_source=n.join("\n")+this.computed_vertex_source),0<o.length&&(this.computed_fragment_source=o.join("\n")+this.computed_fragment_source)}}},{key:"setUniforms",value:function(e,t){var i=!(1<arguments.length&&void 0!==t)||t;if(this.compiled){i&&(this.texture_unit=0);for(var r=Gl.parseUniforms(e),n=0;n<r.length;n++){var o=r[n];"sampler2D"===o.type?this.setTextureUniform(o.name,o.value):this.uniform(o.method,o.name,o.value)}}}},{key:"saveUniforms",value:function(e){var t=e||this.uniforms;for(var i in t){var r=this.uniforms[i];r&&(r.saved_value=r.value)}this.saved_texture_unit=this.texture_unit||0}},{key:"restoreUniforms",value:function(e){var t=e||this.uniforms;for(var i in t){var r=this.uniforms[i];r&&r.saved_value&&(r.value=r.saved_value,this.updateUniform(r))}this.texture_unit=this.saved_texture_unit||0}},{key:"setTextureUniform",value:function(e,t){var i=Jo.textures[t];null!=i?(i.bind(this.texture_unit),this.uniform("1i",e,this.texture_unit),this.texture_unit++):Jr("warn","Cannot find texture '".concat(t,"'"))}},{key:"uniform",value:function(e,t,i){if(this.compiled){this.uniforms[t]=this.uniforms[t]||{};var r=this.uniforms[t];r.name=t,void 0===r.location&&(r.location=this.gl.getUniformLocation(this.program,t)),r.method=e,r.value=i,this.updateUniform(r)}}},{key:"updateUniform",value:function(e){this.compiled&&e&&null!=e.location&&(this.use(),this.commitUniform(e))}},{key:"commitUniform",value:function(e){var t=e.location,i=e.value;switch(e.method){case"1i":this.gl.uniform1i(t,i);break;case"1f":this.gl.uniform1f(t,i);break;case"2f":this.gl.uniform2f(t,i[0],i[1]);break;case"3f":this.gl.uniform3f(t,i[0],i[1],i[2]);break;case"4f":this.gl.uniform4f(t,i[0],i[1],i[2],i[3]);break;case"1iv":this.gl.uniform1iv(t,i);break;case"3iv":this.gl.uniform3iv(t,i);break;case"1fv":this.gl.uniform1fv(t,i);break;case"2fv":this.gl.uniform2fv(t,i);break;case"3fv":this.gl.uniform3fv(t,i);break;case"4fv":this.gl.uniform4fv(t,i);break;case"Matrix3fv":this.gl.uniformMatrix3fv(t,!1,i);break;case"Matrix4fv":this.gl.uniformMatrix4fv(t,!1,i)}}},{key:"refreshUniforms",value:function(){if(this.compiled)for(var e in this.uniforms){var t=this.uniforms[e];t.location=this.gl.getUniformLocation(this.program,e),this.updateUniform(t)}}},{key:"refreshAttributes",value:function(){this.attribs={}}},{key:"attribute",value:function(e){if(this.compiled){var t=this.attribs[e]=this.attribs[e]||{};return null!=t.location||(t.name=e,t.location=this.gl.getAttribLocation(this.program,e)),t}}},{key:"source",value:function(e){return"vertex"===e?this.computed_vertex_source:"fragment"===e?this.computed_fragment_source:void 0}},{key:"lines",value:function(e){var t=this.source(e);return t?t.split("\n"):[]}},{key:"line",value:function(e,t){var i=this.lines(e);if(i)return i[t]}},{key:"block",value:function(e,t){for(var i,r=this.lines(e),n=0;n<t&&n<r.length;n++){var o=r[n],s=o.match(/\/\/ tangram-block-start: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/);s&&1<s.length?i={scope:s[1],name:s[2],num:s[3]}:(s=o.match(/\/\/ tangram-block-end: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/))&&1<s.length&&(i=null),i&&(i.line=null==i.line?-1:i.line+1,i.source=o)}return i}},{key:"checkExtensions",value:function(){var r=this,n=[];return this.extensions.forEach(function(e){var t=Vl(r.gl,e),i="TANGRAM_EXTENSION_".concat(e);r.defines[i]=null!=t,t?n.push(e):Jr("debug","Could not enable extension '".concat(e,"'"))}),n}}]),f}();Zl.id=0,Zl.current=null,Zl.defines={},Zl.blocks={},Zl.reset=function(){Zl.programs_by_source={},Zl.shaders_by_source={}},Zl.reset(),Zl.buildDefineString=function(e){var t="";for(var i in e)null!=e[i]&&!1!==e[i]&&("boolean"==typeof e[i]&&!0===e[i]?t+="#define "+i+"\n":"number"==typeof e[i]&&Math.floor(e[i])===e[i]?t+="#define "+i+" "+e[i].toFixed(1)+"\n":t+="#define "+i+" "+e[i]+"\n");return t},Zl.buildExtensionString=function(e){var t="";return(e=e||[]).forEach(function(e){t+="#ifdef GL_".concat(e,"\n#extension GL_").concat(e," : enable\n#endif\n")}),t},Zl.addBlock=function(e){var t;Zl.blocks[e]=Zl.blocks[e]||[];for(var i=arguments.length,r=new Array(1<i?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];(t=Zl.blocks[e]).push.apply(t,r)},Zl.removeBlock=function(e){Zl.blocks[e]=[]},Zl.replaceBlock=function(e){Zl.removeBlock(e);for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];Zl.addBlock.apply(Zl,[e].concat(i))},Zl.updateProgram=function(e,t,i,r){var n=ql(e._tangram_id+"::"+i+"::"+r);if(Zl.programs_by_source[n])return Jr("trace","Reusing identical source GL program object"),Zl.programs_by_source[n];var o=Zl.createShader(e,i,e.VERTEX_SHADER),s=Zl.createShader(e,r,e.FRAGMENT_SHADER);if(e.useProgram(null),null!=t)for(var a=e.getAttachedShaders(t),l=0;l<a.length;l++)e.detachShader(t,a[l]);else t=e.createProgram();if(null==o||null==s)return t;if(e.attachShader(t,o),e.attachShader(t,s),e.linkProgram(t),e.getProgramParameter(t,e.LINK_STATUS))return Zl.programs_by_source[n]=t;var u=new Error("WebGL program error:\n            VALIDATE_STATUS: ".concat(e.getProgramParameter(t,e.VALIDATE_STATUS),"\n            ERROR: ").concat(e.getError(),"\n            --- Vertex Shader ---\n            ").concat(i,"\n            --- Fragment Shader ---\n            ").concat(r));throw Object.assign(new Error(u),{type:"program"})};var Jl={disabled:!(Zl.createShader=function(e,t,i){var r=ql(e._tangram_id+"::"+t);if(Zl.shaders_by_source[r])return Jr("trace","Reusing identical source GL shader object"),Zl.shaders_by_source[r];var n=e.createShader(i);if(e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))return Zl.shaders_by_source[r]=n;var o=i===e.VERTEX_SHADER?"vertex":"fragment",s=e.getShaderInfoLog(n),a=Yl(s);throw Object.assign(new Error(s),{type:o,errors:a})}),bound_vao:[],init:function(e){var t;!0!==this.disabled&&(t=Vl(e,"OES_vertex_array_object")),null!=t?Jr("info","Vertex Array Object extension available"):!0!==this.disabled?Jr("warn","Vertex Array Object extension NOT available"):Jr("warn","Vertex Array Object extension force disabled")},create:function(e,t,i){var r={};r.setup=t,r.teardown=i;var n=Vl(e,"OES_vertex_array_object");return null!=n&&(r._vao=n.createVertexArrayOES(),n.bindVertexArrayOES(r._vao)),r.setup(!0),r},getCurrentBinding:function(t){var e=this.bound_vao.filter(function(e){return e[0]===t})[0];return e&&e[1]},setCurrentBinding:function(t,e){var i=this.bound_vao,r=i.filter(function(e){return e[0]===t})[0];null==r?i.push([t,e]):r[1]=e},bind:function(e,t){var i=Vl(e,"OES_vertex_array_object");if(null!=t)null!=i&&null!=t._vao?(i.bindVertexArrayOES(t._vao),this.setCurrentBinding(e,t)):t.setup(!1);else{var r=this.getCurrentBinding(e);null!=i?i.bindVertexArrayOES(null):null!=r&&"function"==typeof r.teardown&&r.teardown(),this.setCurrentBinding(e,null)}},destroy:function(e,t){var i=Vl(e,"OES_vertex_array_object");null!=i&&null!=t&&null!=t._vao&&(i.deleteVertexArrayOES(t._vao),t._vao=null)}},Kl=function(){function y(e){mr(this,y),this._gl=e,this._requests={},this._pixels=null,this._has_dirty_buffer=!1,this._fbo=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._fbo_size={width:256,height:256};var t=Jo.create(this._gl,"selection_fbo",{filtering:"nearest"});t.setData(this._fbo_size.width,this._fbo_size.height,null,{filtering:"nearest"}),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,t.texture,0);var i=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,i),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this._fbo_size.width,this._fbo_size.height),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,i),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}return yr(y,[{key:"destroy",value:function(){this._gl&&this._fbo&&(this._gl.deleteFramebuffer(this._fbo),this._fbo=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null))}},{key:"bind",value:function(){var e;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._gl.viewport(0,0,this._fbo_size.width,this._fbo_size.height),(e=this._gl).clearColor.apply(e,zr(y.defaultColor))}},{key:"getFeatureAt",value:function(i,e){var r=this,n=e.radius,t=e.top_most_only,o=void 0===t||t;return!i||i.x<0||i.y<0||1<i.x||1<i.y?Promise.resolve({features:null}):new Promise(function(e,t){r.selection_request_id=r.selection_request_id+1||0,r._requests[r.selection_request_id]={id:r.selection_request_id,point:i,radius:n,top_most_only:o,ttl:o?1:y.MAX_PICKING_TRIES,resolve:e,reject:t}})}},{key:"hasPendingRequests",value:function(){return 0<Object.keys(this._requests).length}},{key:"clearPendingRequests",value:function(){for(var e in this._requests){var t=this._requests[e];t.reject({request:t}),delete this._requests[e]}this._pending_deep_request=null}},{key:"read",value:function(e){if(this.hasPendingRequests()){var t=this._gl;for(var i in t.bindFramebuffer(t.FRAMEBUFFER,this._fbo),this._pending_deep_request&&this.processRequest(this._pending_deep_request,e),this._requests)if(this.processRequest(this._requests[i],e))break;t.bindFramebuffer(t.FRAMEBUFFER,null)}}},{key:"processRequest",value:function(e,t){var i,r,n=this._gl,o=255,s=e.point,a=e.radius;if(a){var l=Math.min(this._fbo_size.width,this._fbo_size.height);r={x:Math.min(Math.ceil(2*a.x*this._fbo_size.width),l),y:Math.min(Math.ceil(2*a.y*this._fbo_size.height),l)}}else a={x:0,y:0},r={x:1,y:1};var u=r.x*r.y*4;if(null==this._pixels||this._pixels.byteLength<u)this._pixels=new Uint8Array(u);else if(this._pixels.fill instanceof Function)this._pixels.fill(0,0,u);else for(var c=0;c<u;c++)this._pixels[c]=0;n.readPixels(Math.round((s.x-a.x)*this._fbo_size.width),Math.round((1-s.y-a.y)*this._fbo_size.height),r.x,r.y,n.RGBA,n.UNSIGNED_BYTE,this._pixels),e.ttl--;var h=4*(Math.round(r.y/2)*r.x+Math.round(r.x/2)),f=this._pixels.slice(0,4),d=this._pixels[h]+(this._pixels[h+1]<<8)+(this._pixels[h+2]<<16);if(0<d)i=d+(this._pixels[h+3]<<24)>>>0,o=this._pixels[h+3];else for(var _=-1>>>0,p=h=0;p<r.y;p++)for(var v=0;v<r.x;v++,h+=4)if(0<(d=this._pixels[h]+(this._pixels[h+1]<<8)+(this._pixels[h+2]<<16))){var m=(v-r.x/2)*(v-r.x/2)+(p-r.y/2)*(p-r.y/2);m<=_&&(f=this._pixels.slice(h,h+4),i=d+(this._pixels[h+3]<<24)>>>0,o=this._pixels[h+3],_=m)}if(255!==o){var g=this._getFeatureWithKey(i,t);if(e.features||(e.features=[]),!g)return void this._finishRead(e);if(e.features.every(function(e){return e.id!==g.id})&&e.features.push(g),e.ttl)return this._pending_deep_request=e,y._discardColor([f[0]/255,f[1]/255,f[2]/255,f[3]/255]),this._has_dirty_buffer=!0;this._finishRead(e)}else this._finishRead(e)}},{key:"_finishRead",value:function(e){var t=e.features||y.EMPTY_ARRAY;e.top_most_only||(this._pending_deep_request=null,y._resetDiscardedColors()),delete this._requests[e.id],e.resolve({features:t})}},{key:"_getFeatureWithKey",value:function(e,t){for(var i=null,r=0;r<t.length;r++){var n=t[r];if(n.selection_data&&(i=n.selection_data[e])){i.tile={coords:n.coords};break}}return i}},{key:"setupDiscards",value:function(e){for(var t=y.MAX_PICKING_TRIES;t--;)e.uniform("4fv","u_selection_discard".concat(t),y._discarded_colors[t]||y.defaultColor)}},{key:"has_dirty_buffer",get:function(){return this._has_dirty_buffer},set:function(e){this._has_dirty_buffer=!!this._pending_deep_request}}],[{key:"makeEntry",value:function(){this.map_entry++;var e=255&this.map_entry,t=this.map_entry>>8&255,i=this.map_entry>>16&255,r=this.map_prefix;return{key:e+(t<<8)+(i<<16)+(r<<24)>>>0,color:[e/255,t/255,i/255,r/255]}}},{key:"reset",value:function(){this.map_entry=0}},{key:"setPrefix",value:function(e){this.map_prefix=e}},{key:"_discardColor",value:function(e){this._discarded_colors.push(e)}},{key:"_resetDiscardedColors",value:function(){this._discarded_colors.length=0}}]),y}();Kl._discarded_colors=[],Kl.map_entry=0,Kl.map_prefix=0,Kl.defaultColor=[0,0,0,1],Kl.MAX_PICKING_TRIES=10,Kl.EMPTY_ARRAY=Object.freeze([]);var $l,Ql=function(){function o(e,t,i,r,n){mr(this,o),n=n||{},this.gl=e,this.vertex_data=t,this.element_data=i,this.vertex_layout=r,this.vertex_buffer=this.gl.createBuffer(),this.buffer_size=this.vertex_data.byteLength,this.draw_mode=n.draw_mode||this.gl.TRIANGLES,this.data_usage=n.data_usage||this.gl.STATIC_DRAW,this.vertices_per_geometry=3,this.uniforms=n.uniforms,this.textures=n.textures,this.retain=n.retain||!1,this.created_at=+new Date,this.fade_in_time=n.fade_in_time||0,this.vertex_count=this.vertex_data.byteLength/this.vertex_layout.stride,this.element_count=0,this.vaos={},this.toggle_element_array=!1,this.element_data?(this.toggle_element_array=!0,this.element_count=this.element_data.length,this.geometry_count=this.element_count/this.vertices_per_geometry,this.element_type=this.element_data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,this.element_buffer=this.gl.createBuffer(),this.buffer_size+=this.element_data.byteLength,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.element_buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.element_data,this.data_usage)):this.geometry_count=this.vertex_count/this.vertices_per_geometry,this.upload(),this.retain||(delete this.vertex_data,delete this.element_data),this.valid=!0}return yr(o,[{key:"render",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};if(!this.valid)return!1;var i=t.program||Zl.current;i.use(),this.uniforms&&(i.saveUniforms(this.uniforms),i.setUniforms(this.uniforms,!1));var r=(+new Date-this.created_at)/1e3;return i.uniform("1f","u_visible_time",r),this.bind(i),this.toggle_element_array?this.gl.drawElements(this.draw_mode,this.element_count,this.element_type,0):this.gl.drawArrays(this.draw_mode,0,this.vertex_count),Jl.bind(this.gl,null),this.uniforms&&i.restoreUniforms(this.uniforms),r<this.fade_in_time}},{key:"bind",value:function(t){var i=this,e=this.vaos[t.id];e?Jl.bind(this.gl,e):this.vaos[t.id]=Jl.create(this.gl,function(e){i.gl.bindBuffer(i.gl.ARRAY_BUFFER,i.vertex_buffer),i.toggle_element_array&&i.gl.bindBuffer(i.gl.ELEMENT_ARRAY_BUFFER,i.element_buffer),i.vertex_layout.enable(i.gl,t,e)})}},{key:"upload",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertex_data,this.data_usage)}},{key:"destroy",value:function(){if(!this.valid)return!1;for(var e in this.valid=!1,this.vaos)Jl.destroy(this.gl,this.vaos[e]);return this.gl.deleteBuffer(this.vertex_buffer),this.vertex_buffer=null,this.element_buffer&&(this.gl.deleteBuffer(this.element_buffer),this.element_buffer=null),delete this.vertex_data,delete this.element_data,this.textures&&this.textures.forEach(function(e){return Jo.release(e)}),!0}}]),o}(),eu=["emission","ambient","diffuse","specular"],tu=function(){function e(i){var r=this;mr(this,e),i=i||{},eu.forEach(function(e){var t=i[e];null!=t&&(t.texture?r[e]={texture:t.texture,mapping:t.mapping||"spheremap",scale:Gl.expandVec3(null!=t.scale?t.scale:1),amount:Gl.expandVec4(null!=t.amount?t.amount:1)}:"number"==typeof t||Array.isArray(t)?r[e]={amount:Gl.expandVec4(t)}:r[e]="string"==typeof t?{amount:Fo.parseColor(t)}:t)}),this.specular&&(this.specular.shininess=i.shininess?parseFloat(i.shininess):.2),null!=i.normal&&(this.normal={texture:i.normal.texture,mapping:i.normal.mapping||"triplanar",scale:Gl.expandVec3(null!=i.normal.scale?i.normal.scale:1),amount:null!=i.normal.amount?i.normal.amount:1})}return yr(e,[{key:"inject",value:function(r){var n=this;eu.forEach(function(e){var t="TANGRAM_MATERIAL_".concat(e.toUpperCase()),i=t+"_TEXTURE";r.defines[t]=null!=n[e],n[e]&&n[e].texture&&(r.defines[i]=!0,r.defines[i+"_"+n[e].mapping.toUpperCase()]=!0,r.defines["TANGRAM_MATERIAL_TEXTURE_".concat(n[e].mapping.toUpperCase())]=!0,r.texcoords=r.texcoords||"uv"===n[e].mapping)}),this.normal&&this.normal.texture&&(r.defines.TANGRAM_MATERIAL_NORMAL_TEXTURE=!0,r.defines["TANGRAM_MATERIAL_NORMAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,r.defines["TANGRAM_MATERIAL_TEXTURE_".concat(this.normal.mapping.toUpperCase())]=!0,r.texcoords=r.texcoords||"uv"===this.normal.mapping),r.replaceShaderBlock(e.block,"/*Defines globals:materiallight_accumulator_**/struct Material{\n#ifdef TANGRAM_MATERIAL_EMISSION\nvec4 emission;\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nvec3 emissionScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT\nvec4 ambient;\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nvec3 ambientScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nvec4 diffuse;\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nvec3 diffuseScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nvec4 specular;float shininess;\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nvec3 specularScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvec3 normalScale;float normalAmount;\n#endif\n};uniform Material u_material;Material material;\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nuniform sampler2D u_material_emission_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nuniform sampler2D u_material_ambient_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nuniform sampler2D u_material_diffuse_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nuniform sampler2D u_material_specular_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nuniform sampler2D u_material_normal_texture;\n#endif\nvec4 light_accumulator_ambient=vec4(vec3(0.0),1.);vec4 light_accumulator_diffuse=vec4(vec3(0.0),1.);\n#ifdef TANGRAM_MATERIAL_SPECULAR\nvec4 light_accumulator_specular=vec4(vec3(0.0),1.);\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_SPHEREMAP\nvec4 getSphereMap(in sampler2D _tex,in vec3 _eyeToPoint,in vec3 _normal,in vec2 _skew){vec3 eye=normalize(_eyeToPoint);eye.xy-=_skew;eye=normalize(eye);vec3 r=reflect(eye,_normal);r.z+=1.0;float m=2.*length(r);vec2 uv=r.xy/m+.5;return texture2D(_tex,uv);}\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_TRIPLANAR\nvec3 getTriPlanarBlend(in vec3 _normal){vec3 blending=abs(_normal);blending=normalize(max(blending,0.00001));float b=(blending.x+blending.y+blending.z);return blending/b;}vec4 getTriPlanar(in sampler2D _tex,in vec3 _pos,in vec3 _normal,in vec3 _scale){vec3 blending=getTriPlanarBlend(_normal);vec4 xaxis=texture2D(_tex,fract(_pos.yz*_scale.x));vec4 yaxis=texture2D(_tex,fract(_pos.xz*_scale.y));vec4 zaxis=texture2D(_tex,fract(_pos.xy*_scale.z));return xaxis*blending.x+yaxis*blending.y+zaxis*blending.z;}\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_PLANAR\nvec4 getPlanar(in sampler2D _tex,in vec3 _pos,in vec2 _scale){return texture2D(_tex,fract(_pos.xy*_scale.x));}\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvoid calculateNormal(inout vec3 _normal){\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_UV\n_normal+=texture2D(u_material_normal_texture,fract(v_texcoord*material.normalScale.xy)).rgb*2.0-1.0;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_PLANAR\nvec3 normalTex=getPlanar(u_material_normal_texture,v_world_position.xyz,material.normalScale.xy).rgb*2.0-1.0;_normal+=normalTex;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_TRIPLANAR\nvec3 normalTex=getTriPlanar(u_material_normal_texture,v_world_position.xyz,_normal,material.normalScale).rgb*2.0-1.0;_normal+=normalTex;\n#endif\n_normal=normalize(_normal);}\n#endif\nvoid calculateMaterial(in vec3 _eyeToPoint,inout vec3 _normal){\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_UV\nmaterial.emission*=texture2D(u_material_emission_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_PLANAR\nmaterial.emission*=getPlanar(u_material_emission_texture,v_world_position.xyz,material.emissionScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_TRIPLANAR\nmaterial.emission*=getTriPlanar(u_material_emission_texture,v_world_position.xyz,_normal,material.emissionScale);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_SPHEREMAP\nmaterial.emission*=getSphereMap(u_material_emission_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_UV\nmaterial.ambient*=texture2D(u_material_ambient_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_PLANAR\nmaterial.ambient*=getPlanar(u_material_ambient_texture,v_world_position.xyz,material.ambientScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_TRIPLANAR\nmaterial.ambient*=getTriPlanar(u_material_ambient_texture,v_world_position.xyz,_normal,material.ambientScale);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_SPHEREMAP\nmaterial.ambient*=getSphereMap(u_material_ambient_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_UV\nmaterial.diffuse*=texture2D(u_material_diffuse_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_PLANAR\nmaterial.diffuse*=getPlanar(u_material_diffuse_texture,v_world_position.xyz,material.diffuseScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_TRIPLANAR\nmaterial.diffuse*=getTriPlanar(u_material_diffuse_texture,v_world_position.xyz,_normal,material.diffuseScale);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_SPHEREMAP\nmaterial.diffuse*=getSphereMap(u_material_diffuse_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_UV\nmaterial.specular*=texture2D(u_material_specular_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_PLANAR\nmaterial.specular*=getPlanar(u_material_specular_texture,v_world_position.xyz,material.specularScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_TRIPLANAR\nmaterial.specular*=getTriPlanar(u_material_specular_texture,v_world_position.xyz,_normal,material.specularScale);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_SPHEREMAP\nmaterial.specular*=getSphereMap(u_material_specular_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n}","Material"),r.addShaderBlock("setup","\nmaterial = u_material;\n","Material")}},{key:"setupProgram",value:function(t){var i=this;eu.forEach(function(e){i[e]&&(i[e].texture?(t.setTextureUniform("u_material_".concat(e,"_texture"),i[e].texture),t.uniform("3fv","u_material.".concat(e,"Scale"),i[e].scale),t.uniform("4fv","u_material.".concat(e),i[e].amount)):i[e].amount&&t.uniform("4fv","u_material.".concat(e),i[e].amount))}),this.specular&&t.uniform("1f","u_material.shininess",this.specular.shininess),this.normal&&this.normal.texture&&(t.setTextureUniform("u_material_normal_texture",this.normal.texture),t.uniform("3fv","u_material.normalScale",this.normal.scale),t.uniform("1f","u_material.normalAmount",this.normal.amount))}}],[{key:"isValid",value:function(e){return null!=e&&(null!=e.emission||null!=e.ambient||null!=e.diffuse||null!=e.specular)}}]),e}();tu.block="material";var iu=$l={};$l.copy=function(e){for(var t=[],i=e.length,r=0;r<i;r++)t[r]=e[r];return t},$l.neg=function(e){for(var t=[],i=e.length,r=0;r<i;r++)t[r]=-e[r];return t},$l.add=function(e,t){for(var i=[],r=Math.min(e.length,t.length),n=0;n<r;n++)i[n]=e[n]+t[n];return i},$l.sub=function(e,t){for(var i=[],r=Math.min(e.length,t.length),n=0;n<r;n++)i[n]=e[n]-t[n];return i},$l.signed_area=function(e,t,i){return(t[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(t[1]-e[1])},$l.mult=function(e,t){var i,r=[],n=e.length;if("number"==typeof t)for(i=0;i<n;i++)r[i]=e[i]*t;else for(n=Math.min(e.length,t.length),i=0;i<n;i++)r[i]=e[i]*t[i];return r},$l.multMatrix=function(e,t){return[e[0][0]*t[0]+e[0][1]*t[1],e[1][0]*t[0]+e[1][1]*t[1]]},$l.div=function(e,t){var i,r=[];if("number"==typeof t)for(i=0;i<e.length;i++)r[i]=e[i]/t;else{var n=Math.min(e.length,t.length);for(i=0;i<n;i++)r[i]=e[i]/t[i]}return r},$l.perp=function(e,t){return[t[1]-e[1],e[0]-t[0]]},$l.rot=function(e,t){var i=Math.cos(t),r=Math.sin(t);return[e[0]*i-e[1]*r,e[0]*r+e[1]*i]},$l.angle=function(e){var t=Sr(e,2),i=t[0],r=t[1];return Math.atan2(r,i)},$l.angleBetween=function(e,t){var i=$l.dot($l.normalize($l.copy(e)),$l.normalize($l.copy(t)));return 1<i&&(i=1),Math.acos(i)},$l.signedAngleBetween=function(e,t){return Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1])},$l.isEqual=function(e,t){for(var i=e.length,r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0},$l.lengthSq=function(e){return 2===e.length?e[0]*e[0]+e[1]*e[1]:3<=e.length?e[0]*e[0]+e[1]*e[1]+e[2]*e[2]:0},$l.length=function(e){return Math.sqrt($l.lengthSq(e))},$l.normalize=function(e){var t;if(2===e.length){if(1===(t=e[0]*e[0]+e[1]*e[1]))return e;0!==(t=Math.sqrt(t))?(e[0]/=t,e[1]/=t):(e[0]=0,e[1]=0)}else if(3<=e.length){if(1===(t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2]))return e;0!==(t=Math.sqrt(t))?(e[0]/=t,e[1]/=t,e[2]/=t):(e[0]=0,e[1]=0,e[2]=0)}return e},$l.cross=function(e,t){return 2===e.length?e[0]*t[1]-e[1]*t[0]:3===e.length?[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]:void 0},$l.dot=function(e,t){for(var i=0,r=Math.min(e.length,t.length),n=0;n<r;n++)i+=e[n]*t[n];return i};var ru=function(){function a(e,t){mr(this,a),this.name=t.name,this.view=e,null==t.ambient||"number"==typeof t.ambient?this.ambient=Gl.expandVec3(t.ambient||0):this.ambient=Fo.parseColor(t.ambient).slice(0,3),null==t.diffuse||"number"==typeof t.diffuse?this.diffuse=Gl.expandVec3(null!=t.diffuse?t.diffuse:1):this.diffuse=Fo.parseColor(t.diffuse).slice(0,3),null==t.specular||"number"==typeof t.specular?this.specular=Gl.expandVec3(t.specular||0):this.specular=Fo.parseColor(t.specular).slice(0,3)}return yr(a,[{key:"inject",value:function(){var e="\n            uniform ".concat(this.struct_name," u_").concat(this.name,";\n            ").concat(this.struct_name," ").concat(this.name,";\n            "),t="\n            ".concat(this.name," = u_").concat(this.name,";\n\n        ");Zl.addBlock(a.block,e),Zl.addBlock("setup",t)}},{key:"update",value:function(){}},{key:"setupProgram",value:function(e){e.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient),e.uniform("3fv","u_".concat(this.name,".diffuse"),this.diffuse),e.uniform("3fv","u_".concat(this.name,".specular"),this.specular)}}],[{key:"create",value:function(e,t){if(a.types[t.type])return new a.types[t.type](e,t)}},{key:"setMode",value:function(e,t){!0===e&&(e="fragment"),e=a.enabled&&(null!=e?e:"fragment"),t.defines.TANGRAM_LIGHTING_FRAGMENT="fragment"===e,t.defines.TANGRAM_LIGHTING_VERTEX="vertex"===e}},{key:"inject",value:function(e){if(Zl.removeBlock(a.block),a.enabled){var t="";if(e&&0<Object.keys(e).length){var i={};for(var r in e)i[e[r].type]=!0;for(var n in i)a.types[n].inject();for(var o in e)e[o].inject(),t+="calculateLight(".concat(o,", _eyeToPoint, _normal);\n")}var s="\n            vec4 calculateLighting(in vec3 _eyeToPoint, in vec3 _normal, in vec4 _color) {\n\n                // Do initial material calculations over normal, emission, ambient, diffuse and specular values\n                calculateMaterial(_eyeToPoint,_normal);\n\n                // Un roll the loop of individual ligths to calculate\n                ".concat(t,"\n\n                //  Final light intensity calculation\n                vec4 color = vec4(vec3(0.), _color.a); // start with vertex color alpha\n\n                #ifdef TANGRAM_MATERIAL_EMISSION\n                    color.rgb = material.emission.rgb;\n                    color.a *= material.emission.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_AMBIENT\n                    color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.ambient.rgb;\n                    color.a *= material.ambient.a;\n                #else\n                    #ifdef TANGRAM_MATERIAL_DIFFUSE\n                        color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.diffuse.rgb;\n                    #endif\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_DIFFUSE\n                    color.rgb += light_accumulator_diffuse.rgb * _color.rgb * material.diffuse.rgb;\n                    color.a *= material.diffuse.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_SPECULAR\n                    color.rgb += light_accumulator_specular.rgb * material.specular.rgb;\n                    color.a *= material.specular.a;\n                #endif\n\n                // Clamp final color\n                color = clamp(color, 0.0, 1.0);\n\n                return color;\n            }");Zl.addBlock(a.block,s)}}}]),a}();ru.types={},ru.block="lighting",ru.enabled=!0;var nu=function(){function r(e,t){var i;return mr(this,r),(i=Mr(this,wr(r).call(this,e,t))).type="ambient",i.struct_name="AmbientLight",i}return br(r,ru),yr(r,[{key:"setupProgram",value:function(e){e.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient)}}],[{key:"inject",value:function(){Zl.addBlock(ru.block,"/*Expected globals:light_accumulator_**/struct AmbientLight{vec3 ambient;};void calculateLight(in AmbientLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;}")}}]),r}();ru.types.ambient=nu;var ou=function(){function n(e,t){var i;if(mr(this,n),(i=Mr(this,wr(n).call(this,e,t))).type="directional",i.struct_name="DirectionalLight",t.direction)i._direction=t.direction;else{var r=Math.sin(60*Math.PI/180);i._direction=[Math.cos(135*Math.PI/180)*r,Math.sin(135*Math.PI/180)*r,-.5]}return null==t.ambient&&(i.ambient=Gl.expandVec3(.5)),i.direction=i._direction.map(parseFloat),i._initial_direction=[i.direction[0],i.direction[1],i.direction[2]],i}return br(n,ru),yr(n,[{key:"update",value:function(){$o.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}},{key:"setupProgram",value:function(e){Rr(wr(n.prototype),"setupProgram",this).call(this,e),e.uniform("3fv","u_".concat(this.name,".direction"),this.direction)}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=iu.normalize(iu.copy(e))}}],[{key:"inject",value:function(){Zl.addBlock(ru.block,"/*Expected globals:materiallight_accumulator_**/struct DirectionalLight{vec3 ambient;vec3 diffuse;vec3 specular;vec3 direction;};void calculateLight(in DirectionalLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;float nDotVP=clamp(dot(_normal,-_light.direction),0.0,1.0);\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(_light.direction,_normal);float eyeDotR=max(dot(normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf;\n#endif\n}")}}]),n}();ru.types.directional=ou;var su=function(){function r(e,t){var i;return mr(this,r),(i=Mr(this,wr(r).call(this,e,t))).type="point",i.struct_name="PointLight",i.position=t.position||[0,0,"100px"],i.position_eye=[],i.origin=t.origin||"ground",i.attenuation=isNaN(parseFloat(t.attenuation))?0:parseFloat(t.attenuation),t.radius?Array.isArray(t.radius)&&2===t.radius.length?i.radius=t.radius:i.radius=[null,t.radius]:i.radius=null,i}return br(r,ru),yr(r,[{key:"inject",value:function(){Rr(wr(r.prototype),"inject",this).call(this),Zl.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT=0!==this.attenuation,Zl.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS=null!=this.radius&&null!=this.radius[0],Zl.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS=null!=this.radius}},{key:"update",value:function(){var e=this.view.lookAtManipulator.getLookAtData().zoom;if("world"===this.origin){var t=Sr(Kr.latLngToMeters(this.position),2),i=t[0],r=t[1];this.position_eye[0]=i-this.view.lookAtManipulator.getLookAtData().position[0],this.position_eye[1]=r-this.view.lookAtManipulator.getLookAtData().position[1],this.position_eye[2]=Fo.convertUnits(this.position[2],{zoom:e,meters_per_pixel:Kr.metersPerPixel(e)}),this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance}else"ground"!==this.origin&&"camera"!==this.origin||(this.position_eye=Fo.convertUnits(this.position,{zoom:e,meters_per_pixel:Kr.metersPerPixel(e)}),"ground"===this.origin&&(this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance));this.position_eye[3]=1}},{key:"setupProgram",value:function(e){Rr(wr(r.prototype),"setupProgram",this).call(this,e),e.uniform("4fv","u_".concat(this.name,".position"),this.position_eye),Zl.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT&&e.uniform("1f","u_".concat(this.name,".attenuationExponent"),this.attenuation);var t=this.view.lookAtManipulator.getLookAtData().zoom;Zl.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS&&e.uniform("1f","u_".concat(this.name,".innerRadius"),Fo.convertUnits(this.radius[0],{zoom:t,meters_per_pixel:Kr.metersPerPixel(t)})),Zl.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS&&e.uniform("1f","u_".concat(this.name,".outerRadius"),Fo.convertUnits(this.radius[1],{zoom:t,meters_per_pixel:Kr.metersPerPixel(t)}))}}],[{key:"inject",value:function(){Zl.addBlock(ru.block,"/*Expected globals:materiallight_accumulator_**/struct PointLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat attenuationExponent;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nfloat innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat outerRadius;\n#endif\n};void calculateLight(in PointLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(VP,_normal),0.0,1.0);float attenuation=1.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat Rin=1.0;float e=_light.attenuationExponent;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);\n#endif\n#else\nfloat Rin=0.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);\n#endif\n#else\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;\n#else\nattenuation=1.0;\n#endif\n#endif\n#endif\nlight_accumulator_ambient.rgb+=_light.ambient*attenuation;\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(0.0,dot(-normalize(_eyeToPoint),reflectVector));pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation;\n#endif\n}")}}]),r}();ru.types.point=su;var au=function(){function r(e,t){var i;return mr(this,r),(i=Mr(this,wr(r).call(this,e,t))).type="spotlight",i.struct_name="SpotLight",i.direction=i._direction=(t.direction||[0,0,-1]).map(parseFloat),i._initial_direction=[i.direction[0],i.direction[1],i.direction[2]],i.exponent=t.exponent?parseFloat(t.exponent):.2,i.angle=t.angle?parseFloat(t.angle):20,i}return br(r,su),yr(r,[{key:"setupProgram",value:function(e){Rr(wr(r.prototype),"setupProgram",this).call(this,e),e.uniform("3fv","u_".concat(this.name,".direction"),this.direction),e.uniform("1f","u_".concat(this.name,".spotCosCutoff"),Math.cos(3.14159*this.angle/180)),e.uniform("1f","u_".concat(this.name,".spotExponent"),this.exponent)}},{key:"update",value:function(){Rr(wr(r.prototype),"update",this).call(this),$o.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}},{key:"direction",get:function(){return this._direction},set:function(e){this._direction=iu.normalize(iu.copy(e))}}],[{key:"inject",value:function(){Zl.addBlock(ru.block,"/*Expected globals:materiallight_accumulator_**/struct SpotLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat attenuationExponent;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nfloat innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat outerRadius;\n#endif\nvec3 direction;float spotCosCutoff;float spotExponent;};void calculateLight(in SpotLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(_normal,VP),0.0,1.0);float attenuation=1.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat Rin=1.0;float e=_light.attenuationExponent;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);\n#endif\n#else\nfloat Rin=0.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);\n#endif\n#else\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;\n#else\nattenuation=1.0;\n#endif\n#endif\n#endif\nfloat spotAttenuation=0.0;float spotDot=clamp(dot(-VP,_light.direction),0.0,1.0);if(spotDot>=_light.spotCosCutoff){spotAttenuation=pow(spotDot,_light.spotExponent);}light_accumulator_ambient.rgb+=_light.ambient*attenuation*spotAttenuation;\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation*spotAttenuation;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(dot(-normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation*spotAttenuation;\n#endif\n}")}}]),r}();ru.types.spotlight=au;var lu,uu="\n#ifdef TANGRAM_FRAGMENT_SHADER\nuniform sampler2D u_rasters[TANGRAM_NUM_RASTER_SOURCES];uniform vec2 u_raster_sizes[TANGRAM_NUM_RASTER_SOURCES];uniform vec3 u_raster_offsets[TANGRAM_NUM_RASTER_SOURCES];\n#define adjustRasterUV(raster_index, uv) ((uv) * u_raster_offsets[raster_index].z + u_raster_offsets[raster_index].xy)\n#define currentRasterUV(raster_index) (adjustRasterUV(raster_index, v_modelpos_base_zoom.xy))\n#define currentRasterPixel(raster_index) (currentRasterUV(raster_index) * rasterPixelSize(raster_index))\n#define sampleRaster(raster_index) (texture2D(u_rasters[raster_index], currentRasterUV(raster_index)))\n#define sampleRasterAtPixel(raster_index, pixel) (texture2D(u_rasters[raster_index], adjustRasterUV(raster_index, (pixel) / rasterPixelSize(raster_index))))\n#define rasterPixelSize(raster_index) (u_raster_sizes[raster_index])\n#endif\n",cu={init:function(e){var t=0<arguments.length&&void 0!==e?e:{},i=t.generation,r=t.styles,n=t.sources,o=void 0===n?{}:n,s=t.introspection,a=t.id,l=void 0!==a?a+"/":"";this.main_thread_target="".concat(l,"Style/").concat(this.name),this.setGeneration(i),this.styles=r,this.sources=o,this.defines=this.hasOwnProperty("defines")&&this.defines||{},this.shaders=this.hasOwnProperty("shaders")&&this.shaders||{},this.introspection=s||!1,this.selection=this.selection||this.introspection||!1,this.compile_setup=!1,this.program=null,this.selection_program=null,this.feature_style={},this.vertex_template=[],this.tile_data={},this.defines.TANGRAM_WORLD_POSITION_WRAP=1e5,this.blend=this.blend||"opaque",this.defines["TANGRAM_BLEND_".concat(this.blend.toUpperCase())]=!0,null==this.blend_order&&(this.blend_order=-1),this.removeShaderBlock("setup"),this.material instanceof tu||(tu.isValid(this.material)||(this.material=Fo.defaults.material),this.material=new tu(this.material)),this.material.inject(this),ru.setMode(this.lighting,this),this.setupRasters(),this.initialized=!0},destroy:function(){this.program&&(this.program.destroy(),this.program=null),this.selection_program&&(this.selection_program.destroy(),this.selection_program=null),Cr.removeTarget(this.main_thread_target),this.gl=null,this.initialized=!1},reset:function(){},baseStyle:function(){return this.base||this.name},setGeneration:function(e){this.generation=e,Ir.is_main&&Cr.addTarget(this.main_thread_target,this)},fillVertexTemplate:function(e,t,i,r){var n=r.size,o=r.offset;o=void 0===o?0:o;var s=e.index[t];if(void 0!==s)for(var a=0;a<n;++a){var l=i.length>a?i[a]:i;this.vertex_template[s+a+o]=l}else Jr("warn","Style: in style '".concat(this.name,"', no index found in vertex layout for attribute '").concat(t,"'"))},startData:function(e){this.tile_data[e.id]=this.tile_data[e.id]||{meshes:{},uniforms:{},textures:[]}},endData:function(e){var t=this.tile_data[e.id];if(this.tile_data[e.id]=null,t&&0<Object.keys(t.meshes).length){for(var i in t.meshes){var r=t.meshes[i];0!==r.vertex_data.vertex_count?(r.vertex_data.end(),r.vertex_elements=r.vertex_data.element_buffer,r.vertex_data=r.vertex_data.vertex_buffer):delete t.meshes[i]}return e.mesh_data[this.name]=t,this.buildRasterTextures(e,t).then(function(e){return e})}return Promise.resolve(null)},hasDataForTile:function(e){return null!=this.tile_data[e.id]},getTileMesh:function(e,t){var i=this.tile_data[e.id].meshes;return null==i[t.key]&&(i[t.key]={variant:t,vertex_data:this.vertexLayoutForMeshVariant(t).createVertexData()}),i[t.key]},vertexLayoutForMeshVariant:function(e){return this.vertex_layout},default_mesh_variant:{key:0},meshVariantTypeForDraw:function(e){return this.default_mesh_variant},addFeature:function(e,t,i){var r=i.tile;this.tile_data[r.id]||this.startData(r);var n=this.parseFeature(e,t,i);if(n){var o=this.getTileMesh(r,this.meshVariantTypeForDraw(n)),s=o.vertex_data.offset,a=o.vertex_data.vertex_count;0<this.buildGeometry(e.geometry,n,o,i)?e.generation=this.generation:o.vertex_data.vertex_count>a&&(o.vertex_data.vertex_buffer.fill(0,s,o.vertex_data.offset),o.vertex_data.vertex_count=a,o.vertex_data.offset=s)}},buildGeometry:function(e,t,i,r){var n;return"Polygon"===e.type?n=this.buildPolygons([e.coordinates],t,i,r):"MultiPolygon"===e.type?n=this.buildPolygons(e.coordinates,t,i,r):"LineString"===e.type?n=this.buildLines([e.coordinates],t,i,r):"MultiLineString"===e.type?n=this.buildLines(e.coordinates,t,i,r):"Point"===e.type?n=this.buildPoints([e.coordinates],t,i,r):"MultiPoint"===e.type&&(n=this.buildPoints(e.coordinates,t,i,r)),n},parseFeature:function(t,e,i){try{var r=this.feature_style;if(r.order=this.parseOrder(e.order,i),null==r.order&&"overlay"!==this.blend){var n="Layer '".concat(e.layers.join(", "),"', draw group '").concat(e.group,"': ");return n+="'order' parameter is required unless blend mode is 'overlay'",null!=e.order&&(n+="; 'order' was set to a dynamic value (e.g. string tied to feature property, ",n+="or JS function), but evaluated to null for one or more features"),void Jr({level:"warn",once:!0},n)}if(!(r=this._parseFeature(t,e,i)))return;if(this.selection?r.interactive=Fo.evalProperty(this.introspection||e.interactive,i):r.interactive=!1,!0===r.interactive){var o=Kl.makeEntry(),s=o.color,a=o.key;r.selection_color=s,i.tile.selection_data||(i.tile.selection_data={}),i.tile.selection_data[a]={id:t.id||a,properties:t.properties,source_name:i.source,source_layer:i.layer,layers:i.layers}}else r.selection_color=Kl.defaultColor;return r}catch(e){Jr("error","Style.parseFeature: style parsing error",t,r,e.stack)}},_parseFeature:function(e,t,i){return this.feature_style},preprocess:function(e,t){if(!e.preprocessed){if(this.draw)for(var i in this.draw){var r=this.draw[i];"object"!==vr(r)||Array.isArray(r)?null==e[i]&&(e[i]=r):e[i]=hl({},r,e[i])}var n=t||"";if(!(e=this._preprocess(e,n)))return;e.preprocessed=!0}return e},_preprocess:function(e,t){return e},parseOrder:function(e,t){return"number"!=typeof e?Fo.calculateOrder(e,t):e},scaleOrder:function(e){return 2*e},parseColor:function(e,t){return e?Fo.evalCachedColorProperty(e,t):this.shaders.blocks.color||this.shaders.blocks.filter?Fo.defaults.color:void 0},buildPolygons:function(){return 0},buildLines:function(){return 0},buildPoints:function(){return 0},setGL:function(e){this.gl=e,this.max_texture_size=Jo.getMaxTextureSize(this.gl)},makeMesh:function(e,t,i){var r=2<arguments.length&&void 0!==i?i:{},n=this.vertexLayoutForMeshVariant(r.variant);return new Ql(this.gl,e,t,n,r)},render:function(e){return e.render()},getProgram:function(e){var t=0<arguments.length&&void 0!==e?e:"program";this.compileSetup();var i=this[t];if(i&&!i.error){if(!i.compiled)try{i.compile()}catch(e){Jr("error","Style: error compiling program for style '".concat(this.name,"' (program key '").concat(t,"')"),this,e.stack)}return i}},compileSetup:function(){if(!this.compile_setup){if(!this.gl)throw new Error("style.compile(): skipping for ".concat(this.name," because no GL context"));var e=this.buildDefineList();if(this.selection){var t=Object.assign({},e);t.TANGRAM_FEATURE_SELECTION=!0}var i=this.shaders&&this.shaders.blocks,r=this.shaders&&this.shaders.block_scopes,n=Object.assign({},this.shaders&&this.shaders.uniforms);for(var o in n)null==n[o]&&Jr({level:"warn",once:!0},"Style '".concat(this.name,"' has invalid uniform '").concat(o,"': uniform values must be non-null"));var s=this.shaders&&this.shaders.extensions;"string"==typeof s&&(s=[s]),this.program=new Zl(this.gl,this.vertex_shader_src,this.fragment_shader_src,{name:this.name,defines:e,uniforms:n,blocks:i,block_scopes:r,extensions:s}),this.selection?this.selection_program=new Zl(this.gl,this.vertex_shader_src,this.crop_by_tile?"\n#pragma tangram: utils\n#ifdef TANGRAM_FEATURE_SELECTION\nuniform float u_tile_size;uniform vec3 u_map_position;uniform float u_meters_per_pixel;varying vec4 v_selection_color;varying vec4 v_world_position;varying vec4 v_wrapped_tile_origin;\n#endif\nvoid main(void){\n#ifdef TANGRAM_FEATURE_SELECTION\nif(isPixelOutsideTile(u_tile_size,u_meters_per_pixel,u_map_position,v_world_position,v_wrapped_tile_origin)){discard;}else{gl_FragColor=v_selection_color;}\n#else\ngl_FragColor=vec4(0.,0.,0.,1.);\n#endif\n}":"\n#ifdef TANGRAM_FEATURE_SELECTION\nvarying vec4 v_selection_color;\n#endif\nvoid main(void){\n#ifdef TANGRAM_FEATURE_SELECTION\ngl_FragColor=v_selection_color;\n#else\ngl_FragColor=vec4(0.,0.,0.,1.);\n#endif\n}",{name:this.name+" (selection)",defines:t,uniforms:n,blocks:i,block_scopes:r,extensions:s}):this.selection_program=null,this.compile_setup=!0}},addShaderBlock:function(e,t,i){var r=2<arguments.length&&void 0!==i?i:null;this.shaders.blocks=this.shaders.blocks||{},this.shaders.blocks[e]=this.shaders.blocks[e]||[],this.shaders.blocks[e].push(t),this.shaders.block_scopes=this.shaders.block_scopes||{},this.shaders.block_scopes[e]=this.shaders.block_scopes[e]||[],this.shaders.block_scopes[e].push(r)},removeShaderBlock:function(e){this.shaders.blocks&&(this.shaders.blocks[e]=null)},replaceShaderBlock:function(e,t,i){var r=2<arguments.length&&void 0!==i?i:null;this.removeShaderBlock(e),this.addShaderBlock(e,t,r)},buildDefineList:function(){var e={};if(null!=this.defines)for(var t in this.defines)e[t]=this.defines[t];if(null!=this.shaders&&null!=this.shaders.defines)for(t in this.shaders.defines)e[t]=this.shaders.defines[t];return e},hasRasters:function(){return-1<["color","normal","custom"].indexOf(this.raster)},setupRasters:function(){var t=this;if(this.hasRasters()){"color"===this.raster?this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0:"normal"===this.raster&&(this.defines.TANGRAM_RASTER_TEXTURE_NORMAL=!0);var e=Object.keys(this.sources).filter(function(e){return t.sources[e]instanceof os}).length;this.defines.TANGRAM_NUM_RASTER_SOURCES="".concat(e),0<e&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",uu,"Raster"))}},buildRasterTextures:function(l,u){var t=this;if(!this.hasRasters())return Promise.resolve(u);var c={},h={};return l.rasters.map(function(e){return t.sources[e]}).filter(function(e){return e}).forEach(function(e,t){if(e instanceof os){var i=e.tileTexture(l);c[i.url]=i,h[i.url]=t}}),0===Object.keys(c).length?Promise.resolve(u):Cr.postMessage(this.main_thread_target+".loadTextures",c).then(function(e){if(!e||e.length<1)return Jr("trace","Missing texture info for tile ".concat(l.key)),null;if(e.some(function(e){return!e.loaded}))return null;u.uniforms=u.uniforms||{},u.textures=u.textures||[];var o=u.uniforms.u_rasters=[],s=u.uniforms.u_raster_sizes=[],a=u.uniforms.u_raster_offsets=[];return e.forEach(function(e){var t=h[e.name],i=c[e.name].coords;if(o[t]=e.name,u.textures.push(e.name),s[t]=[e.width,e.height],l.coords.z>i.z){var r=l.coords.z-i.z,n=Math.pow(2,r);a[t]=[(l.coords.x%n+n)%n/n,(n-1-l.coords.y%n)/n,1/n]}else a[t]=[0,0,1]}),u})},loadTextures:function(e){return Jo.createFromObject(this.gl,e).then(function(){return Promise.all(Object.keys(e).map(function(e){return Jo.textures[e]&&Jo.textures[e].load()}).filter(function(e){return e}))}).then(function(e){return e.forEach(function(e){return e.retain()}),e.map(function(e){return{name:e.name,width:e.width,height:e.height,loaded:e.loaded}})})},setup:function(){this.setUniforms(),this.material.setupProgram(Zl.current)},setUniforms:function(){var e=Zl.current;e&&e.setUniforms(this.shaders&&this.shaders.uniforms,!0)},render_states:{opaque:{depth_test:!0,depth_write:!0},translucent:{depth_test:!0,depth_write:!0},add:{depth_test:!0,depth_write:!1},multiply:{depth_test:!0,depth_write:!1},inlay:{depth_test:!0,depth_write:!1},overlay:{depth_test:!1,depth_write:!1}},default_blend_orders:{opaque:0,add:1,multiply:2,inlay:3,translucent:4,overlay:5},blendOrderSort:function(e,t){var i=parseInt(e.name)-parseInt(t.name);return i||("opaque"===e.blend||"opaque"===t.blend?"opaque"===e.blend&&"opaque"===t.blend?e.name<t.name?-1:1:"opaque"===e.blend?-1:1:e.blend_order<t.blend_order?-1:e.blend_order>t.blend_order?1:cu.default_blend_orders[e.blend]<cu.default_blend_orders[t.blend]?-1:cu.default_blend_orders[e.blend]>cu.default_blend_orders[t.blend]?1:e.name<t.name?-1:1)}},hu=lu={};lu.BYTE=5120,lu.UNSIGNED_BYTE=5121,lu.SHORT=5122,lu.UNSIGNED_SHORT=5123,lu.INT=5124,lu.UNSIGNED_INT=5125,lu.FLOAT=5126;var fu,du=Math.pow(2,16)-1,_u=!1,pu=function(){function t(e){mr(this,t),this.size_=e||1024,this.position_=0,this.ArrayType_=Uint16Array,this.buffer_=new this.ArrayType_(this.size_),this.overflows_=!1}return yr(t,[{key:"push",value:function(e){if(!this.overflows_||_u){if(du<e){if(this.overflows_=!0,!_u)return;this.ArrayType_===Uint16Array&&(this.ArrayType_=Uint32Array,this.buffer_=new this.ArrayType_(this.buffer_))}this.position_===this.size_&&this.expand_(),this.buffer_[this.position_]=e,this.position_+=1}}},{key:"end",value:function(){if(0===this.position_)return!1;var e=this.buffer_,t=this.position_;return this.buffer_=new this.ArrayType_(this.size_),this.position_=0,this.overflows_=!1,e.subarray(0,t)}},{key:"expand_",value:function(){this.size_=this.size_<<1;var e=new this.ArrayType_(this.size_);e.set(this.buffer_),this.buffer_=e}}]),t}();pu.setElementIndexUint=function(e){_u=e};var vu=(xr(fu={},hu.FLOAT,Float32Array),xr(fu,hu.BYTE,Int8Array),xr(fu,hu.UNSIGNED_BYTE,Uint8Array),xr(fu,hu.INT,Int32Array),xr(fu,hu.UNSIGNED_INT,Uint32Array),xr(fu,hu.SHORT,Int16Array),xr(fu,hu.UNSIGNED_SHORT,Uint16Array),fu),mu=function(){function r(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).prealloc,i=void 0===t?500:t;mr(this,r),this.vertex_layout=e,this.vertex_elements=new pu,this.stride=this.vertex_layout.stride,0<r.array_pool.length?(this.vertex_buffer=r.array_pool.pop(),this.byte_length=this.vertex_buffer.byteLength,this.size=Math.floor(this.byte_length/this.stride),Jr("trace","VertexData: reused buffer of bytes ".concat(this.byte_length,", ").concat(this.size," vertices"))):(this.size=i,this.byte_length=this.stride*this.size,this.vertex_buffer=new Uint8Array(this.byte_length)),this.offset=0,this.vertex_count=0,this.realloc_count=0,this.setBufferViews(),this.setAddVertexFunction()}return yr(r,[{key:"setBufferViews",value:function(){var i=this;this.views={},this.views[hu.UNSIGNED_BYTE]=this.vertex_buffer,this.vertex_layout.dynamic_attribs.forEach(function(e){if(null==i.views[e.type]){var t=vu[e.type];i.views[e.type]=new t(i.vertex_buffer.buffer)}})}},{key:"checkBufferSize",value:function(){if(this.offset+this.stride>this.byte_length){this.size=Math.floor(1.5*this.size),this.size-=this.size%4,this.byte_length=this.stride*this.size;var e=new Uint8Array(this.byte_length);e.set(this.vertex_buffer),r.array_pool.push(this.vertex_buffer),this.vertex_buffer=e,this.setBufferViews(),this.realloc_count++}}},{key:"setAddVertexFunction",value:function(){this.vertexLayoutAddVertex=this.vertex_layout.getAddVertexFunction()}},{key:"addVertex",value:function(e){this.checkBufferSize(),this.vertexLayoutAddVertex(e,this.views,this.offset),this.offset+=this.stride,this.vertex_count++}},{key:"end",value:function(){return this.vertex_buffer=this.vertex_buffer.subarray(0,this.offset),this.element_buffer=this.vertex_elements.end(),Jr("trace","VertexData: ".concat(this.size," vertices total, realloc count ").concat(this.realloc_count)),this}}]),r}();mu.array_pool=[];var gu=function(){function l(e){mr(this,l),this.attribs=e,this.dynamic_attribs=this.attribs.filter(function(e){return!e.static}),this.components=[],this.index={},this.offset={};for(var t=this.stride=0,i=0,r=0;r<this.attribs.length;r++){var n=this.attribs[r];if(null==n.static){n.offset=this.stride,n.byte_size=n.size;var o=0;switch(n.type){case hu.FLOAT:case hu.INT:case hu.UNSIGNED_INT:n.byte_size*=4,o=2;break;case hu.SHORT:case hu.UNSIGNED_SHORT:n.byte_size*=2,o=1}3&n.byte_size&&(n.byte_size+=4-(3&n.byte_size)),this.stride+=n.byte_size;for(var s=n.offset>>o,a=0;a<n.size;a++)this.components.push({type:n.type,shift:o,offset:s++,index:i++});this.index[n.name]=t,t+=n.size,this.offset[n.name]=n.offset}else n.static=Array.isArray(n.static)?n.static:[n.static],n.method="vertexAttrib".concat(n.static.length,"fv")}}return yr(l,[{key:"enable",value:function(e,t,i){for(var r,n,o=0;o<this.attribs.length;o++)r=this.attribs[o],-1!==(n=t.attribute(r.name).location)&&(null==r.static?(l.enabled_attribs[n]&&!i||e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r.size,r.type,r.normalized,this.stride,r.offset),l.enabled_attribs[n]=t):e[r.method]instanceof Function&&(e.enableVertexAttribArray(n),e[r.method](n,r.static),e.disableVertexAttribArray(n),delete l.enabled_attribs[n]));for(n in l.enabled_attribs)this.disableUnusedAttribute(e,n,t)}},{key:"disableUnusedAttribute",value:function(e,t,i){l.enabled_attribs[t]!==i&&(e.disableVertexAttribArray(t),delete l.enabled_attribs[t])}},{key:"createVertexData",value:function(){return new mu(this)}},{key:"getAddVertexFunction",value:function(){return null==this.addVertex&&this.createAddVertexFunction(),this.addVertex}},{key:"createAddVertexFunction",value:function(){var e=ql(JSON.stringify(this.attribs));if(null==l.add_vertex_funcs[e]){var t,i=["var t, o;"],r=zr(this.components);r.sort(function(e,t){return e.type!==t.type?e.type-t.type:e.index-t.index});for(var n=0;n<r.length;n++){var o=r[n];t!==o.type&&(i.push("t = vs[".concat(o.type,"];")),i.push("o = off".concat(o.shift?" >> "+o.shift:"",";")),t=o.type),i.push("t[o + ".concat(o.offset,"] = v[").concat(o.index,"];"))}i=i.join("\n");var s=new Function("v","vs","off",i);l.add_vertex_funcs[e]=s}this.addVertex=l.add_vertex_funcs[e]}}]),l}();gu.enabled_attribs={},gu.add_vertex_funcs={};var yu=[{x:0,y:0},{x:Kr.tile_scale,y:-Kr.tile_scale}],xu=[0,0,1,1];function bu(e,t,i){var r=yu[0],n=yu[1];return e[0]<=r.x+i&&t[0]<=r.x+i||e[0]>=n.x-i&&t[0]>=n.x-i||e[1]>=r.y-i&&t[1]>=r.y-i||e[1]<=n.y+i&&t[1]<=n.y+i}function wu(e,t){t=t||0;var i=yu[0],r=yu[1];return e[0]<=i.x+t||e[0]>=r.x-t||e[1]>=i.y-t||e[1]<=r.y+t}var Au=Tu;function Tu(e,t,i){i=i||2;var r,n,o,s,a,l,u,c=t&&t.length,h=c?t[0]*i:e.length,f=ku(e,0,h,i,!0),d=[];if(!f)return d;if(c&&(f=function(e,t,i,r){var n,o,s,a,l,u=[];for(n=0,o=t.length;n<o;n++)s=t[n]*r,a=n<o-1?t[n+1]*r:e.length,(l=ku(e,s,a,r,!1))===l.next&&(l.steiner=!0),u.push(Iu(l));for(u.sort(Nu),n=0;n<u.length;n++)Ou(u[n],i),i=Eu(i,i.next);return i}(e,t,f,i)),e.length>80*i){r=o=e[0],n=s=e[1];for(var _=i;_<h;_+=i)(a=e[_])<r&&(r=a),(l=e[_+1])<n&&(n=l),o<a&&(o=a),s<l&&(s=l);u=Math.max(o-r,s-n)}return Mu(f,d,i,r,n,u),d}function ku(e,t,i,r,n){var o,s;if(n===0<Hu(e,t,i,r))for(o=t;o<i;o+=r)s=Bu(o,e[o],e[o+1],s);else for(o=i-r;t<=o;o-=r)s=Bu(o,e[o],e[o+1],s);return s&&Du(s,s.next)&&(Vu(s),s=s.next),s}function Eu(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!Du(r,r.next)&&0!==Fu(r.prev,r,r.next))r=r.next;else{if(Vu(r),(r=t=r.prev)===r.next)return null;i=!0}}while(i||r!==t);return t}function Mu(e,t,i,r,n,o,s){if(e){!s&&o&&function(e,t,i,r){var n=e;for(;null===n.z&&(n.z=Lu(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next,n!==e;);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,l,u=1;do{for(i=e,o=e=null,s=0;i;){for(s++,r=i,t=a=0;t<u&&(a++,r=r.nextZ);t++);for(l=u;0<a||0<l&&r;)0===a?(r=(n=r).nextZ,l--):0!==l&&r?i.z<=r.z?(i=(n=i).nextZ,a--):(r=(n=r).nextZ,l--):(i=(n=i).nextZ,a--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(1<s)}(n)}(e,r,n,o);for(var a,l,u=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Su(e,r,n,o):Ru(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),Vu(e),e=l.next,u=l.next;else if((e=l)===u){s?1===s?Mu(e=zu(e,t,i),t,i,r,n,o,2):2===s&&Pu(e,t,i,r,n,o):Mu(Eu(e),t,i,r,n,o,1);break}}}function Ru(e){var t=e.prev,i=e,r=e.next;if(0<=Fu(t,i,r))return!1;for(var n=e.next.next;n!==e.prev;){if(Cu(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&0<=Fu(n.prev,n,n.next))return!1;n=n.next}return!0}function Su(e,t,i,r){var n=e.prev,o=e,s=e.next;if(0<=Fu(n,o,s))return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,u=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,h=Lu(a,l,t,i,r),f=Lu(u,c,t,i,r),d=e.nextZ;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&Cu(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=Fu(d.prev,d,d.next))return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&Cu(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=Fu(d.prev,d,d.next))return!1;d=d.prevZ}return!0}function zu(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!Du(n,o)&&Uu(n,r,r.next,o)&&ju(n,o)&&ju(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),Vu(r),Vu(r.next),r=e=o),r=r.next}while(r!==e);return r}function Pu(e,t,i,r,n,o){var s,a,l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&(a=u,(s=l).next.i!==a.i&&s.prev.i!==a.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Uu(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(s,a)&&ju(s,a)&&ju(a,s)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;i.y>o!=i.next.y>o&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next,i!==e;);return r}(s,a))){var c=Gu(l,u);return l=Eu(l,l.next),c=Eu(c,c.next),Mu(l,t,i,r,n,o),void Mu(c,t,i,r,n,o)}u=u.next}l=l.next}while(l!==e)}function Nu(e,t){return e.x-t.x}function Ou(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&s<a){if((s=a)===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i.prev;var l,u=i,c=i.x,h=i.y,f=1/0;r=i.next;for(;r!==u;)n>=r.x&&r.x>=c&&Cu(o<h?n:s,o,c,h,o<h?s:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<f||l===f&&r.x>i.x)&&ju(r,e)&&(i=r,f=l),r=r.next;return i}(e,t)){var i=Gu(t,e);Eu(i,i.next)}}function Lu(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)/n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Iu(e){for(var t=e,i=e;t.x<i.x&&(i=t),(t=t.next)!==e;);return i}function Cu(e,t,i,r,n,o,s,a){return 0<=(n-s)*(t-a)-(e-s)*(o-a)&&0<=(e-s)*(r-a)-(i-s)*(t-a)&&0<=(i-s)*(o-a)-(n-s)*(r-a)}function Fu(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Du(e,t){return e.x===t.x&&e.y===t.y}function Uu(e,t,i,r){return!!(Du(e,t)&&Du(i,r)||Du(e,r)&&Du(i,t))||0<Fu(e,t,i)!=0<Fu(e,t,r)&&0<Fu(i,r,e)!=0<Fu(i,r,t)}function ju(e,t){return Fu(e.prev,e,e.next)<0?0<=Fu(e,t,e.next)&&0<=Fu(e,e.prev,t):Fu(e,t,e.prev)<0||Fu(e,e.next,t)<0}function Gu(e,t){var i=new qu(e.i,e.x,e.y),r=new qu(t.i,t.x,t.y),n=e.next,o=t.prev;return(e.next=t).prev=e,(i.next=n).prev=i,(r.next=i).prev=r,(o.next=r).prev=o,r}function Bu(e,t,i,r){var n=new qu(e,t,i);return r?(n.next=r.next,(n.prev=r).next.prev=n,r.next=n):(n.prev=n).next=n,n}function Vu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function qu(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Hu(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}Tu.deviation=function(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,s=Math.abs(Hu(e,0,o,i));if(n)for(var a=0,l=t.length;a<l;a++){var u=t[a]*i,c=a<l-1?t[a+1]*i:e.length;s-=Math.abs(Hu(e,u,c,i))}var h=0;for(a=0;a<r.length;a+=3){var f=r[a]*i,d=r[a+1]*i,_=r[a+2]*i;h+=Math.abs((e[f]-e[_])*(e[1+d]-e[1+f])-(e[f]-e[d])*(e[1+_]-e[1+f]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},Tu.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);0<n&&(r+=e[n-1].length,i.holes.push(r))}return i};var Yu=[0,0,1];function Xu(e,t,i,r){var n=r.texcoord_index,o=r.texcoord_scale,s=r.texcoord_normalize,a=t.vertex_elements;if(n){s=s||1;var l=Sr(o||xu,4),u=l[0],c=l[1],h=l[2],f=l[3]}for(var d,_=0,p=e.length,v=0;v<p;v++){var m=t.vertex_count,g=e[v];if(n)var y=Sr(Kr.findBoundingBox(g),4),x=y[0],b=y[1],w=(h-u)/(y[2]-x),A=(f-c)/(y[3]-b);for(var T=0;T<g.length;T++)for(var k=g[T],E=0;E<k.length;E++){var M=k[E];i[0]=M[0],i[1]=M[1],n&&(i[n+0]=((M[0]-x)*w+u)*s,i[n+1]=((M[1]-b)*A+c)*s),t.addVertex(i)}for(var R=(d=Au.flatten(g),Au(d.vertices,d.holes,d.dimensions)),S=0;S<R.length;S++)a.push(m+R[S]);_+=R.length/3}return _}var Wu="uniform vec2 u_resolution;uniform float u_time;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;attribute vec4 a_position;attribute vec4 a_color;\n#ifdef TANGRAM_NORMAL_ATTRIBUTE\nattribute vec3 a_normal;\n#define TANGRAM_NORMAL a_normal\n#else\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#endif\n#ifdef TANGRAM_EXTRUDE_LINES\nattribute vec2 a_extrude;attribute vec2 a_offset;attribute vec2 a_scaling;uniform float u_v_scale_adjust;\n#endif\nvarying vec4 v_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;varying vec4 v_wrapped_tile_origin;\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\nattribute vec2 a_texcoord;varying vec2 v_texcoord;\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#define UNPACK_SCALING(x) (x / 1024.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\nvoid main(){\n#pragma tangram: setup\n#ifdef TANGRAM_TEXTURE_COORDS\nv_texcoord=a_texcoord;\n#ifdef TANGRAM_EXTRUDE_LINES\nv_texcoord.y*=u_v_scale_adjust;\n#endif\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nv_modelpos_base_zoom=modelPositionBaseZoom();\n#endif\nvec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.);\n#ifdef TANGRAM_EXTRUDE_LINES\nvec2 extrude=a_extrude.xy;vec2 offset=a_offset.xy;float dz=clamp(u_map_position.z-u_tile_origin.z,0.,4.);dz+=step(1.,dz)*(1.-dz)+mix(0.,2.,clamp((dz-2.)/2.,0.,1.));float mdz=(dz-0.5)*2.;extrude-=extrude*UNPACK_SCALING(a_scaling.x)*mdz;float dwdz=UNPACK_SCALING(a_scaling.y);float sdwdz=sign(step(0.,dwdz)-0.5);offset-=offset*abs(dwdz)*((1.-step(0.,sdwdz))-(dz*-sdwdz));float ssz=exp2(-dz-(u_tile_origin.z-u_tile_origin.w));extrude*=ssz;offset*=ssz;\n#ifdef TANGRAM_BLOCK_WIDTH\nfloat width=1.;\n#pragma tangram: width\nextrude*=width;\n#endif\nposition.xy+=extrude+offset;\n#endif\nv_world_position=wrapWorldPosition(u_model*position);v_wrapped_tile_origin=wrapWorldPosition(u_tile_origin);position=u_modelView*position;\n#pragma tangram: position\nv_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);v_color=a_color;\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvec3 normal=v_normal;\n#pragma tangram: normal\nv_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));\n#endif\ncameraProjection(position);applyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);gl_Position=position;}",Zu="uniform vec2 u_resolution;uniform float u_time;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;varying vec4 v_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;varying vec4 v_wrapped_tile_origin;\n#ifdef TANGRAM_EXTRUDE_LINES\nuniform bool u_has_line_texture;uniform sampler2D u_texture;uniform float u_texture_ratio;uniform vec4 u_dash_background_color;uniform float u_tile_size;\n#endif\n#define TANGRAM_NORMAL v_normal\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\nvarying vec2 v_texcoord;\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n#pragma tangram: utils\nvoid main(void){\n#pragma tangram: setup\nvec4 color=v_color;vec3 normal=TANGRAM_NORMAL;\n#ifdef TANGRAM_CROP_BY_TILE\nif(isPixelOutsideTile(u_tile_size,u_meters_per_pixel,u_map_position,v_world_position,v_wrapped_tile_origin)){discard;}\n#endif\n#ifdef TANGRAM_RASTER_TEXTURE_COLOR\ncolor*=sampleRaster(0);\n#endif\n#ifdef TANGRAM_EXTRUDE_LINES\nif(u_has_line_texture){vec2 _line_st=vec2(v_texcoord.x,fract(v_texcoord.y/u_texture_ratio));vec4 _line_color=texture2D(u_texture,_line_st);if(_line_color.a<TANGRAM_ALPHA_TEST){\n#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY)\nif(u_dash_background_color.a==0.){discard;}color=u_dash_background_color;\n#else\ncolor=vec4(u_dash_background_color.rgb,color.a*step(TANGRAM_EPSILON,u_dash_background_color.a));\n#endif\n}else{color*=_line_color;}}\n#endif\n#ifdef TANGRAM_RASTER_TEXTURE_NORMAL\nnormal=normalize(sampleRaster(0).rgb*2.-1.);\n#endif\n#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\ncalculateNormal(normal);\n#endif\n#if !defined(TANGRAM_LIGHTING_VERTEX)\n#pragma tangram: normal\n#endif\n#pragma tangram: color\n#if defined(TANGRAM_LIGHTING_FRAGMENT)\ncolor=calculateLighting(v_position.xyz-u_eye,normal,color);\n#elif defined(TANGRAM_LIGHTING_VERTEX)\ncolor*=v_lighting;\n#endif\n#pragma tangram: filter\ngl_FragColor=color;}",Ju=Object.create(cu);Object.assign(Ju,{name:"polygons",built_in:!0,vertex_shader_src:Wu,fragment_shader_src:Zu,selection:!0,init:function(){cu.init.apply(this,arguments),this.defines.TANGRAM_NORMAL_ATTRIBUTE=!0,this.defines.TANGRAM_LAYER_ORDER=!0,this.texcoords&&(this.defines.TANGRAM_TEXTURE_COORDS=!0)},vertexLayoutForMeshVariant:function(e){if(!this.vertex_layout){var t=[{name:"a_position",size:4,type:hu.SHORT,normalized:!1},{name:"a_normal",size:3,type:hu.BYTE,normalized:!0},{name:"a_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0}];this.texcoords&&t.push({name:"a_texcoord",size:2,type:hu.UNSIGNED_SHORT,normalized:!0}),this.vertex_layout=new gu(t)}return this.vertex_layout},_parseFeature:function(e,t,i){var r=this.feature_style;return r.color=this.parseColor(t.color,i),r.color?(r.z=t.z&&Fo.evalCachedDistanceProperty(t.z,i)||Fo.defaults.z,r.z*=Kr.height_scale,r.extrude=Fo.evalProperty(t.extrude,i),r.extrude&&(!0===r.extrude?(r.height=e.properties.height||Fo.defaults.height,r.min_height=e.properties.min_height||Fo.defaults.min_height):"number"==typeof r.extrude?(r.height=r.extrude,r.min_height=0):Array.isArray(r.extrude)&&(r.min_height=r.extrude[0],r.height=r.extrude[1]),r.height*=Kr.height_scale,r.min_height*=Kr.height_scale),r.tile_edges=t.tile_edges,r):null},_preprocess:function(e){return e.color=Fo.createColorPropertyCache(e.color),e.z=Fo.createPropertyCache(e.z,Fo.parseUnits),e},makeVertexTemplate:function(e){var t=0;return this.vertex_template[t++]=0,this.vertex_template[t++]=0,this.vertex_template[t++]=e.z||0,this.vertex_template[t++]=this.scaleOrder(e.order),this.vertex_template[t++]=0,this.vertex_template[t++]=0,this.vertex_template[t++]=127,this.vertex_template[t++]=255*e.color[0],this.vertex_template[t++]=255*e.color[1],this.vertex_template[t++]=255*e.color[2],this.vertex_template[t++]=255*e.color[3],this.selection&&(this.vertex_template[t++]=255*e.selection_color[0],this.vertex_template[t++]=255*e.selection_color[1],this.vertex_template[t++]=255*e.selection_color[2],this.vertex_template[t++]=255*e.selection_color[3]),this.texcoords&&(this.vertex_template[t++]=0,this.vertex_template[t++]=0),this.vertex_template},buildPolygons:function(e,t,i,r){var n=this.makeVertexTemplate(t),o={texcoord_index:this.vertex_layout.index.a_texcoord,texcoord_normalize:65535,remove_tile_edges:!t.tile_edges,tile_edge_tolerance:Kr.tile_scale*r.tile.pad_scale*4,winding:r.winding};return t.extrude&&t.height?function(e,t,i,r,n,o,s,a,l){var u=l.remove_tile_edges,c=l.tile_edge_tolerance,h=l.texcoord_index,f=l.texcoord_scale,d=l.texcoord_normalize,_=l.winding,p=t+(r||0),v=t+i;o[2]=v;var m=Xu(e,n,o,{texcoord_index:h,texcoord_scale:f,texcoord_normalize:d}),g=n.vertex_elements,y=n.vertex_count;if(h){d=d||1;var x=Sr(f||xu,4),b=x[0],w=x[1],A=x[2],T=x[3],k=[[b,T],[b,w],[A,w],[A,T]]}for(var E=e.length,M=0;M<E;M++)for(var R=e[M],S=0;S<R.length;S++)for(var z=R[S],P=0;P<z.length-1;P++)if(!u||!bu(z[P],z[P+1],c)){var N=void 0,O=void 0,L=[[z[O="CCW"===_?(N=P)+1:(N=P+1,P)][0],z[O][1],v],[z[O][0],z[O][1],p],[z[N][0],z[N][1],p],[z[N][0],z[N][1],v]],I=iu.normalize([z[O][0]-z[N][0],z[O][1]-z[N][1],0]),C=iu.cross(Yu,I);o[s+0]=C[0]*a,o[s+1]=C[1]*a,o[s+2]=C[2]*a;for(var F=0;F<L.length;F++)o[0]=L[F][0],o[1]=L[F][1],o[2]=L[F][2],h&&(o[h+0]=k[F][0]*d,o[h+1]=k[F][1]*d),n.addVertex(o);g.push(y+0),g.push(y+1),g.push(y+2),g.push(y+2),g.push(y+3),g.push(y+0),y+=4,m+=2}return m}(e,t.z,t.height,t.min_height,i.vertex_data,n,this.vertex_layout.index.a_normal,127,o):Xu(e,i.vertex_data,n,o)}});var Ku=[0,0],$u={butt:0,square:1,round:2},Qu={miter:0,bevel:1,round:2},ec={MITER_LIMIT:3,TEXCOORD_NORMALIZE:1,TEXCOORD_RATIO:1,MIN_FAN_WIDTH:5},tc=Kr.tile_scale,ic=[0,0],rc=[1,0],nc=[.5,0];function oc(e,t){if(!(e.length<2)){var i,r,n,o,s=t.join_type,a=t.cap_type,l=t.closed_polygon,u=t.remove_tile_edges,c=t.tile_edge_tolerance,h=t.v_scale,f=t.miter_len_sq,d=t.crop_by_tile,_=null!=t.texcoord_index,p=0;if(l&&s===Qu.miter){var v=function(e){if(wu(e[0]))return 0;for(var t=0;t<e.length;t++){if(wu(e[e.length-1-t]))return e.length-1-t}return 0}(e);if(0!==v){var m=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=(r+t)%e.length;0!=n&&i.push(e[n])}return i.push(i[0]),i}(e,v);return t.extra_lines=t.extra_lines||[],void t.extra_lines.push(m)}}var g=0,y=e.length-1,x=0;for(i=e[g],r=e[g+1];iu.isEqual(i,r);)if(i=r,r=e[++g+1],x++,g===e.length-1)return;for(;iu.isEqual(e[y],e[y-1]);)if(x++,0===--y)return;if(!(e.length<2+x))if(o=iu.normalize(iu.perp(i,r)),u&&bu(i,r,c)){var b=sc(e,g,c);b&&(t.extra_lines=t.extra_lines||[],t.extra_lines.push(b))}else{l?function(e,t,i,r,n){if(void 0===r||wu(e)&&!n.crop_by_tile)hc(e,i,i,1,0,n,1),hc(e,i,i,0,0,n,-1);else{r===Qu.miter?lc(0,e,t,i,n.miter_len_sq,!0,n):uc(r,0,e,t,i,!0,n)}}(i,n=iu.normalize(iu.perp(e[y-1],i)),o,s,t):(!d&&wu(i)||(_c(i,p,o,a,!0,t),_&&a!==$u.butt&&(p+=.5*h*t.texcoord_width)),hc(i,o,o,1,p,t,1),hc(i,o,o,0,p,t,-1)),_&&(p+=h*iu.length(iu.sub(r,i)));for(var w=g+1;w<y;w++){var A=w,T=w+1;if(i=e[A],r=e[T],!iu.isEqual(i,r)){if(u&&bu(i,r,c)){hc(i,o,o,1,p,t,1),hc(i,o,o,0,p,t,-1),cc(1,t);var k=sc(e,A+1,c);return void(k&&(t.extra_lines=t.extra_lines||[],t.extra_lines.push(k)))}n=o,o=iu.normalize(iu.perp(i,r)),s===Qu.miter?lc(p,i,n,o,f,!1,t):uc(s,p,i,n,o,!1,t),_&&(p+=h*iu.length(iu.sub(r,i)))}}i=r,n=o,l?function(e,t,i,r,n,o){if(wu(e)&&!o.crop_by_tile)hc(e,t,t,1,n,o,1),hc(e,t,t,0,n,o,-1),cc(1,o);else{var s=ac(t,i);r===Qu.miter&&iu.lengthSq(s)>o.miter_len_sq&&(r=Qu.bevel),r===Qu.miter?(hc(e,s,t,1,n,o,1),hc(e,s,t,0,n,o,-1)):(hc(e,t,t,1,n,o,1),hc(e,t,t,0,n,o,-1)),cc(1,o)}}(i,n,o=iu.normalize(iu.perp(i,e[1])),s,p,t):(hc(i,n,o,1,p,t,1),hc(i,n,o,0,p,t,-1),cc(1,t),!d&&wu(i)||_c(i,p,n,a,!1,t))}}}function sc(e,t,i){for(var r=t;e[r+1]&&bu(e[r],e[r+1],i);)r++;return 2<=e.length-r&&e.slice(r)}function ac(e,t){var i=iu.normalize(iu.add(e,t)),r=2/(1+Math.abs(iu.dot(e,i)));return iu.mult(i,r*r)}function lc(e,t,i,r,n,o,s){var a=ac(i,r);iu.lengthSq(a)>n?uc(Qu.bevel,e,t,i,r,o,s):(hc(t,a,a,1,e,s,1),hc(t,a,a,0,e,s,-1),o||cc(1,s))}function uc(e,t,i,r,n,o,s){var a=ac(r,n),l=0<n[0]*r[1]-n[1]*r[0];null!=s.texcoord_index&&(ic[1]=t,rc[1]=t),l?(hc(i,a,a,1,t,s,1),hc(i,r,a,0,t,s,-1),o||cc(1,s),dc(i,iu.neg(r),a,iu.neg(n),a,ic,rc,ic,!1,e===Qu.bevel,s),hc(i,a,a,1,t,s,1),hc(i,n,a,0,t,s,-1)):(hc(i,r,a,1,t,s,1),hc(i,a,a,0,t,s,-1),o||cc(1,s),dc(i,r,iu.neg(a),n,a,rc,ic,rc,!1,e===Qu.bevel,s),hc(i,n,a,1,t,s,1),hc(i,a,a,0,t,s,-1))}function cc(e,t){for(var i=t.vertex_data.vertex_elements,r=t.vertex_data.vertex_count-2*e-2,n=0;n<e;n++)i.push(r+2*n+2),i.push(r+2*n+1),i.push(r+2*n+0),i.push(r+2*n+2),i.push(r+2*n+3),i.push(r+2*n+1),t.geom_count+=2}function hc(e,t,i,r,n,o,s){var a=o.vertex_template,l=o.vertex_data;a[0]=e[0],a[1]=e[1];var u=o.half_width*s;a[o.extrude_index+0]=t[0]*u,a[o.extrude_index+1]=t[1]*u,o.offset&&(a[o.offset_index+0]=i[0]*o.offset,a[o.offset_index+1]=i[1]*o.offset),null!=o.texcoord_index&&(a[o.texcoord_index+0]=r*o.texcoord_normalize,a[o.texcoord_index+1]=n*o.texcoord_normalize),l.addVertex(a)}var fc=[0,0];function dc(e,t,i,r,n,o,s,a,l,u,c){for(var h=t[0]*r[1]-t[1]*r[0],f=iu.dot(t,r),d=Math.atan2(h,f);d>=Math.PI;)d-=2*Math.PI;if(u)_=1;else{var _=function(e,t){e<0&&(e=-e);var i=t>2*ec.MIN_FAN_WIDTH?Math.log2(t/ec.MIN_FAN_WIDTH):1;return Math.ceil(e/Math.PI*i)}(d,c.half_width);if(_<1)return}var p=c.vertex_data.vertex_count,v=c.vertex_data.vertex_elements;hc(e,i,n,s[0],s[1],c,1),hc(e,t,n,o[0],o[1],c,1);var m=t,g=null!=c.texcoord_index;if(g)if(l)var y=iu.sub(o,s);else{fc=iu.copy(o);var x=iu.div(iu.sub(a,o),_)}var b,w,A=d/_,T=d<0?-1:1;w=0<h?(b=2,1):(b=1,2);for(var k=0;k<_;k++)0===k&&d<0&&(m=iu.neg(m)),m=iu.rot(m,A),g&&(l?(y=iu.rot(y,A),fc[0]=y[0]+s[0],fc[1]=y[1]*c.texcoord_width*c.v_scale+s[1]):fc=iu.add(fc,x)),hc(e,m,n,fc[0],fc[1],c,T),v.push(p+k+b),v.push(p),v.push(p+k+w)}function _c(e,t,i,r,n,o){var s=iu.neg(i),a=null!=o.texcoord_index;switch(r){case $u.square:var l;n?(l=[i[1],-i[0]],hc(e,iu.add(i,l),i,1,t,o,1),hc(e,iu.add(s,l),i,0,t,o,1),a&&(t+=.5*o.texcoord_width*o.v_scale),hc(e,i,i,1,t,o,1),hc(e,s,i,0,t,o,1)):(l=[-i[1],i[0]],hc(e,i,i,1,t,o,1),hc(e,s,i,0,t,o,1),a&&(t+=.5*o.texcoord_width*o.v_scale),hc(e,iu.add(i,l),i,1,t,o,1),hc(e,iu.add(s,l),i,0,t,o,1)),cc(1,o);break;case $u.round:var u,c,h=ic,f=rc,d=nc;n?(u=i,c=s,a&&(t+=.5*o.texcoord_width*o.v_scale,h=rc,f=ic,d=nc)):(u=s,c=i),a&&(ic[1]=t,rc[1]=t,nc[1]=t),dc(e,u,Ku,c,i,h,d,f,!0,!1,o);break;case $u.butt:return}}var pc=[255,255,255,255],vc=[0,0,0,0];var mc=Object.create(cu);mc.vertex_layouts=[[],[]],mc.variants={},mc.dash_textures={};function gc(e,t){if(!(e.length<2)){for(var i=[e[0]],r=0,n=[],o=[],s=1,a=e.length;s<a;s++)if(e[s][0]!==e[s-1][0]||e[s][1]!==e[s-1][1]){i.push(e[s]);var l=iu.sub(e[s],e[s-1]),u=iu.length(l);n.push(l),o.push([r,r+u]),r+=u}if(!(i.length<2)){var c=0,h=n[n.length-1],f=n[0],d=n[1],_=[0,0];2<i.length&&(t.closed&&(_[0]=iu.signedAngleBetween(h,f)),_[1]=iu.signedAngleBetween(f,d));var p=i[0],v=o[0];t.closed?(bc(p,t,c++,v,r,_,[h,f]),bc(p,t,c++,v,r,_,[h,f])):(bc(p,t,c++,v,r,_,[f,f]),bc(p,t,c++,v,r,_,[f,f]));for(var m=1,g=i.length-1;m<g;m++)p=i[m],h=n[m-1],f=n[m],d=n[m+1],bc(p,t,c++,v=o[m-1],r,_,[h,f]),bc(p,t,c++,v,r,_,[h,f]),yc(t),v=o[m],_[0]=_[1],_[1]=m!==g-1?iu.signedAngleBetween(f,d):t.closed?iu.signedAngleBetween(f,n[0]):0,bc(p,t,c++,v,r,_,[h,f]),bc(p,t,c++,v,r,_,[h,f]);p=i[i.length-1],v=o[o.length-1],f=n[n.length-1],t.closed?(bc(p,t,c++,v,r,_,[f,n[0]]),bc(p,t,c++,v,r,_,[f,n[0]])):(bc(p,t,c++,v,r,_,[f,f]),bc(p,t,c++,v,r,_,[f,f])),yc(t)}}}function yc(e){var t=e.vertex_data.vertex_elements,i=e.vertex_data.vertex_count-4;t.push(2+i),t.push(1+i),t.push(0+i),t.push(2+i),t.push(3+i),t.push(1+i),e.geom_count+=2}Object.assign(mc,{name:"lines",built_in:!0,vertex_shader_src:Wu,fragment_shader_src:Zu,selection:!0,init:function(){cu.init.apply(this,arguments),this.styles=this.styles||{},this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_EXTRUDE_LINES=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_TEXTURE_COORDS=!0,this.outline_feature_style={},this.inline_feature_style=this.feature_style},calcDistance:function(e,t){return e&&Fo.evalCachedDistanceProperty(e,t)||0},calcDistanceNextZoom:function(e,t){t.zoom++;var i=this.calcDistance(e,t);return t.zoom--,i},calcWidth:function(e,t,i){var r=this.calcDistance(e.width,i);if(!(r<0)){var n;if(n=e.next_width?this.calcDistanceNextZoom(e.next_width,i):r/2,0===r&&0===n||n<0)return!1;if(t.width_unscaled=r,t.next_width_unscaled=n,e.next_width){var o=.5*(r+(n*=2));t.width=o*i.units_per_meter_overzoom,t.width_scale=1-n/o}else t.width=r*i.units_per_meter_overzoom,t.width_scale=0;return e.texcoords&&(e.inline_texcoord_width?t.texcoord_width=e.inline_texcoord_width:t.texcoord_width=(t.width_unscaled||t.next_width_unscaled)*i.units_per_meter_overzoom/i.tile.overzoom2),!0}},calcOffset:function(e,t,i){if(e.offset_precalc)t.offset=e.offset_precalc,t.offset_scale=e.offset_scale_precalc;else if(e.offset){var r=this.calcDistance(e.offset,i);if(e.next_offset){var n=2*this.calcDistanceNextZoom(e.next_offset,i);Math.abs(r)>=Math.abs(n)?(t.offset=r*i.units_per_meter_overzoom,t.offset_scale=0!==r?1-n/r:0):(t.offset=n*i.units_per_meter_overzoom,t.offset_scale=0!=n?-1*(1-r/n):0)}else t.offset=r*i.units_per_meter_overzoom,t.offset_scale=0}else t.offset=0,t.offset_scale=0;Fo.evalProperty(e.offset_reverse,i)&&(t.offset*=-1)},_parseFeature:function(e,t,i){var r=this.feature_style;if(!1!==this.calcWidth(t,r,i)&&(this.calcOffset(t,r,i),r.color=this.parseColor(t.color,i),r.color)){if(r.variant=t.variant,r.z=t.z&&Fo.evalCachedDistanceProperty(t.z||0,i)||Fo.defaults.z,r.height=e.properties.height||Fo.defaults.height,r.extrude=Fo.evalProperty(t.extrude,i),r.extrude&&("number"==typeof r.extrude?r.height=r.extrude:Array.isArray(r.extrude)&&(r.height=r.extrude[1])),r.extrude&&r.height&&(r.z+=r.height),r.z*=Kr.height_scale,r.height*=Kr.height_scale,r.cap=Fo.evalProperty(t.cap,i),r.join=Fo.evalProperty(t.join,i),r.miter_limit=Fo.evalProperty(t.miter_limit,i),r.tile_edges=t.tile_edges,r.outline=r.outline||{width:{},next_width:{},preprocessed:!0},t.outline&&!1!==t.outline.visible&&t.outline.color&&t.outline.width){var n=2*this.calcDistance(t.outline.width,i),o=2*this.calcDistanceNextZoom(t.outline.next_width,i);0==n&&0==o||n<0||o<0?(r.outline.width.value=null,r.outline.next_width.value=null,r.outline.color=null,r.outline.inline_texcoord_width=null,r.outline.texcoords=!1):(r.outline.width.value=n+r.width_unscaled,r.outline.next_width.value=o+r.next_width_unscaled,r.outline.inline_texcoord_width=r.texcoord_width,r.outline.offset_precalc=r.offset,r.outline.offset_scale_precalc=r.offset_scale,r.outline.color=t.outline.color,r.outline.cap=t.outline.cap,r.outline.join=t.outline.join,r.outline.miter_limit=t.outline.miter_limit,r.outline.texcoords=t.outline.texcoords,r.outline.style=t.outline.style,r.outline.variant=t.outline.variant,t.outline.order?r.outline.order=this.parseOrder(t.outline.order,i):r.outline.order=r.order,r.outline.order>r.order&&(r.outline.order=r.order),r.outline.order-=.5,r.outline.variant_order=0)}else r.outline.width.value=null,r.outline.next_width.value=null,r.outline.color=null,r.outline.inline_texcoord_width=null;return r}},_preprocess:function(e,t){var i=this.sources[t]?this.sources[t].config.uid:"";if(e.color=Fo.createColorPropertyCache(e.color),e.width=Fo.createPropertyCache(e.width,Fo.parseUnits),e.width&&e.width.type!==Fo.CACHE_TYPE.STATIC&&(e.next_width=Fo.createPropertyCache(e.width,Fo.parseUnits)),e.offset=e.offset&&Fo.createPropertyCache(e.offset,Fo.parseUnits),e.offset&&e.offset.type!==Fo.CACHE_TYPE.STATIC&&(e.next_offset=Fo.createPropertyCache(e.offset,Fo.parseUnits)),e.z=Fo.createPropertyCache(e.z,Fo.parseUnits),e.dash=void 0!==e.dash?e.dash:this.dash,e.dash_key=e.dash&&this.dashTextureKey(e.dash,i),e.dash_background_color=void 0!==e.dash_background_color?e.dash_background_color:this.dash_background_color,e.dash_background_color=e.dash_background_color&&Fo.parseColor(e.dash_background_color),e.texture_merged=e.dash_key||(void 0!==e.texture?e.texture:this.texture),e.texcoords=this.texcoords||e.texture_merged?1:0,this.computeVariant(e),e.outline){e.outline.style=e.outline.style||this.name,e.outline.color=Fo.createColorPropertyCache(e.outline.color),e.outline.width=Fo.createPropertyCache(e.outline.width,Fo.parseUnits),e.outline.next_width=Fo.createPropertyCache(e.outline.width,Fo.parseUnits),e.outline.cap=e.outline.cap||e.cap,e.outline.join=e.outline.join||e.join,e.outline.miter_limit=e.outline.miter_limit||e.miter_limit,e.outline.offset=e.offset;var r=this.styles[e.outline.style];r?(e.outline.dash=void 0!==e.outline.dash?e.outline.dash:r.dash,e.outline.texture=void 0!==e.outline.texture?e.outline.texture:r.texture,null!=e.outline.dash?(e.outline.dash_key=e.outline.dash&&this.dashTextureKey(e.outline.dash,i),e.outline.texture_merged=e.outline.dash_key):null===e.outline.dash?(e.outline.dash_key=null,e.outline.texture_merged=e.outline.texture):null!=e.outline.texture?(e.outline.dash_key=null,e.outline.texture_merged=e.outline.texture):(e.outline.dash=e.dash,e.outline.dash_key=e.outline.dash&&this.dashTextureKey(e.outline.dash,i),e.outline.texture_merged=e.outline.dash_key),e.outline.dash_background_color=void 0!==e.outline.dash_background_color?e.outline.dash_background_color:r.dash_background_color,e.outline.dash_background_color=void 0!==e.outline.dash_background_color?e.outline.dash_background_color:e.dash_background_color,e.outline.dash_background_color=e.outline.dash_background_color&&Fo.parseColor(e.outline.dash_background_color),e.outline.texcoords=r.texcoords||e.outline.texture_merged?1:0,this.computeVariant(e.outline)):(Jr({level:"warn",once:!0},"Layer '".concat(e.layers[e.layers.length-1],"': ")+"line 'outline' specifies non-existent draw style '".concat(e.outline.style,"' (or maybe the style is ")+"defined but is missing a 'base' or has another error), skipping outlines in layer"),e.outline=null)}return e},dashTextureKey:function(e,t){return"__dash_"+t+"_"+JSON.stringify(e)},getDashTexture:function(e,t){var i=this.dashTextureKey(e,this.sources[t].config.uid);if(null==mc.dash_textures[i]){mc.dash_textures[i]=!0;var r=function(e,t){var i=1<arguments.length&&void 0!==t?t:{},r=i.dash_color||pc,n=i.background_color||vc,o=e,s=i.scale||1;o.length%2==1&&Array.prototype.push.apply(o,o);for(var a=!0,l=[],u=0;u<o.length;u++){for(var c=Math.floor(o[u]*s),h=0;h<c;h++)Array.prototype.push.apply(l,a?r:n);a=!a}return{pixels:l=new Uint8Array(l),length:l.length/4}}(e,{scale:20});Jo.create(this.gl,i,{data:r.pixels,height:r.length,width:1,filtering:"nearest"})}},endData:function(s){var a=this;return cu.endData.call(this,s).then(function(n){if(n){n.uniforms.u_has_line_texture=!1,n.uniforms.u_texture=Jo.default,n.uniforms.u_v_scale_adjust=Kr.tile_scale,n.uniforms.u_tile_size=a.sources[s.source].tile_size;var o=[],e=function(e){var i=n.meshes[e].variant;if(i.texture){var r=n.meshes[e].uniforms=n.meshes[e].uniforms||{};if(r.u_has_line_texture=!0,r.u_texture=i.texture,r.u_texture_ratio=1,i.dash&&(r.u_v_scale_adjust=20*Kr.tile_scale,r.u_dash_background_color=i.dash_background_color||[0,0,0,0]),i.dash_key&&null==mc.dash_textures[i.dash_key]&&(mc.dash_textures[i.dash_key]=!0,Cr.postMessage(a.main_thread_target+".getDashTexture",i.dash,s.source)),null==Jo.textures[i.texture])o.push(Jo.syncTexturesToWorker([i.texture]).then(function(e){var t=e[i.texture];t&&(r.u_texture_ratio=t.height/t.width)}));else{var t=Jo.textures[i.texture];r.u_texture_ratio=t.height/t.width}}};for(var t in n.meshes)e(t);return s.mesh_data[a.name]=n,Promise.all(o).then(function(){return n})}return n})},computeVariant:function(e){var t=e.offset?1:0;e.dash_key&&(t+=e.dash_key,e.dash_background_color&&(t+=e.dash_background_color)),e.texture_merged&&(t+=e.texture_merged),t=ql(t+="/"+e.texcoords),e.variant=t,null==mc.variants[t]&&(mc.variants[t]={key:t,order:e.variant_order,offset:e.offset?1:0,texcoords:e.texcoords,texture:e.texture_merged,dash:e.dash,dash_key:e.dash_key,dash_background_color:e.dash_background_color})},vertexLayoutForMeshVariant:function(e){if(null==mc.vertex_layouts[e.key]){var t=[{name:"a_position",size:4,type:hu.SHORT,normalized:!1},{name:"a_extrude",size:2,type:hu.SHORT,normalized:!1},{name:"a_offset",size:2,type:hu.SHORT,normalized:!1,static:e.offset?null:[0,0]},{name:"a_scaling",size:2,type:hu.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:hu.UNSIGNED_SHORT,normalized:!0,static:e.texcoords?null:[0,0]},{name:"a_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0}];mc.vertex_layouts[e.key]=new gu(t)}return mc.vertex_layouts[e.key]},meshVariantTypeForDraw:function(e){return mc.variants[e.variant]},makeVertexTemplate:function(e,t){var i=0;return this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=e.z||0,this.vertex_template[i++]=this.scaleOrder(e.order),this.vertex_template[i++]=0,this.vertex_template[i++]=0,t.variant.offset&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),this.vertex_template[i++]=1024*e.width_scale,this.vertex_template[i++]=1024*e.offset_scale,t.variant.texcoords&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0),this.vertex_template[i++]=255*e.color[0],this.vertex_template[i++]=255*e.color[1],this.vertex_template[i++]=255*e.color[2],this.vertex_template[i++]=255*e.color[3],this.selection&&(this.vertex_template[i++]=255*e.selection_color[0],this.vertex_template[i++]=255*e.selection_color[1],this.vertex_template[i++]=255*e.selection_color[2],this.vertex_template[i++]=255*e.selection_color[3]),this.vertex_template},buildLines:function(e,t,i,r,n){if(this.feature_style=this.outline_feature_style,t.outline&&null!=t.outline.color&&null!=t.outline.width.value){var o=this.styles[t.outline.style];o&&o.addFeature(r.feature,t.outline,r)}this.feature_style=this.inline_feature_style;var s=i.vertex_data,a=s.vertex_layout,l=this.makeVertexTemplate(t,i);return function(e,t,i,r,n){var o,s=n.closed_polygon,a=n.remove_tile_edges,l=n.tile_edge_tolerance,u=n.texcoord_index,c=(n.texcoord_scale,n.texcoord_width),h=n.texcoord_ratio,f=n.texcoord_normalize,d=n.extrude_index,_=n.offset_index,p=n.join,v=n.cap,m=n.miter_limit,g=n.offset,y=n.crop_by_tile,x=v?$u[v]:$u.butt,b=p?Qu[p]:Qu.miter;if(b===Qu.miter)var w=(m=m||ec.MITER_LIMIT)*m;u&&(f=f||ec.TEXCOORD_NORMALIZE,o=1/(c*(h=h||ec.TEXCOORD_RATIO)*tc));for(var A={closed_polygon:s,remove_tile_edges:a,tile_edge_tolerance:l,miter_len_sq:w,join_type:b,cap_type:x,vertex_data:i,vertex_template:r,half_width:t/2,extrude_index:d,offset_index:_,v_scale:o,texcoord_index:u,texcoord_width:c,texcoord_normalize:f,offset:g,geom_count:0,crop_by_tile:y},T=0;T<e.length;T++)oc(e[T],A);if(A.extra_lines)for(var k=0;k<A.extra_lines.length;k++)oc(A.extra_lines[k],A);return A.geom_count}(e,t.width,s,l,{cap:t.cap,join:t.join,miter_limit:t.miter_limit,extrude_index:a.index.a_extrude,offset_index:a.index.a_offset,texcoord_index:a.index.a_texcoord,texcoord_width:t.texcoord_width,texcoord_normalize:65535,closed_polygon:n&&n.closed_polygon,remove_tile_edges:!t.tile_edges&&n&&n.remove_tile_edges,tile_edge_tolerance:Kr.tile_scale*r.tile.pad_scale*2,offset:t.offset,crop_by_tile:this.crop_by_tile})},buildPolygons:function(e,t,i,r){for(var n=0,o=0;o<e.length;o++)n+=this.buildLines(e[o],t,i,r,{closed_polygon:!0,remove_tile_edges:!this.crop_by_tile});return n}});var xc=[[1,1],[1,-1],[-1,1],[-1,-1]];function bc(e,t,i,r,n,o,s){var a=t.vertex_template,l=t.vertex_data;if(wc(t,"a_position",e),wc(t,"a_width",t.half_width),t.vertex_layout_index.a_barycentric){var u=[0,0,0];u[i%3]=1,wc(t,"a_barycentric",u)}wc(t,"a_tangents",s[0].concat(s[1])),wc(t,"a_segment",r),wc(t,"a_texcoord",xc[i%4]),wc(t,"a_length",n),wc(t,"a_closed",t.closed?1:0),wc(t,"a_angles",o),l.addVertex(a)}function wc(e,t,i){var r=i.length,n=e.vertex_template,o=e.vertex_layout_index[t],s=0;if(r)for(;s!==r;)n[o+s]=i[s],s++;else n[o+s]=i}function Ac(e,s){for(var a=e.reduce(function(e,t){return e+t}),t=0,l=[],i=0,r=e.length;i<=r;i+=2){var n=Math.max(1e-4,e[i%r]),o=Math.max(1e-4,e[(i+1)%r]);l.push(t,t+n),t+=n+o}for(var u=new Uint8Array(4*s),c=0,h=function(e){var t=a*e/(s-1),i=function(e){for(var t=e[0],i=0,r=1,n=e.length;r<n;r++)e[r]<t&&(t=e[i=r]);return i}(l.map(function(e){return Math.abs(e-t)})),r=void 0,n=void 0,o=void 0;o=i%2==0?(r=t<=l[i]?1:0,n=l[i],l[i+1]):(r=t>l[i]?2:0,n=l[i-1],l[i]),u[c++]=l[i],u[c++]=r,u[c++]=n,u[c++]=o},f=0;f<s;f++)h(f);return u}var Tc=Object.create(cu),kc={round:1,"arrow-tail":2,"arrow-head":3,square:4,butt:5},Ec={miter:0,round:1,bevel:2},Mc=kc.round,Rc=Ec.miter,Sc=[0,0],zc="antialias join linecaps miter_limit dash_index dash dash_caps dash_phase".split(" ");Object.assign(Tc,{name:"pattern-lines",built_in:!0,vertex_shader_src:"uniform vec2 u_resolution;uniform float u_time;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform sampler2D u_uniforms;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_index;uniform vec2 u_dash_caps;uniform float u_dash_phase;uniform float u_dash_period;attribute vec4 a_position;attribute vec4 a_color;attribute float a_width;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nattribute vec3 a_barycentric;\n#endif\nattribute vec2 a_normal;attribute float a_dist_from_start;attribute float a_length;attribute vec2 a_segment;attribute vec2 a_texcoord;attribute vec2 a_angles;attribute vec4 a_tangents;attribute float a_closed;varying vec4 v_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;varying vec4 v_wrapped_tile_origin;varying float v_closed;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nvarying vec3 v_barycentric;\n#endif\nvarying float v_dist_from_start;varying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_miter;varying float v_length;varying float v_linewidth;\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#ifndef TANGRAM_HEIGHT_SCALE\nfloat TANGRAM_HEIGHT_SCALE=16.0;\n#endif\n#define UNPACK_SCALING(x) (x / 1024.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: global\nconst float PI=3.141592653589793;const float THETA=15.0*PI/180.0;float cross(in vec2 v1,in vec2 v2){return v1.x*v2.y-v1.y*v2.x;}float signed_distance(in vec2 v1,in vec2 v2,in vec2 v3){return cross(v2-v1,v1-v3)/length(v2-v1);}void rotate(in vec2 v,in float alpha,out vec2 result){float cosine=cos(alpha);float sine=sin(alpha);result=vec2(cosine*v.x-sine*v.y,sine*v.x+cosine*v.y);}void main(){\n#pragma tangram: setup\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nv_modelpos_base_zoom=modelPositionBaseZoom();\n#endif\nv_closed=a_closed;bool closed=a_closed>0.0;v_angles=a_angles;v_segment=a_segment;v_color=a_color;v_length=a_length;v_linewidth=a_width*2.0;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nv_barycentric=a_barycentric;\n#endif\nv_dist_from_start=a_dist_from_start;v_wrapped_tile_origin=wrapWorldPosition(u_tile_origin);v_color.a=min(v_linewidth,v_color.a);v_linewidth=max(v_linewidth,1.0);if(v_color.a<=0.0){gl_Position=vec4(0.0,0.0,0.0,1.0);return;}float width=ceil(1.25*u_antialias+v_linewidth)/2.0;vec2 t1=normalize(a_tangents.xy);vec2 t2=normalize(a_tangents.zw);float u=a_texcoord.x;u*=-1.0;float v=a_texcoord.y;vec2 o1=vec2(+t1.y,-t1.x);vec2 o2=vec2(+t2.y,-t2.x);vec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.);if(t1!=t2){float angle=atan(t1.x*t2.y-t1.y*t2.x,t1.x*t2.x+t1.y*t2.y);vec2 t=normalize(t1+t2);vec2 o=vec2(+t.y,-t.x);if(u_dash_index>0.0){if((abs(angle)>THETA)){position.xy+=v*width*o/cos(angle/2.0);float s=sign(angle);if(angle<0.0){if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==1.0){position.xy-=2.0*width*t1/sin(angle);u-=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==1.0){position.xy+=2.0*width*t2/sin(angle);u+=2.0*width/sin(angle);}}}else{if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==-1.0){position.xy+=2.0*width*t1/sin(angle);u+=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==-1.0){position.xy-=2.0*width*t2/sin(angle);u-=2.0*width/sin(angle);}}}}else{position.xy+=v*width*o/cos(angle/2.0);if(u==+1.0)u=v_segment.y;else u=v_segment.x;}}else{position.xy+=v*width*o/cos(angle/2.0);if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);}else{u=v_segment.x-v*width*tan(angle/2.0);}}}else{position.xy+=v*width*o1;if(u==-1.0){u=v_segment.x-width;position.xy-=width*t1;}else{u=v_segment.y+width;position.xy+=width*t2;}}vec2 t;vec2 curr=a_position.xy;if(a_texcoord.x>=0.0){vec2 next=curr+t2*(v_segment.y-v_segment.x);rotate(t1,+a_angles.x/2.0,t);v_miter.x=signed_distance(curr,curr+t,position.xy);rotate(t2,+a_angles.y/2.0,t);v_miter.y=signed_distance(next,next+t,position.xy);}else{vec2 prev=curr-t1*(v_segment.y-v_segment.x);rotate(t1,-a_angles.x/2.0,t);v_miter.x=signed_distance(prev,prev+t,position.xy);rotate(t2,-a_angles.y/2.0,t);v_miter.y=signed_distance(curr,curr+t,position.xy);}if(!closed&&v_segment.x<=0.0){v_miter.x=1e10;}if(!closed&&v_segment.y>=v_length){v_miter.y=1e10;}v_texcoord=vec2(u,v*width);v_world_position=wrapWorldPosition(u_model*position);position=u_modelView*position;\n#pragma tangram: position\nv_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvec3 normal=v_normal;\n#pragma tangram: normal\nv_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));\n#endif\ncameraProjection(position);\n#ifdef TANGRAM_LAYER_ORDER\napplyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);\n#endif\ngl_Position=position;}",fragment_shader_src:"uniform vec2 u_resolution;uniform float u_time;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform float u_tile_size;uniform sampler2D u_dash_atlas;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_phase;uniform float u_dash_period;uniform float u_dash_index;uniform vec2 u_dash_caps;varying vec4 v_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;varying vec4 v_wrapped_tile_origin;varying float v_closed;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nvarying vec3 v_barycentric;\n#endif\nvarying float v_dist_from_start;varying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_miter;varying float v_length;varying float v_linewidth;\n#define TANGRAM_NORMAL v_normal\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: global\n#pragma tangram: utils\nconst float PI=3.141592653589793;const float HALF_PI=PI/2.0;const float THETA=15.0*PI/180.0;/***Compute distance to cap.*@param{int}type The Type of the cap(see CAP_TYPE in pattern_lines)*@param{float}dx The distance of the pixel from the beginning of the line(not straight distance,but along the legs)*@param{float}dy The distance of the pixel from the midline(see v_texcoord in vertex shader,aka \xb11*half_line_width)*@param{float}aa_radius The distance from the mid-line from where antialiasing starts.*For example for a line width 10px width and 2px filter radius it is 10px/2-2px=3px.*@return{float}distance*/float cap(int type,float dx,float dy,float aa_radius){float dist=0.0;dx=abs(dx);dy=abs(dy);if(type==1)dist=sqrt(dx*dx+dy*dy);else if(type==3)dist=(dx+abs(dy));else if(type==2)dist=max(abs(dy),(aa_radius+dx-abs(dy)));else if(type==4)dist=max(dx,dy);else if(type==5)dist=max(dx+aa_radius,dy);return dist;}/***Compute distance to join.*@param{int}type The type of the join(see JOIN_TYPE in pattern_lines)*@param{vec2}segment Interpolated a_segment attribute from the vertex shader*@param{vec2}texcoord 2 component vector where:*x is the distance of the pixel from the beginning of the line(along the legs)*y is the  distance of the pixel from the midline(see v_texcoord in vertex shader,\xb11*half_line_width)*@param{vec2}miter Miter point coordiante*@param{float}miter_limit The miter limit*@param{float}line_width The line width*@return{float}computed distance*/float join(in int type,in float dist,in vec2 segment,in vec2 texcoord,in vec2 miter,in float miter_limit,in float line_width){float dx=texcoord.x;if(type==1){if(dx<segment.x){dist=max(dist,length(texcoord-vec2(segment.x,0.0)));}else if(dx>segment.y){dist=max(dist,length(texcoord-vec2(segment.y,0.0)));}}else if(type==2){if((dx<segment.x)||(dx>segment.y))dist=max(dist,min(abs(miter.x),abs(miter.y)));}if((dx<segment.x)||(dx>segment.y)){dist=max(dist,min(abs(miter.x),abs(miter.y))-miter_limit*line_width/2.0);}return dist;}void main(void){\n#pragma tangram: setup\nvec4 color=v_color;vec3 normal=TANGRAM_NORMAL;\n#ifdef TANGRAM_CROP_BY_TILE\nif(isPixelOutsideTile(u_tile_size,u_meters_per_pixel,u_map_position,v_world_position,v_wrapped_tile_origin)){discard;}\n#endif\n#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\ncalculateNormal(normal);\n#endif\n#if !defined(TANGRAM_LIGHTING_VERTEX)\n#pragma tangram: normal\n#endif\n#pragma tangram: color\n#if defined(TANGRAM_LIGHTING_FRAGMENT)\ncolor=calculateLighting(v_position.xyz-u_eye,normal,color);\n#elif defined(TANGRAM_LIGHTING_VERTEX)\ncolor*=v_lighting;\n#endif\n#pragma tangram: filter\nif(v_color.a<=0.0){discard;}bool solid=(u_dash_index==0.0);bool closed=v_closed>0.0;float dx=v_texcoord.x;float dy=v_texcoord.y;float aa_radius=v_linewidth/2.0-u_antialias;float width=v_linewidth;float dist=0.0;vec2 linecaps=u_linecaps;vec2 dash_caps=u_dash_caps;float line_start=0.0;float line_stop=v_length;if(solid){dist=abs(dy);if((!closed)&&(dx<line_start)){dist=cap(int(u_linecaps.x),abs(dx),abs(dy),aa_radius);}else if((!closed)&&(dx>line_stop)){dist=cap(int(u_linecaps.y),abs(dx)-line_stop,abs(dy),aa_radius);}else{dist=join(int(u_linejoin),abs(dy),v_segment,v_texcoord,v_miter,u_miter_limit,v_linewidth);}}else{float segment_start=v_segment.x;float segment_stop=v_segment.y;float segment_center=(segment_start+segment_stop)/2.0;float freq=u_dash_period*width;float dash_phase=u_dash_phase-1e-5;float u=mod(dx+dash_phase*width,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));float dash_center=float(tex.x)*255.0*width;float dash_type=floor(float(tex.y)*255.0+0.5);float _start=float(tex.z)*255.0*width;float _stop=float(tex.a)*255.0*width;float dash_start=dx-u+_start;float dash_stop=dx-u+_stop;if((dash_stop<segment_start)&&(dash_caps.x!=5.0)){float u=mod(segment_start+dash_phase*width,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*width;float _start=float(tex.z)*255.0*width;float _stop=float(tex.a)*255.0*width;dash_start=segment_start-u+_start;dash_stop=segment_start-u+_stop;}else if((dash_start>segment_stop)&&(dash_caps.y!=5.0)){float u=mod(segment_stop+dash_phase*width,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*width;float _start=float(tex.z)*255.0*width;float _stop=float(tex.a)*255.0*width;dash_start=segment_stop-u+_start;dash_stop=segment_stop-u+_stop;}bool discontinuous=((dx<segment_center)&&abs(v_angles.x)>THETA)||((dx>=segment_center)&&abs(v_angles.y)>THETA);float d_join=join(int(u_linejoin),abs(dy),v_segment,v_texcoord,v_miter,u_miter_limit,v_linewidth);if(closed){line_start+=v_linewidth/2.0;line_stop-=v_linewidth/2.0;}if(dash_stop<=line_start){discard;}if(dash_start>=line_stop){discard;}if(discontinuous){if((dash_start>segment_stop)){discard;}if((dash_stop<segment_start)){discard;}if(dash_caps.x==1.0){if((u>_stop)&&(dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){discard;}}if(dash_caps.y==1.0){if((u<_start)&&(dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){discard;}}if((dash_caps.x!=1.0)&&(dash_caps.x!=5.0)){if((dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){float a=v_angles.x/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(segment_start-dx)*cos_a-dy*sin_a;float y=(segment_start-dx)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.x=4.0;}}if((dash_caps.y!=1.0)&&(dash_caps.y!=5.0)){if((dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){float a=v_angles.y/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(dx-segment_stop)*cos_a-dy*sin_a;float y=(dx-segment_stop)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.y=4.0;}}}if((dx<line_start)&&(dash_start<=line_start)&&(dash_stop>line_start)){dist=cap(int(linecaps.x),dx-line_start,dy,aa_radius);}else if((dx>line_stop)&&(dash_stop>line_stop)&&(dash_start<line_stop)){dist=cap(int(linecaps.y),dx-line_stop,dy,aa_radius);}else if(dash_type==1.0){dist=cap(int(dash_caps.x),abs(dash_center-u),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}else if(dash_type==0.0){dist=abs(dy);}else if(dash_type==2.0){dist=cap(int(dash_caps.y),abs(u-dash_center),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}if((dx>line_start)&&(dx<line_stop)){if((dx<=segment_start)&&(dash_start<=segment_start)&&(dash_stop>=segment_start)){dist=d_join;float angle=HALF_PI+v_angles.x;float f=abs((segment_start-dx)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if((dx>segment_stop)&&(dash_start<=segment_stop)&&(dash_stop>=segment_stop)){dist=d_join;float angle=HALF_PI+v_angles.y;float f=abs((dx-segment_stop)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if(dx<(segment_start-v_linewidth/2.)){discard;}else if(dx>(segment_stop+v_linewidth/2.)){discard;}}else if(dx<(segment_start-v_linewidth/2.)){discard;}else if(dx>(segment_stop+v_linewidth/2.)){discard;}}dist=dist-aa_radius;if(dist>=0.0){if(u_antialias==0.0){discard;}else{color=vec4(color.rgb,exp(-dist*dist)*color.a);}}\n#ifdef TANGRAM_DEBUG_TRIANGLES\nif(any(lessThan(v_barycentric,vec3(0.03)))){color=vec4(0.0,1.0,0.0,1.0);}\n#endif\ngl_FragColor=color;}",selection:!0,init:function(){cu.init.apply(this,arguments),this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_DEBUG_TRIANGLES=!1,this.defines.TANGRAM_DEBUG_NO_TEXTURE_FLOAT_SUPPORT=!0,this.styles=this.styles||{},Tc.vertex_layouts=[],Tc.variants={}},calcDistance:function(e,t){return e&&Fo.evalCachedDistanceProperty(e,t)||0},calcDash:function(e,t){var i=Fo.evalProperty(e.dash,t),r=0;return i&&((i=Array.isArray(i)&&i.length?i:Sc).length%2==1&&(i=i.concat(i)),r=+(r=i.reduce(function(e,t){return e+t}))||0),{dash:i,dash_period:r}},calcWidth:function(e,t,i){var r=this.calcDistance(e.width,i);return!(r<0)&&(t.width=r*i.units_per_meter_overzoom,!0)},getCapType:function(e,t,i){var r=Fo.evalProperty(e,t);return void 0!==kc[r]?kc[r]:i},_parseFeature:function(e,t,i){if(!1!==this.calcWidth(t,this.feature_style,i)){var r=this.parseColor(t.color,i);if(r&&0!==r[3]){var n=this.getCapType(t.cap,i,Mc),o=Fo.evalProperty(t.join,i),s=+Fo.evalProperty(t.miter_limit,i),a=this.calcDash(t,i),l=a.dash,u=a.dash_period,c=Object.assign({color:r,antialias:t.antialias,linecaps:[this.getCapType(t.tail_cap,i,n),this.getCapType(t.head_cap,i,n)],join:void 0!==Ec[o]?Ec[o]:Rc,miter_limit:0<=s?s:3,dash_index:0===u?0:1,dash:l,dash_caps:[this.getCapType(t.tail_cap,i,n),this.getCapType(t.head_cap,i,n)],dash_phase:+Fo.evalProperty(t.dash_phase,i)||0,dash_period:u},this.feature_style);return c.z=t.z&&Fo.evalCachedDistanceProperty(t.z||0,i)||Fo.defaults.z,c.height=e.properties.height||Fo.defaults.height,c.z*=Kr.height_scale,c.height*=Kr.height_scale,this.computeVariant(c),c}}},_preprocess:function(e,t){e.color=Fo.createColorPropertyCache(e.color),e.width=Fo.createPropertyCache(e.width,Fo.parseUnits),e.width&&e.width.type!==Fo.CACHE_TYPE.STATIC&&(e.next_width=Fo.createPropertyCache(e.width,Fo.parseUnits)),e.z=Fo.createPropertyCache(e.z,Fo.parseUnits);var i=+e.antialias;return e.antialias=isNaN(i)?0:i,e},buildRasterTextures:function(e,t){var i=[];for(var r in t.meshes){var n=Tc.variants[r],o=n.uniforms,s=n.pattern;if(o.u_dash_index){var a="__dash_"+s.join("_")+"_"+e.key+"_"+e.id;i.push({name:a,data:Ac(s,1024)}),o.u_dash_atlas=a,t.meshes[r].textures=[a]}t.meshes[r].uniforms=o}return t.uniforms=t.uniforms||{},t.uniforms.u_tile_size=this.sources[e.source].tile_size,i.length?Cr.postMessage(this.main_thread_target+".loadTextures",i).then(function(){return t}):Promise.resolve(t)},loadTextures:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=Jo.textures[r.name];n||(n=Jo.create(this.gl,r.name,{filtering:"nearest",repeat:!0,width:1024,height:1,data:r.data})),t.push(n.loading)}return Promise.all(t).then(function(e){return e.map(function(e){return e.retain(),e.name})})},computeVariant:function(e){var t=function(e){for(var t=[],i=0,r=zc.length;i<r;i++){var n=e[zc[i]];Array.isArray(n)?t.push(n.join("_")):"boolean"==typeof n?t.push(n?1:0):n&&t.push(n.toString())}return t.join("/")}(e);e.variant=t,null==Tc.variants[t]&&(Tc.variants[t]={key:t,order:e.variant_order,uniforms:{u_antialias:e.antialias,u_linecaps:e.linecaps,u_linejoin:e.join,u_miter_limit:e.miter_limit,u_dash_index:e.dash_index,u_dash_caps:e.dash_caps,u_dash_phase:e.dash_phase,u_dash_period:e.dash_period},pattern:e.dash})},vertexLayoutForMeshVariant:function(e){if(null==Tc.vertex_layouts[e.key]){var t=[{name:"a_position",size:4,type:hu.SHORT,normalized:!1},{name:"a_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0},{name:"a_width",size:1,type:hu.FLOAT,normalized:!1},{name:"a_tangents",size:4,type:hu.FLOAT,normalized:!1},{name:"a_segment",size:2,type:hu.FLOAT,normalized:!1},{name:"a_angles",size:2,type:hu.FLOAT,normalized:!1},{name:"a_texcoord",size:2,type:hu.FLOAT,normalized:!0},{name:"a_length",size:1,type:hu.FLOAT,normalized:!1},{name:"a_closed",size:1,type:hu.FLOAT,normalized:!1},{name:"a_selection_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0}];this.defines.TANGRAM_DEBUG_TRIANGLES&&t.push({name:"a_barycentric",size:3,type:hu.SHORT,normalized:!1}),Tc.vertex_layouts[e.key]=new gu(t)}return Tc.vertex_layouts[e.key]},meshVariantTypeForDraw:function(e){return Tc.variants[e.variant]},makeVertexTemplate:function(e,t){var i=0;return this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=e.z||0,this.vertex_template[i++]=this.scaleOrder(e.order),this.vertex_template[i++]=255*e.color[0],this.vertex_template[i++]=255*e.color[1],this.vertex_template[i++]=255*e.color[2],this.vertex_template[i++]=255*e.color[3],this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.selection&&(this.vertex_template[i++]=255*e.selection_color[0],this.vertex_template[i++]=255*e.selection_color[1],this.vertex_template[i++]=255*e.selection_color[2],this.vertex_template[i++]=255*e.selection_color[3]),this.defines.TANGRAM_DEBUG_TRIANGLES&&(this.vertex_template[i++]=0,this.vertex_template[i++]=0,this.vertex_template[i++]=0),this.vertex_template},buildLines:function(e,t,i,r,n){var o=4<arguments.length&&void 0!==n&&n,s=i.vertex_data,a=s.vertex_layout,l=this.makeVertexTemplate(t,i);return function(e,t,i,r,n,o){for(var s={closed:o,vertex_data:i,vertex_template:r,half_width:t/2,vertex_layout_index:n,geom_count:0},a=0,l=e.length;a<l;a++)gc(e[a],s);return s.geom_count}(e,t.width,s,l,a.index,o)},buildPolygons:function(e,t,i,r){for(var n=0,o=0,s=e.length;o<s;o++)n+=this.buildLines(e[o],t,i,r,!0);return n}});var Pc=0,Nc={id_prefix:"",nextLabelId:function(){return"".concat(Nc.id_prefix,"/").concat(Pc++)}};function Oc(e){return{priority:e.priority,collide:e.collide,repeat_distance:e.repeat_distance,repeat_group:e.repeat_group,buffer:e.buffer,italic:e.italic}}var Lc=["left","top-left","bottom-left"],Ic=["right","top-right","bottom-right"],Cc=["top","top-left","top-right"],Fc=["bottom","bottom-left","bottom-right"],Dc={computeOffset:function(e,t,i,r){var n=3<arguments.length&&void 0!==r?r:null;if(!i||"center"===i)return e;var o=[e[0],e[1]];return n=n||this.default_buffer,this.isLeftAnchor(i)?(o[0]-=t[0]/2,"left"===i&&(o[0]-=n[0])):this.isRightAnchor(i)&&(o[0]+=t[0]/2,"right"===i&&(o[0]+=n[1])),this.isTopAnchor(i)?(o[1]-=t[1]/2,"top"===i&&(o[1]-=n[2])):this.isBottomAnchor(i)&&(o[1]+=t[1]/2,"bottom"===i&&(o[1]+=n[3])),o},alignForAnchor:function(e){if(e&&"center"!==e){if(this.isLeftAnchor(e))return"right";if(this.isRightAnchor(e))return"left"}return"center"},isLeftAnchor:function(e){return-1<Lc.indexOf(e)},isRightAnchor:function(e){return-1<Ic.indexOf(e)},isTopAnchor:function(e){return-1<Cc.indexOf(e)},isBottomAnchor:function(e){return-1<Fc.indexOf(e)},default_buffer:[2.5,2.5,1.5,.75],zero_buffer:[0,0,0,0]};function Uc(e,t,i,r,n){var o=[],s=i-e,a=r-t,l=vl.getLineLength(e,t,i,r),u=2*n,c=l/u;if(c<=1)o.push(e+s/2,t+a/2,n);else{var h=u/l,f=s*h,d=a*h;(c=l/n/2)%1&&o.push(i-f/2,r-d/2,n),c|=0;for(var _=e+f/2,p=t+d/2;c--;)o.push(_,p,n),_+=f,p+=d}return o}var jc=function(){function n(e,t,i,r){mr(this,n),this.id=Nc.nextLabelId(),this.position=[e[0],e[1]],this.size=t,this.layout=r,this.anchor=Array.isArray(this.layout.anchor)?this.layout.anchor[0]:this.layout.anchor,this.placed=null,this.type="point",this.parent=this.layout.parent,this.offset=this.computeOffset(),this.align=this.layout.align||Dc.alignForAnchor(this.anchor),this._is_flat=i}return yr(n,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,align:this.align,sides:this.getSides(),breach:!this.inTileBounds(),layout:Oc(this.layout)}}},{key:"inTileBounds",value:function(){var e=this.getAABB(),t=e.left,i=e.top,r=e.right,n=e.bottom;return on.pointInTile([t,i])&&on.pointInTile([r,n])}},{key:"isFlat",value:function(){return this._is_flat}},{key:"setAnchor",value:function(e){this._circles=void 0,this._aabb=void 0,this.anchor=e,this.offset=this.computeOffset()}},{key:"computeOffset",value:function(){var e=[this.layout.offset[0],this.layout.offset[1]];if(this.parent){var t=this.parent;e=Dc.computeOffset(e,t.size,t.anchor,Dc.zero_buffer),e=Dc.computeOffset(e,t.size,this.anchor,Dc.zero_buffer),t.offset!==Fo.zeroPair&&(e===Fo.zeroPair?e=t.offset:(e[0]+=t.offset[0],e[1]+=t.offset[1]))}return Dc.computeOffset(e,this.size,this.anchor)}},{key:"getBoundingCircles",value:function(){if(!this.angle)return[];if(!this._circles){var e=this.layout.units_per_pixel,t=this.size[0]/2*e,i=t*Math.cos(this.angle),r=t*Math.sin(this.angle),n=-i,o=-r,s=Sr(this.position,2),a=s[0],l=s[1];i+=a,r+=l*=-1,n+=a,o+=l;var u=this.size[1]/2*e;this._circles=Uc(i,r,n,o,u)}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){var e=this.layout.units_per_pixel,t=(this.size[0]/2+this.layout.buffer[0])*e,i=(this.size[1]/2+this.layout.buffer[1])*e,r=this.position[0]+this.offset[0]*e,n=this.position[1]-this.offset[1]*e;this._aabb={left:r-t,top:n+i,right:r+t,bottom:n-i}}return this._aabb}},{key:"getSides",value:function(){var e=this.getAABB(),t=e.left,i=e.top,r=e.right,n=(i+e.bottom)/2;return[t,n,r,n]}}]),n}();jc.PLACEMENT={VERTEX:0,MIDPOINT:1,SPACED:2,CENTROID:3};var Gc=jc.PLACEMENT,Bc=80;function Vc(e,t,i,r){var n=[],o=r.placement,s=Math.max(t[0],t[1])*r.placement_min_length_ratio*r.units_per_pixel;switch(o){case Gc.SPACED:var a=function(e,t,i){var r=i.units_per_pixel,n=(i.placement_spacing||Bc)*r,o=function(e){for(var t=0,i=0;i<e.length-1;i++)t+=Hc(e[i],e[i+1]);return t}(e);if(o<=t)return!1;for(var s=Math.max(Math.floor(o/n),1),a=[],l=[],u=.5*(o-(s-1)*n),c=0;c<s;c++){var h=Yc(e,u,t,i),f=h.position,d=h.angle;null!=f&&null!=d&&(a.push(f),l.push(d)),u+=n}return{positions:a,angles:l}}(e,s,r);if(!a)return[];for(var l=a.positions,u=a.angles,c=0;c<l.length;c++){var h=l[c],f=u[c];if(!0===r.tile_edges||!wu(h)){var d=new jc(h,t,i,r);d.angle=f,n.push(d)}}break;case Gc.VERTEX:for(var _,p,v,m=0;m<e.length-1;m++)_=e[m],p=e[m+1],!0!==r.tile_edges&&wu(_)||((v=new jc(_,t,i,r)).angle=qc(_,p,r.angle),n.push(v));(v=new jc(p,t,i,r)).angle=qc(_,p,r.angle),n.push(v);break;case Gc.MIDPOINT:for(var g=0;g<e.length-1;g++){var y=e[g],x=e[g+1],b=[.5*(y[0]+x[0]),.5*(y[1]+x[1])];if((!0===r.tile_edges||!wu(b))&&(!s||Hc(y,x)>s)){var w=new jc(b,t,i,r);w.angle=qc(y,x,r.angle),n.push(w)}}}return n}function qc(e,t,i){var r=2<arguments.length&&void 0!==i?i:0;return"auto"===r?Math.atan2(t[0]-e[0],t[1]-e[1]):r}function Hc(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Yc(e,t,i,r){for(var n,o,s,a,l,u,c,h=0,f=0;f<e.length-1;f++){var d=e[f],_=e[f+1],p=Hc(d,_);if(!(p<=i)&&t<(h+=p)){l=h-t,void 0,u=Hc(s=d,a=_),n=[(c=l/u)*s[0]+(1-c)*a[0],c*s[1]+(1-c)*a[1]],o=qc(d,_,r.angle);break}}return{position:n,angle:o}}var Xc={key:function(e){return[e.style,e.weight,e.family,e.px_size,e.fill,e.stroke,e.stroke_width,e.transform,e.text_wrap,e.max_lines,e.supersample,on.device_pixel_ratio].join("/")},defaults:{style:"normal",weight:null,size:"12px",px_size:12,family:"Helvetica",fill:"white",text_wrap:15,max_lines:5,align:"center",stroke:null,stroke_width:0},compute:function(e,t,i){var r={};t.font=t.font||this.defaults,r.can_articulate=t.can_articulate,r.fill=t.font.fill&&on.toCSSColor(Fo.evalCachedColorProperty(t.font.fill,i))||this.defaults.fill,r.style=t.font.style||this.defaults.style,r.weight=t.font.weight||this.defaults.weight,t.font.family?(r.family=t.font.family,r.family!==this.defaults.family&&(r.family+=", "+this.defaults.family)):r.family=this.defaults.family,r.transform=t.font.transform,r.size=t.font.size||this.defaults.size,r.supersample=t.supersample_text?1.5:1,r.px_size=Fo.evalCachedProperty(t.font.px_size,i)*r.supersample,t.font.stroke&&t.font.stroke.color&&(r.stroke=on.toCSSColor(Fo.evalCachedColorProperty(t.font.stroke.color,i)||this.defaults.stroke),r.stroke_width=Fo.evalCachedProperty(t.font.stroke.width,i)||this.defaults.stroke_width),r.font_css=this.fontCSS(r);var n=t.text_wrap;return null==n&&"line"!==Kr.geometryType(e.geometry.type)&&(n=!0),!0===n&&(n=this.defaults.text_wrap),r.text_wrap=n,r.max_lines=t.max_lines||this.defaults.max_lines,r},fontCSS:function(e){return[e.style,e.weight,e.px_size+"px",e.family].filter(function(e){return e}).join(" ")}},Wc=i(function(e){function n(e,t){document.addEventListener?e.addEventListener("scroll",t,!1):e.attachEvent("scroll",t)}function y(e){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(e)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function x(e,t){e.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+t+";"}function o(e){var t=e.a.offsetWidth,i=t+100;return e.f.style.width=i+"px",e.c.scrollLeft=i,e.b.scrollLeft=e.b.scrollWidth+100,e.g!==t&&(e.g=t,!0)}function b(e,t){function i(){var e=r;o(e)&&e.a.parentNode&&t(e.g)}var r=e;n(e.b,i),n(e.c,i),o(e)}function t(e,t){var i=t||{};this.family=e,this.style=i.style||"normal",this.weight=i.weight||"normal",this.stretch=i.stretch||"normal"}function w(e,t){return[e.style,e.weight,function(){if(null===r){var e=document.createElement("div");try{e.style.font="condensed 100px sans-serif"}catch(e){}r=""!==e.style.font}return r}()?e.stretch:"","100px",t].join(" ")}var A,i,r,s;s=r=i=A=null,t.prototype.load=function(e,t){var _=this,p=e||"BESbswy",v=0,m=t||3e3,g=(new Date).getTime();return new Promise(function(f,d){var e;if(null===s&&(s=!!document.fonts),(e=s)&&(null===i&&(i=/OS X.*Version\/10\..*Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),e=!i),e){e=new Promise(function(i,e){!function t(){(new Date).getTime()-g>=m?e():document.fonts.load(w(_,'"'+_.family+'"'),p).then(function(e){1<=e.length?i():setTimeout(t,25)},function(){e()})}()});var t=new Promise(function(e,t){v=setTimeout(t,m)});Promise.race([t,e]).then(function(){clearTimeout(v),f(_)},function(){d(_)})}else!function(t){document.body?t():document.addEventListener?document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e),t()}):document.attachEvent("onreadystatechange",function e(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",e),t())})}(function(){function t(){var e;(e=-1!=o&&-1!=s||-1!=o&&-1!=a||-1!=s&&-1!=a)&&((e=o!=s&&o!=a&&s!=a)||(null===A&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),A=!!e&&(parseInt(e[1],10)<536||536===parseInt(e[1],10)&&parseInt(e[2],10)<=11)),e=A&&(o==l&&s==l&&a==l||o==u&&s==u&&a==u||o==c&&s==c&&a==c)),e=!e),e&&(h.parentNode&&h.parentNode.removeChild(h),clearTimeout(v),f(_))}var i=new y(p),r=new y(p),n=new y(p),o=-1,s=-1,a=-1,l=-1,u=-1,c=-1,h=document.createElement("div");h.dir="ltr",x(i,w(_,"sans-serif")),x(r,w(_,"serif")),x(n,w(_,"monospace")),h.appendChild(i.a),h.appendChild(r.a),h.appendChild(n.a),document.body.appendChild(h),l=i.a.offsetWidth,u=r.a.offsetWidth,c=n.a.offsetWidth,function H(){if((new Date).getTime()-g>=m)h.parentNode&&h.parentNode.removeChild(h),d(_);else{var e=document.hidden;!0!==e&&void 0!==e||(o=i.a.offsetWidth,s=r.a.offsetWidth,a=n.a.offsetWidth,t()),v=setTimeout(H,50)}}(),b(i,function(e){o=e,t()}),x(i,w(_,'"'+_.family+'",sans-serif')),b(r,function(e){s=e,t()}),x(r,w(_,'"'+_.family+'",serif')),b(n,function(e){a=e,t()}),x(n,w(_,'"'+_.family+'",monospace'))})})},e.exports=t}),Zc={fonts_loaded:Promise.resolve(),last_loaded:null,loadFonts:function(r){var n=this,e=JSON.stringify(r)===this.last_loaded;return r&&!e&&function(){function e(t){Array.isArray(r[t])?r[t].forEach(function(e){return i.push(n.loadFontFace(t,e))}):i.push(n.loadFontFace(t,r[t]))}var i=[];for(var t in r)e(t);n.last_loaded=JSON.stringify(r),n.fonts_loaded=Promise.all(i.filter(function(e){return e}))}(),this.fonts_loaded},loadFontFace:function(e,t){if(null!=t&&("object"===vr(t)||"external"===t)){var i={family:e},r=Promise.resolve();"object"===vr(t)&&(Object.assign(i,t),"string"==typeof t.url&&(r=this.injectFontFace(i)));var n=new Wc(e,i);return r.then(function(){return n.load()}).then(function(){Jr("debug","Font face '".concat(e,"' is available"),i)},function(){Jr("debug","Font face '".concat(e,"' is NOT available"),i)})}},injectFontFace:function(e){var n=this,o=e.family,t=e.url,s=e.weight,a=e.style;void 0===this.supports_native_font_loading&&(this.supports_native_font_loading=void 0!==window.FontFace);var i=Promise.resolve(t);return"blob:"===t.slice(0,5)&&(i=on.io(t,6e4,"arraybuffer").then(function(e){var t=new Uint8Array(e);if(n.supports_native_font_loading)return t;for(var i="",r=0;r<t.length;r++)i+=String.fromCharCode(t[r]);return"data:font/opentype;base64,"+btoa(i)})),i.then(function(e){if(n.supports_native_font_loading){var t;"string"==typeof e?t=new FontFace(o,"url(".concat(encodeURI(e),")"),{weight:s,style:a}):e instanceof Uint8Array&&(t=new FontFace(o,e,{weight:s,style:a})),document.fonts.add(t),Jr("trace","Adding FontFace to document.fonts:",t)}else{var i="\n                    @font-face {\n                        font-family: '".concat(o,"';\n                        font-weight: ").concat(s||"normal",";\n                        font-style: ").concat(a||"normal",";\n                        src: url(").concat(encodeURI(e),");\n                    }\n                "),r=document.createElement("style");r.appendChild(document.createTextNode("")),document.head.appendChild(r),r.sheet.insertRule(i,0),Jr("trace","Injecting CSS font face:",i)}})}},Jc=function(){function A(){mr(this,A),this.createCanvas(),this.vertical_text_buffer=8,this.horizontal_text_buffer=4}return yr(A,[{key:"createCanvas",value:function(){this.canvas=document.createElement("canvas"),this.canvas.style.backgroundColor="transparent",this.context=this.canvas.getContext("2d")}},{key:"resize",value:function(e,t){this.canvas.width=e,this.canvas.height=t,this.context.clearRect(0,0,e,t)}},{key:"setFont",value:function(e){var t=e.font_css,i=e.fill,r=e.stroke,n=e.stroke_width,o=e.px_size,s=e.supersample;this.px_size=o;var a=this.context,l=on.device_pixel_ratio*s;r&&0<n&&(a.strokeStyle=r,a.lineWidth=n*l),a.fillStyle=i,a.font=t,a.miterLimit=2}},{key:"textSizes",value:function(e,t){var i=this;return Zc.loadFonts().then(function(){return Wo.add({type:"textSizes",run:i.processTextSizesTask.bind(i),texts:t,tile_id:e,cursor:{styles:Object.keys(t),texts:null,style_idx:null,text_idx:null}})})}},{key:"processTextSizesTask",value:function(e){var t,i=e.cursor,r=e.texts;for(i.style_idx=i.style_idx||0;i.style_idx<i.styles.length;){var n=i.styles[i.style_idx];null==i.text_idx&&(i.text_idx=0,i.texts=Object.keys(r[n]));for(var o=r[n],s=!0;i.text_idx<i.texts.length;){var a=i.texts[i.text_idx],l=o[a],u=l.text_settings;if(s&&(this.setFont(u),s=!1),l.size=this.textSize(n,a,u).size,u.can_articulate){var c=!1,h=!1;if($c(a)&&(th(a)?c=!0:h=!0),l.isRTL=c,l.no_curving=h||(t=a,uh.test(t)),l.vertical_buffer=this.vertical_text_buffer,l.segment_sizes=[],!l.no_curving){var f=hh(a,c);l.segments=f;for(var d=0;d<f.length;d++)l.segment_sizes.push(this.textSize(n,f[d],u).size)}}if(i.text_idx++,!Wo.shouldContinue(e))return!1}i.text_idx=null,i.style_idx++}return Wo.finish(e,{texts:r}),!0}},{key:"textSize",value:function(e,t,i){var r=i.transform,n=i.text_wrap,o=i.max_lines,s=i.stroke_width,a=void 0===s?0:s,l=i.supersample;if(A.cache.text[e]=A.cache.text[e]||{},A.cache.text[e][t])return A.cache.stats.text_hits++,A.cache.text[e][t];A.cache.stats.text_misses++,A.cache.text_count++;var u=on.device_pixel_ratio*l,c=this.applyTextTransform(t,r),h=this.context,f=this.vertical_text_buffer*u,d=u*(a+this.horizontal_text_buffer),_=2*u,p=this.px_size+_,v=fh.parse(c,n,o,p,h),m=v.height,g=v.width,y=v.lines,x=[g/u,m/u],b=[g+2*d,m+2*f],w=[b[0]/u,b[1]/u];return A.cache.text[e][t]={lines:y,size:{collision_size:x,texture_size:b,logical_size:w,line_height:p}},A.cache.text[e][t]}},{key:"drawTextMultiLine",value:function(e,t,i,r,n){for(var o=Sr(t,2),s=o[0],a=o[1],l=r.stroke,u=r.stroke_width,c=void 0===u?0:u,h=r.transform,f=r.align,d=r.supersample,_=i.line_height,p=a,v=0;v<e.length;v++){var m=e[v];this.drawTextLine(m,[s,p],i,{stroke:l,stroke_width:c,transform:h,align:f,supersample:d},n),p+=_}if(Ll.draw_label_collision_boxes){this.context.save();var g=on.device_pixel_ratio*d,y=g*(this.horizontal_text_buffer+c),x=g*this.vertical_text_buffer,b=i.collision_size;this.context.strokeStyle="blue",this.context.lineWidth=2,this.context.strokeRect(s+y,a+x,g*b[0],g*b[1]),"curved"===n&&this.context.strokeRect(s+i.texture_size[0]+y,a+x,g*b[0],g*b[1]),this.context.restore()}if(Ll.draw_label_texture_boxes){this.context.save();var w=i.texture_size;this.context.strokeStyle="green",this.context.lineWidth=2,this.context.strokeRect(s+2,a+2,w[0]-4,w[1]-4),"curved"===n&&this.context.strokeRect(s+2+i.texture_size[0],a+2,w[0]-4,w[1]-4),this.context.restore()}}},{key:"drawTextLine",value:function(e,t,i,r,n){var o=Sr(t,2),s=o[0],a=o[1],l=r.stroke,u=r.stroke_width,c=void 0===u?0:u,h=r.transform,f=r.align,d=r.supersample,_=on.device_pixel_ratio*d;f=f||"center";var p,v=this.vertical_text_buffer*_,m=i.texture_size,g=i.line_height,y=_*(c+this.horizontal_text_buffer),x=this.applyTextTransform(e.text,h);"left"===f?p=s+y:"center"===f?p=s+m[0]/2-e.width/2:"right"===f&&(p=s+m[0]-e.width-y);var b=a+.75*v+g;if(l&&0<c){var w="curved"===n?m[0]:0;this.context.strokeText(x,p+w,b)}this.context.fillText(x,p,b)}},{key:"rasterize",value:function(e,t,i,r,n){return Wo.add({type:"rasterizeLabels",run:this.processRasterizeTask.bind(this),cancel:this.cancelRasterizeTask.bind(this),pause_factor:2,user_moving_view:!1,texts:e,textures:t,texture_prefix:r,gl:n,tile_id:i,cursor:{styles:Object.keys(e),texts:null,style_idx:0,text_idx:null,texture_idx:0,texture_resize:!0,texture_names:[]}})}},{key:"processRasterizeTask",value:function(e){for(var t,i=e.cursor,r=e.texts,n=e.textures;i.texture_idx<e.textures.length;){for(t=n[i.texture_idx],i.texture_resize&&(i.texture_resize=!1,this.resize.apply(this,zr(t.texture_size)));i.style_idx<i.styles.length;){var o=i.styles[i.style_idx];null==i.text_idx&&(i.text_idx=0,i.texts=Object.keys(r[o]));for(var s=r[o],a=!0;i.text_idx<i.texts.length;){var l=i.texts[i.text_idx],u=s[l],c=u.text_settings;if(a&&(this.setFont(c),a=!1),c.can_articulate){u.texcoords=u.texcoords||{};for(var h=0;h<u.type.length;h++){var f=u.type[h];switch(f){case"straight":if(u.textures[h]!==i.texture_idx)continue;var d=u.isRTL?l.split().reverse().join():l,_=t.texcoord_cache[o][d],p=void 0;if(_.texcoord)p=_.texcoord;else{var v=_.texture_position,m=this.textSize(o,d,c),g=m.size,y=m.lines;this.drawTextMultiLine(y,v,g,c,f),p=Jo.getTexcoordsForSprite(v,g.texture_size,t.texture_size),_.texcoord=p}u.texcoords[f]={texcoord:p,texture_id:_.texture_id};break;case"curved":var x=u.segments;u.texcoords.curved=u.texcoords.curved||[],u.texcoords_stroke=u.texcoords_stroke||[];for(var b=0;b<x.length;b++)if(u.textures[h][b]===i.texture_idx){var w=x[b],A=t.texcoord_cache[o][w],T=void 0,k=void 0;if(A.texcoord)T=A.texcoord,k=A.texcoord_stroke,u.texcoords_stroke.push(k);else{var E=A.texture_position,M=this.textSize(o,w,c),R=M.size,S=M.lines;this.drawTextMultiLine(S,E,R,c,f),T=Jo.getTexcoordsForSprite(E,R.texture_size,t.texture_size);var z=[E[0]+R.texture_size[0],E[1]];k=Jo.getTexcoordsForSprite(z,R.texture_size,t.texture_size),A.texcoord=T,A.texcoord_stroke=k,u.texcoords_stroke.push(k)}u.texcoords.curved.push({texcoord:T,texture_id:A.texture_id})}}}}else{var P=this.textSize(o,l,c).lines;for(var N in u.align)u.align[N].texture_id===i.texture_idx&&(this.drawTextMultiLine(P,u.align[N].texture_position,u.size,{stroke:c.stroke,stroke_width:c.stroke_width,transform:c.transform,supersample:c.supersample,align:N}),u.align[N].texcoords=Jo.getTexcoordsForSprite(u.align[N].texture_position,u.size.texture_size,t.texture_size))}if(i.text_idx++,!Wo.shouldContinue(e))return!1}i.text_idx=null,i.style_idx++}var O=e.texture_prefix+i.texture_idx;Jo.create(e.gl,O,{element:this.canvas,filtering:"linear",UNPACK_PREMULTIPLY_ALPHA_WEBGL:!0}),Jo.retain(O),i.texture_names.push(O),i.texture_idx++,i.texture_resize=!0,i.style_idx=0}return Wo.finish(e,{textures:i.texture_names}),!0}},{key:"cancelRasterizeTask",value:function(e){Jr("trace","RasterizeTask: release textures [".concat(e.cursor.texture_names.join(", "),"]")),e.cursor.texture_names.forEach(function(e){return Jo.release(e)})}},{key:"setTextureTextPositions",value:function(e,t){var i={cx:0,cy:0,width:0,height:0,column_width:0,texture_id:0,texcoord_cache:{}},r=[];for(var n in e){var o=e[n];for(var s in o){var a=o[s],l=void 0;if(a.text_settings.can_articulate){a.textures=[],i.texcoord_cache[n]=i.texcoord_cache[n]||{};for(var u=0;u<a.type.length;u++){switch(a.type[u]){case"straight":var c=a.isRTL?s.split().reverse().join():s;if(!i.texcoord_cache[n][c]){var h=a.size.texture_size;l=this.placeText(h[0],h[1],n,i,r,t),i.texcoord_cache[n][c]={texture_id:i.texture_id,texture_position:l}}a.textures[u]=i.texture_id;break;case"curved":a.textures[u]=[];for(var f=0;f<a.segment_sizes.length;f++){var d=a.segments[f];if(!i.texcoord_cache[n][d]){var _=a.segment_sizes[f].texture_size,p=2*_[0];l=this.placeText(p,_[1],n,i,r,t),i.texcoord_cache[n][d]={texture_id:i.texture_id,texture_position:l}}a.textures[u].push(i.texture_id)}}}}else{var v=a.size.texture_size;for(var m in a.align)l=this.placeText(v[0],v[1],n,i,r,t),a.align[m].texture_id=i.texture_id,a.align[m].texture_position=l}}}return 0<i.column_width&&0<i.height&&(r[i.texture_id]={texture_size:[i.width,i.height],texcoord_cache:i.texcoord_cache}),r}},{key:"placeText",value:function(e,t,i,r,n,o){var s;return r.cy+t>o?(r.cx+=r.column_width,r.cy=0,r.column_width=e):r.column_width=Math.max(r.column_width,e),r.cx+r.column_width<=o?(s=[r.cx,r.cy],r.cy+=t,r.height=Math.max(r.height,r.cy),r.width=Math.max(r.width,r.cx+r.column_width)):(n[r.texture_id]={texture_size:[r.width,r.height],texcoord_cache:r.texcoord_cache},r.texcoord_cache={},r.texcoord_cache[i]={},r.texture_id++,r.cx=0,r.cy=t,r.column_width=e,r.width=e,r.height=t,s=[0,0]),s}},{key:"applyTextTransform",value:function(e,t){return"capitalize"===t?e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)}):"uppercase"===t?e.toUpperCase():"lowercase"===t?e.toLowerCase():e}}],[{key:"fontPixelSize",value:function(e){if(null!=e){var t=Sr((e="string"==typeof e?e:String(e)).match(A.font_size_re)||[],3),i=t[1],r=t[2];return"em"===(r=r||"px")?i*=16:"pt"===r?i/=.75:"%"===r&&(i/=6.25),i=Fo.parsePositiveNumber(i),i*=on.device_pixel_ratio}}},{key:"pruneTextCache",value:function(){A.cache.text_count>A.cache.text_count_max&&(A.cache.text={},A.cache.text_count=0,Jr("debug","CanvasText: pruning text cache")),Object.keys(A.cache.segment).length>A.cache.segment_count_max&&(A.cache.segment={},Jr("debug","CanvasText: pruning segment cache"))}}]),A}();Jc.font_size_re=/((?:[0-9]*\.)?[0-9]+)\s*(px|pt|em|%)?/,Jc.cache={text:{},text_count:0,text_count_max:2e3,segment:{},segment_count_max:2e3,stats:{text_hits:0,text_misses:0,segment_hits:0,segment_misses:0}};var Kc=new RegExp("[\u0591-\u07ff\u200f\u202b\u202e\ufb1d-\ufdfd\ufe70-\ufefc]");function $c(e){return Kc.test(e)}var Qc="\0-/:-@[-`{-\xbf\xd7\xf7\u02b9-\u02ff\u2000-\u2bff\u2010-\u2029\u202c\u202f-\u2bff",eh=new RegExp("["+Qc+"]+");function th(e){return eh.test(e)}var ih=new RegExp("^["+Qc+"\u0600-\u06ff]+"),rh=new RegExp("["+Qc+"\u0622-\u0625\u0627\u062f-\u0632\u0648\u0671-\u0677\u0688-\u0699\u06c4-\u06cb\u06cf\u06d2\u06d3\u06ee\u06ef]"),nh=new RegExp("^[\u0610-\u061a\u064b-\u065f\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed]+"),oh="[\u0300-\u036f\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u07a6-\u07b0\u0900-\u0903\u093a-\u094c\u094e\u094f\u0951-\u0957\u0962\u0963\u0981-\u0983\u09bc\u09be-\u09cc\u09d7\u09e2\u09e3\u0a01-\u0a03\u0a3c-\u0a4c\u0a51\u0a81-\u0a83\u0abc\u0abe-\u0acc\u0ae2\u0ae3\u0b01-\u0b03\u0b3c\u0b3e-\u0b4c\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe-\u0bcd\u0bd7\u0c00-\u0c03\u0c3e-\u0c4c\u0c55\u0c56\u0c62\u0c63\u0c81-\u0c83\u0cbc\u0cbe-\u0ccc\u0cd5\u0cd6\u0ce2\u0ce3\u0d01-\u0d03\u0d3e-\u0d4c\u0d4e\u0d57\u0d62\u0d63\u0d82\u0d83\u0dca-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f83\u0f86\u0f87\u0f8d-\u0fbc\u0fc6\u102b-\u1038\u103a-\u103e\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f\u109a-\u109d\u17b4-\u17d1\u17d3\u1a55-\u1a5e\u1a61-\u1a7c\u1dc0-\u1dff\u20d0-\u20ff]",sh=new RegExp("^.(?:"+oh+"+)?([\u094d\u09cd\u0a4d\u0acd\u0b4d\u0c4d\u0ccd\u0d4d\u0f84\u1039\u17d2\u1a60\u1a7f]\\W(?:"+oh+"+)?)*"),ah={Mongolian:"\u1800-\u18af"},lh=Object.keys(ah).map(function(e){return ah[e]}).join(""),uh=new RegExp("["+lh+"]");var ch=2;function hh(e,t){var i=t?1:ch;if(e.length<i)return[e];var r=e;if(Jc.cache.segment[r])return Jc.cache.stats.segment_hits++,Jc.cache.segment[r];var n=[];if(ih.exec(e)){n=e.split(rh);for(var o=-1,s=0;s<n.length-1;s++){if(0<s){var a=nh.exec(n[s]);a&&(n[s]=n[s].substring(a[0].length),n[s-1]+=a[0],o+=a[0].length)}o+=1+n[s].length,n[s]+=e.slice(o,o+1)}e=""}for(;e.length;){for(var l="",u=e,c=0;c<i&&u.length;c++){var h=(sh.exec(u)||u)[0];l+=h,u=u.substring(h.length)}n.push(l),e=e.substring(l.length)}return t&&n.reverse(),Jc.cache.stats.segment_misses++,Jc.cache.segment[r]=n}var fh=function(){function _(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1/0;mr(this,_),this.width=0,this.height=0,this.lines=[],this.max_lines=t,this.text_wrap=i,this.context=e}return yr(_,[{key:"createLine",value:function(e){return this.lines.length<this.max_lines&&new dh(e,this.text_wrap)}},{key:"push",value:function(e){if(this.lines.length<this.max_lines){var t=this.context.measureText(e.text).width;return(e.width=t)>this.width&&(this.width=Math.ceil(t)),this.lines.push(e),this.height+=e.height,!0}return this.addEllipsis(),!1}},{key:"advance",value:function(e,t){return!!this.push(e)&&this.createLine(t)}},{key:"addEllipsis",value:function(){var e=this.lines[this.lines.length-1],t=Math.ceil(this.context.measureText(_.ellipsis).width);e.append(_.ellipsis),e.width+=t,e.width>this.width&&(this.width=e.width)}},{key:"finish",value:function(e){e?this.push(e):this.addEllipsis()}}],[{key:"parse",value:function(e,t,i,r,n){var o;o="number"==typeof t?e.split(" "):[e];for(var s=new _(n,i,t),a=s.createLine(r),l=0;l<o.length;l++){for(var u=o[l].split("\n"),c=0===l,h=0;h<u.length&&a;h++){var f=u[h];$c(f)&&th(f[f.length-1])&&(f+="\u200f");var d=c?f:" "+f;if(t&&0<l&&a.exceedsTextwrap(d)){if(!(a=s.advance(a,r)))break;a.append(f),c=!0}else a.append(d);h<u.length-1&&(a=s.advance(a,r),c=!0)}l===o.length-1&&s.finish(a)}return s}}]),_}();fh.ellipsis="...";var dh=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;mr(this,i),this.chars=0,this.text="",this.height=Math.ceil(e),this.text_wrap=t}return yr(i,[{key:"append",value:function(e){this.chars+=e.length,this.text+=e}},{key:"exceedsTextwrap",value:function(e){return e.length+this.chars>this.text_wrap}}]),i}(),_h={resetText:function(){this.texts={}},freeText:function(e){delete this.texts[e.id]},parseTextFeature:function(e,t,i,r){var n=this.parseTextSource(e,t,i);if(null!=n&&""!==n){var o=Xc.compute(e,t,i),s=Xc.key(o);this.texts[r.id]=this.texts[r.id]||{};var a=this.texts[r.id][s]=this.texts[r.id][s]||{};if(n instanceof Object){var l=[],u=n.left+"-"+n.right;for(var c in n){var h=n[c];if(h){var f=this.computeTextLayout({},e,t,i,r,h,o,u,c);a[h]||(a[h]={text_settings:o,ref:0}),l.push({draw:t,text:h,text_settings_key:s,layout:f})}}return 0<l.length&&l}var d=this.computeTextLayout({},e,t,i,r,n,o);return a[n]||(a[n]={text_settings:o,ref:0}),{draw:t,text:n,text_settings_key:s,layout:d}}},parseTextSource:function(e,t,i){var r,n=t.text_source||"name";if(null!=n&&"object"===vr(n))for(var o in r={},n)r[o]=this.parseTextSourceValue(n[o],e,i);else r=this.parseTextSourceValue(n,e,i);return r},parseTextSourceValue:function(e,t,i){var r;if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("string"==typeof e[n]?r=t.properties[e[n]]:"function"==typeof e[n]&&(r=e[n](i)),r)return r}else"string"==typeof e?r=t.properties[e]:e instanceof Function&&(r=e(i));return r},prepareTextLabels:function(i,e,r){var n=this;return 0===Object.keys(this.texts[i.id]||{}).length?Promise.resolve([]):Cr.postMessage(this.main_thread_target+".calcTextSizes",i.id,this.texts[i.id]).then(function(e){var t=e.texts;return i.canceled?(Jr("trace","Style ".concat(n.name,": stop tile build because tile was canceled: ").concat(i.key,", post-calcTextSizes()")),[]):(n.texts[i.id]=t||[],t?n.buildTextLabels(i,r):(Xo.abortTile(i.id),[]))})},collideAndRenderTextLabels:function(t,i,e){var n=this;return this.prepareTextLabels(t,i,e).then(function(e){return 0===e.length?(Xo.collide([],i,t.id),Promise.resolve({})):Xo.collide(e,i,t.id).then(function(e){if(t.canceled)return Jr("trace","stop tile build because tile was canceled: ".concat(t.key,", post-collide()")),{};var r=n.texts[t.id];return null==r||0===e.length?{}:(n.cullTextStyles(r,e),e.forEach(function(e){var t=e.text_settings_key,i=r[t]&&r[t][e.text];i.text_settings.can_articulate?(i.type||(i.type=[]),-1===i.type.indexOf(e.label.type)&&i.type.push(e.label.type)):(i.align=i.align||{},i.align[e.label.align]={})}),{labels:e,texts:r,textures:[]})})})},cullTextStyles:function(e,t){for(var i=0;i<t.length;i++){var r=t[i];e[r.text_settings_key][r.text].ref++}for(var n in e)for(var o in e[n])e[n][o].ref<1&&delete e[n][o];for(var s in e)0===Object.keys(e[s]).length&&delete e[s]},calcTextSizes:function(e,t){return this.canvas||(this.canvas=new Jc),this.canvas.textSizes(e,t)},preprocessText:function(e){if(e&&e.font&&"object"===vr(e.font))return e.font.fill=Fo.createPropertyCache(e.font.fill),e.font.stroke&&(e.font.stroke.color=Fo.createPropertyCache(e.font.stroke.color)),e.font.px_size=Fo.createPropertyCache(e.font.size||Xc.defaults.size,Jc.fontPixelSize),e.font.stroke&&null!=e.font.stroke.width&&(e.font.stroke.width=Fo.createPropertyCache(e.font.stroke.width,Fo.parsePositiveNumber)),e.offset=Fo.createPropertyCache(e.offset,function(e){return Array.isArray(e)&&e.map(Fo.parseNumber)}),e.buffer=Fo.createPropertyCache(e.buffer,function(e){return(Array.isArray(e)?e:[e,e]).map(Fo.parsePositiveNumber)}),e.repeat_distance=Fo.createPropertyCache(e.repeat_distance||Kr.tile_size,Fo.parsePositiveNumber),e},computeTextLayout:function(e,t,i,r,n,o,s,a,l){var u=e||{};return(u=this.computeLayout(u,t,i,r,n)).repeat_distance&&(a&&(u.repeat_group+="/"+a),u.repeat_group+="/"+o),u.subdiv=n.overzoom2,u.align=i.align,u.italic="normal"!==s.style,"right"===l?u.orientation=1:"left"===l&&(u.orientation=-1),u}};var ph=Math.PI/180,vh=function(){function i(e,t){mr(this,i),this._min_zoom=H.util.constants.DEFAULT_MIN_ZOOM_LEVEL,this._max_zoom=H.util.constants.DEFAULT_MAX_ZOOM_LEVEL,this._viewport=e,this._center_offset=[],this._center_offset_normalized=[],this._viewport_aspect_ratio=1,this._focal_length=[[16,2],[17,2.5],[18,3],[19,4],[20,6]],this._view_matrix=new Float64Array(16),this._projection_matrix=new Float64Array(16),this._heading_matrix=new Float64Array(16),this._tilt_matrix=new Float64Array(16),this._transformation_matrix=new Float64Array(16),this._lookAtData={position:[0,0,0],zoom:0,tile_level:0,distance:void 0,tilt:0,incline:0,heading:180},this._zoom_direction=0,this._horizon=0,this.handleViewportUpdate(!0),t?this.setLookAtData(t):this._updateMatrices(),Zl.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_center_offset;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n            }")}return yr(i,[{key:"_getZoomForBounds",value:function(e,t,i,r){for(var n=this.clone(),o=this._max_zoom;o>=this._min_zoom;){if(n.setLookAtData({zoom:o-=.1,position:t,tilt:i,heading:r}),e.every(function(e){return vl.isPointInsidePolygon(e,n.getLookAtData().bounds)}))break}return n.getLookAtData().zoom}},{key:"setZoomConstraints",value:function(e,t){this._min_zoom=e,this._max_zoom=t,this.setLookAtData(this.getLookAtData())}},{key:"setLookAtData",value:function(e,t){var i,r,n=e.position,o=e.zoom;if(n===i&&e.bounds!==i&&(n=vl.getBBoxCenter(vl.getBBox(e.bounds))),o===i&&e.bounds!==i&&(o=this._getZoomForBounds(e.bounds,n,e.tilt,e.heading)),t!==i&&(r=n||this.screenToWorld(t)),o!==i){o=vl.clamp(o,this._min_zoom,this._max_zoom);var s=on.zoomToTileLevel(o),a=this._lookAtData.tile_level;s!==a&&(this._zoom_direction=a<s?1:-1),this._lookAtData.zoom=o,this._lookAtData.tile_level=s}if(e.tilt!==i&&(this._lookAtData.tilt=e.tilt),e.heading!==i&&(this._lookAtData.heading=e.heading),t!==i){this._updateMatrices();var l=this.screenToWorld(t);this._lookAtData.position[0]-=l[0]-r[0],this._lookAtData.position[1]-=l[1]-r[1]}else n&&(this._lookAtData.position=n);this._lookAtData.position[2]=0,this._lookAtData.position[1]=vl.clamp(this._lookAtData.position[1],-Kr.half_circumference_meters,Kr.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"getZoomDirection",value:function(){return this._zoom_direction}},{key:"resetZoomDirection",value:function(){this._zoom_direction=0}},{key:"getLookAtData",value:function(){return this._lookAtData}},{key:"handleViewportUpdate",value:function(e){var t=0<arguments.length&&void 0!==e&&e,i=this._viewport,r=i.width,n=i.height;this._viewport_aspect_ratio=r/n;var o=this._viewport.center.x-(r/2<<0),s=this._viewport.center.y-(n/2<<0);this._center_offset[0]=o,this._center_offset[1]=s,this._center_offset_normalized[0]=o/r,this._center_offset_normalized[1]=s/-n,t||(this._updateMatrices(),this._updateVisibleBounds())}},{key:"setupMatrices",value:function(e,t){es.multiply(e.model_view32,this._view_matrix,e.model),t.uniform("Matrix4fv","u_modelView",e.model_view32),t.uniform("1f","u_tilt",this._lookAtData.tilt*ph),t.uniform("1f","u_heading",this._lookAtData.heading*ph),Qo.normalFromMat4(e.normal32,e.model_view32),Qo.invert(e.inverse_normal32,e.normal32),t.uniform("Matrix3fv","u_normalMatrix",e.normal32),t.uniform("Matrix3fv","u_inverseNormalMatrix",e.inverse_normal32)}},{key:"_updateMatrices",value:function(){var e=this._viewport.height*Kr.metersPerPixel(this._lookAtData.zoom),t=on.interpolate(this._lookAtData.zoom,this._focal_length);this._lookAtData.distance=e/2*t;var i=this._lookAtData.position[0],r=this._lookAtData.position[1];es.lookAt(this._view_matrix,$o.fromValues(i,r,0),$o.fromValues(i,r,-1),$o.fromValues(0,1,0)),this._heading_matrix=es.identity(this._heading_matrix);var n=180-this._lookAtData.heading;n*=ph,this._heading_matrix[0]=Math.cos(n),this._heading_matrix[1]=-Math.sin(n),this._heading_matrix[4]=Math.sin(n),this._heading_matrix[5]=Math.cos(n),this._tilt_matrix=es.identity(this._tilt_matrix),n=0<(n=this._lookAtData.tilt?this._lookAtData.tilt*ph:0)?-n:n,this._tilt_matrix[5]=Math.cos(n),this._tilt_matrix[6]=Math.sin(n),this._tilt_matrix[9]=-Math.sin(n),this._tilt_matrix[10]=Math.cos(n),es.multiply(this._transformation_matrix,this._tilt_matrix,this._heading_matrix),es.multiply(this._view_matrix,this._transformation_matrix,this._view_matrix);var o=2*Math.atan(1/t);es.perspective(this._projection_matrix,o,this._viewport_aspect_ratio,1,2*this._lookAtData.distance),this._projection_matrix[8]=2*-this._center_offset_normalized[0],this._projection_matrix[9]=2*-this._center_offset_normalized[1],es.translate(this._projection_matrix,this._projection_matrix,$o.fromValues(0,0,-this._lookAtData.distance))}},{key:"_updateVisibleBounds",value:function(){var e=this._viewport,t=e.width,i=e.height;this._horizon=Math.max(i/2-Math.cos(function(e){return e*Math.PI/180}(this._lookAtData.tilt))*i*.75,0),this._lookAtData.tetragon=[this.screenToWorld([0,this._horizon]),this.screenToWorld([t,this._horizon]),this.screenToWorld([t,i]),this.screenToWorld([0,i])];var r=this._viewport.padding,n=[];if(0===r.left&&0===r.top&&0===r.right&&0===r.bottom)n=this._lookAtData.tetragon;else{var o=r.left,s=Math.max(this._horizon,r.top),a=t-r.right,l=i-r.bottom;n=[this.screenToWorld([o,s]),this.screenToWorld([a,s]),this.screenToWorld([a,l]),this.screenToWorld([o,l])]}var u=Sr(vl.getBBox(n),4),c=u[0],h=u[1],f=u[2],d=u[3],_=[[c,Kr.half_circumference_meters],[f,Kr.half_circumference_meters],[f,-Kr.half_circumference_meters],[c,-Kr.half_circumference_meters]],p=vl.clipPolygon(_,n)[0],v=Sr(vl.getBBox(p),4);c=v[0],h=v[1],f=v[2],d=v[3],f-c>=Kr.circumference_meters&&(p=[[-Kr.half_circumference_meters,d],[Kr.half_circumference_meters,d],[Kr.half_circumference_meters,h],[-Kr.half_circumference_meters,h]]);var m=[];p&&(m=vl.splitLegs(p,Kr.half_circumference_meters)),this._lookAtData.bounds=m}},{key:"applyPxOffset",value:function(e){var t=Sr(e,2),i=t[0],r=t[1],n=Math.PI-this._lookAtData.heading*ph,o=Kr.metersPerPixel(this._lookAtData.zoom);this._lookAtData.position[0]+=(i*Math.cos(n)+r*Math.sin(n))*o,this._lookAtData.position[1]-=(r*Math.cos(n)-i*Math.sin(n))*o,this._lookAtData.position[1]=vl.clamp(this._lookAtData.position[1],-Kr.half_circumference_meters,Kr.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"screenToWorld",value:function(e){var t=Sr(e,2),i=t[0],r=t[1],n=this._viewport,o=n.width,s=n.height;return 0===o||0===s?[0,0]:(i-=o/2,r-=s/2,this._clipCoordsToWorldPlaneCoords([2*(i+o/2)/o-1,1-2*(r+s/2)/s,-1,1]))}},{key:"_clipToScreenCoords",value:function(e){var t=this._viewport,i=t.width,r=t.height;return[(.5*e[0]+.5)*i,r-(.5*e[1]+.5)*r]}},{key:"_isScreenPointInViewPort",value:function(e){var t=this._viewport,i=t.width,r=t.height;return 0<=e[0]&&e[0]<=i&&0<=e[1]&&e[1]<=r}},{key:"worldToScreen",value:function(e,t){var i;if(1<arguments.length&&void 0!==t&&t){var r=this._worldToClipCoords(e);i=this._clipToScreenCoords(r)}else{var n=Math.sign(this._lookAtData.position[0]),o=Math.trunc(this._lookAtData.position[0]/Kr.circumference_meters+n/2),s=[e[0]+Kr.circumference_meters*o,e[1]],a=this._worldToClipCoords(s),l=i=this._clipToScreenCoords(a);this._isScreenPointInViewPort(i)||(a=this._worldToClipCoords([s[0]+Kr.circumference_meters,s[1]]),i=this._clipToScreenCoords(a),this._isScreenPointInViewPort(i)||(a=this._worldToClipCoords([s[0]-Kr.circumference_meters,s[1]]),i=this._clipToScreenCoords(a)),this._isScreenPointInViewPort(i)||(i=l))}return i}},{key:"getHorizon",value:function(){return this._horizon}},{key:"_clipCoordsToWorldPlaneCoords",value:function(e){var t=[],i=this._lookAtData.distance,r=this._lookAtData.position,n=[0,0,i,0],o=0,s=i*Math.sin(ph*this._lookAtData.tilt)*Math.cos(ph*this._lookAtData.heading),a=i*Math.sin(ph*this._lookAtData.tilt)*Math.sin(ph*this._lookAtData.heading),l=new Float64Array(16),u=new Float64Array(16);return es.invert(l,this._projection_matrix),ts.transformMat4(t,e,l),t[2]=-1,t[3]=0,es.invert(u,this._view_matrix),ts.transformMat4(t,t,u),ts.normalize(t,t),ts.transformMat4(n,n,this._transformation_matrix),0!==t[2]&&(o=-n[2]/t[2]),ts.scale(t,t,o),[r[0]+(t[0]+a),r[1]+(t[1]+s)]}},{key:"_worldToClipCoords",value:function(e){var t=[e[0],e[1],0,1];return ts.transformMat4(t,t,this._view_matrix),ts.transformMat4(t,t,this._projection_matrix),ts.scale(t,t,1/t[3]),t}},{key:"setupProgram",value:function(e){e.uniform("Matrix4fv","u_projection",this._projection_matrix),e.uniform("3f","u_eye",[0,0,this._lookAtData.distance]),e.uniform("2fv","u_center_offset",this._center_offset_normalized)}},{key:"getTransformationMatrix",value:function(){return this._transformation_matrix}},{key:"clone",value:function(){var e=new i(this._viewport,this._lookAtData);return e.setZoomConstraints(this._min_zoom,this._max_zoom),e}},{key:"getViewport",value:function(){return this._viewport}}]),i}();function mh(e){return void 0===e.x?e[0]:e.x}function gh(e){return void 0===e.y?e[1]:e.y}function yh(e,t){return mh(e)-mh(t)}function xh(e,t){return gh(e)-gh(t)}function bh(e){return e.sort(yh)}function wh(e,t){for(var i,r=e[0],n=r,o=0;o<e.length;o+=1)t(i=e[o],r)<0?r=i:0<t(i,n)&&(n=i);return[r,n]}function Ah(r,e){return Object.values(e.reduce(function(e,t){var i=t[+r];return e[i]||(e[i]=[]),e[i].push(t),e},{}))}function Th(e,t,i){var r=+e,n=t[r],o=i[r];if(o<n)return[];var s=[t];if(o<n)return s;for(var a=t[(1+r)%2],l=e?function(e){return s.push([a,e])}:function(e){return s.push([e,a])},u=n+1;u<o;u+=1)l(u);return s.push(i),s}function kh(e,t){return Th(!1,e,t)}function Eh(e,t){return Th(!0,e,t)}function Mh(e){var i={},r=[];return e.forEach(function(e){var t=e.key||(Array.isArray(e)?"".concat(e[0],"/").concat(e[1]):"".concat(e.x,"/").concat(e.y));i[t]||(i[t]=!0,r.push(e))}),r}function Rh(e){return e.reduce(function(e,t){return e.concat(t)})}function Sh(e,s){if(s<=0)return e;var t=function(e){var t=Sr(wh(e,yh),2),i=t[0],r=t[1],n=[i[0]-s,i[1]],o=[r[0]+s,r[1]];return e.concat(kh(n,i),kh(r,o))},i=function(e){var t=Sr(wh(e,xh),2),i=t[0],r=t[1],n=[i[0],i[1]-s],o=[r[0],r[1]+s];return e.concat(Eh(n,i),Eh(r,o))};return Mh(Rh(function(e){return Ah(!0,e)}(Rh(function(e){return Ah(!1,e)}(e).map(i))).map(t)))}function zh(t,e,i){function r(e){return Object.values(Kr.metersToExactTileCoords(e,t.tile_level))}return Mh(function(e,n,o){return e.map(function(e){var t=Sr(e,2),i=t[0],r=t[1];return ns.coord(Kr.wrapTile({x:i,y:r,z:n},{x:!o,y:!0}))})}(Sh(function(e,t,i,r){var n=Ph(t,e,i),o=Ph(i,r,t);return Mh(n.concat(o))}(r(t.tetragon[0]),r(t.tetragon[1]),r(t.tetragon[3]),r(t.tetragon[2])),e),t.tile_level,i))}function Ph(e,t,i){var r=Sr(function(e,t,i){var r=Sr(e,2),n=r[0],o=r[1],s=Sr(t,2),a=s[0],l=s[1],u=Sr(i,2),c=u[0],h=u[1],f=n+(l-o)/(h-o)*(c-n);return[[[n,o]].concat(zr(bh([[a,l],[f,l]]))),[].concat(zr(bh([[a,l],[f,l]])),[[c,h]])]}.apply(void 0,zr(function(e){return e.sort(xh)}([e,t,i]))),2),n=r[0],o=r[1];return Mh(function(e,t,i){var r=Sr(e,2),n=r[0],o=r[1],s=Sr(t,2),a=s[0],l=s[1],u=Sr(i,1)[0];return Oh(n,a,u,o,l)}.apply(void 0,zr(n)).concat(function(e,t,i){var r=Sr(e,2),n=r[0],o=r[1],s=Sr(t,1)[0],a=Sr(i,2),l=a[0],u=a[1];return Oh(l,n,s,u,o)}.apply(void 0,zr(o))))}var Nh=.125;function Oh(e,t,i,r,n){var o=Math.min(e,t),s=Math.max(e,i),a=Math.min(r,n),l=Math.max(r,n);if(Math.floor(r)===Math.floor(n))return Ch(o,s,r);if(l-a<Nh)return function(e,t){var i=Sr(e,2),r=i[0],n=i[1],o=Sr(t,2),s=o[0],a=o[1],l=Ih(r,s),u=Lh(l,n),c=Lh(l,a);return u.concat(c)}([o,a],[s,l]);function u(e){_=_.concat(Ch(p,v,Math.floor(e))),p+=f,v+=d}var c=function(e,t){return Nh*(t-e)/(Math.ceil(t)-Math.floor(e))}(a,l),h=(l-a)/c,f=(t-e)/h,d=(i-e)/h,_=[],p=e,v=e;if(r<n)for(var m=a;m<=l;m+=c)u(m);else for(var g=l;a<=g;g-=c)u(g);return Mh(_)}function Lh(e,t){return e.map(function(e){return[e,t]})}function Ih(e,t){var i=Math.floor(e),r=Math.floor(t);if(r<i)return[];if(i===r)return[i];for(var n=[],o=i;o<=r;o+=1)n.push(o);return n}function Ch(e,t,i){return Lh(Ih(e,t),i)}var Fh=function(){function i(e,t){mr(this,i),Zo(this),this.scene=e,this.createMatrices(),this.bounds=null,this.center_tile=null,this.panning=!1,this.panning_stop_at=0,this.pan_snap_timer=0,this.user_input_at=0,this.user_input_timeout=50,this.user_input_active=!1,this.size={},this.buffer=0,this.wrap=!1!==t.wrapView,this.preserve_tiles_within_zoom=1,this.lookAtManipulator=new vh(t.viewport),this._viewport=t.viewport,this.handleViewportUpdate(!0)}return yr(i,[{key:"update",value:function(){this.pan_snap_timer=(+new Date-this.panning_stop_at)/1e3,this.user_input_active=+new Date-this.user_input_at<this.user_input_timeout,this.scene.tile_manager.updateTilesVisibilityCounters()}},{key:"handleViewportUpdate",value:function(e){var t=0<arguments.length&&void 0!==e&&e,i=this._viewport,r=i.width,n=i.height;this.size.css={width:r,height:n},this.size.device={width:Math.round(r*on.device_pixel_ratio),height:Math.round(n*on.device_pixel_ratio)},this.lookAtManipulator.handleViewportUpdate(),t||this.updateBounds()}},{key:"setLookAtData",value:function(e,t){var i=e.position,r=e.zoom,n=e.tilt,o=e.heading,s=e.bounds,a={zoom:r,tilt:n,heading:o};if(i&&"number"==typeof i.lng&&"number"==typeof i.lat&&(a.position=Kr.latLngToMeters([i.lng,i.lat])),s){var l=[],u=s.getBoundingBox();l.push(Kr.latLngToMeters([u.getLeft(),u.getTop()])),l.push(Kr.latLngToMeters([u.getRight(),u.getTop()])),l.push(Kr.latLngToMeters([u.getRight(),u.getBottom()])),l.push(Kr.latLngToMeters([u.getLeft(),u.getBottom()])),a.bounds=l}this.lookAtManipulator.setLookAtData(a,t),this.updateBounds()}},{key:"getLookAtData",value:function(){var e=this.lookAtManipulator.getLookAtData(),t=Sr(Kr.metersToLatLng(e.position),2),i=t[0],r=t[1],n=new H.geo.LineString;return e.bounds.forEach(function(e){var t=Kr.metersToLatLng(e);n.pushLatLngAlt(t[1],t[0],0)}),{heading:e.heading,incline:e.incline,tilt:e.tilt,zoom:e.zoom,bounds:new H.geo.Polygon(n),position:{lat:r,lng:i,alt:e.position[2]}}}},{key:"applyPxOffset",value:function(e){this.lookAtManipulator.applyPxOffset(e),this.updateBounds()}},{key:"setPanning",value:function(e){this.panning=e,this.panning||(this.panning_stop_at=+new Date)}},{key:"markUserInput",value:function(){this.user_input_at=+new Date}},{key:"ready",value:function(){return"number"==typeof this.size.css.width&&"number"==typeof this.size.css.height}},{key:"updateBounds",value:function(){if(this.markUserInput(),this.ready()){this.center_tile=Kr.tileForMeters(this.lookAtManipulator.getLookAtData().position,this.lookAtManipulator.getLookAtData().tile_level);var e=this.lookAtManipulator.screenToWorld([0,this.size.css.height]),t=this.lookAtManipulator.screenToWorld([this.size.css.width,0]);this.bounds={sw:{x:e[0],y:e[1]},ne:{x:t[0],y:t[1]}},this.scene.tile_manager.updateTilesForView(),this.trigger("move"),this.scene.requestRedraw()}}},{key:"getTileGridFlat",value:function(){var e=this.lookAtManipulator.getLookAtData().tile_level,t=Kr.tileForMeters([this.bounds.sw.x,this.bounds.sw.y],e),i=Kr.tileForMeters([this.bounds.ne.x,this.bounds.ne.y],e),r=[t.x-this.buffer,i.x+this.buffer,i.y-this.buffer,t.y+this.buffer];if(!1===this.wrap){var n=(1<<e)-1;r=r.map(function(e){return Math.min(Math.max(0,e),n)})}for(var o=[],s=r[0];s<=r[1];s++)for(var a=r[2];a<=r[3];a++)o.push(ns.coord(Kr.wrapTile({x:s,y:a,z:e},{x:!this.wrap,y:!0})));return Mh(o)}},{key:"getTileGridDistorted",value:function(){return zh(this.lookAtManipulator.getLookAtData(),this.buffer,this.wrap)}},{key:"findVisibleTileCoordinates",value:function(){if(!this.bounds)return[];var e=this.lookAtManipulator.getLookAtData(),t=e.tilt,i=e.heading;return 0===t&&180===i?this.getTileGridFlat():this.getTileGridDistorted()}},{key:"pruneTilesForView",value:function(){var i=this;if(this.ready()){var r=[Math.ceil((Math.floor(this.size.css.width/Kr.tile_size)+2)/2),Math.ceil((Math.floor(this.size.css.height/Kr.tile_size)+2)/2)];this.scene.tile_manager.removeTiles(function(e){if(e.visible||e.isProxy())return!1;if(e.loading&&e.style_zoom!==i.lookAtManipulator.getLookAtData().tile_level)return!0;if(Math.abs(e.style_zoom-i.lookAtManipulator.getLookAtData().tile_level)>i.preserve_tiles_within_zoom)return!0;var t=ns.coordinateAtZoom(e.coords,i.lookAtManipulator.getLookAtData().tile_level);return Math.abs(t.x-i.center_tile.x)-r[0]>i.buffer||Math.abs(t.y-i.center_tile.y)-r[1]>i.buffer})}}},{key:"createMatrices",value:function(){this.matrices={},this.matrices.model=new Float64Array(16),this.matrices.model32=new Float32Array(16),this.matrices.model_view=new Float64Array(16),this.matrices.model_view32=new Float32Array(16),this.matrices.normal=new Float64Array(9),this.matrices.normal32=new Float32Array(9),this.matrices.inverse_normal32=new Float32Array(9)}},{key:"setupTile",value:function(e,t){e.setupProgram(this.matrices,t),this.lookAtManipulator.setupMatrices(this.matrices,t)}},{key:"setupProgram",value:function(e){var t=this.lookAtManipulator.getLookAtData();e.uniform("2fv","u_resolution",[this.size.device.width,this.size.device.height]),e.uniform("3fv","u_map_position",[t.position[0],t.position[1],Math.trunc(1e5*t.zoom)/1e5]),e.uniform("1f","u_meters_per_pixel",Kr.metersPerPixel(t.zoom)),e.uniform("1f","u_device_pixel_ratio",on.device_pixel_ratio),e.uniform("1f","u_view_pan_snap_timer",this.pan_snap_timer),e.uniform("1i","u_view_panning",this.panning),e.uniform("1f","u_horizon",this.lookAtManipulator.getHorizon()/(this.size.css.height/2)),this.lookAtManipulator.setupProgram(e)}},{key:"isAnimating",value:function(){return this.pan_snap_timer<=.5}},{key:"xyToGeo",value:function(e,t){var i=this.lookAtManipulator.screenToWorld([e,t]),r=Sr(Kr.metersToLatLng(i),2),n=r[0];return{lat:r[1],lng:n}}},{key:"geoToPixel",value:function(e){var t=Sr(this.lookAtManipulator.worldToScreen(Kr.latLngToMeters([e.lng,e.lat])),2),i=t[0],r=t[1];return{x:Math.floor(i),y:Math.floor(r)}}},{key:"setZoomConstraints",value:function(e,t){this.lookAtManipulator.setZoomConstraints(e,t)}}]),i}(),Dh=jc.PLACEMENT,Uh=128/Math.PI,jh=16384/Math.PI,Gh=Object.create(cu);Gh.variants={};Object.assign(Gh,_h),Object.assign(Gh,{name:"points",built_in:!0,vertex_shader_src:"uniform vec2 u_resolution;uniform float u_time;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform bool u_tile_fade_in;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform bool u_view_panning;uniform float u_view_pan_snap_timer;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform float u_tilt;uniform float u_heading;attribute vec4 a_position;attribute vec4 a_shape;attribute vec4 a_color;attribute vec2 a_texcoord;attribute vec2 a_offset;uniform float u_point_type;attribute float a_is_flat;\n#ifdef TANGRAM_IS_TEXT_STYLE\nattribute vec4 a_offsets_alt;attribute vec4 a_pre_angles_alt;attribute vec4 a_angles_alt;attribute vec4 a_offsets;attribute vec4 a_pre_angles;attribute vec4 a_angles;\n#endif\nvarying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nattribute float a_outline_edge;attribute vec4 a_outline_color;varying float v_outline_edge;varying vec4 v_outline_color;varying float v_aa_offset;\n#endif\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nvarying float v_label_hidden;\n#endif\n#define PI 3.14159265359\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\nvec2 rotate2D(vec2 _st,float _angle){return mat2(cos(_angle),-sin(_angle),sin(_angle),cos(_angle))*_st;}vec3 rotateX3D(vec3 _st,float _angle){return mat3(1.,0.,0.,0.,cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle))*_st;}vec3 rotateZ3D(vec3 _st,float _angle){return mat3(cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle),0.,0.,0.,1.)*_st;}\n#ifdef TANGRAM_IS_TEXT_STYLE\nfloat mix4linear(float a,float b,float c,float d,float x){return mix(mix(a,b,3.*x),mix(b,mix(c,d,3.*(max(x,.66)-.66)),3.*(clamp(x,.33,.66)-.33)),step(0.33,x));}\n#endif\nvoid main(){\n#pragma tangram: setup\n#ifndef TANGRAM_SHOW_HIDDEN_LABELS\nif(a_shape.w==0.){gl_Position=vec4(0.,0.,0.,1.);return;}\n#else\nif(a_shape.w==0.){v_label_hidden=1.;}else{v_label_hidden=0.;}\n#endif\nv_alpha_factor=1.0;v_color=a_color;v_texcoord=a_texcoord;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nv_outline_color=a_outline_color;v_outline_edge=a_outline_edge;if(u_point_type==TANGRAM_POINT_TYPE_SHADER){v_outline_color=a_outline_color;v_outline_edge=a_outline_edge;float size=abs(a_shape.x/128.);v_texcoord=sign(a_shape.xy)*(size+1.)/(size);size+=2.;v_aa_offset=2./size;}\n#endif\nvec4 position=u_modelView*vec4(a_position.xyz,1.);vec4 shape=vec4(a_shape.xy,0.,0.);vec2 offset=vec2(a_offset.x,-a_offset.y);float zoom=clamp(u_map_position.z-u_tile_origin.z,0.,1.);float theta=a_shape.z/4096.;float heading=u_heading;float delta=(heading-PI);float new_theta=theta-delta;float reversed=abs(new_theta)>PI/2. ? 1. : 0.;if(a_is_flat==1.0){\n#ifdef TANGRAM_IS_TEXT_STYLE\nif(a_offsets[0]!=0.){vec4 angles_scaled;vec4 pre_angles_scaled;vec4 offsets_scaled;if(reversed==1.){offsets_scaled=a_offsets_alt*4.;angles_scaled=(PI/16384.)*a_angles_alt;pre_angles_scaled=(PI/128.)*a_pre_angles_alt;}else{offsets_scaled=a_offsets*4.;angles_scaled=(PI/16384.)*a_angles;pre_angles_scaled=(PI/128.)*a_pre_angles;}float pre_angle=mix4linear(pre_angles_scaled[0],pre_angles_scaled[1],pre_angles_scaled[2],pre_angles_scaled[3],zoom);float angle=mix4linear(angles_scaled[0],angles_scaled[1],angles_scaled[2],angles_scaled[3],zoom);float offset_curve=mix4linear(offsets_scaled[0],offsets_scaled[1],offsets_scaled[2],offsets_scaled[3],zoom);shape.xy=rotate2D(shape.xy,pre_angle+PI*reversed);shape.x+=offset_curve;shape.xy=rotate2D(shape.xy,angle);shape.xy+=rotate2D(offset,theta);}else{shape.xy=rotate2D(shape.xy+offset*256.,theta+(PI*reversed));}\n#else\nshape.xy=rotate2D(shape.xy+offset*256.,theta);\n#endif\nshape.xy/=pow(2.,4.+(u_map_position.z-u_tile_origin.w));shape=u_modelView*shape;position+=shape;}else{shape.xy/=256.;shape.xy=rotate2D(shape.xy+offset,theta);}\n#ifdef TANGRAM_FADE_IN_RATE\nif(u_tile_fade_in){v_alpha_factor*=clamp(u_visible_time*TANGRAM_FADE_IN_RATE,0.,1.);}\n#endif\n#ifdef TANGRAM_FADE_ON_ZOOM_OUT\nv_alpha_factor*=clamp(1.+TANGRAM_FADE_ON_ZOOM_OUT_RATE*(u_map_position.z-u_tile_origin.z),0.,1.);\n#endif\nv_world_position=u_model*position;v_world_position.xy+=shape.xy*u_meters_per_pixel;v_world_position=wrapWorldPosition(v_world_position);\n#pragma tangram: position\ncameraProjection(position);\n#ifdef TANGRAM_LAYER_ORDER\napplyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);\n#endif\nif(a_is_flat!=1.){position.xy+=shape.xy*position.w*2.*u_device_pixel_ratio/u_resolution;}\n#ifdef TANGRAM_HAS_SHADER_POINTS\nif(u_point_type==TANGRAM_POINT_TYPE_SHADER){position.xy+=sign(shape.xy)*position.w*u_device_pixel_ratio/u_resolution;}\n#endif\n#ifdef TANGRAM_HAS_SHADER_POINTS\nif(!u_view_panning&&(abs(theta)<TANGRAM_EPSILON)&&u_point_type!=TANGRAM_POINT_TYPE_SHADER){\n#else\nif(!u_view_panning&&(abs(theta)<TANGRAM_EPSILON)){\n#endif\nvec2 position_fract=fract((((position.xy/position.w)+1.)*.5)*u_resolution);vec2 position_snap=position.xy+((step(0.5,position_fract)-position_fract)*position.w*2./u_resolution);\n#ifdef TANGRAM_VIEW_PAN_SNAP_RATE\nposition.xy=mix(position.xy,position_snap,clamp(u_view_pan_snap_timer*TANGRAM_VIEW_PAN_SNAP_RATE,0.,1.));\n#else\nposition.xy=position_snap;\n#endif\n}gl_Position=position;}",fragment_shader_src:"uniform vec2 u_resolution;uniform float u_time;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform sampler2D u_texture;uniform float u_point_type;uniform bool u_apply_color_blocks;varying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nvarying vec4 v_outline_color;varying float v_outline_edge;varying float v_aa_offset;\n#endif\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nvarying float v_label_hidden;\n#endif\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n#ifdef TANGRAM_HAS_SHADER_POINTS\nfloat _tangram_antialias(float l,float R){float low=R-v_aa_offset;float high=R+v_aa_offset;return 1.-smoothstep(low,high,l);}\n#endif\nvoid main(void){\n#pragma tangram: setup\nvec4 color=v_color;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nif(u_point_type==TANGRAM_POINT_TYPE_TEXTURE){color*=texture2D(u_texture,v_texcoord);}else if(u_point_type==TANGRAM_POINT_TYPE_LABEL){color=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);}else if(u_point_type==TANGRAM_POINT_TYPE_SHADER){float outline_edge=v_outline_edge;vec4 outlineColor=v_outline_color;float l=length(v_texcoord);float outer_alpha=_tangram_antialias(l,1.);float fill_alpha=_tangram_antialias(l,1.-v_outline_edge*0.5)*color.a;float stroke_alpha=(outer_alpha-_tangram_antialias(l,1.-v_outline_edge))*outlineColor.a;\n#ifdef TANGRAM_BLEND_ADD\ncolor.a=stroke_alpha+fill_alpha;color.rgb=color.rgb*fill_alpha+outlineColor.rgb*stroke_alpha;\n#else\ncolor.a=stroke_alpha+fill_alpha*(1.-stroke_alpha);color.rgb=mix(color.rgb*fill_alpha,outlineColor.rgb,stroke_alpha)/max(color.a,0.001);\n#endif\n}\n#else\ncolor=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);\n#endif\nif(u_apply_color_blocks){\n#pragma tangram: color\n#pragma tangram: filter\n}color.a*=v_alpha_factor;\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nif(v_label_hidden>0.){color.a*=0.5;color.rgb=vec3(1.,0.,0.);}\n#endif\n#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY) && !defined(TANGRAM_BLEND_ADD)\nif(color.a<TANGRAM_ALPHA_TEST){discard;}\n#endif\ngl_FragColor=color;}",selection:!0,collision:!0,blend:"overlay",init:function(e){var t=0<arguments.length&&void 0!==e?e:{};cu.init.call(this,t),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!0,this.defines.TANGRAM_POINT_TYPE_TEXTURE=1,this.defines.TANGRAM_POINT_TYPE_LABEL=2,this.defines.TANGRAM_POINT_TYPE_SHADER=3,this.collision_group_points=this.name+"-points",this.collision_group_text=this.name+"-text",this.reset()},setupDefines:function(){"overlay"!==this.blend&&(this.defines.TANGRAM_LAYER_ORDER=!0),this.defines.TANGRAM_FADE_ON_ZOOM_OUT=!0,this.defines.TANGRAM_FADE_ON_ZOOM_OUT_RATE=2,Ll.suppress_label_fade_in||this.suppress_fade?(this.fade_in_time=0,this.defines.TANGRAM_FADE_IN_RATE=null):(this.fade_in_time=.15,this.defines.TANGRAM_FADE_IN_RATE=1/this.fade_in_time),!0!==Ll.suppress_label_snap_animation&&(this.defines.TANGRAM_VIEW_PAN_SNAP_RATE=2),!0===Ll.show_hidden_labels&&(this.defines.TANGRAM_SHOW_HIDDEN_LABELS=!0)},reset:function(){this.queues={},this.resetText(),this.texture_missing_sprites={}},addFeature:function(e,t,i){var r=i.tile,n={};if(n.color=this.parseColor(t.color,i),n.texture=t.texture,n.label_texture=null,n.color||n.texture){var o;if(this.hasSprites(n)){if(!(o=this.parseSprite(n,t,i)))return;n.texcoords=o.texcoords}if(n.size=t.size,n.size){if(n.size=Fo.evalCachedPointSizeProperty(t.size,o,i),null==n.size)return void Jr({level:"warn",once:!0},"Layer '".concat(t.layers[t.layers.length-1],"': ")+"'size' includes % and/or ratio-based scaling (".concat(JSON.stringify(t.size.value),"); ")+"these can only applied to sprites, but no sprite was specified, skipping features in layer");"number"==typeof n.size&&(n.size=[n.size,n.size])}else n.size=o&&o.css_size||[16,16];if(t.outline&&(n.outline_width=Fo.evalCachedProperty(t.outline.width,i)||Fo.defaults.outline.width,n.outline_color=this.parseColor(t.outline.color,i)),n.outline_edge_pct=0,n.outline_width&&n.outline_color){var s=n.outline_width;n.size[0]+=s,n.size[1]+=s,n.outline_edge_pct=s/Math.min(n.size[0],n.size[1])*2}n.size[0]=Math.min(n.size[0],256),n.size[1]=Math.min(n.size[1],256),n.placement=t.placement,n.placement_min_length_ratio=Fo.evalCachedProperty(t.placement_min_length_ratio,i),n.placement===Dh.SPACED&&t.placement_spacing&&(n.placement_spacing=Fo.evalCachedProperty(t.placement_spacing,i)),n.angle=Fo.evalProperty(t.angle,i)||0,n.z=t.z&&Fo.evalCachedDistanceProperty(t.z,i)||Fo.defaults.z,n.flat=t.flat,n.tile_edges=t.tile_edges,this.computeLayout(n,e,t,i,r);var a=t.text&&!1!==Fo.evalProperty(t.text.visible,i)&&this.parseTextFeature(e,t.text,i,r);Array.isArray(a)&&Jr({level:"warn",once:!(a=null)},"Layer '".concat(t.layers[t.layers.length-1],"': ")+"cannot use boundary labels (e.g. 'text_source: { left: ..., right: ... }') for 'text' labels attached to 'points'; "+"provided 'text_source' value was ".concat(JSON.stringify(t.text.text_source))),a&&(a.layout.parent=n,a.layout.priority=t.text.priority?Math.max(a.layout.priority,n.priority+.5):n.priority+.5,a.layout.move_into_tile=!1,Xo.addStyle(this.collision_group_text,r.id)),this.queueFeature({feature:e,draw:t,context:i,style:n,text_feature:a},r),Xo.addStyle(this.collision_group_points,r.id)}},hasSprites:function(e){return e.texture&&Jo.textures[e.texture]&&Jo.textures[e.texture].sprites},getSpriteInfo:function(e,t){var i=Jo.textures[e.texture].sprites[t]&&Jo.getSpriteInfo(e.texture,t);return t&&!i?(this.texture_missing_sprites[e.texture]=this.texture_missing_sprites[e.texture]||{},this.texture_missing_sprites[e.texture][t]||(Jr("debug","Style: in style '".concat(this.name,"', could not find sprite '").concat(t,"' for texture '").concat(e.texture,"'")),this.texture_missing_sprites[e.texture][t]=!0)):i&&(i.sprite=t),i},parseSprite:function(e,t,i){var r=Fo.evalProperty(t.sprite,i);return this.getSpriteInfo(e,r)||this.getSpriteInfo(e,t.sprite_default)},queueFeature:function(e,t){this.tile_data[t.id]&&this.queues[t.id]||this.startData(t),this.queues[t.id]=this.queues[t.id]||[],this.queues[t.id].push(e)},endData:function(r){var u=this;if(r.canceled)return Jr("trace","Style ".concat(this.name,": stop tile build because tile was canceled: ").concat(r.key)),Promise.resolve();var e=this.queues[r.id];delete this.queues[r.id];var c=[],h=[];return e.forEach(function(e){for(var t=e.style,i=e.feature,r=i.geometry,n=u.buildLabels(t.size,r,t),o=0;o<n.length;o++){var s=n[o],a={feature:i,draw:e.draw,context:e.context,style:t,label:s};if(h.push(a),e.text_feature){var l={feature:i,draw:e.text_feature.draw,context:e.context,text:e.text_feature.text,text_settings_key:e.text_feature.text_settings_key,layout:e.text_feature.layout,point_label:s,linked:a};c.push(l),e.draw.text.optional||(a.linked=l)}}}),Promise.all([Xo.collide(h,this.collision_group_points,r.id).then(function(e){e.forEach(function(e){u.feature_style=e.style,u.feature_style.label=e.label,u.feature_style.linked=e.linked,cu.addFeature.call(u,e.feature,e.draw,e.context)})}),this.collideAndRenderTextLabels(r,this.collision_group_text,c)]).then(function(e){var t=Sr(e,2)[1],i=t.labels,n=t.texts;return i&&n&&i.forEach(function(e){var t=e.text_settings_key,i=n[t]&&n[t][e.text],r=u.feature_style;r.label=e.label,r.linked=e.linked,r.size=i.size.logical_size,r.angle=0,e.label.text_data={text_info:i,text_settings_key:t,text:e.text},r.label_texture=Jo.default,cu.addFeature.call(u,e.feature,e.draw,e.context)}),u.freeText(r),cu.endData.call(u,r)})},_preprocess:function(t){t.color=Fo.createColorPropertyCache(t.color),t.texture=void 0!==t.texture?t.texture:this.texture,t.outline&&(t.outline.color=Fo.createColorPropertyCache(t.outline.color),t.outline.width=Fo.createPropertyCache(t.outline.width,Fo.parsePositiveNumber)),t.z=Fo.createPropertyCache(t.z,Fo.parseUnits);try{t.size=Fo.createPointSizePropertyCache(t.size)}catch(e){return Jr({level:"warn",once:!0},"Layer '".concat(t.layers[t.layers.length-1],"': ")+"".concat(e," (").concat(JSON.stringify(t.size),"), skipping features in layer")),null}return t.offset=Fo.createPropertyCache(t.offset,function(e){return Array.isArray(e)&&e.map(Fo.parseNumber)}),t.buffer=Fo.createPropertyCache(t.buffer,function(e){return(Array.isArray(e)?e:[e,e]).map(Fo.parsePositiveNumber)}),t.repeat_distance=Fo.createPropertyCache(t.repeat_distance,Fo.parseNumber),null==t.repeat_group&&(t.repeat_group=t.layers.join("-")),t.placement=Dh[t.placement&&t.placement.toUpperCase()],null==t.placement&&(t.placement=Dh.VERTEX),t.placement_spacing=null!=t.placement_spacing?t.placement_spacing:80,t.placement_spacing=Fo.createPropertyCache(t.placement_spacing,Fo.parsePositiveNumber),t.placement_min_length_ratio=null!=t.placement_min_length_ratio?t.placement_min_length_ratio:1,t.placement_min_length_ratio=Fo.createPropertyCache(t.placement_min_length_ratio,Fo.parsePositiveNumber),"number"==typeof t.angle?t.angle=t.angle*Math.PI/180:t.angle=t.angle||0,t.text=this.preprocessText(t.text),t.text&&(t.text.key=t.key,t.text.group=t.group,t.text.layers=t.layers,t.text.order=t.order,t.text.repeat_group=t.text.repeat_group||t.repeat_group,t.text.anchor=t.text.anchor||this.default_anchor,t.text.optional="boolean"==typeof t.text.optional&&t.text.optional,t.text.interactive=t.text.interactive||t.interactive),t},default_anchor:["bottom","top","right","left"],computeLayout:function(e,t,i,r,n){var o=e||{};o.id=t,o.units_per_pixel=n.units_per_pixel||1,o.collide=!1!==i.collide,o.anchor=i.anchor,o.offset=Fo.evalCachedProperty(i.offset,r)||Fo.zeroPair,o.buffer=Fo.evalCachedProperty(i.buffer,r)||Fo.zeroPair,o.repeat_distance=Fo.evalCachedProperty(i.repeat_distance,r),o.repeat_distance&&(o.repeat_distance*=o.units_per_pixel,o.repeat_scale=1,"function"==typeof i.repeat_group?o.repeat_group=i.repeat_group(r):o.repeat_group=i.repeat_group);var s=i.priority;return null!=s?"function"==typeof s&&(s=s(r)):s=-1>>>0,o.priority=s,o},buildTextLabels:function(e,t){for(var i=[],r=0;r<t.length;r++){var n=t[r],o=this.texts[e.id][n.text_settings_key][n.text].size.collision_size;n.label=new jc(n.point_label.position,o,n.point_label.isFlat(),n.layout),i.push(n)}return i},buildLabels:function(e,t,i){var r=!!i.flat,n=[];if("Point"===t.type)n.push(new jc(t.coordinates,e,r,i));else if("MultiPoint"===t.type)for(var o=t.coordinates,s=0;s<o.length;++s){var a=o[s];n.push(new jc(a,e,r,i))}else if("LineString"===t.type)for(var l=Vc(t.coordinates,e,r,i),u=0;u<l.length;++u)n.push(l[u]);else if("MultiLineString"===t.type)for(var c=t.coordinates,h=0;h<c.length;h++)for(var f=Vc(c[h],e,r,i),d=0;d<f.length;++d)n.push(f[d]);else if("Polygon"===t.type)if(i.placement===Dh.CENTROID){var _=Kr.centroid(t.coordinates);n.push(new jc(_,e,r,i))}else for(var p=t.coordinates,v=0;v<p.length;v++)for(var m=Vc(p[v],e,r,i),g=0;g<m.length;++g)n.push(m[g]);else if("MultiPolygon"===t.type)if(i.placement===Dh.CENTROID){var y=Kr.multiCentroid(t.coordinates);n.push(new jc(y,e,r,i))}else for(var x=t.coordinates,b=0;b<x.length;b++)for(var w=x[b],A=0;A<w.length;A++)for(var T=Vc(w[A],e,r,i),k=0;k<T.length;++k)n.push(T[k]);return n},makeVertexTemplate:function(e,t){var i=e.color||Fo.defaults.color,r=t.vertex_data.vertex_layout;if(this.fillVertexTemplate(r,"a_position",0,{size:2}),this.fillVertexTemplate(r,"a_position",e.z||0,{size:1,offset:2}),this.fillVertexTemplate(r,"a_position",this.scaleOrder(e.order),{size:1,offset:3}),this.fillVertexTemplate(r,"a_shape",0,{size:4}),this.fillVertexTemplate(r,"a_shape",e.label.layout.collide?0:1,{size:1,offset:3}),this.fillVertexTemplate(r,"a_texcoord",0,{size:2}),this.fillVertexTemplate(r,"a_offset",0,{size:2}),this.fillVertexTemplate(r,"a_color",iu.mult(i,255),{size:4}),this.defines.TANGRAM_HAS_SHADER_POINTS&&t.variant.shader_point){var n=e.outline_color||Fo.defaults.outline.color;this.fillVertexTemplate(r,"a_outline_color",iu.mult(n,255),{size:4}),this.fillVertexTemplate(r,"a_outline_edge",e.outline_edge_pct||Fo.defaults.outline.width,{size:1})}return this.selection&&this.fillVertexTemplate(r,"a_selection_color",iu.mult(e.selection_color,255),{size:4}),this.fillVertexTemplate(r,"a_is_flat",0,{size:1}),this.vertex_template},buildQuad:function(e,t,i,r,n,o,s,a,l,u,c,h,f,d,_){return t[0]<=0||t[1]<=0?0:function(e,t,i,r,n){var o=r.texcoord_index,s=r.position_index,a=r.shape_index,l=r.offset_index,u=r.offsets_index,c=r.offsets_alt_index,h=r.pre_angles_index,f=r.pre_angles_alt_index,d=r.angles_index,_=r.angles_alt_index,p=r.is_flat_index,v=n.quad,m=n.quad_normalize,g=n.offset,y=n.offsets,x=n.offsets_alt,b=n.pre_angles,w=n.pre_angles_alt,A=n.angle,T=n.angles,k=n.angles_alt,E=n.is_flat,M=n.curve,R=n.texcoord_scale,S=n.texcoord_normalize,z=n.pre_angles_normalize,P=n.angles_normalize,N=n.offsets_normalize;m=m||1;var O,L=v[0]/2*m,I=v[1]/2*m,C=[[-L,-I],[L,-I],[L,I],[-L,I]],F=t.vertex_elements,D=t.vertex_count;if(o){S=S||1;var U=Sr(R||xu,4),j=U[0],G=U[1],B=U[2],V=U[3];O=[[j,G],[B,G],[B,V],[j,V]]}for(var q=0,Y=e.length,X=0;X<Y;X++){for(var W=e[X],Z=0;Z<4;Z++)o&&(i[o+0]=O[Z][0]*S,i[o+1]=O[Z][1]*S),i[s+0]=W[0],i[s+1]=W[1],i[a+0]=C[Z][0],i[a+1]=C[Z][1],i[a+2]=A,i[l+0]=g[0],i[l+1]=g[1],i[p+0]=E?1:0,M&&(i[h+0]=z*b[0],i[h+1]=z*b[1],i[h+2]=z*b[2],i[h+3]=z*b[3],i[d+0]=P*T[0],i[d+1]=P*T[1],i[d+2]=P*T[2],i[d+3]=P*T[3],i[u+0]=N*y[0],i[u+1]=N*y[1],i[u+2]=N*y[2],i[u+3]=N*y[3],x&&(i[c+0]=N*x[0],i[c+1]=N*x[1],i[c+2]=N*x[2],i[c+3]=N*x[3],i[f+0]=z*w[0],i[f+1]=z*w[1],i[f+2]=z*w[2],i[f+3]=z*w[3],i[_+0]=P*k[0],i[_+1]=P*k[1],i[_+2]=P*k[2],i[_+3]=P*k[3])),t.addVertex(i);F.push(D+0),F.push(D+1),F.push(D+2),F.push(D+2),F.push(D+3),F.push(D+0),D+=4,q+=2}return q}(e,d,_,{texcoord_index:d.vertex_layout.index.a_texcoord,position_index:d.vertex_layout.index.a_position,shape_index:d.vertex_layout.index.a_shape,offset_index:d.vertex_layout.index.a_offset,offsets_index:d.vertex_layout.index.a_offsets,offsets_alt_index:d.vertex_layout.index.a_offsets_alt,pre_angles_index:d.vertex_layout.index.a_pre_angles,pre_angles_alt_index:d.vertex_layout.index.a_pre_angles_alt,angles_index:d.vertex_layout.index.a_angles,angles_alt_index:d.vertex_layout.index.a_angles_alt,is_flat_index:d.vertex_layout.index.a_is_flat},{quad:t,quad_normalize:256,offset:a,offsets:l,offsets_alt:u,pre_angles:o,pre_angles_alt:s,angle:4096*i,angles:r,angles_alt:n,is_flat:f,curve:h,texcoord_scale:c,texcoord_normalize:65535,pre_angles_normalize:Uh,angles_normalize:jh,offsets_normalize:64})},build:function(e,t,i){var r=e.label;return"curved"===r.type?this.buildCurvedLabel(r,e,t,i):this.buildStraightLabel(r,e,t,i)},buildStraightLabel:function(e,t,i,r){var n,o,s=this.makeVertexTemplate(t,i),a=e.angle||t.angle;o="point"!==e.type?(n=t.size[e.type],xu):(n=t.size,t.texcoords||xu),i.uniforms=i.uniforms||{},t.label_texture?(i.uniforms.u_texture=t.label_texture,i.uniforms.u_point_type=2,i.uniforms.u_apply_color_blocks=!1):(t.texture?(i.uniforms.u_texture=t.texture,i.uniforms.u_point_type=1):(i.uniforms.u_texture=Jo.default,i.uniforms.u_point_type=3),i.uniforms.u_apply_color_blocks=!0);var l=e.offset,u=this.buildQuad([e.position],n,a,null,null,null,null,l,null,null,o,!1,e.isFlat(),i.vertex_data,s),c=t.linked&&t.linked.label.id;return this.trackLabel(e,c,i,u,r),u},buildCurvedLabel:function(e,t,i,r){for(var n=this.makeVertexTemplate(t,i),o=e.angle,s=0,a=0;a<2;a++)for(var l=0;l<e.num_segments;l++){var u=t.size[e.type][l],c=xu,h=this.getTileMesh(r.tile,this.meshVariantTypeForDraw(t));h.uniforms=h.uniforms||{},h.uniforms.u_texture=t.label_texture,h.uniforms.u_point_type=2,h.uniforms.u_apply_color_blocks=!1;var f=e.offset||[0,0],d=e.position,_=e.angles[l],p=e.offsets[l],v=e.pre_angles[l],m=e.num_segments-l-1,g=e.alt_angles[m],y=e.alt_pre_angles[m],x=e.alt_offsets[m],b=this.buildQuad([d],u,o,_,g,v,y,f,p,x,c,!0,e.isFlat(),h.vertex_data,n);s+=b;var w=t.linked&&t.linked.label.id;this.trackLabel(e,w,i,b,r)}return s},trackLabel:function(e,t,i,r,n){if(e.layout.collide){i.labels=i.labels||{},i.labels[e.id]=i.labels[e.id]||{container:{label:e.text_data?Object.assign(e.toJSON(),{text_data:e.text_data}):e.toJSON(),linked:t},ranges:[]};var o=2*r,s=i.vertex_data.offset-i.vertex_data.stride*o;i.labels[e.id].ranges.push([s,o])}},buildLines:function(e,t,i,r){return this.build(t,i,r)},buildPoints:function(e,t,i,r){return this.build(t,i,r)},buildPolygons:function(e,t,i,r){return this.build(t,i,r)},vertexLayoutForMeshVariant:function(e){if(!this.vertex_layout){var t=[{name:"a_position",size:4,type:hu.SHORT,normalized:!1},{name:"a_shape",size:4,type:hu.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:hu.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:hu.SHORT,normalized:!1},{name:"a_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0},{name:"a_outline_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0,static:[0,0,0,0]},{name:"a_outline_edge",size:1,type:hu.FLOAT,normalized:!1,static:0},{name:"a_selection_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:hu.FLOAT,normalized:!0}];this.vertex_layout=new gu(t),(t=t.map(function(e){return Object.assign({},e)})).forEach(function(e){"a_outline_color"!==e.name&&"a_outline_edge"!==e.name||(e.static=null)}),this.vertex_layout_shader_point=new gu(t)}return e.shader_point?this.vertex_layout_shader_point:this.vertex_layout},meshVariantTypeForDraw:function(e){var t=e.label_texture||e.texture||this.default_mesh_variant.key;return null==Gh.variants[t]&&(Gh.variants[t]={key:t,shader_point:t===this.default_mesh_variant.key,order:e.label_texture?1:0}),Gh.variants[t]},makeMesh:function(e,t,i){var r=2<arguments.length&&void 0!==i?i:{};return r=Object.assign({},r,{fade_in_time:this.fade_in_time}),cu.makeMesh.call(this,e,t,r)}});var Bh=[0,.33,.66,.99],Vh=function(e,t,i,r,n){for(var o=[{type:"straight",tolerance:n.no_curving?1.8:1.5},{type:"curved"},{type:"straight",tolerance:2.3}],s=0;s<o.length;s++){var a=o[s],l=void 0;if("straight"===a.type?l=new Hh(t,i,r,n,a.tolerance):"curved"===a.type&&!n.no_curving&&2<i.length&&(l=new Yh(e,i,r,n)),l&&!l.throw_away)return l}return!1},qh=function(){function i(e,t){mr(this,i),this.id=Nc.nextLabelId(),this.layout=t,this.position=[],this.angle=0,this.offset=t.offset.slice(),this.unit_scale=this.layout.units_per_pixel,this.type="",this.throw_away=!1,this._is_flat=e,this._circles=void 0,this.placed=null}return yr(i,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,angle:this.angle,breach:this.breach,layout:Oc(this.layout),circles:this.getBoundingCircles()}}},{key:"inTileBounds",value:function(){var e=this.getAABB(),t=e.left,i=e.top,r=e.right,n=e.bottom;return on.pointInTile([t,i])&&on.pointInTile([r,n])}},{key:"getAABBForSegment",value:function(e,t,i,r){var n=this.unit_scale,o=t/2,s=i/2,a=Sr(e,2),l=a[0],u=a[1];if(0!==this.offset[0]||0!==this.offset[1]){var c=iu.rot(this.offset,this.angle);l+=c[0]*n,u-=c[1]*n}var h=[[Math.cos(r),-Math.sin(r)],[Math.sin(r),Math.cos(r)]],f=iu.multMatrix(h,[-o,-s]),d=iu.multMatrix(h,[o,-s]),_=iu.multMatrix(h,[o,s]),p=iu.multMatrix(h,[-o,s]);return{left:l+Math.min(f[0],d[0],_[0],p[0]),top:u+Math.max(f[1],d[1],_[1],p[1]),right:l+Math.max(f[0],d[0],_[0],p[0]),bottom:u+Math.min(f[1],d[1],_[1],p[1])}}},{key:"isFlat",value:function(){return this._is_flat}},{key:"getBoundingCircles",value:function(){}},{key:"getAABB",value:function(){}}],[{key:"splitLineByOrientation",value:function(e){for(var t=[e[0]],i=0,r=0,n=0,o=t,s=!1,a=1;a<e.length;a++){var l=e[a],u=e[a-1],c=iu.length(iu.sub(l,u));l[0]>u[0]?1===n?(t.push(l),r<(i+=c)&&(o=t,r=i,s=!1)):(t=[u,l],r<(i=c)&&(o=t,r=i,s=!1),n=1):l[0]<u[0]?-1===n?(t.unshift(l),r<(i+=c)&&(o=t,r=i,s=!0)):(t=[l,u],r<(i=c)&&(o=t,r=i,s=!0),n=-1):(-1===n?t.unshift(l):(t.push(l),n=1),r<(i+=c)&&(o=t,r=i,s=-1===n))}return[o,s]}}]),i}(),Hh=function(){function s(e,t,i,r,n){var o;return mr(this,s),(o=Mr(this,wr(s).call(this,i,r))).type="straight",o.size=e,o.throw_away=!o.fit(e,t,r,n),o}return br(s,qh),yr(s,[{key:"fit",value:function(e,t,i,r){var n,o=this.unit_scale,s=Sr(qh.splitLineByOrientation(t),2);t=s[0],n=s[1],"number"==typeof i.orientation&&(this.offset[1]+=1.2*(e[1]-i.vertical_buffer),n&&(this.offset[1]*=-1),-1===i.orientation&&(this.offset[1]*=-1));for(var a=Wh(t),l=e[0]*o,u=0;u<t.length-1;u++)for(var c=t[u],h=0,f=0,d=u+1,_=void 0;d<t.length;){var p=t[d-1],v=t[d],m=Xh(p,v);if(d!==u+1&&(h+=Zh(m,_)),.1<Math.abs(h))break;if(f+=a[d-1],l/f<r){var g=iu.mult(iu.add(c,v),.5);return this.angle=-m,Math.abs(this.angle-Math.PI/2)<.01&&(this.angle=-Math.PI/2,"number"==typeof i.orientation&&(this.offset[1]*=-1)),this.position=g,this.breach=!this.inTileBounds(),!0}_=m,d++}return!1}},{key:"getBoundingCircles",value:function(){if(!this._circles){var e=this.unit_scale,t=this.size[0]/2*e,i=t*Math.cos(this.angle),r=t*Math.sin(this.angle),n=-i,o=-r,s=this.offset[0]*e,a=this.offset[1]*e,l=Sr(this.position,2),u=l[0],c=l[1];if(c*=-1,s){var h=[i,r];iu.normalize(h),h[0]*=s,h[1]*=s,u+=h[0],c+=h[1]}if(a){var f=[r,-i];iu.normalize(f),f[0]*=a,f[1]*=a,u-=f[0],c-=f[1]}i+=u,r+=c,n+=u,o+=c;var d=this.size[1]/2*e;this._circles=Uc(i,r,n,o,d)}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){var e=this.unit_scale,t=this.size,i=this.layout.buffer,r=(t[0]+2*i[0])*e,n=(t[1]+2*i[1])*e;this._aabb=this.getAABBForSegment(this.position,r,n,this.angle)}return this._aabb}}]),s}(),Yh=function(){function U(e,t,i,r){var n;return mr(this,U),(n=Mr(this,wr(U).call(this,i,r))).type="curved",n.positions=[],n.angles=[],n._aabbs=[],n.pre_angles=[],n.offsets=[],n.num_segments=e.length,n.sizes=e,n.alt_angles=[],n.alt_pre_angles=[],n.alt_offsets=[],n.throw_away=!n.fit(n.sizes,t,r),n}return br(U,qh),yr(U,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,breach:this.breach,layout:Oc(this.layout),circles:this.getBoundingCircles()}}},{key:"fit",value:function(e,t,i){var r,n=this.unit_scale,o=Math.max.apply(Math,zr(e.map(function(e){return e[1]}))),s=o*n,a=Sr(qh.splitLineByOrientation(t),2);t=a[0],r=a[1],"number"==typeof i.orientation&&(this.offset[1]+=1.2*(o-i.vertical_buffer),r&&(this.offset[1]*=-1),-1===i.orientation&&(this.offset[1]*=-1));var l=Wh(t),u=e.map(function(e){return e[0]*n}),c=l.reduce(function(e,t){return e+t},0),h=u.reduce(function(e,t){return e+t},0);if(c<h)return!1;var f=t.length-1;if(f-0<2)return!1;var d=U.curvaturePlacement(t,c,l,h,0,f),_=t[d];if(-1===d||f-d<2)return!1;this.position=_;for(var p=0;p<u.length;p++){this.positions[p]=[],this.offsets[p]=[],this.angles[p]=[],this.pre_angles[p]=[];for(var v=0;v<Bh.length;v++){var m=Bh[v],g=Sr(U.scaleLine(m,t),2),y=g[0],x=g[1];_=y[d];var b=U.placeAtIndex(d,y,x,u),w=b.positions,A=b.offsets,T=b.angles,k=b.pre_angles,E=A.map(function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])/n});if(0===m){this.angle=1/T.length*T.reduce(function(e,t){return e+t});for(var M=0;M<w.length;M++){var R=w[M],S=k[M],z=u[M],P=S+T[M];this._aabbs.push(this.getAABBForSegment(R,z,s,P))}}this.positions[p].push(w[p]),this.offsets[p].push(E[p]),this.angles[p].push(T[p]),this.pre_angles[p].push(k[p])}}u=e.slice().reverse().map(function(e){return e[0]*n});for(var N=0;N<u.length;N++){this.alt_offsets[N]=[],this.alt_angles[N]=[],this.alt_pre_angles[N]=[];for(var O=0;O<Bh.length;O++){var L=Bh[O],I=Sr(U.scaleLine(L,t),2),C=(y=I[0],I[1]);_=y[d];var F=U.placeAtIndex(d,y,C,u),D=(A=F.offsets,T=F.angles,k=F.pre_angles,A.map(function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])/n}));0===L&&(this.alt_angle=1/T.length*T.reduce(function(e,t){return e+t})),this.alt_offsets[N].push(D[N]),this.alt_angles[N].push(T[N]),this.alt_pre_angles[N].push(k[N])}}return!0}},{key:"getBoundingCircles",value:function(){if(!this._circles){for(var e=[],t=this.unit_scale,i=0;i<this.positions.length;i++){var r=this.sizes[i],n=this.angles[i][0],o=this.positions[i][0],s=r[0]/2*t,a=s*Math.cos(n),l=s*Math.sin(n),u=-a,c=-l,h=Sr(o,2),f=h[0],d=h[1],_=Uc(a+=f,l+=d*=-1,u+=f,c+=d,r[1]/2*t);Array.prototype.push.apply(e,_)}this._circles=e}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){for(var e=1/0,t=-1/0,i=-1/0,r=1/0,n=0;n<this._aabbs.length;n++){var o=this._aabbs[n];e=Math.min(e,o.left),t=Math.max(t,o.top),i=Math.max(i,o.right),r=Math.min(r,o.bottom)}this._aabb={left:e,top:t,right:i,bottom:r}}return this._aabb}}],[{key:"curvaturePlacement",value:function(e,t,i,r,n,o){n=n||0,o=o||e.length-1;for(var s=[],a=n+1;a<o;a++){var l=e[a-1],u=e[a],c=e[a+1],h=iu.perp(u,l),f=iu.perp(c,u),d=iu.angleBetween(h,f);1<d&&(d=1/0),s.push(d)}s.push(1/0);for(var _=[],p=[],v=n,m=0,g=0;g<n;g++)m+=i[g];for(;m+r<t;){for(var y=m+r,x=m,b=v,w=0;b<o&&x+i[b]<y&&(w+=s[b])!==1/0;)x+=i[b],b++;if(0===w)return v;var A=w/(b-v);_.push(w),p.push(A),m+=i[v],v++}if(0===_.length)return-1;var T=Math.min.apply(null,_),k=p[_.indexOf(T)];return T<1.3&&k<.4?_.indexOf(T):-1}},{key:"scaleLine",value:function(n,o){var s=[o[0]],a=[];return o.forEach(function(e,t){if(t!==o.length-1){var i=iu.sub(o[t+1],o[t]),r=iu.mult(i,1+n);s.push(iu.add(s[t],r)),a.push(iu.length(r))}}),[s,a]}},{key:"placeAtIndex",value:function(e,t,i,r){var n=t[e],o=Sr(U.getIndicesAndOffsets(e,i,r),2),s=o[0],a=o[1],l=U.getPositionsFromIndicesAndOffsets(t,s,a),u=Sr(U.getAnglesFromIndicesAndOffsets(n,s,t,l),3);return{positions:l,offsets:u[0],angles:u[1],pre_angles:u[2]}}},{key:"getIndicesAndOffsets",value:function(e,t,i){for(var r=i.length,n=[],o=[],s=0,a=0,l=0;s<r;){for(var u=i[s];s<r&&a+.5*u<=l+t[e];){var c=a-l+.5*u;o.push(c),n.push(e),a+=u,u=i[++s]}l+=t[e],e++}return[n,o]}},{key:"getPositionsFromIndicesAndOffsets",value:function(e,t,i){for(var r=[],n=0;n<t.length;n++){var o=t[n],s=i[n],a=Xh(e[o],e[o+1]),l=iu.rot([s,0],a),u=iu.add(e[o],l);r.push(u)}return r}},{key:"getAnglesFromIndicesAndOffsets",value:function(e,t,i,r){for(var n,o,s=[],a=[],l=[],u=0;u<r.length;u++){var c=r[u],h=t[u],f=iu.sub(c,e),d=-iu.angle(f),_=(n=i[h],o=i[h+1],-Xh(n,o))-d;if(0<u){var p=s[u-1],v=a[u-1];Math.abs(d-p)>Math.PI&&(d+=p<d?-2*Math.PI:2*Math.PI),Math.abs(v-_)>Math.PI&&(_+=v<_?-2*Math.PI:2*Math.PI)}s.push(d),a.push(_),l.push(f)}return[l,s,a]}}]),U}();function Xh(e,t){var i=iu.sub(t,e);return iu.angle(i)}function Wh(e){for(var t=[],i=0;i<e.length-1;i++){var r=e[i],n=e[i+1],o=Math.hypot(r[0]-n[0],r[1]-n[1]);t.push(o)}return t}function Zh(e,t){var i,r;for(r=t<e?(i=t,e):(i=e,t);r-i>Math.PI;)i+=2*Math.PI;return Math.abs(r-i)}var Jh=Object.create(Gh);Object.assign(Jh,{name:"text",super:Gh,built_in:!0,init:function(e){var t=0<arguments.length&&void 0!==e?e:{};cu.init.call(this,t),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!1,this.defines.TANGRAM_IS_TEXT_STYLE=!0,this.reset()},makeVertexTemplate:function(e,t){this.super.makeVertexTemplate.apply(this,arguments);var i=t.vertex_data.vertex_layout;return this.fillVertexTemplate(i,"a_pre_angles",0,{size:4}),this.fillVertexTemplate(i,"a_offsets",0,{size:4}),this.fillVertexTemplate(i,"a_angles",0,{size:4}),this.fillVertexTemplate(i,"a_offsets_alt",0,{size:4}),this.fillVertexTemplate(i,"a_pre_angles_alt",0,{size:4}),this.fillVertexTemplate(i,"a_angles_alt",0,{size:4}),this.vertex_template},reset:function(){this.queues={},this.resetText()},addFeature:function(t,e,i){var r=this,n=i.tile,o=t.geometry.type;e.can_articulate="LineString"===o||"MultiLineString"===o,e.supersample_text="LineString"===o||"MultiLineString"===o;var s=this.parseTextFeature(t,e,i,n);s&&(s instanceof Array?s.forEach(function(e){e.feature=t,e.context=i,e.layout.vertex=!1,r.queueFeature(e,n)}):(s.feature=t,s.context=i,s.layout.vertex=!1,this.queueFeature(s,n)),Xo.addStyle(this.name,n.id))},endData:function(n){var o=this,e=this.queues[n.id];return delete this.queues[n.id],this.collideAndRenderTextLabels(n,this.name,e).then(function(e){var t=e.labels,i=e.texts;return t&&i&&(o.texts[n.id]=i,t.forEach(function(e){var t=e.text_settings_key,i=o.texts[n.id][t]&&o.texts[n.id][t][e.text],r=o.feature_style;r.label=e.label,e.label.text_data={text_info:i,text_settings_key:t,text:e.text},r.label_texture=Jo.default,i.text_settings.can_articulate?(r.size={},"straight"===e.label.type?r.size.straight=i.size.logical_size:r.size.curved=i.segment_sizes.map(function(e){return e.logical_size})):r.size=i.size.logical_size,cu.addFeature.call(o,e.feature,e.draw,e.context)})),o.freeText(n),cu.endData.call(o,n).then(function(e){if(e){for(var t in e.meshes)e.meshes[t].uniforms.u_apply_color_blocks=!0;n.mesh_data[o.name]=e}return e})})},_preprocess:function(e){return this.preprocessText(e)},buildTextLabels:function(e,t){for(var i=[],r=0;r<t.length;r++){var n=t[r],o=this.texts[e.id][n.text_settings_key][n.text],s=void 0;if(n.layout.vertical_buffer=o.vertical_buffer,o.text_settings.can_articulate){var a=o.segment_sizes.map(function(e){return e.collision_size});n.layout.no_curving=o.no_curving,s=this.buildLabels(a,n.feature.geometry,n.layout,o.size.collision_size)}else s=this.buildLabels(o.size.collision_size,n.feature.geometry,n.layout);for(var l=0;l<s.length;l++){var u=Object.create(n);u.label=s[l],i.push(u)}}return i},buildLabels:function(e,t,i,r){var n="Point"!==t.type,o=[];if("LineString"===t.type)Array.prototype.push.apply(o,this.buildLineLabels(t.coordinates,e,n,i,r));else if("MultiLineString"===t.type)for(var s=t.coordinates,a=0;a<s.length;++a)Array.prototype.push.apply(o,this.buildLineLabels(s[a],e,n,i,r));else if("Point"===t.type)o.push(new jc(t.coordinates,e,n,i));else if("MultiPoint"===t.type)for(var l=t.coordinates,u=0;u<l.length;++u)o.push(new jc(l[u],e,n,i));else if("Polygon"===t.type){var c=Kr.centroid(t.coordinates);o.push(new jc(c,e,n,i))}else if("MultiPolygon"===t.type){var h=Kr.multiCentroid(t.coordinates);o.push(new jc(h,e,n,i))}return o},buildLineLabels:function(e,t,i,r,n){var o=[],s=Math.min(r.subdiv,e.length-1);if(1<s)for(var a=(e.length-1)/s,l=0;l<s;l++){var u=Math.floor(l*a),c=Math.floor((l+1)*a)+1,h=e.slice(u,c),f=Vh(t,n,h,i,r);f&&o.push(f)}if(o.length<s){var d=Vh(t,n,e,i,r);d&&o.push(d)}return o},vertexLayoutForMeshVariant:function(){if(!this.vertex_layout){var e=[{name:"a_position",size:4,type:hu.SHORT,normalized:!1},{name:"a_shape",size:4,type:hu.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:hu.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:hu.SHORT,normalized:!1},{name:"a_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0},{name:"a_angles",size:4,type:hu.SHORT,normalized:!1},{name:"a_offsets",size:4,type:hu.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles",size:4,type:hu.BYTE,normalized:!1},{name:"a_selection_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:hu.FLOAT,normalized:!0},{name:"a_offsets_alt",size:4,type:hu.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles_alt",size:4,type:hu.BYTE,normalized:!1},{name:"a_angles_alt",size:4,type:hu.SHORT,normalized:!1}];this.vertex_layout=new gu(e)}return this.vertex_layout},meshVariantTypeForDraw:Gh.meshVariantTypeForDraw}),Jh.texture_id=0;var Kh=Object.create(Ju);Object.assign(Kh,{name:"raster",super:Ju,built_in:!0,init:function(){this.raster=this.raster||"color",this.super.init.apply(this,arguments),this.selection=!1},_preprocess:function(e){return e.color=e.color||Fo.defaults.color,this.super._preprocess.apply(this,arguments)}});var $h=Object.create(Gh);Object.assign($h,{name:"custom_icons",collision:!1,init:function(e){var t=0<arguments.length&&void 0!==e?e:{};Gh.init.call(this,t)},loadTexture:function(e,t,i){var r,n=e.width,o=e.height,s=e.items,a=document.createElement("canvas"),l=this.sources[t],u={sprites:{}};if(a.width=n,a.height=o,l)for(var c,h=s.length,f=a.getContext("2d");c=s[--h];){var d=l.getIconBitmapByObjectId(c.meta.objectId,c.meta.id);if(d){var _=fl(d);_?Jr("error",_):(f.drawImage(d,c.x,c.y,c.width,c.height),u.sprites[c.meta.id]=[c.x,c.y,c.width,c.height])}}return u.element=a,(r=Jo.create(this.gl,i,u)).retain(),r.loading.then(function(e){return e.name})},buildRasterTextures:function(e,t){return Cr.postMessage(this.main_thread_target+".loadTexture",e.rasters,e.source,e.texture_name).then(function(e){return t.textures.push(e),t})},addFeature:function(e,t,i){var r=i.tile.rasters,n={};r.items.forEach(function(e){n[e.meta.id]=[e.x,e.y,e.width,e.height]});var o="".concat(i.tile.source,"_dyn_").concat(i.tile.coords.key,"_").concat(this.generation,"_").concat(i.tile.id);t.texture=i.tile.texture_name=o;var s=Object.assign({},Qh,{name:o,width:r.width,height:r.height,sprites:n});Jo.prototype.calculateSprites.apply(s),Jo.textures[o]=s,Gh.addFeature.apply(this,arguments),delete Jo.textures[o]}});var Qh={filtering:"linear",density:1,valid:!0,power_of_2:!1,texcoords:{},sizes:{},css_sizes:{},aspects:{}},ef=Object.create(Ju);Object.assign(ef,{name:"overlays",super:Ju,init:function(e){var t=0<arguments.length&&void 0!==e?e:{};this.selection=t.selection||!0,this.raster=this.raster||"color",this.super.init.apply(this,arguments)},countObjectSource:function(e,t){return e+(this.sources[t]instanceof xl)},setupRasters:function(){if(this.super.setupRasters.call(this),"0"===this.defines.TANGRAM_NUM_RASTER_SOURCES){var e=Object.keys(this.sources).reduce(this.countObjectSource.bind(this),0);e&&(this.defines.TANGRAM_NUM_RASTER_SOURCES="".concat(e),this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0,this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",uu,"Raster"))}},loadTextures:function(s,e){var a,l,u,c=this.sources[e],t=s.name;if(s.overlays_config.forEach(function(e){var t=e.texcoords,i=e.id,r=c.getMapObjectById(i),n=r.getBitmap();if(n){var o=fl(n=dl(n,n.width,n.height));o?Jr("error",o):(a||((a=document.createElement("canvas")).width=s.width,a.height=s.height,l=a.getContext("2d")),l.save(),l.globalAlpha=r.getOpacity(),t.forEach(function(e){return l.drawImage(n,e[0],e[1],e[2],e[3])}),l.restore(),u=!0)}}),u){s.element=a;var i={};return i[t]=s,this.super.loadTextures.call(this,i)}var r=Jo.textures[Jo.default];return Promise.resolve([{name:r.name,width:r.width,height:r.height,loaded:r.loaded}])},buildRasterTextures:function(e,i){var t=this.sources[e.source].tileTexture(e);if(!t)return Promise.resolve(i);return{}[({}[t.name]=t).name]=0,Cr.postMessage(this.main_thread_target+".loadTextures",t,e.source).then(function(e){if(!e||e.length<1)return i;if(e.some(function(e){return!e.loaded}))return null;var t=e[0];return i.uniforms=i.uniforms||{},i.textures=i.textures||[],i.uniforms.u_rasters=[t.name],i.uniforms.u_raster_sizes=[t.width,t.height],i.uniforms.u_raster_offsets=[0,0,1],i.textures.push(t.name),i})}});var tf=Object.create(cu),rf=[-1,0,1,0,-1,1,-1,1,1,0,1,1,-1,0,1,0,-1,1,-1,1,1,0,1,1];Object.assign(tf,{name:"skybox",built_in:!0,vertex_shader_src:"uniform float u_horizon;uniform float u_tilt;attribute vec2 a_position;attribute float a_is_sky;attribute vec4 a_color;varying vec4 v_color;void main(){v_color=a_color;float y=a_position.y;float fog_height=sin(u_tilt)-0.7;gl_Position=vec4(a_position.x,y*a_is_sky+1.0-u_horizon-(1.0-a_is_sky)*(1.0-y)*fog_height,1.0,1.0);}",fragment_shader_src:"varying vec4 v_color;void main(void){gl_FragColor=v_color;}",selection:!1,blend:"overlay",blend_order:Number.MAX_VALUE,init:function(){cu.init.apply(this,arguments),this.selection=!1},_preprocess:function(e){return e.color={top:Fo.createColorPropertyCache(e.color.top),bottom:Fo.createColorPropertyCache(e.color.bottom),fog:Fo.createColorPropertyCache(e.color.fog)},e},vertexLayoutForMeshVariant:function(e){if(!this.vertex_layout){var t=[{name:"a_position",size:2,type:hu.FLOAT,normalized:!1},{name:"a_is_sky",size:1,type:hu.FLOAT,normalized:!0},{name:"a_color",size:4,type:hu.UNSIGNED_BYTE,normalized:!0}];this.vertex_layout=new gu(t)}return this.vertex_layout},makeVertexTemplate:function(e){var t=0;return this.vertex_template[t++]=0,this.vertex_template[t++]=0,this.vertex_template},parseFeature:function(e,t,i){var r=this.feature_style;return t.color&&t.color.top&&t.color.bottom&&(r.color_top=this.parseColor(t.color.top,i),r.color_bottom=this.parseColor(t.color.bottom,i),r.color_fog=this.parseColor(t.color.fog||"white",i),r.color_fog[3]=0),r},buildGeometry:function(e,t,i,r){for(var n=this.makeVertexTemplate(t),o=i.vertex_data,s=i.vertex_data.vertex_layout,a=o.vertex_layout.index.a_position,l={top:t.color_top,bottom:t.color_bottom},u={top:t.color_bottom,bottom:t.color_fog},c=0,h=rf.length-1;c<h;c+=2){n[a+0]=rf[c],n[a+1]=rf[c+1];var f=c<12,d=0<rf[c+1],_=f?l:u;this.fillVertexTemplate(s,"a_is_sky",f?1:0,{size:1}),this.fillVertexTemplate(s,"a_color",iu.mult(d?_.top:_.bottom,255),{size:4}),o.addVertex(n)}return 4}});var nf=function(){function e(){mr(this,e),this.styles={},this.base_styles={},this.register(Object.create(Ju)),this.register(Object.create(mc)),this.register(Object.create(Tc)),this.register(Object.create(Gh)),this.register(Object.create(Jh)),this.register(Object.create(Kh)),this.register(Object.create($h)),this.register(Object.create(ef)),this.register(Object.create(tf))}return yr(e,[{key:"init",value:function(){Zl.removeBlock("global"),Zl.removeBlock("setup"),Zl.addBlock("global","#ifdef TANGRAM_VERTEX_SHADER\nvec4 modelPosition(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE*exp2(u_tile_origin.z-u_tile_origin.w),1.)+vec4(0.,1.,0.,0.);}vec4 modelPositionBaseZoom(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE,1.)+vec4(0.,1.,0.,0.);}\n#endif\nvec4 worldPosition(){return v_world_position;}\n#ifdef TANGRAM_VERTEX_SHADER\nvec4 wrapWorldPosition(vec4 world_position){\n#if defined(TANGRAM_WORLD_POSITION_WRAP)\nvec2 anchor=u_tile_origin.xy-mod(u_tile_origin.xy,TANGRAM_WORLD_POSITION_WRAP);world_position.xy-=anchor;\n#endif\nreturn world_position;}\n#endif\n#if defined(TANGRAM_VERTEX_SHADER)\nvec3 worldNormal(){return TANGRAM_NORMAL;}\n#elif defined(TANGRAM_FRAGMENT_SHADER)\nvec3 worldNormal(){return u_inverseNormalMatrix*TANGRAM_NORMAL;}\n#endif\n"),Zl.addBlock("global","void applyLayerOrder(float layer,inout vec4 position){position.z-=layer*TANGRAM_LAYER_DELTA*position.w;}"),Zl.addBlock("global","\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\nattribute vec4 a_selection_color;varying vec4 v_selection_color;uniform vec4 u_selection_discard0;uniform vec4 u_selection_discard1;uniform vec4 u_selection_discard2;uniform vec4 u_selection_discard3;uniform vec4 u_selection_discard4;uniform vec4 u_selection_discard5;uniform vec4 u_selection_discard6;uniform vec4 u_selection_discard7;uniform vec4 u_selection_discard8;uniform vec4 u_selection_discard9;\n#endif\n"),Zl.replaceBlock("utils","#ifndef UTILS\n#define UTILS\nbool isPixelOutsideTile(float tile_size,float meters_per_pixel,vec3 map_position,vec4 pixel_world_position,vec4 wrapped_tile_world_origin){float exponent=log(tile_size)/log(2.0);float stretched_tile_exponent=exponent+(map_position.z-floor(map_position.z));float stretched_tile_world_size=pow(2.0,stretched_tile_exponent)*meters_per_pixel;return pixel_world_position.y>wrapped_tile_world_origin.y||pixel_world_position.x<wrapped_tile_world_origin.x||pixel_world_position.y<wrapped_tile_world_origin.y-stretched_tile_world_size||pixel_world_position.x>wrapped_tile_world_origin.x+stretched_tile_world_size;}\n#endif\n"),Zl.replaceBlock("setup","\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\nif(a_selection_color.rgb==vec3(0.)||a_selection_color==u_selection_discard0||a_selection_color==u_selection_discard1||a_selection_color==u_selection_discard2||a_selection_color==u_selection_discard3||a_selection_color==u_selection_discard4||a_selection_color==u_selection_discard5||a_selection_color==u_selection_discard6||a_selection_color==u_selection_discard7||a_selection_color==u_selection_discard8||a_selection_color==u_selection_discard9){gl_Position=vec4(0.,0.,0.,1.);return;}v_selection_color=a_selection_color;\n#endif\n"),Zl.defines.TANGRAM_EPSILON=1e-5,Zl.defines.TANGRAM_LAYER_DELTA=1/16384,Zl.defines.TANGRAM_TILE_SCALE="vec3(".concat(Kr.tile_scale,"., ").concat(Kr.tile_scale,"., u_meters_per_pixel * ").concat(Kr.tile_size,".)"),Zl.defines.TANGRAM_HEIGHT_SCALE=Kr.height_scale,Zl.defines.TANGRAM_ALPHA_TEST=.5,mc.dash_textures={}}},{key:"destroy",value:function(i){var r=this;Object.keys(this.styles).forEach(function(e){var t=r.styles[e];t.gl===i&&(Jr("trace","StyleManager.destroy: destroying render style ".concat(t.name)),t.base&&r.remove(t.name),t.destroy())})}},{key:"register",value:function(e){this.styles[e.name]=e,this.base_styles[e.name]=e}},{key:"remove",value:function(e){delete this.styles[e]}},{key:"mix",value:function(t,i){if(t.mixed)return t;t.mixed={};var e=[];if(t.mix){var r;if(Array.isArray(t.mix))(r=e).push.apply(r,zr(t.mix));else e.push(t.mix);(e=e.map(function(e){return i[e]}).filter(function(e){return e&&e!==t})).forEach(function(e){return t.mixed[e.name]=!0})}e.push(t),t.animated=e.some(function(e){return e&&e.animated}),t.texcoords=e.some(function(e){return e&&e.texcoords}),t.base=e.map(function(e){return e.base}).filter(function(e){return e}).pop(),t.lighting=e.map(function(e){return e.lighting}).filter(function(e){return null!=e}).pop(),t.texture=e.map(function(e){return e.texture}).filter(function(e){return e}).pop(),t.raster=e.map(function(e){return e.raster}).filter(function(e){return null!=e}).pop(),t.dash=e.map(function(e){return e.dash}).filter(function(e){return null!=e}).pop(),t.dash_background_color=e.map(function(e){return e.dash_background_color}).filter(function(e){return null!=e}).pop(),e.some(function(e){return e.hasOwnProperty("blend")&&e.blend})&&(t.blend=e.map(function(e){return e.hasOwnProperty("blend")&&e.blend}).filter(function(e){return e}).pop()),t.blend_order=e.map(function(e){return e.blend_order}).filter(function(e){return null!=e}).pop(),t.defines=Object.assign.apply(Object,[{}].concat(zr(e.map(function(e){return e.defines}).filter(function(e){return e})))),t.material=Object.assign.apply(Object,[{}].concat(zr(e.map(function(e){return e.material}).filter(function(e){return e}))));var n=e.map(function(e){return e.draw}).filter(function(e){return e});return 0<n.length&&(t.draw=hl.apply(void 0,[{}].concat(zr(n)))),this.mixShaders(t,i,e),t}},{key:"mixShaders",value:function(e,r,t){var s={},i=t.map(function(e){return e.shaders}).filter(function(e){return e});if(s.defines=Object.assign.apply(Object,[{}].concat(zr(i.map(function(e){return e.defines}).filter(function(e){return e})))),s.uniforms={},s._uniforms=e.shaders&&e.shaders.uniforms||{},s._uniform_scopes={},t.filter(function(e){return e.shaders&&e.shaders.uniforms}).forEach(function(e){function t(t){s._uniform_scopes[t]=e.name,Object.defineProperty(s.uniforms,t,{enumerable:!0,configurable:!0,get:function(){return void 0!==s._uniforms[t]?s._uniforms[t]:r[s._uniform_scopes[t]].shaders.uniforms!==s.uniforms?r[s._uniform_scopes[t]].shaders.uniforms[t]:void 0},set:function(e){s._uniforms[t]=e}})}for(var i in e.shaders.uniforms)t(i)}),s.extensions=Object.keys(i.map(function(e){return e.extensions}).filter(function(e){return e}).reduce(function(t,e){return"string"==typeof e?t[e]=!0:e.forEach(function(e){return t[e]=!0}),t},{})||{}),e.shaders&&e.shaders.blocks)for(var n in e.shaders.block_scopes=e.shaders.block_scopes||{},e.shaders.blocks){var o,a=e.shaders.blocks[n];if(e.shaders.block_scopes[n]=e.shaders.block_scopes[n]||[],Array.isArray(a))(o=e.shaders.block_scopes[n]).push.apply(o,zr(a.map(function(){return e.name})));else e.shaders.block_scopes[n].push(e.name)}var l={};return i.forEach(function(e){if(e.blocks){s.blocks=s.blocks||{},s.block_scopes=s.block_scopes||{};var t={};for(var i in e.blocks){var r=e.blocks[i],n=e.block_scopes[i];s.blocks[i]=s.blocks[i]||[],s.block_scopes[i]=s.block_scopes[i]||[],r=Array.isArray(r)?r:[r],n=Array.isArray(n)?n:[n];for(var o=0;o<r.length;o++)l[n[o]]||(t[n[o]]=!0,s.blocks[i].push(r[o]),s.block_scopes[i].push(n[o]))}Object.assign(l,t)}}),Object.assign(e.mixed,l),e.shaders=s,e}},{key:"create",value:function(e,t,i){var r=2<arguments.length&&void 0!==i?i:{},n=hl({},t);return n.name=e,(n=this.mix(n,r)).base&&this.base_styles[n.base]?this.styles[e]=n=Object.assign(Object.create(this.base_styles[n.base]),n):n.base=null,n}},{key:"build",value:function(i){var r=this,e=Object.keys(i).sort(function(e,t){return r.inheritanceDepth(e,i)-r.inheritanceDepth(t,i)});for(var t in this.styles)this.base_styles[t]?this.styles[t].reset():delete this.styles[t];var n={};return e.forEach(function(e){n[e]=r.create(e,i[e],n)}),this.styles}},{key:"initStyles",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};for(var i in this.styles)this.styles[i].init(t)}},{key:"inheritanceDepth",value:function(t,i){for(var r=this,e=0;;){var n=i[t];if(!n)break;if(!n.mix)break;if(e++,Array.isArray(n.mix)){e+=Math.max.apply(Math,zr(n.mix.map(function(e){if(t!==e)return r.inheritanceDepth(e,i)})));break}if(t===n.mix)break;t=n.mix}return e}}]),e}();function of(e){return null==e}var sf={isNothing:of,isObject:function(e){return"object"==typeof e&&null!==e},toArray:function(e){return Array.isArray(e)?e:of(e)?[]:[e]},repeat:function(e,t){var i,r="";for(i=0;i<t;i+=1)r+=e;return r},isNegativeZero:function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},extend:function(e,t){var i,r,n,o;if(t)for(i=0,r=(o=Object.keys(t)).length;i<r;i+=1)e[n=o[i]]=t[n];return e}};function af(e,t){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||"",this.name="YAMLException",this.reason=e,this.mark=t,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}((af.prototype=Object.create(Error.prototype)).constructor=af).prototype.toString=function(e){var t=this.name+": ";return t+=this.reason||"(unknown reason)",!e&&this.mark&&(t+=" "+this.mark.toString()),t};var lf=af;function uf(e,t,i,r,n){this.name=e,this.buffer=t,this.position=i,this.line=r,this.column=n}uf.prototype.getSnippet=function(e,t){var i,r,n,o,s;if(!this.buffer)return null;for(e=e||4,t=t||75,i="",r=this.position;0<r&&-1==="\0\r\n\x85\u2028\u2029".indexOf(this.buffer.charAt(r-1));)if(r-=1,this.position-r>t/2-1){i=" ... ",r+=5;break}for(n="",o=this.position;o<this.buffer.length&&-1==="\0\r\n\x85\u2028\u2029".indexOf(this.buffer.charAt(o));)if((o+=1)-this.position>t/2-1){n=" ... ",o-=5;break}return s=this.buffer.slice(r,o),sf.repeat(" ",e)+i+s+n+"\n"+sf.repeat(" ",e+this.position-r+i.length)+"^"},uf.prototype.toString=function(e){var t,i="";return this.name&&(i+='in "'+this.name+'" '),i+="at line "+(this.line+1)+", column "+(this.column+1),e||(t=this.getSnippet())&&(i+=":\n"+t),i};var cf=uf,hf=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],ff=["scalar","sequence","mapping"];var df=function(t,e){if(e=e||{},Object.keys(e).forEach(function(e){if(-1===hf.indexOf(e))throw new lf('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')}),this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(e){return e},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.defaultStyle=e.defaultStyle||null,this.styleAliases=function(e){var i={};return null!==e&&Object.keys(e).forEach(function(t){e[t].forEach(function(e){i[String(e)]=t})}),i}(e.styleAliases||null),-1===ff.indexOf(this.kind))throw new lf('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')};function _f(e,t,r){var n=[];return e.include.forEach(function(e){r=_f(e,t,r)}),e[t].forEach(function(i){r.forEach(function(e,t){e.tag===i.tag&&n.push(t)}),r.push(i)}),r.filter(function(e,t){return-1===n.indexOf(t)})}function pf(e){this.include=e.include||[],this.implicit=e.implicit||[],this.explicit=e.explicit||[],this.implicit.forEach(function(e){if(e.loadKind&&"scalar"!==e.loadKind)throw new lf("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=_f(this,"implicit",[]),this.compiledExplicit=_f(this,"explicit",[]),this.compiledTypeMap=function(){var e,t,i={};function r(e){i[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return i}(this.compiledImplicit,this.compiledExplicit)}pf.DEFAULT=null,pf.create=function(e,t){var i,r;switch(arguments.length){case 1:i=pf.DEFAULT,r=e;break;case 2:i=e,r=t;break;default:throw new lf("Wrong number of arguments for Schema.create function")}if(i=sf.toArray(i),r=sf.toArray(r),!i.every(function(e){return e instanceof pf}))throw new lf("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!r.every(function(e){return e instanceof df}))throw new lf("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new pf({include:i,explicit:r})};var vf=pf,mf=new vf({explicit:[new df("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}}),new df("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}}),new df("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}})]});var gf=new df("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"});var yf=new df("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});var xf=new df("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,i,r,n,o=e.length,s=0,a=!1;if(!o)return!1;if("-"!==(t=e[s])&&"+"!==t||(t=e[++s]),"0"===t){if(s+1===o)return!0;if("b"===(t=e[++s])){for(s++;s<o;s++)if("_"!==(t=e[s])){if("0"!==t&&"1"!==t)return!1;a=!0}return a}if("x"===t){for(s++;s<o;s++)if("_"!==(t=e[s])){if(!(48<=(r=e.charCodeAt(s))&&r<=57||65<=r&&r<=70||97<=r&&r<=102))return!1;a=!0}return a}for(;s<o;s++)if("_"!==(t=e[s])){if(!(48<=(i=e.charCodeAt(s))&&i<=55))return!1;a=!0}return a}for(;s<o;s++)if("_"!==(t=e[s])){if(":"===t)break;if(!(48<=(n=e.charCodeAt(s))&&n<=57))return!1;a=!0}return!!a&&(":"!==t||/^(:[0-5]?[0-9])+$/.test(e.slice(s)))},construct:function(e){var t,i,r=e,n=1,o=[];return-1!==r.indexOf("_")&&(r=r.replace(/_/g,"")),"-"!==(t=r[0])&&"+"!==t||("-"===t&&(n=-1),t=(r=r.slice(1))[0]),"0"===r?0:"0"===t?"b"===r[1]?n*parseInt(r.slice(2),2):"x"===r[1]?n*parseInt(r,16):n*parseInt(r,8):-1!==r.indexOf(":")?(r.split(":").forEach(function(e){o.unshift(parseInt(e,10))}),r=0,i=1,o.forEach(function(e){r+=e*i,i*=60}),n*r):n*parseInt(r,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!sf.isNegativeZero(e)},represent:{binary:function(e){return"0b"+e.toString(2)},octal:function(e){return"0"+e.toString(8)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return"0x"+e.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),bf=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?|\\.[0-9_]+(?:[eE][-+][0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");var wf=/^[-+]?[0-9]+e/;var Af=new vf({include:[mf],implicit:[gf,yf,xf,new df("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!!bf.test(e)},construct:function(e){var t,i,r,n;return i="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,n=[],0<="+-".indexOf(t[0])&&(t=t.slice(1)),".inf"===t?1==i?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:0<=t.indexOf(":")?(t.split(":").forEach(function(e){n.unshift(parseFloat(e,10))}),t=0,r=1,n.forEach(function(e){t+=e*r,r*=60}),i*t):i*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||sf.isNegativeZero(e))},represent:function(e,t){var i;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(sf.isNegativeZero(e))return"-0.0";return i=e.toString(10),wf.test(i)?i.replace("e",".e"):i},defaultStyle:"lowercase"})]}),Tf=new vf({include:[Af]}),kf=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?)?$");var Ef=new df("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&null!==kf.exec(e)},construct:function(e){var t,i,r,n,o,s,a,l,u=0,c=null;if(null===(t=kf.exec(e)))throw new Error("Date resolve error");if(i=+t[1],r=+t[2]-1,n=+t[3],!t[4])return new Date(Date.UTC(i,r,n));if(o=+t[4],s=+t[5],a=+t[6],t[7]){for(u=t[7].slice(0,3);u.length<3;)u+="0";u=+u}return t[9]&&(c=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(c=-c)),l=new Date(Date.UTC(i,r,n,o,s,a,u)),c&&l.setTime(l.getTime()-c),l},instanceOf:Date,represent:function(e){return e.toISOString()}});var Mf=new df("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}}),Rf=da.Buffer,Sf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";var zf=new df("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,i,r=0,n=e.length,o=Sf;for(i=0;i<n;i++)if(!(64<(t=o.indexOf(e.charAt(i))))){if(t<0)return!1;r+=6}return r%8==0},construct:function(e){var t,i,r=e.replace(/[\r\n=]/g,""),n=r.length,o=Sf,s=0,a=[];for(t=0;t<n;t++)t%4==0&&t&&(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)),s=s<<6|o.indexOf(r.charAt(t));return 0==(i=n%4*6)?(a.push(s>>16&255),a.push(s>>8&255),a.push(255&s)):18==i?(a.push(s>>10&255),a.push(s>>2&255)):12==i&&a.push(s>>4&255),Rf?new Rf(a):a},predicate:function(e){return Rf&&Rf.isBuffer(e)},represent:function(e){var t,i,r="",n=0,o=e.length,s=Sf;for(t=0;t<o;t++)t%3==0&&t&&(r+=s[n>>18&63],r+=s[n>>12&63],r+=s[n>>6&63],r+=s[63&n]),n=(n<<8)+e[t];return 0==(i=o%3)?(r+=s[n>>18&63],r+=s[n>>12&63],r+=s[n>>6&63],r+=s[63&n]):2==i?(r+=s[n>>10&63],r+=s[n>>4&63],r+=s[n<<2&63],r+=s[64]):1==i&&(r+=s[n>>2&63],r+=s[n<<4&63],r+=s[64],r+=s[64]),r}}),Pf=Object.prototype.hasOwnProperty,Nf=Object.prototype.toString;var Of=new df("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,i,r,n,o,s=[],a=e;for(t=0,i=a.length;t<i;t+=1){if(r=a[t],o=!1,"[object Object]"!==Nf.call(r))return!1;for(n in r)if(Pf.call(r,n)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==s.indexOf(n))return!1;s.push(n)}return!0},construct:function(e){return null!==e?e:[]}}),Lf=Object.prototype.toString;var If=new df("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,i,r,n,o,s=e;for(o=new Array(s.length),t=0,i=s.length;t<i;t+=1){if(r=s[t],"[object Object]"!==Lf.call(r))return!1;if(1!==(n=Object.keys(r)).length)return!1;o[t]=[n[0],r[n[0]]]}return!0},construct:function(e){if(null===e)return[];var t,i,r,n,o,s=e;for(o=new Array(s.length),t=0,i=s.length;t<i;t+=1)r=s[t],n=Object.keys(r),o[t]=[n[0],r[n[0]]];return o}}),Cf=Object.prototype.hasOwnProperty;var Ff=new vf({include:[Tf],implicit:[Ef,Mf],explicit:[zf,Of,If,new df("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,i=e;for(t in i)if(Cf.call(i,t)&&null!==i[t])return!1;return!0},construct:function(e){return null!==e?e:{}}})]});var Df=new df("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(e){return void 0===e},represent:function(){return""}});var Uf,jf=new df("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(e){if(null===e)return!1;if(0===e.length)return!1;var t=e,i=/\/([gim]*)$/.exec(e),r="";if("/"===t[0]){if(i&&(r=i[1]),3<r.length)return!1;if("/"!==t[t.length-r.length-1])return!1}return!0},construct:function(e){var t=e,i=/\/([gim]*)$/.exec(e),r="";return"/"===t[0]&&(i&&(r=i[1]),t=t.slice(1,t.length-r.length-1)),new RegExp(t,r)},predicate:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},represent:function(e){var t="/"+e.source+"/";return e.global&&(t+="g"),e.multiline&&(t+="m"),e.ignoreCase&&(t+="i"),t}});try{Uf=function(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}("esprima")}catch(e){"undefined"!=typeof window&&(Uf=window.esprima)}var Gf=new df("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(e){if(null===e)return!1;try{var t="("+e+")",i=Uf.parse(t,{range:!0});return"Program"===i.type&&1===i.body.length&&"ExpressionStatement"===i.body[0].type&&"FunctionExpression"===i.body[0].expression.type}catch(e){return!1}},construct:function(e){var t,i="("+e+")",r=Uf.parse(i,{range:!0}),n=[];if("Program"!==r.type||1!==r.body.length||"ExpressionStatement"!==r.body[0].type||"FunctionExpression"!==r.body[0].expression.type)throw new Error("Failed to resolve function");return r.body[0].expression.params.forEach(function(e){n.push(e.name)}),t=r.body[0].expression.body.range,new Function(n,i.slice(t[0]+1,t[1]-1))},predicate:function(e){return"[object Function]"===Object.prototype.toString.call(e)},represent:function(e){return e.toString()}}),Bf=vf.DEFAULT=new vf({include:[Ff],explicit:[Df,jf,Gf]}),Vf=Object.prototype.hasOwnProperty,qf=1,Hf=2,Yf=3,Xf=4,Wf=1,Zf=2,Jf=3,Kf=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,$f=/[\x85\u2028\u2029]/,Qf=/[,\[\]\{\}]/,ed=/^(?:!|!!|![a-z\-]+!)$/i,td=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function id(e){return 10===e||13===e}function rd(e){return 9===e||32===e}function nd(e){return 9===e||32===e||10===e||13===e}function od(e){return 44===e||91===e||93===e||123===e||125===e}function sd(e){return 48===e?"\0":97===e?"\x07":98===e?"\b":116===e?"\t":9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"\x1b":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"\x85":95===e?"\xa0":76===e?"\u2028":80===e?"\u2029":""}for(var ad=new Array(256),ld=new Array(256),ud=0;ud<256;ud++)ad[ud]=sd(ud)?1:0,ld[ud]=sd(ud);function cd(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||Bf,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function hd(e,t){return new lf(t,new cf(e.filename,e.input,e.position,e.line,e.position-e.lineStart))}function fd(e,t){throw hd(e,t)}function dd(e,t){e.onWarning&&e.onWarning.call(null,hd(e,t))}var _d={YAML:function(e,t,i){var r,n,o;null!==e.version&&fd(e,"duplication of %YAML directive"),1!==i.length&&fd(e,"YAML directive accepts exactly one argument"),null===(r=/^([0-9]+)\.([0-9]+)$/.exec(i[0]))&&fd(e,"ill-formed argument of the YAML directive"),n=parseInt(r[1],10),o=parseInt(r[2],10),1!==n&&fd(e,"unacceptable YAML version of the document"),e.version=i[0],e.checkLineBreaks=o<2,1!==o&&2!==o&&dd(e,"unsupported YAML version of the document")},TAG:function(e,t,i){var r,n;2!==i.length&&fd(e,"TAG directive accepts exactly two arguments"),r=i[0],n=i[1],ed.test(r)||fd(e,"ill-formed tag handle (first argument) of the TAG directive"),Vf.call(e.tagMap,r)&&fd(e,'there is a previously declared suffix for "'+r+'" tag handle'),td.test(n)||fd(e,"ill-formed tag prefix (second argument) of the TAG directive"),e.tagMap[r]=n}};function pd(e,t,i,r){var n,o,s,a;if(t<i){if(a=e.input.slice(t,i),r)for(n=0,o=a.length;n<o;n+=1)9===(s=a.charCodeAt(n))||32<=s&&s<=1114111||fd(e,"expected valid JSON character");else Kf.test(a)&&fd(e,"the stream contains non-printable characters");e.result+=a}}function vd(e,t,i,r){var n,o,s,a;for(sf.isObject(i)||fd(e,"cannot merge mappings; the provided source object is unacceptable"),s=0,a=(n=Object.keys(i)).length;s<a;s+=1)o=n[s],Vf.call(t,o)||(t[o]=i[o],r[o]=!0)}function md(e,t,i,r,n,o){var s,a;if(n=String(n),null===t&&(t={}),"tag:yaml.org,2002:merge"===r)if(Array.isArray(o))for(s=0,a=o.length;s<a;s+=1)vd(e,t,o[s],i);else vd(e,t,o,i);else e.json||Vf.call(i,n)||!Vf.call(t,n)||fd(e,"duplicated mapping key"),t[n]=o,delete i[n];return t}function gd(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):fd(e,"a line break is expected"),e.line+=1,e.lineStart=e.position}function yd(e,t,i){for(var r=0,n=e.input.charCodeAt(e.position);0!==n;){for(;rd(n);)n=e.input.charCodeAt(++e.position);if(t&&35===n)for(;10!==(n=e.input.charCodeAt(++e.position))&&13!==n&&0!==n;);if(!id(n))break;for(gd(e),n=e.input.charCodeAt(e.position),r++,e.lineIndent=0;32===n;)e.lineIndent++,n=e.input.charCodeAt(++e.position)}return-1!==i&&0!==r&&e.lineIndent<i&&dd(e,"deficient indentation"),r}function xd(e){var t,i=e.position;return!(45!==(t=e.input.charCodeAt(i))&&46!==t||t!==e.input.charCodeAt(i+1)||t!==e.input.charCodeAt(i+2)||(i+=3,0!==(t=e.input.charCodeAt(i))&&!nd(t)))}function bd(e,t){1===t?e.result+=" ":1<t&&(e.result+=sf.repeat("\n",t-1))}function wd(e,t){var i,r,n=e.tag,o=e.anchor,s=[],a=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=s),r=e.input.charCodeAt(e.position);0!==r&&45===r&&nd(e.input.charCodeAt(e.position+1));)if(a=!0,e.position++,yd(e,!0,-1)&&e.lineIndent<=t)s.push(null),r=e.input.charCodeAt(e.position);else if(i=e.line,kd(e,t,Yf,!1,!0),s.push(e.result),yd(e,!0,-1),r=e.input.charCodeAt(e.position),(e.line===i||e.lineIndent>t)&&0!==r)fd(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!a&&(e.tag=n,e.anchor=o,e.kind="sequence",e.result=s,!0)}function Ad(e){var t,i,r,n,o=!1,s=!1;if(33!==(n=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&fd(e,"duplication of a tag property"),60===(n=e.input.charCodeAt(++e.position))?(o=!0,n=e.input.charCodeAt(++e.position)):33===n?(s=!0,i="!!",n=e.input.charCodeAt(++e.position)):i="!",t=e.position,o){for(;0!==(n=e.input.charCodeAt(++e.position))&&62!==n;);e.position<e.length?(r=e.input.slice(t,e.position),n=e.input.charCodeAt(++e.position)):fd(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==n&&!nd(n);)33===n&&(s?fd(e,"tag suffix cannot contain exclamation marks"):(i=e.input.slice(t-1,e.position+1),ed.test(i)||fd(e,"named tag handle cannot contain such characters"),s=!0,t=e.position+1)),n=e.input.charCodeAt(++e.position);r=e.input.slice(t,e.position),Qf.test(r)&&fd(e,"tag suffix cannot contain flow indicator characters")}return r&&!td.test(r)&&fd(e,"tag name cannot contain such characters: "+r),o?e.tag=r:Vf.call(e.tagMap,i)?e.tag=e.tagMap[i]+r:"!"===i?e.tag="!"+r:"!!"===i?e.tag="tag:yaml.org,2002:"+r:fd(e,'undeclared tag handle "'+i+'"'),!0}function Td(e){var t,i;if(38!==(i=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&fd(e,"duplication of an anchor property"),i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!nd(i)&&!od(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&fd(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function kd(e,t,i,r,n){var o,s,a,l,u,c,h,f,d=1,_=!1,p=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,o=s=a=Xf===i||Yf===i,r&&yd(e,!0,-1)&&(_=!0,e.lineIndent>t?d=1:e.lineIndent===t?d=0:e.lineIndent<t&&(d=-1)),1===d)for(;Ad(e)||Td(e);)yd(e,!0,-1)?(_=!0,a=o,e.lineIndent>t?d=1:e.lineIndent===t?d=0:e.lineIndent<t&&(d=-1)):a=!1;if(a&&(a=_||n),1!==d&&Xf!==i||(h=qf===i||Hf===i?t:t+1,f=e.position-e.lineStart,1===d?a&&(wd(e,f)||function(e,t,i){var r,n,o,s,a=e.tag,l=e.anchor,u={},c={},h=null,f=null,d=null,_=!1,p=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=u),s=e.input.charCodeAt(e.position);0!==s;){if(r=e.input.charCodeAt(e.position+1),o=e.line,63!==s&&58!==s||!nd(r)){if(!kd(e,i,Hf,!1,!0))break;if(e.line===o){for(s=e.input.charCodeAt(e.position);rd(s);)s=e.input.charCodeAt(++e.position);if(58===s)nd(s=e.input.charCodeAt(++e.position))||fd(e,"a whitespace character is expected after the key-value separator within a block mapping"),_&&(md(e,u,c,h,f,null),h=f=d=null),n=_=!(p=!0),h=e.tag,f=e.result;else{if(!p)return e.tag=a,e.anchor=l,!0;fd(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!p)return e.tag=a,e.anchor=l,!0;fd(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===s?(_&&(md(e,u,c,h,f,null),h=f=d=null),n=_=p=!0):_?n=!(_=!1):fd(e,"incomplete explicit mapping pair; a key node is missed"),e.position+=1,s=r;if((e.line===o||e.lineIndent>t)&&(kd(e,t,Xf,!0,n)&&(_?f=e.result:d=e.result),_||(md(e,u,c,h,f,d),h=f=d=null),yd(e,!0,-1),s=e.input.charCodeAt(e.position)),e.lineIndent>t&&0!==s)fd(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return _&&md(e,u,c,h,f,null),p&&(e.tag=a,e.anchor=l,e.kind="mapping",e.result=u),p}(e,f,h))||function(e,t){var i,r,n,o,s,a,l,u,c,h,f=!0,d=e.tag,_=e.anchor,p={};if(91===(h=e.input.charCodeAt(e.position)))a=!(n=93),r=[];else{if(123!==h)return!1;n=125,a=!0,r={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=r),h=e.input.charCodeAt(++e.position);0!==h;){if(yd(e,!0,t),(h=e.input.charCodeAt(e.position))===n)return e.position++,e.tag=d,e.anchor=_,e.kind=a?"mapping":"sequence",e.result=r,!0;f||fd(e,"missed comma between flow collection entries"),c=null,o=s=!1,63===h&&nd(e.input.charCodeAt(e.position+1))&&(o=s=!0,e.position++,yd(e,!0,t)),i=e.line,kd(e,t,qf,!1,!0),u=e.tag,l=e.result,yd(e,!0,t),h=e.input.charCodeAt(e.position),!s&&e.line!==i||58!==h||(o=!0,h=e.input.charCodeAt(++e.position),yd(e,!0,t),kd(e,t,qf,!1,!0),c=e.result),a?md(e,r,p,u,l,c):o?r.push(md(e,null,p,u,l,c)):r.push(l),yd(e,!0,t),44===(h=e.input.charCodeAt(e.position))?(f=!0,h=e.input.charCodeAt(++e.position)):f=!1}fd(e,"unexpected end of the stream within a flow collection")}(e,h)?p=!0:(s&&function(e,t){var i,r,n,o,s,a=Wf,l=!1,u=t,c=0,h=!1;if(124===(o=e.input.charCodeAt(e.position)))r=!1;else{if(62!==o)return!1;r=!0}for(e.kind="scalar",e.result="";0!==o;)if(43===(o=e.input.charCodeAt(++e.position))||45===o)Wf===a?a=43===o?Jf:Zf:fd(e,"repeat of a chomping mode identifier");else{if(!(0<=(n=48<=(s=o)&&s<=57?s-48:-1)))break;0==n?fd(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?fd(e,"repeat of an indentation width identifier"):(u=t+n-1,l=!0)}if(rd(o)){for(;rd(o=e.input.charCodeAt(++e.position)););if(35===o)for(;!id(o=e.input.charCodeAt(++e.position))&&0!==o;);}for(;0!==o;){for(gd(e),e.lineIndent=0,o=e.input.charCodeAt(e.position);(!l||e.lineIndent<u)&&32===o;)e.lineIndent++,o=e.input.charCodeAt(++e.position);if(!l&&e.lineIndent>u&&(u=e.lineIndent),id(o))c++;else{if(e.lineIndent<u){a===Jf?e.result+=sf.repeat("\n",c):a===Wf&&l&&(e.result+="\n");break}for(r?rd(o)?(h=!0,e.result+=sf.repeat("\n",c+1)):h?(h=!1,e.result+=sf.repeat("\n",c+1)):0===c?l&&(e.result+=" "):e.result+=sf.repeat("\n",c):e.result+=l?sf.repeat("\n",c+1):sf.repeat("\n",c),l=!0,c=0,i=e.position;!id(o)&&0!==o;)o=e.input.charCodeAt(++e.position);pd(e,i,e.position,!1)}}return!0}(e,h)||function(e,t){var i,r,n;if(39!==(i=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,r=n=e.position;0!==(i=e.input.charCodeAt(e.position));)if(39===i){if(pd(e,r,e.position,!0),39!==(i=e.input.charCodeAt(++e.position)))return!0;r=n=e.position,e.position++}else id(i)?(pd(e,r,n,!0),bd(e,yd(e,!1,t)),r=n=e.position):e.position===e.lineStart&&xd(e)?fd(e,"unexpected end of the document within a single quoted scalar"):(e.position++,n=e.position);fd(e,"unexpected end of the stream within a single quoted scalar")}(e,h)||function(e,t){var i,r,n,o,s,a,l,u,c,h;if(34!==(a=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,i=r=e.position;0!==(a=e.input.charCodeAt(e.position));){if(34===a)return pd(e,i,e.position,!0),e.position++,!0;if(92===a){if(pd(e,i,e.position,!0),id(a=e.input.charCodeAt(++e.position)))yd(e,!1,t);else if(a<256&&ad[a])e.result+=ld[a],e.position++;else if(0<(s=120===(h=a)?2:117===h?4:85===h?8:0)){for(n=s,o=0;0<n;n--)a=e.input.charCodeAt(++e.position),c=void 0,0<=(s=48<=(u=a)&&u<=57?u-48:97<=(c=32|u)&&c<=102?c-97+10:-1)?o=(o<<4)+s:fd(e,"expected hexadecimal character");e.result+=(l=o)<=65535?String.fromCharCode(l):String.fromCharCode(55296+(l-65536>>10),56320+(l-65536&1023)),e.position++}else fd(e,"unknown escape sequence");i=r=e.position}else id(a)?(pd(e,i,r,!0),bd(e,yd(e,!1,t)),i=r=e.position):e.position===e.lineStart&&xd(e)?fd(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}fd(e,"unexpected end of the stream within a double quoted scalar")}(e,h)?p=!0:!function(e){var t,i,r;if(42!==(r=e.input.charCodeAt(e.position)))return!1;for(r=e.input.charCodeAt(++e.position),t=e.position;0!==r&&!nd(r)&&!od(r);)r=e.input.charCodeAt(++e.position);return e.position===t&&fd(e,"name of an alias node must contain at least one character"),i=e.input.slice(t,e.position),e.anchorMap.hasOwnProperty(i)||fd(e,'unidentified alias "'+i+'"'),e.result=e.anchorMap[i],yd(e,!0,-1),!0}(e)?function(e,t,i){var r,n,o,s,a,l,u,c,h=e.kind,f=e.result;if(nd(c=e.input.charCodeAt(e.position))||od(c)||35===c||38===c||42===c||33===c||124===c||62===c||39===c||34===c||37===c||64===c||96===c)return!1;if((63===c||45===c)&&(nd(r=e.input.charCodeAt(e.position+1))||i&&od(r)))return!1;for(e.kind="scalar",e.result="",n=o=e.position,s=!1;0!==c;){if(58===c){if(nd(r=e.input.charCodeAt(e.position+1))||i&&od(r))break}else if(35===c){if(nd(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&xd(e)||i&&od(c))break;if(id(c)){if(a=e.line,l=e.lineStart,u=e.lineIndent,yd(e,!1,-1),e.lineIndent>=t){s=!0,c=e.input.charCodeAt(e.position);continue}e.position=o,e.line=a,e.lineStart=l,e.lineIndent=u;break}}s&&(pd(e,n,o,!1),bd(e,e.line-a),n=o=e.position,s=!1),rd(c)||(o=e.position+1),c=e.input.charCodeAt(++e.position)}return pd(e,n,o,!1),!!e.result||(e.kind=h,e.result=f,!1)}(e,h,qf===i)&&(p=!0,null===e.tag&&(e.tag="?")):(p=!0,null===e.tag&&null===e.anchor||fd(e,"alias node should not have any properties")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===d&&(p=a&&wd(e,f))),null!==e.tag&&"!"!==e.tag)if("?"===e.tag){for(l=0,u=e.implicitTypes.length;l<u;l+=1)if((c=e.implicitTypes[l]).resolve(e.result)){e.result=c.construct(e.result),e.tag=c.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else Vf.call(e.typeMap,e.tag)?(c=e.typeMap[e.tag],null!==e.result&&c.kind!==e.kind&&fd(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+c.kind+'", not "'+e.kind+'"'),c.resolve(e.result)?(e.result=c.construct(e.result),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):fd(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")):fd(e,"unknown tag !<"+e.tag+">");return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||p}function Ed(e){var t,i,r,n,o=e.position,s=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap={},e.anchorMap={};0!==(n=e.input.charCodeAt(e.position))&&(yd(e,!0,-1),n=e.input.charCodeAt(e.position),!(0<e.lineIndent||37!==n));){for(s=!0,n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!nd(n);)n=e.input.charCodeAt(++e.position);for(r=[],(i=e.input.slice(t,e.position)).length<1&&fd(e,"directive name must not be less than one character in length");0!==n;){for(;rd(n);)n=e.input.charCodeAt(++e.position);if(35===n){for(;0!==(n=e.input.charCodeAt(++e.position))&&!id(n););break}if(id(n))break;for(t=e.position;0!==n&&!nd(n);)n=e.input.charCodeAt(++e.position);r.push(e.input.slice(t,e.position))}0!==n&&gd(e),Vf.call(_d,i)?_d[i](e,i,r):dd(e,'unknown document directive "'+i+'"')}yd(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,yd(e,!0,-1)):s&&fd(e,"directives end mark is expected"),kd(e,e.lineIndent-1,Xf,!1,!0),yd(e,!0,-1),e.checkLineBreaks&&$f.test(e.input.slice(o,e.position))&&dd(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&xd(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,yd(e,!0,-1)):e.position<e.length-1&&fd(e,"end of the stream or a document separator is expected")}function Md(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var i=new cd(e,t);for(i.input+="\0";32===i.input.charCodeAt(i.position);)i.lineIndent+=1,i.position+=1;for(;i.position<i.length-1;)Ed(i);return i.documents}function Rd(e,t,i){var r,n,o=Md(e,i);for(r=0,n=o.length;r<n;r+=1)t(o[r])}function Sd(e,t){var i=Md(e,t);if(0!==i.length){if(1===i.length)return i[0];throw new lf("expected a single document in the stream, but found more")}}var zd={loadAll:Rd,load:Sd,safeLoadAll:function(e,t,i){Rd(e,t,sf.extend({schema:Ff},i))},safeLoad:function(e,t){return Sd(e,sf.extend({schema:Ff},t))}},Pd=Object.prototype.toString,Nd=Object.prototype.hasOwnProperty,Od=9,Ld=10,Id=13,Cd=32,Fd=33,Dd=34,Ud=35,jd=37,Gd=38,Bd=39,Vd=42,qd=44,Hd=45,Yd=58,Xd=62,Wd=63,Zd=64,Jd=91,Kd=93,$d=96,Qd=123,e_=124,t_=125,i_={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},r_=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function n_(e){this.schema=e.schema||Bf,this.indent=Math.max(1,e.indent||2),this.skipInvalid=e.skipInvalid||!1,this.flowLevel=sf.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=function(e,t){var i,r,n,o,s,a,l;if(null===t)return{};for(i={},n=0,o=(r=Object.keys(t)).length;n<o;n+=1)s=r[n],a=String(t[s]),"!!"===s.slice(0,2)&&(s="tag:yaml.org,2002:"+s.slice(2)),(l=e.compiledTypeMap[s])&&Nd.call(l.styleAliases,a)&&(a=l.styleAliases[a]),i[s]=a;return i}(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function o_(e,t){for(var i,r=sf.repeat(" ",t),n=0,o=-1,s="",a=e.length;n<a;)n=-1===(o=e.indexOf("\n",n))?(i=e.slice(n),a):(i=e.slice(n,o+1),o+1),i.length&&"\n"!==i&&(s+=r),s+=i;return s}function s_(e,t){return"\n"+sf.repeat(" ",e.indent*t)}function a_(e){this.source=e,this.result="",this.checkpoint=0}function l_(e,t,i,r){var n,o,s,a,l,u,c,h,f,d,_,p,v,m,g,y,x,b,w,A;if(0!==t.length)if(-1===r_.indexOf(t)){for(n=!0,o=t.length?t.charCodeAt(0):0,s=Cd===o||Cd===t.charCodeAt(t.length-1),Hd!==o&&Wd!==o&&Zd!==o&&$d!==o||(n=!1),l=a=s||-1<e.flowLevel&&e.flowLevel<=i?(s&&(n=!1),!1):!r,u=!0,c=new a_(t),h=!1,d=f=0,_=e.indent*i,-1===(p=e.lineWidth)&&(p=9007199254740991),_<40?p-=_:p=40,m=0;m<t.length;m++){if(v=t.charCodeAt(m),n){if(Od!==(T=v)&&Ld!==T&&Id!==T&&qd!==T&&Jd!==T&&Kd!==T&&Qd!==T&&t_!==T&&Ud!==T&&Gd!==T&&Vd!==T&&Fd!==T&&e_!==T&&Xd!==T&&Bd!==T&&Dd!==T&&jd!==T&&Yd!==T&&!i_[T]&&!c_(T))continue;n=!1}u&&v===Bd&&(u=!1),g=i_[v],y=c_(v),(g||y)&&(v!==Ld&&v!==Dd&&v!==Bd?l=a=!1:v===Ld&&(u=!(h=!0),0<m&&t.charCodeAt(m-1)===Cd&&(a=l=!1),a&&(x=m-f,f=m,d<x&&(d=x))),v!==Dd&&(u=!1),c.takeUpTo(m),c.escapeChar())}var T;if(n&&function(e,t){var i,r;for(i=0,r=e.implicitTypes.length;i<r;i+=1)if(e.implicitTypes[i].resolve(t))return!0;return!1}(e,t)&&(n=!1),b="",(a||l)&&(w=0,t.charCodeAt(t.length-1)===Ld&&(w+=1,t.charCodeAt(t.length-2)===Ld&&(w+=1)),0===w?b="-":2===w&&(b="+")),(l&&d<p||null!==e.tag)&&(a=!1),h||(l=!1),n)e.dump=t;else if(u)e.dump="'"+t+"'";else if(a)A=function(e,t){var i,r="",n=0,o=e.length,s=/\n+$/.exec(e);s&&(o=s.index+1);for(;n<o;)i=e.indexOf("\n",n),n=o<i||-1===i?(r&&(r+="\n\n"),r+=u_(e.slice(n,o),t),o):(r&&(r+="\n\n"),r+=u_(e.slice(n,i),t),i+1);s&&"\n"!==s[0]&&(r+=s[0]);return r}(t,p),e.dump=">"+b+"\n"+o_(A,_);else if(l)b||(t=t.replace(/\n$/,"")),e.dump="|"+b+"\n"+o_(t,_);else{if(!c)throw new Error("Failed to dump scalar value");c.finish(),e.dump='"'+c.result+'"'}}else e.dump="'"+t+"'";else e.dump="''"}function u_(e,t){if(""===e)return e;for(var i,r,n=/[^\s] [^\s]/g,o="",s=0,a=0,l=n.exec(e);l;)t<(i=l.index)-a&&(r=s!==a?s:i,o&&(o+="\n"),o+=e.slice(a,r),a=r+1),s=i+1,l=n.exec(e);return o&&(o+="\n"),a!==s&&e.length-a>t?o+=e.slice(a,s)+"\n"+e.slice(s+1):o+=e.slice(a),o}function c_(e){return!(32<=e&&e<=126||133===e||160<=e&&e<=55295||57344<=e&&e<=65533||65536<=e&&e<=1114111)}function h_(e,t,i){var r,n,o,s,a,l;for(o=0,s=(n=i?e.explicitTypes:e.implicitTypes).length;o<s;o+=1)if(((a=n[o]).instanceOf||a.predicate)&&(!a.instanceOf||"object"==typeof t&&t instanceof a.instanceOf)&&(!a.predicate||a.predicate(t))){if(e.tag=i?a.tag:"?",a.represent){if(l=e.styleMap[a.tag]||a.defaultStyle,"[object Function]"===Pd.call(a.represent))r=a.represent(t,l);else{if(!Nd.call(a.represent,l))throw new lf("!<"+a.tag+'> tag resolver accepts not "'+l+'" style');r=a.represent[l](t,l)}e.dump=r}return!0}return!1}function f_(e,t,i,r,n,o){e.tag=null,e.dump=i,h_(e,i,!1)||h_(e,i,!0);var s=Pd.call(e.dump);r&&(r=e.flowLevel<0||e.flowLevel>t);var a,l,u="[object Object]"===s||"[object Array]"===s;if(u&&(l=-1!==(a=e.duplicates.indexOf(i))),(null!==e.tag&&"?"!==e.tag||l||2!==e.indent&&0<t)&&(n=!1),l&&e.usedDuplicates[a])e.dump="*ref_"+a;else{if(u&&l&&!e.usedDuplicates[a]&&(e.usedDuplicates[a]=!0),"[object Object]"===s)r&&0!==Object.keys(e.dump).length?(function(e,t,i,r){var n,o,s,a,l,u,c="",h=e.tag,f=Object.keys(i);if(!0===e.sortKeys)f.sort();else if("function"==typeof e.sortKeys)f.sort(e.sortKeys);else if(e.sortKeys)throw new lf("sortKeys must be a boolean or a function");for(n=0,o=f.length;n<o;n+=1)u="",r&&0===n||(u+=s_(e,t)),a=i[s=f[n]],f_(e,t+1,s,!0,!0,!0)&&((l=null!==e.tag&&"?"!==e.tag||e.dump&&1024<e.dump.length)&&(e.dump&&Ld===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,l&&(u+=s_(e,t)),f_(e,t+1,a,!0,l)&&(e.dump&&Ld===e.dump.charCodeAt(0)?u+=":":u+=": ",c+=u+=e.dump));e.tag=h,e.dump=c||"{}"}(e,t,e.dump,n),l&&(e.dump="&ref_"+a+e.dump)):(function(e,t,i){var r,n,o,s,a,l="",u=e.tag,c=Object.keys(i);for(r=0,n=c.length;r<n;r+=1)a="",0!==r&&(a+=", "),s=i[o=c[r]],f_(e,t,o,!1,!1)&&(1024<e.dump.length&&(a+="? "),a+=e.dump+": ",f_(e,t,s,!1,!1)&&(l+=a+=e.dump));e.tag=u,e.dump="{"+l+"}"}(e,t,e.dump),l&&(e.dump="&ref_"+a+" "+e.dump));else if("[object Array]"===s)r&&0!==e.dump.length?(function(e,t,i,r){var n,o,s="",a=e.tag;for(n=0,o=i.length;n<o;n+=1)f_(e,t+1,i[n],!0,!0)&&(r&&0===n||(s+=s_(e,t)),s+="- "+e.dump);e.tag=a,e.dump=s||"[]"}(e,t,e.dump,n),l&&(e.dump="&ref_"+a+e.dump)):(function(e,t,i){var r,n,o="",s=e.tag;for(r=0,n=i.length;r<n;r+=1)f_(e,t,i[r],!1,!1)&&(0!==r&&(o+=", "),o+=e.dump);e.tag=s,e.dump="["+o+"]"}(e,t,e.dump),l&&(e.dump="&ref_"+a+" "+e.dump));else{if("[object String]"!==s){if(e.skipInvalid)return!1;throw new lf("unacceptable kind of an object to dump "+s)}"?"!==e.tag&&l_(e,e.dump,t,o)}null!==e.tag&&"?"!==e.tag&&(e.dump="!<"+e.tag+"> "+e.dump)}return!0}function d_(e,t){var i,r,n=[],o=[];for(function e(t,i,r){var n,o,s;if(null!==t&&"object"==typeof t)if(-1!==(o=i.indexOf(t)))-1===r.indexOf(o)&&r.push(o);else if(i.push(t),Array.isArray(t))for(o=0,s=t.length;o<s;o+=1)e(t[o],i,r);else for(n=Object.keys(t),o=0,s=n.length;o<s;o+=1)e(t[n[o]],i,r)}(e,n,o),i=0,r=o.length;i<r;i+=1)t.duplicates.push(n[o[i]]);t.usedDuplicates=new Array(r)}function __(e,t){var i=new n_(t=t||{});return i.noRefs||d_(e,i),f_(i,0,e,!0,!0)?i.dump+"\n":""}a_.prototype.takeUpTo=function(e){var t;if(e<this.checkpoint)throw(t=new Error("position should be > checkpoint")).position=e,t.checkpoint=this.checkpoint,t;return this.result+=this.source.slice(this.checkpoint,e),this.checkpoint=e,this},a_.prototype.escapeChar=function(){var e,t;return e=this.source.charCodeAt(this.checkpoint),t=i_[e]||function(e){var t,i,r;if(t=e.toString(16).toUpperCase(),e<=255)i="x",r=2;else if(e<=65535)i="u",r=4;else{if(!(e<=4294967295))throw new lf("code point within a string may not be greater than 0xFFFFFFFF");i="U",r=8}return"\\"+i+sf.repeat("0",r-t.length)+t}(e),this.result+=t,this.checkpoint+=1,this},a_.prototype.finish=function(){this.source.length>this.checkpoint&&this.takeUpTo(this.source.length)};var p_={dump:__,safeDump:function(e,t){return __(e,sf.extend({schema:Ff},t))}};function v_(e){return function(){throw new Error("Function "+e+" is deprecated and cannot be used.")}}var m_={Type:df,Schema:vf,FAILSAFE_SCHEMA:mf,JSON_SCHEMA:Af,CORE_SCHEMA:Tf,DEFAULT_SAFE_SCHEMA:Ff,DEFAULT_FULL_SCHEMA:Bf,load:zd.load,loadAll:zd.loadAll,safeLoad:zd.safeLoad,safeLoadAll:zd.safeLoadAll,dump:p_.dump,safeDump:p_.safeDump,YAMLException:lf,MINIMAL_SCHEMA:mf,SAFE_SCHEMA:Ff,DEFAULT_SCHEMA:Bf,scan:v_("scan"),parse:v_("parse"),compose:v_("compose"),addConstructor:v_("addConstructor")},g_=function(){function r(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;mr(this,r),this.url=e,!t||hn(t)&&!hn(this.url)?this.path=cn(this.url):this.path=t,this.path_for_parent=t||this.path,this.parent=i,this.container=null,this.parent&&(this.parent.container?this.container=this.parent.container:this.parent.isContainer()&&(this.container=this.parent))}return yr(r,[{key:"load",value:function(){return function(e){return new Promise(function(i,r){"string"==typeof e?on.io(e).then(function(e){try{var t=function(e){var t;try{t=m_.safeLoad(e,{json:!0})}catch(e){throw e}return t}(e);i(t)}catch(e){r(e)}},r):(e=Object.assign({},e),i(e))})}(this.url)}},{key:"resourceFor",value:function(e){return{url:this.urlFor(e),path:this.pathFor(e),type:this.typeFor(e)}}},{key:"urlFor",value:function(e){return y_(e)?e:hn(e)&&this.container?this.parent.urlFor(this.path_for_parent+e):function(e,t){if(!e||!hn(e))return e;var i,r="/"!==e[0];if(t?(i=document.createElement("a")).href=t:i=window.location,r){e=cn(i.href)+e}else{var n=i.origin;n||(n=i.protocol+"//"+i.host),e=n+e}return e}(e,this.path)}},{key:"pathFor",value:function(e){return cn(e)}},{key:"typeFor",value:function(e){return function(e){var t=(e=e.split("/").pop()).lastIndexOf(".");if(-1<t)return e.substring(t+1)}(e)}},{key:"isContainer",value:function(){return!1}}]),r}();function y_(e){return!(!e||"global."!==e.slice(0,7))}function x_(e){return null!=e}function b_(e){return"("+e+")"}function w_(e){return"$"===e[0]?"context['"+e.substring(1)+"']":"context.feature.properties['"+e+"']"}function A_(e,t){return b_(function(e){return"string"==typeof e?'"'+e+'"':e}(t)+" === "+w_(e))}function T_(t,e){return b_(e.map(function(e){return A_(t,e)}).join(" || "))}function k_(e,t){return b_(e.filter(x_).map(function(e){return b_(e.join(" && "))}).join(" "+t+" "))}function E_(e,t,i){return t&&0<t.length?k_(t.map(function(e){return S_(e,i)}),"||"):"true"}function M_(e,t,i){return t&&0<t.length?k_(t.map(function(e){return S_(e,i)}),"&&"):"true"}function R_(e,t,i){var r=[],n=i&&"function"==typeof i.rangeTransform&&i.rangeTransform;if(t.max){var o=n?n(t.max):t.max;r.push(w_(e)+" < "+o)}if(t.min){var s=n?s=n(t.min):t.min;r.push(w_(e)+" >= "+s)}return b_(r.join(" && "))}function S_(e,t){var i=[];if("function"==typeof e)return[b_(e.toString()+"(context)")];if(Array.isArray(e))return[E_(0,e,t)];if(null==e)return["true"];for(var r,n=Object.keys(e),o=0;o<n.length;o++){var s=n[o],a=e[s],l=vr(a);if("string"===l||"number"===l)i.push(A_(s,a));else if("boolean"===l)i.push((r=a,b_(w_(s)+(r?" != ":" == ")+"null")));else if("not"===s)i.push("!"+b_(S_(a,t).join(" && ")));else if("any"===s)i.push(E_(0,a,t));else if("all"===s)i.push(M_(0,a,t));else if("none"===s)i.push("!"+b_(E_(0,a,t)));else if(Array.isArray(a))i.push(T_(s,a));else if("object"===l&&null!=a)(a.max||a.min)&&i.push(R_(s,a,t));else{if(null!=a)throw new Error("Unknown Query syntax: "+a);i.push(" true ")}}return 0===n.length?["true"]:i}function z_(e,t){return null==e?function(){return!0}:new Function("context","return "+function(e){return b_(e.join(" && "))}(S_(e,t))+";")}var P_=["filter","draw","visible","enabled","data"],N_={};function O_(e,i){for(var r,t=0,n=0;n<e.length;n++)e[n].length>t&&(t=e[n].length);if(0===t)return null;for(var o={visible:!0},s=function(t){if(r=[],e.forEach(function(e){e[t]&&e[t][i]&&-1===r.indexOf(e[t][i])&&r.push(e[t][i])}),0===r.length)return"continue";r.sort(function(e,t){return(e&&e.layer_name)>(t&&t.layer_name)?1:-1}),hl.apply(void 0,[o].concat(zr(r))),delete o.layer_name},a=0;a<t;a++)s(a);return!1===o.visible?null:o}var L_=["any","all","not","none"],I_=function(){function h(e){var t=e.layer,i=e.name,r=e.parent,n=e.draw,o=e.visible,s=e.enabled,a=e.filter,l=e.styles;if(mr(this,h),this.id=h.id++,this.config_data=t.data,this.parent=r,this.name=i,this.full_name=this.parent?this.parent.full_name+":"+this.name:this.name,this.draw=n,this.filter=a,this.styles=l,this.is_built=!1,s=void 0===s?o:s,this.parent&&!1===this.parent.visible?this.enabled=!1:this.enabled=!1!==s,this.draw)for(var u in this.draw)if(this.draw[u]=null==this.draw[u]?{}:this.draw[u],"object"!==vr(this.draw[u])){var c="Draw group '".concat(u,"' for layer ").concat(this.full_name," is invalid, must be an object, ");Jr("warn",c+="but was set to `".concat(u,": ").concat(this.draw[u],"` instead")),delete this.draw[u]}else this.draw[u].layer_name=this.full_name}return yr(h,[{key:"build",value:function(){Jr("trace","Building layer '".concat(this.full_name,"'")),this.buildFilter(),this.buildDraw(),this.is_built=!0}},{key:"buildDraw",value:function(){this.draw=on.stringsToFunctions(this.draw,Fo.wrapFunction),this.calculatedDraw=function(e){var t=[];if(e.parent){var i=e.parent.calculatedDraw||[];t.push.apply(t,zr(i))}return t.push(e.draw),t}(this)}},{key:"buildFilter",value:function(){this.filter_original=this.filter,this.filter=on.stringsToFunctions(this.filter,Fo.wrapFunction);var e=vr(this.filter);if(null==this.filter||"object"===e||"function"===e)try{this.buildZooms(),this.buildPropMatches(),null!=this.filter&&("function"==typeof this.filter||0<Object.keys(this.filter).length)?this.filter=z_(this.filter,U_):this.filter=null}catch(e){var t="Filter for layer ".concat(this.full_name," is invalid, `filter: ").concat(JSON.stringify(this.filter),"` ");Jr("warn",t+="failed with error '".concat(e.message,"', stack trace: ").concat(e.stack))}else{var i="Filter for layer ".concat(this.full_name," is invalid, filter value must be an object or function, ");Jr("warn",i+="but was set to `filter: ".concat(this.filter,"` instead"))}}},{key:"buildZooms",value:function(){var e=this.filter&&this.filter.$zoom,t=vr(e);if(null!=e&&"function"!==t){if(this.zooms={},"number"===t)this.zooms[e]=!0;else if(Array.isArray(e))for(var i=0;i<e.length;i++)this.zooms[e[i]]=!0;else if("object"===t&&(null!=e.min||null!=e.max))for(var r=e.min||0,n=e.max||25,o=r;o<n;o++)this.zooms[o]=!0;delete this.filter.$zoom}}},{key:"buildPropMatches",value:function(){var n=this;this.filter&&!Array.isArray(this.filter)&&"function"!=typeof this.filter&&Object.keys(this.filter).forEach(function(e){if(-1===L_.indexOf(e)){var t=n.filter[e],i=vr(t),r=Array.isArray(t);if(!r&&"string"!==i&&"number"!==i)return;"$"===e[0]?(n.context_prop_matches=n.context_prop_matches||[],n.context_prop_matches.push([e.substring(1),r?t:[t]])):(n.feature_prop_matches=n.feature_prop_matches||[],n.feature_prop_matches.push([e,r?t:[t]])),delete n.filter[e]}})}},{key:"doPropMatches",value:function(e){if(this.feature_prop_matches)for(var t=0;t<this.feature_prop_matches.length;t++){var i=this.feature_prop_matches[t],r=e.feature.properties[i[0]];if(null==r||-1===i[1].indexOf(r))return!1}if(this.context_prop_matches)for(var n=0;n<this.context_prop_matches.length;n++){var o=this.context_prop_matches[n],s=e[o[0]];if(null==s||-1===o[1].indexOf(s))return!1}return!0}},{key:"doesMatch",value:function(t){if(!this.enabled)return!1;if(this.is_built||this.build(),null!=this.zooms&&!this.zooms[t.zoom])return!1;if(!this.doPropMatches(t))return!1;var e;if(this.filter instanceof Function)try{e=this.filter(t)}catch(e){var i="Filter for this ".concat(this.full_name,": `filter: ").concat(this.filter_original,"` ");Jr("error",i+="failed with error '".concat(e.message,"', stack trace: ").concat(e.stack),t.feature)}else e=null==this.filter;return!!e&&(this.children_to_parse&&(function(e,t,i){for(var r in t){var n=t[r];if("object"!==vr(n)||Array.isArray(n)){var o="Layer value must be an object: cannot create layer '".concat(r,": ").concat(JSON.stringify(n),"'");o+=", under parent layer '".concat(e.full_name,"'."),i[e.name]&&(o+=" The parent name '".concat(e.name,"' is also the name of a style, did you mean to create a 'draw' group"),e.parent&&(o+=" under '".concat(e.parent.name,"'")),o+=" instead?"),Jr("warn",o)}else G_(r,n,e,i)}}(this,this.children_to_parse,this.styles),delete this.children_to_parse),!0)}}]),h}();I_.id=0;var C_,F_=function(){function i(e){var t;return mr(this,i),(t=Mr(this,wr(i).call(this,e))).is_leaf=!0,t}return br(i,I_),i}(),D_=function(){function i(e){var t;return mr(this,i),(t=Mr(this,wr(i).call(this,e))).is_tree=!0,t.layers=e.layers||[],t}return br(i,I_),yr(i,[{key:"addLayer",value:function(e){this.layers.push(e)}},{key:"buildDrawGroups",value:function(e){var t=[],i=[];if(function e(t,i,r,n){var o=!1;if(0===i.length)return;for(var s=0;s<i.length;s++){var a=i[s];a.is_leaf?a.doesMatch(t)&&(o=!0,r.push(a),n.push(a.id)):a.is_tree&&a.doesMatch(t)&&(o=!0,e(t,a.layers,r,n)||(r.push(a),n.push(a.id)))}return o}(e,[this],t,i),0<t.length){var r=function(e){if(1<e.length){for(var t=e[0],i=1;i<e.length;i++)t+="/"+e[i];return t}return e[0]}(i);if(void 0===N_[r]){for(var n=t.map(function(e){return e&&!1!==e.visible&&e.calculatedDraw}),o={},s=0;s<n.length;s++){var a=n[s];if(a)for(var l=0;l<a.length;l++){var u=a[l];for(var c in u)o[c]=!0}}for(var h in o)N_[r]=N_[r]||{},N_[r][h]=O_(n,h),N_[r][h]?(N_[r][h].key=r+"/"+h,N_[r][h].layers=t.map(function(e){return e&&e.full_name}),N_[r][h].group=h):delete N_[r][h];N_[r]&&0===Object.keys(N_[r]).length&&(N_[r]=null)}return N_[r]}}}]),i}(),U_={rangeTransform:function(e){return"string"==typeof e&&"px2"===e.trim().slice(-3)?"".concat(parseFloat(e)," * context.meters_per_pixel_sq"):e}};function j_(e){return-1<P_.indexOf(e)}function G_(e,t,i,r){var n={name:e,layer:t=null==t?{}:t,parent:i,styles:r},o=Sr(function(e){var t={},i={};for(var r in e)j_(r)?t[r]=e[r]:i[r]=e[r];return[t,i]}(t),2),s=o[0],a=o[1],l=function(e){return 0===Object.keys(e).length}(a),u=new(l&&null!=i?F_:D_)(Object.assign(n,s));return u.enabled&&(i&&i.addLayer(u),u.children_to_parse=l?null:a),u}var B_=/^global.(.+)$/,V_=C_={loadScene:function(e,t){var r=this,i=1<arguments.length&&void 0!==t?t:{},n=i.path,o=i.type,s=[];return this.loadSceneRecursive({url:e,path:n,type:o},null,s).then(function(e){return r.finalize(e)}).then(function(e){var t=e.config,i=e.bundle;return t?(0<s.length&&s.forEach(function(e){var t="Failed to import scene: ".concat(e.url);Jr("error",t,e),r.trigger("error",{type:"scene_import",message:t,error:e,url:e.url})}),{config:t,bundle:i}):Promise.reject(s[0])})},loadSceneRecursive:function(e,t,i){var r=this,n=e.url,o=e.path,s=(e.type,2<arguments.length&&void 0!==i?i:[]);if(!n)return Promise.resolve({});var a=function(e,t,i){return new g_(e,t,i)}(n,o,t);return a.load().then(function(i){if(null==i.import)return r.normalize(i,a),{config:i,bundle:a};Array.isArray(i.import)||(i.import=[i.import]);var t=[];return i.import.forEach(function(e){"object"===vr(e)&&(e=fn(new Blob([JSON.stringify(e)]))),t.push(a.resourceFor(e))}),delete i.import,Promise.all(t.map(function(e){return r.loadSceneRecursive(e,a,s)})).then(function(e){e.forEach(function(e){return r.normalize(e.config,e.bundle)});var t=e.map(function(e){return e.config});return i=hl.apply(void 0,zr(t).concat([i])),r.normalize(i,a),{config:i,bundle:a}})}).catch(function(e){return e.url=n,s.push(e),{}})},normalize:function(e,t){return this.normalizeDataSources(e,t),this.normalizeFonts(e,t),this.normalizeTextures(e,t),this.hoistTextures(e,t),{config:e,bundle:t}},normalizeDataSources:function(e,t){for(var i in e.sources=e.sources||{},e.sources)this.normalizeDataSource(e.sources[i],t);return e},normalizeDataSource:function(e,t){if(e.url&&(e.url=t.urlFor(e.url)),e.scripts)for(var i in Array.isArray(e.scripts)&&(e.scripts=e.scripts.reduce(function(e,t){return e[t]=t,e},{})),e.scripts)e.scripts[i]=t.urlFor(e.scripts[i]);return e},normalizeFonts:function(e,t){for(var i in e.fonts=e.fonts||{},e.fonts)if(Array.isArray(e.fonts[i]))e.fonts[i].forEach(function(e){e.url=e.url&&t.urlFor(e.url)});else{var r=e.fonts[i];r.url=r.url&&t.urlFor(r.url)}return e},normalizeTextures:function(e,t){if(e.textures=e.textures||{},e.textures)for(var i in e.textures){var r=e.textures[i];r.url&&(r.url=t.urlFor(r.url))}},hoistTextures:function(r,n){var o=this;if(r.styles){var e=function(e){var i=r.styles[e],t=i.texture;"string"!=typeof t||r.textures[t]||(i.texture=o.hoistTexture(t,r,n)),i.material&&["emission","ambient","diffuse","specular","normal"].forEach(function(e){var t=null!=i.material[e]&&i.material[e].texture;"string"!=typeof t||r.textures[t]||(i.material[e].texture=o.hoistTexture(t,r,n))})};for(var t in r.styles)e(t)}if(this.hoistStyleShaderUniformTextures(r,n,{include_globals:!1}),r.layers)for(var i=[r.layers];0<i.length;){var s=i.pop();if("object"===vr(s)&&!Array.isArray(s))for(var a in s)if("draw"===a){var l=s[a];for(var u in l){if(l[u].texture){var c=l[u].texture;"string"!=typeof c||r.textures[c]||(l[u].texture=this.hoistTexture(c,r,n))}if(l[u].outline&&l[u].outline.texture){var h=l[u].outline.texture;"string"!=typeof h||r.textures[h]||(l[u].outline.texture=this.hoistTexture(h,r,n))}}}else{if(j_(a))continue;i.push(s[a])}}},hoistStyleShaderUniformTextures:function(o,s,e){var a=this,l=e.include_globals;if(o.styles)for(var t in o.styles){var i=o.styles[t];i.shaders&&i.shaders.uniforms&&Gl.parseUniforms(i.shaders.uniforms).forEach(function(e){var t=e.type,i=e.value,r=e.key,n=e.uniforms;"sampler2D"!==t||"string"!=typeof i||o.textures[i]||!l&&y_(i)||(n[r]=a.hoistTexture(i,o,s))})}},hoistTexture:function(e,t,i){var r=y_(e),n=r?e:i.urlFor(e),o=r?"texture-".concat(n):n;return t.textures[o]={url:n},o},applyGlobalProperties:function(e){if(!e.global||0===Object.keys(e.global).length)return e;var s=function e(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:".";var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};r=r?r+i:"";for(var o in t){var s=r+o,a=t[o];"object"!==vr(n[s]=a)||Array.isArray(a)||e(a,i,s,n)}return n}(e.global);return function e(t){if("string"==typeof t){var i=function e(t,i,r){var n=2<arguments.length&&void 0!==r?r:[];if(!(-1<n.indexOf(t))){n.push(t);var o=B_.exec(t),s=o&&o[1];return s&&void 0!==i[s]?"string"==typeof i[s]&&B_.exec(i[s])?e(i[s],i,n):s:void 0}Jr({level:"warn",once:!0},"Global properties: cyclical reference detected",n)}(t,s),r=s[i];void 0!==r&&(t=r)}else if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n]=e(t[n],t,n);else if("object"===vr(t))for(var o in t)t[o]=e(t[o],t,o);return t}(e)},finalize:function(e){var t=e.config,i=e.bundle;return t?(t.global=t.global||{},t.scene=t.scene||{},t.cameras=t.cameras||{},t.lights=t.lights||{},t.styles=t.styles||{},t.layers=t.layers||{},t.camera&&(t.cameras.default=t.camera),0===Object.keys(t.cameras).length&&(t.cameras.default={}),0!==Object.keys(t.lights).length&&!Object.keys(t.lights).every(function(e){return!1===t.lights[e].visible})||(t.lights.default_light={type:"directional"}),{config:t,bundle:i}):{}}};Zo(C_);var q_,H_=function(){function e(){mr(this,e),this.coords={},this.max_proxy_descendant_depth=6,this.max_proxy_ancestor_depth=10}return yr(e,[{key:"sourceTiles",value:function(e,t){return this.coords[e.key]&&this.coords[e.key].sources&&this.coords[e.key].sources[t.name]}},{key:"addTile",value:function(e){var t=e.coords.key,i=this.coords[t];i||(i=this.coords[t]={descendants:0}),i.sources||(i.sources={}),i.sources[e.source.name]||(i.sources[e.source.name]={});for(var r=(i.sources[e.source.name][e.style_zoom]=e).coords.z-1;0<=r;r--){var n=ns.coordinateAtZoom(e.coords,r);this.coords[n.key]||(this.coords[n.key]={descendants:0}),this.coords[n.key].descendants++}}},{key:"removeTile",value:function(e){var t=this.sourceTiles(e.coords,e.source),i=e.coords.key;t&&(delete t[e.style_zoom],0===Object.keys(t).length&&(delete this.coords[i].sources[e.source.name],0===Object.keys(this.coords[i].sources).length&&(delete this.coords[i].sources,0===this.coords[i].descendants&&delete this.coords[i])));for(var r=e.coords.z-1;0<=r;r--){var n=ns.coordinateAtZoom(e.coords,r);this.coords[n.key]&&0<this.coords[n.key].descendants&&(this.coords[n.key].descendants--,0!==this.coords[n.key].descendants||this.coords[n.key].sources||delete this.coords[n.key])}}},{key:"getAncestor",value:function(e,t){var i=e.coords,r=e.style_zoom,n=e.source,o=1<arguments.length&&void 0!==t?t:1;if(!(o>this.max_proxy_ancestor_depth)){if(r>n.max_coord_zoom){var s=this.sourceTiles(i,n);if(s)for(var a=r-1;a>=n.max_coord_zoom;a--)if(s[a]&&s[a].loaded)return s[a];r=n.max_coord_zoom}r--;var l=ns.coordinateAtZoom(i,i.z-1),u=this.sourceTiles(l,n);return u&&u[r]&&u[r].loaded?u[r]:0<l.z?this.getAncestor({coords:l,style_zoom:r,source:n},o+1):void 0}}},{key:"getDescendants",value:function(e,t){var i=e.coords,r=e.style_zoom,n=e.source,o=1<arguments.length&&void 0!==t?t:1,s=[];if(r>=n.max_coord_zoom){var a=this.sourceTiles(i,n);if(a)for(var l=Math.max(Kr.default_view_max_zoom,r+this.max_proxy_descendant_depth),u=r+1;u<=l;u++)if(a[u]&&a[u].loaded)return s.push(a[u]),s;return s}if(this.coords[i.key]&&0<this.coords[i.key].descendants){r++;for(var c=ns.childrenForCoordinate(i),h=0;h<c.length;h++){var f=c[h],d=this.sourceTiles(f,n);d&&d[r]&&d[r].loaded?s.push(d[r]):o<=this.max_proxy_descendant_depth&&f.z<=n.max_coord_zoom&&s.push.apply(s,zr(this.getDescendants({coords:f,source:n,style_zoom:r},o+1)))}}return s}}]),e}(),Y_=function(){function o(e,t,i,r){mr(this,o),Object.assign(this,e),this.placed=null,this._tile=r;var n=Kr.unitsPerMeter(r.coords.z)*Math.pow(2,i-r.style_zoom);this.layout=Object.assign({},e.layout),this.layout.repeat_scale=.75,this.layout.repeat_distance=this.layout.repeat_distance||0,this.layout.repeat_distance/=n,this.position=Kr.tileSpaceToMeters(this.position,r.coords.z,r.min),this._worldToScreen=t,this._screenSpaceBoundingBox=void 0,this._boundingCircles=void 0}return yr(o,[{key:"getTile",value:function(){return this._tile}},{key:"isFlat",value:function(){return this.is_flat}},{key:"getScreenSpaceBoundingBox",value:function(){if(!this._screenSpaceBoundingBox){var e=this._worldToScreen(this.position,!0);e[0]+=this.offset[0],e[1]+=this.offset[1];var t=this.size[0]/2+this.layout.buffer[0],i=this.size[1]/2+this.layout.buffer[1],r=e[0]-t,n=e[0]+t,o=e[1]-i,s=e[1]+i;this._screenSpaceBoundingBox={left:r,bottom:s,right:n,top:o}}return this._screenSpaceBoundingBox}},{key:"getBoundingCircles",value:function(){return this._boundingCircles||(this._boundingCircles="point"===this.type?this._convertSidesToScreenSpaceCircles():this._convertCirclesToScreenSpace()),this._boundingCircles}},{key:"_convertSidesToScreenSpaceCircles",value:function(){var e=this._tile.coords.z,t=this._tile.min,i=Kr.tileSpaceToMeters([this.sides[0],this.sides[1]],e,t),r=Kr.tileSpaceToMeters([this.sides[2],this.sides[3]],e,t),n=Sr(this._worldToScreen(i,!0),2),o=n[0],s=n[1],a=Sr(this._worldToScreen(r,!0),2);return Uc(o,s,a[0],a[1],this.size[1]/2+this.layout.buffer[1])}},{key:"_convertCirclesToScreenSpace",value:function(){for(var e=[],t=this.circles,i=this._tile.coords.z,r=this._tile.min,n=0;n<t.length-2;n+=3){var o=Kr.tileSpaceToMeters([t[n],-t[n+1]],i,r),s=t[n+2]/Kr.unitsPerMeter(i),a=[o[0]+s,o[1]],l=this._worldToScreen(o,!0),u=this._worldToScreen(a,!0),c=vl.getLineLength(l[0],l[1],u[0],u[1]);e.push(l[0],l[1],c)}return e}}]),o}(),X_=0,W_={mainThreadLabelCollisionPass:function(t,u,e,c,i){J_=Z_,Z_={};var h={},f={},r=[],d=e.worldToScreen.bind(e);q_||(q_=Jo.getMaxTextureSize(i));for(var n in t.forEach(function(l){for(var e in l.meshes)l.meshes[e].forEach(function(e){if(e.labels)for(var t in e.labels)if(!h[t]){var i=e.labels[t],r=i.container,n=r.label,o=r.linked,s=i.ranges,a=h[t]=new Y_(n,d,u,l);f[t]={label:a,linked:o,ranges:s,mesh:e}}})}),f){var o=f[n];o.linked&&(o.linked=f[o.linked]),r.push(o)}var s=e.getViewport(),a=s.width,l=s.height;return Xo.startTile("main",{apply_repeat_groups:!0,return_hidden:!0,grid_index:new qo(a,l,30)}),Xo.addStyle("main","main"),Xo.collide(r,"main","main").then(function(e){var l=new $_;return e.forEach(function(e){var i=e.mesh,t=e.label.getTile();if(t.visible&&i.valid){var r=0;!0!==e.show||c&&e.label.breach&&!J_[e.label.id]||(r=1),r&&(Z_[e.label.id]=!0);var n=e.label.text_data;n&&l.insertLabel(n,t);var o=i.vertex_layout.offset.a_shape,s=i.vertex_layout.stride,a=!0;e.ranges.forEach(function(e){if(a){for(var t=0;t<e[1];t++){if(i.vertex_data[e[0]+t*s+o+6]===r)return void(a=!1);i.vertex_data[e[0]+t*s+o+6]=r}l.trackMesh(i)}})}}),l.createTextures(i,q_).then(function(){return l.updateMeshes(e)})}).then(function(e){e.forEach(function(e){return e.valid&&e.upload()}),t.forEach(function(e){e.labeled=!0}),r=[],f={},h={}})}},Z_={},J_={},K_=120===new Uint8Array(new Uint32Array([305419896]).buffer)[0];var $_=function(){function e(){mr(this,e),this.tiles={},this.meshes=[]}return yr(e,[{key:"insertLabel",value:function(e,t){var i=e.text_settings_key,r=e.text,n=e.text_info;this._ensureTextSection(t,i)[r]=n}},{key:"trackMesh",value:function(e){-1===this.meshes.indexOf(e)&&this.meshes.push(e)}},{key:"updateMeshes",value:function(e){var c=this;return e.forEach(function(e){if(e.label.text_data){var t=e.label.getTile(),i=e.mesh;if(t.visible&&i.valid){var r=e.label.type,n=e.label.text_data.text_info;if(c.tiles[t.id]&&c.tiles[t.id].textures){var o=c.tiles[t.id].textures[0];if(i.uniforms.u_texture=o,-1===i.textures.indexOf(o)&&i.textures.push(o),"point"===r||"straight"===r){var s="point"===r?n.align[e.label.align].texcoords:n.texcoords[r].texcoord;c.setTexCoords(i,e,s)}else if("curved"===r){var a=n.segments.length,l=n.texcoords_stroke,u=n.texcoords.curved;c.setTexCoords(i,e,function(e){return e<a?l[e]:u[e-a].texcoord})}}}}}),this.meshes}},{key:"setTexCoords",value:function(e,t,h){var f,d=h instanceof Function;if(!d){var i=Sr(h,4),r=i[0],n=i[1],o=i[2],s=i[3];f=[[r,n],[o,n],[o,s],[r,s]]}var _=e.vertex_layout.stride,p=new DataView(e.vertex_data.buffer),v=e.vertex_layout.offset.a_texcoord;t.ranges.forEach(function(e,t){if(d){var i=Sr(h(t),4),r=i[0],n=i[1],o=i[2],s=i[3];f=[[r,n],[o,n],[o,s],[r,s]]}for(var a=0;a<e[1];a++){var l=65535*f[a][0],u=65535*f[a][1],c=e[0]+a*_;p.setUint16(c+v,l,K_),p.setUint16(c+v+2,u,K_)}})}},{key:"createTextures",value:function(o,s){var a=this,e=Object.values(this.tiles).map(function(e){var i=e.id,t=e.key,r=e.texts,n=["labels",t,i,X_++].join("-");return a._createTexturesForTile(o,r,n,s,i).then(function(e){var t=e.textures;a.tiles[i].textures=t})});return Promise.all(e)}},{key:"_createTexturesForTile",value:function(e,t,i,r,n){var o=new Jc,s=o.setTextureTextPositions(t,Math.min(r,2048));return s?o.rasterize(t,s,n,i,e):Promise.resolve({textures:s})}},{key:"_ensureTile",value:function(e){var t=e.id,i=e.key;return this.tiles[t]||(this.tiles[t]={id:t,key:i,texts:{}}),this.tiles[t]}},{key:"_ensureTextSection",value:function(e,t){var i=this._ensureTile(e).texts;return i[t]||(i[t]={}),i[t]}}]),e}(),Q_=function(){function r(e){var t=e.scene,i=e.view;mr(this,r),this._scene=t,this._view=i,this._tiles={},this._old_tiles={},this._pyramid=new H_,this._visible_coords={},this._building_tiles=null,this._renderable_tiles=[],this._active_styles=[],this._tile_visibility_counters={},this._main_thread_target=["TileManager",this._scene.id].join("_"),Cr.addTarget(this._main_thread_target,this),this._updateVisibility=this._updateVisibility.bind(this),this._keepCoordinate=this._keepCoordinate.bind(this),this._is_labeled=!1}return yr(r,[{key:"destroy",value:function(){this.forEachTile(function(e){return e.destroy()}),this._tiles={},this.forEachOldTile(function(e){return e.destroy()}),this._old_tiles={},this._pyramid=null,this._visible_coords={},this._scene=null,this._view=null}},{key:"keepTile",value:function(e){this._tiles[e.key]=e,this._pyramid.addTile(e)}},{key:"hasTile",value:function(e){return void 0!==this._tiles[e]}},{key:"_forgetTile",value:function(e){if(this.hasTile(e)){var t=this._tiles[e];this._pyramid.removeTile(t),t.workerMessage("self.removeTile",t.id),t.visible&&t.loaded?this._old_tiles[e]=t:t.destroy(),delete this._tiles[e]}this._tileBuildStop(e)}},{key:"removeTile",value:function(e){this._forgetTile(e),this._scene.requestRedraw()}},{key:"forEachOldTile",value:function(e){for(var t in this._old_tiles)e(this._old_tiles[t])}},{key:"forEachTile",value:function(e){for(var t in this._tiles)e(this._tiles[t])}},{key:"removeTiles",value:function(e){var t=[];for(var i in this._tiles){e(this._tiles[i])&&t.push(i)}for(var r=0;r<t.length;r++){var n=t[r];this.removeTile(n)}}},{key:"updateTilesForView",value:function(){this._visible_coords={};for(var e=this._view.findVisibleTileCoordinates(),t=0;t<e.length;t++){var i=e[t];this._visible_coords[i.key]=i}this.updateTileStates()}},{key:"updateTileStates",value:function(){this._keepCoordinates(),this.forEachTile(this._updateVisibility),this.forEachOldTile(this._updateVisibility),this._updateProxyTiles(),this._view.pruneTilesForView(),this._updateRenderableTiles(),this._updateActiveStyles()}},{key:"_updateLabels",value:function(){var e=this._renderable_tiles.sort(ep);return W_.mainThreadLabelCollisionPass(e,function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2,r=Math.pow(10,i);return Math.round(Math.floor(e*t)/t*r)/r}(this._view.lookAtManipulator.getLookAtData().zoom,2),this._view.lookAtManipulator,this.isLoadingVisibleTiles(),this._scene.gl)}},{key:"_updateProxyTiles",value:function(){var n=this,o=this._view.lookAtManipulator.getZoomDirection();if(0!==o){var s=!1;this.forEachTile(function(e){if(e.setProxyFor(null),1===o){if(e.visible&&!e.built){var t=n._pyramid.getAncestor(e);t&&(t.setProxyFor(e),s=!0)}}else if(-1===o&&e.visible&&!e.built)for(var i=n._pyramid.getDescendants(e),r=0;r<i.length;r++)i[r].setProxyFor(e),s=!0}),s||this._view.lookAtManipulator.resetZoomDirection()}}},{key:"_updateVisibility",value:function(e){if(e.visible=!1,e.style_zoom===this._view.lookAtManipulator.getLookAtData().tile_level)if(this._visible_coords[e.coords.key])e.visible=!0;else for(var t in this._visible_coords)if(ns.isDescendant(e.coords,this._visible_coords[t])){e.visible=!0;break}}},{key:"getRenderableTiles",value:function(){return this._renderable_tiles}},{key:"_updateRenderableTiles",value:function(){for(var e in this._renderable_tiles=[],this._tiles){var t=this._tiles[e];t.visible&&t.loaded&&(this._renderable_tiles.push(t),(t=this._old_tiles[e])&&(t.destroy(),delete this._old_tiles[e]))}for(var i in this._old_tiles){var r=this._old_tiles[i];r.visible&&r.generation===this._scene.generation?this._renderable_tiles.push(r):(r.destroy(),delete this._old_tiles[i])}return this._renderable_tiles}},{key:"getWorkerForTile",value:function(e,t){return t.has_volatile_data?this._scene.getWorkers(Fl)[0]:t.tiled?this._scene.getWorkers(Cl)[Math.abs(e.x+e.y+e.z)%this._scene.num_workers]:this._scene.getWorkers(Cl)[t.id%this._scene.num_workers]}},{key:"getActiveStyles",value:function(){return this._active_styles}},{key:"_updateActiveStyles",value:function(){for(var e=this._renderable_tiles,t={},i=0;i<e.length;i++){var r=e[i];Object.keys(r.meshes).forEach(function(e){return t[e]=!0})}return this._active_styles=Object.keys(t),this._active_styles}},{key:"isLoadingVisibleTiles",value:function(){var t=this;return Object.keys(this._tiles).some(function(e){return t._tiles[e].visible&&!t._tiles[e].built})}},{key:"updateTilesVisibilityCounters",value:function(){var t=this;Object.keys(this._visible_coords).forEach(function(e){e in t._tile_visibility_counters||(t._tile_visibility_counters[e]=0)});var e=Object.keys(this._tile_visibility_counters),i=[];e.forEach(function(e){e in t._visible_coords?(t._tile_visibility_counters[e]++,30<=t._tile_visibility_counters[e]&&i.push(t._visible_coords[e])):(t._tile_visibility_counters[e]--,t._tile_visibility_counters[e]<=0&&delete t._tile_visibility_counters[e])}),i.length&&this.loadCoordinates(i)}},{key:"loadCoordinates",value:function(e){var l=this;e.sort(function(e,t){var i=l._view.lookAtManipulator.getLookAtData().position,r=Kr.metersPerTile(e.z)/2,n=Kr.metersForTile(e);n.x+=r,n.y-=r;var o=Kr.metersForTile(t);o.x+=r,o.y-=r;var s=Math.abs(i[0]-n.x)+Math.abs(i[1]-n.y),a=Math.abs(i[0]-o.x)+Math.abs(i[1]-o.y);return(e.center_dist=s)<(t.center_dist=a)?-1:a===s?0:1}),e.forEach(function(e){return l.loadCoordinate(e)})}},{key:"_keepCoordinates",value:function(){Object.keys(this._visible_coords).forEach(this._keepCoordinate)}},{key:"_keepCoordinate",value:function(e){var t=this._visible_coords[e];if(t.z===this._view.center_tile.z)for(var i in this._scene.sources){var r=this._scene.sources[i];if(r.builds_geometry_tiles&&r.includesTile(t,this._view.lookAtManipulator.getLookAtData().tile_level)){var n=ns.normalizedKey(t,r,this._view.lookAtManipulator.getLookAtData().tile_level);if(n&&!this.hasTile(n)){var o=new ns({source:r,coords:t,worker:this.getWorkerForTile(t,r),style_zoom:on.zoomToTileLevel(t.z),view:this._view});this.keepTile(o)}}}}},{key:"loadCoordinate",value:function(e){if(e.z===this._view.center_tile.z)for(var t in this._scene.sources){var i=this._scene.sources[t];if(i.builds_geometry_tiles&&i.includesTile(e,this._view.lookAtManipulator.getLookAtData().tile_level)){var r=ns.normalizedKey(e,i,this._view.lookAtManipulator.getLookAtData().tile_level);this.hasTile(r)&&this.buildTile(this._tiles[r])}}}},{key:"buildTile",value:function(e,t){this._building_tiles&&this._building_tiles[e.key]||e.built&&e.generation===this._scene.generation||(this._tileBuildStart(e.key),this._updateVisibility(e),e.build(this._scene.generation,t))}},{key:"buildTileStylesCompleted",value:function(e){var t=e.tile,i=e.progress;if(null==this._tiles[t.key])ns.abortBuild(t);else if(t.generation!==this._scene.generation)ns.abortBuild(t);else{if(t.id<this._tiles[t.key].id)return void ns.abortBuild(t);t=this._tiles[t.key].merge(t),i.done&&(t.built=!0),t.buildMeshes(this._scene.styles,i),this.updateTileStates(),this._scene.requestRedraw()}i.done&&this._tileBuildStop(t.key)}},{key:"buildTileError",value:function(e){this._forgetTile(e.key),ns.abortBuild(e)}},{key:"_tileBuildStart",value:function(e){this._is_labeled=!1,this._building_tiles=this._building_tiles||{},this._building_tiles[e]=!0}},{key:"_tileBuildStop",value:function(e){this._building_tiles&&(delete this._building_tiles[e],this.checkBuildQueue())}},{key:"isReady",value:function(){return this._is_labeled&&!this.isLoadingVisibleTiles()}},{key:"checkBuildQueue",value:function(){var e=this;this._building_tiles&&0!==Object.keys(this._building_tiles).length||(this._building_tiles=null,Jc.pruneTextCache(),this._updateLabels().then(function(){e._is_labeled=!Wo.queue.length,e._scene.immediateRedraw()}))}}]),r}();function ep(e,t){var i=e.coords,r=t.coords;return i.z-r.z||i.x-r.x||i.y-r.y}function tp(t){mr(this,tp),this.defaults={},this.defaults.culling=!0,this.defaults.culling_face=t.BACK,this.defaults.blending=!1,this.defaults.blending_src=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_dst=t.ONE_MINUS_SRC_ALPHA,this.defaults.blending_src_alpha=t.ONE,this.defaults.blending_dst_alpha=t.ONE_MINUS_SRC_ALPHA,this.defaults.depth_write=!0,this.defaults.depth_test=!0,t.depthFunc(t.LESS),this.culling=new ip({cull:this.defaults.culling,face:this.defaults.culling_face},function(e){e.cull?(t.enable(t.CULL_FACE),t.cullFace(e.face)):t.disable(t.CULL_FACE)}),this.blending=new ip({blend:this.defaults.blending,src:this.defaults.blending_src,dst:this.defaults.blending_dst,src_alpha:this.defaults.blending_src_alpha,dst_alpha:this.defaults.blending_dst_alpha},function(e){e.blend?(t.enable(t.BLEND),e.src_alpha&&e.dst_alpha?t.blendFuncSeparate(e.src,e.dst,e.src_alpha,e.dst_alpha):t.blendFunc(e.src,e.dst)):t.disable(t.BLEND)}),this.depth_write=new ip({depth_write:this.defaults.depth_write},function(e){t.depthMask(e.depth_write)}),this.depth_test=new ip({depth_test:this.defaults.depth_test},function(e){e.depth_test?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)})}var ip=function(){function i(e,t){mr(this,i),t(e),this.value=e,this.setup=t}return yr(i,[{key:"get",value:function(){return this.value}},{key:"set",value:function(e){JSON.stringify(this.value)!==JSON.stringify(e)&&(this.setup(e),this.value=e)}}]),i}(),rp=function(){function e(){mr(this,e),this.canvas=null,this.gl=null,this.screenshot_canvas=null,this.screenshot_context=null,this.queue_screenshot=null,this.video_capture=null}return yr(e,[{key:"setCanvas",value:function(e,t){this.canvas=e,this.gl=t}},{key:"screenshot",value:function(e){var i=this,t=(0<arguments.length&&void 0!==e?e:{}).background;return null!=this.queue_screenshot||(this.queue_screenshot={background:t},this.queue_screenshot.promise=new Promise(function(e,t){i.queue_screenshot.resolve=e,i.queue_screenshot.reject=t})),this.queue_screenshot.promise}},{key:"completeScreenshot",value:function(){if(null!=this.queue_screenshot){var e=this.canvas.width,t=this.canvas.height,i=new Uint8Array(e*t*4);this.gl.readPixels(0,0,e,t,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i);var r=this.queue_screenshot.background;r=r&&"transparent"!==r?Fo.parseColor(r).slice(0,3).map(function(e){return 255*e}):null;for(var n=new Uint8ClampedArray(e*t*4),o=0;o<t;o++)for(var s=0;s<e;s++){var a=4*((t-o-1)*e+s),l=4*(o*e+s),u=i[3+a];n[0+l]=255*i[0+a]/u,n[1+l]=255*i[1+a]/u,n[2+l]=255*i[2+a]/u,n[3+l]=u,r&&(u/=255,n[0+l]=n[0+l]*u+r[0]*(1-u),n[1+l]=n[1+l]*u+r[1]*(1-u),n[2+l]=n[2+l]*u+r[2]*(1-u),n[3+l]=255)}this.screenshot_canvas=this.screenshot_canvas||document.createElement("canvas");var c=this.screenshot_canvas;c.width=e,c.height=t,this.screenshot_context=this.screenshot_context||c.getContext("2d");var h=this.screenshot_context,f=new ImageData(n,e,t);h.putImageData(f,0,0);for(var d=c.toDataURL("image/png"),_=atob(d.slice(22)),p=new Uint8Array(_.length),v=0;v<_.length;++v)p[v]=_.charCodeAt(v);var m=new Blob([p],{type:"image/png"});this.queue_screenshot.resolve({url:d,blob:m,type:"png"}),this.queue_screenshot=null}}},{key:"startVideoCapture",value:function(){var r=this;if("function"!=typeof window.MediaRecorder||!this.canvas||"function"!=typeof this.canvas.captureStream)return Jr("warn","Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(this.video_capture)return Jr("warn","Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var n=this.video_capture={};n.chunks=[],n.stream=this.canvas.captureStream(),n.options={mimeType:"video/webm"},n.media_recorder=new MediaRecorder(n.stream,n.options),n.media_recorder.ondataavailable=function(e){if(0<e.data.size&&n.chunks.push(e.data),n.resolve){var t=new Blob(n.chunks,{type:n.options.mimeType}),i=fn(t);if(n.stream)(n.stream.getTracks()||[]).forEach(function(e){e.stop(),n.stream.removeTrack(e)});n.stream=null,n.media_recorder=null,r.video_capture=null,n.resolve({url:i,blob:t,type:"webm"})}},n.media_recorder.start()}catch(e){return this.video_capture=null,Jr("error","Scene video capture failed",e),!1}return!0}},{key:"stopVideoCapture",value:function(){var i=this;return this.video_capture?(this.video_capture.promise=new Promise(function(e,t){i.video_capture.resolve=e,i.video_capture.reject=t}),this.video_capture.media_recorder.stop(),this.video_capture.promise):(Jr("warn","No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))}}]),e}(),np=function(){function e(){mr(this,e),this.sources={},this.styles={},this.layers={},this.tiles={},this._isConfigured=!1}return yr(e,[{key:"init",value:function(e,t,i,r,n,o){return this.scene_id=e,this._worker_id=t,Jr.setLevel(i),on.device_pixel_ratio=r,pu.setElementIndexUint(n),Kl.setPrefix(this._worker_id),this._style_manager=new nf,this._importExternalScripts(o),Nc.id_prefix=t,this._isConfigured=!1,t}},{key:"dispose",value:function(){this._last_config_sources=null,this._config_sources=null,this.sources=null,this._style_manager=null,this.styles=null,this.layers=null,this.tiles=null}},{key:"_importExternalScripts",value:function(e){if(0!==e.length){Jr("debug","loading custom data source scripts in worker:",e);var t=Object.getOwnPropertyNames(window);importScripts.apply(void 0,zr(e)),Object.getOwnPropertyNames(window).forEach(function(e){-1===t.indexOf(e)&&(self[e]=window[e])})}}},{key:"updateConfig",value:function(e,t){var i=e.config,r=e.generation,n=e.introspection;for(var o in i=JSON.parse(i),function(e){Object.assign(Pl,e)}(t),this._generation=r,this._isConfigured=!1,i.layers)i.layers[o]&&(i.layers[o].data=on.stringsToFunctions(i.layers[o].data));this.global=on.stringsToFunctions(i.global),this._createDataSources(i),i.styles=on.stringsToFunctions(i.styles,Fo.wrapFunction),this.styles=this._style_manager.build(i.styles),self.is_fake_worker=Ir.is_main,this._style_manager.initStyles({generation:this._generation,styles:this.styles,sources:this.sources,introspection:n,id:this.scene_id}),delete self.is_fake_worker,this.layers=function(e,t){N_={};var i={};for(var r in e){var n=e[r];n&&(i[r]=G_(r,n,null,t))}return i}(i.layers,this._style_manager.styles),this._configuring=this._syncTextures(i.textures)}},{key:"_createDataSources",value:function(t){var i=this;this._last_config_sources=this._config_sources||{},this._config_sources=t.sources;var e=this.sources,r=[];for(var n in t.sources=on.stringsToFunctions(t.sources),this.sources={},self.is_fake_worker=Ir.is_main,t.sources)if(JSON.stringify(this._last_config_sources[n])!==JSON.stringify(t.sources[n])){var o=void 0;try{o=_n.create(Object.assign({},t.sources[n],{name:n}),this.sources)}catch(e){Jr("error","Error creating source.",e.message,t.sources[n]);continue}o&&(this.sources[n]=o,r.push(n))}else this.sources[n]=e[n];delete self.is_fake_worker,r.forEach(function(e){for(var t in i.tiles)i.tiles[t].source===e&&delete i.tiles[t]})}},{key:"awaitConfiguration",value:function(){return this._configuring}},{key:"_onConfig",value:function(t){var i=this;if((this._isConfigured=!0)!==t.loaded)t.loading=!0,t.loaded=!1,t.error=null,this._loadTileSourceData(t).then(function(){if(i.getTile(t.id)){t.loading=!1,t.loaded=!0;try{ns.buildGeometry(t,i)}catch(e){t.error=e.toString(),Cr.postMessage("TileManager_".concat(i.scene_id,".buildTileError"),ns.slice(t))}}else Jr("trace","stop tile build after data source load because tile was removed. Key: ".concat(t.key,", id: ").concat(t.id))},function(e){t.loading=!1,t.loaded=!1,t.error=e.stack,Jr("error","tile load error for tile with key ".concat(t.key," and id ").concat(t.id,": ").concat(t.error)),Cr.postMessage("TileManager_".concat(i.scene_id,".buildTileError"),ns.slice(t))});else{Jr("trace","used worker cache for tile with key ".concat(t.key," and id ").concat(t.id));try{ns.buildGeometry(t,this)}catch(e){t.error=e.toString(),Cr.postMessage("TileManager_".concat(this.scene_id,".buildTileError"),ns.slice(t))}}}},{key:"buildTile",value:function(e){var t=e.tile,i=this.getTile(t.id);if(!i||!i.loading)if(t=this.tiles[t.id]=Object.assign(i||{},t),this._isConfigured)this._onConfig(t);else{var r=this;this.awaitConfiguration().then(function(){return r._onConfig(t)})}}},{key:"_loadTileSourceData",value:function(e){return this.sources[e.source]?this.sources[e.source].load(e):(e.source_data={},Promise.resolve(e))}},{key:"getTile",value:function(e){return this.tiles[e]}},{key:"removeTile",value:function(e){var t=this.tiles[e];null!=t&&(!0===t.loading&&(Jr("trace","cancel tile load for tile id ".concat(e)),t.loading=!1,ns.cancel(t)),delete this.tiles[e],Jr("trace","remove tile from cache, tile id: ".concat(e)))}},{key:"queryFeatures",value:function(e){var o=this,s=e.filter,a=e.visible,l=e.geometry,t=e.tile_ids,u=[],i=t.map(function(e){return o.tiles[e]}).filter(function(e){return e});return null!=s&&(s=-1<["{","["].indexOf(s[0])?JSON.parse(s):s,s=on.stringsToFunctions(s,Fo.wrapFunction)),s=z_(s,U_),i.forEach(function(n){function e(r){n.source_data.layers[r].features.forEach(function(e){if(!(!0===a&&e.generation!==o._generation||!1===a&&e.generation===o._generation)){var t=Fo.getFeatureParseContext(e,n,o.global);if(t.source=n.source,t.layer=r,s(t)){var i={type:e.type,properties:e.properties};!0===l&&(i.geometry=Kr.copyGeometry(e.geometry),Kr.tileSpaceToLatlng(i.geometry,n.coords.z,n.min)),u.push(i)}}})}for(var t in n.source_data.layers)e(t)}),u}},{key:"resetFeatureSelection",value:function(){Kl.reset()}},{key:"_syncTextures",value:function(e){var t=[];return e&&t.push.apply(t,zr(Object.keys(e))),Jr("trace","sync textures to worker:",t),0<t.length?Jo.syncTexturesToWorker(t):Promise.resolve()}},{key:"profile",value:function(e){console.profile("worker ".concat(this._worker_id,": ").concat(e))}},{key:"profileEnd",value:function(e){console.profileEnd("worker ".concat(this._worker_id,": ").concat(e))}},{key:"terminate",value:function(){this.dispose()}}]),e}();(Ir.is_worker||self.H&&self.H.DEBUG)&&Cr.addTarget("self",new np);var op=function(){function l(e,t){mr(this,l),t=t||{},Zo(this),this.id=l.id++,this.initialized=!1,this.initializing=null,this.sources={},this.view=new Fh(this,t),this.tile_manager=new Q_({scene:this,view:this.view}),this.num_workers=t.numWorkers||2,!0===t.disableVertexArrayObjects&&(Jl.disabled=!0),on.device_pixel_ratio=t.devicePixelRatio,this.config=null,this.config_source=e,this.config_bundle=null,this.last_valid_config_source=null,this.styles=null,this.style_manager=new nf,this.building=null,this.dirty=!0,t.preUpdate&&this.subscribe({pre_update:t.preUpdate}),t.postUpdate&&this.subscribe({post_update:t.postUpdate}),this.render_loop=!t.disableRenderLoop,this.render_loop_active=!1,this.render_loop_stop=!1,this.render_count=0,this.last_render_count=0,this.render_count_changed=!1,this.frame=0,this.last_main_render=-1,this.last_selection_render=-1,this.media_capture=new rp,this.selection=null,this.introspection=!0===t.introspection,this.resetTime(),this.viewport=t.viewport,this.container=t.container,this.canvas=null,this.contextOptions=t.webGLContextOptions,this.lights=null,this.background=null,this.createListeners(),this.updating=0,this.generation=l.generation,this.last_complete_generation=l.generation,this.log_level=t.logLevel||"warn",Jr.setLevel(this.log_level),Jr.reset()}return yr(l,[{key:"load",value:function(e,t){var r=this,i=0<arguments.length&&void 0!==e?e:null,n=1<arguments.length&&void 0!==t?t:{};return this.initializing||(Jr.reset(),this.updating++,this.initialized=!1,this.initial_build_time=null,(n="string"==typeof n?{base_path:n}:n).blocking=void 0===n.blocking||n.blocking,!1!==this.render_loop&&this.setupRenderLoop(),this.createCanvas(),Jo.destroy(this.gl),this.initializing=this.loadScene(i,n).then(function(){return r.createWorkers()}).then(function(){r.resetFeatureSelection();var e="object"===vr(r.config_source)||r.hasSubscribersFor("load"),t=r.updateConfig({serialize_funcs:e,normalize:!1,load_event:!0,fade_in:!0});if(!0===n.blocking)return t}).then(function(){r.updating--,r.initializing=null,r.initialized=!0,r.last_valid_config_source=r.config_source,r.last_valid_options={base_path:n.base_path,file_type:n.file_type},r.requestRedraw()}).catch(function(e){var t,i;if(r.initializing=null,r.updating=0,i="YAMLException"===e.name?(t="yaml","Error parsing scene YAML"):"Error initializing scene",r.trigger("error",{type:t,message:i,error:e,url:r.config_source}),i="Scene.load() failed to load ".concat(r.config_source,": ").concat(e.message),r.last_valid_config_source)return Jr("warn",i,e),Jr("info","Scene.load() reverting to last valid configuration"),r.load(r.last_valid_config_source,r.last_valid_base_path);throw Jr("error",i,e),e})),this.initializing}},{key:"destroy",value:function(){if(this.initialized=!1,this.render_loop_stop=!0,this.destroyListeners(),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.container=null,this.selection&&this.selection.destroy(),this.gl){Jo.destroy(this.gl),this.style_manager.destroy(this.gl),this.styles={},Zl.reset();var e=this.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.gl=null}this.sources={},this.tile_manager.destroy(),this.tile_manager=null,this.destroyWorkers(),Jr.reset()}},{key:"createCanvas",value:function(){if(!this.canvas){this.container=this.container||document.body,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.container.style.backgroundColor="transparent",this.container.appendChild(this.canvas);try{this.gl=Ul.getContext(this.canvas,Object.assign({alpha:!0,premultipliedAlpha:!1,stencil:!0,device_pixel_ratio:on.device_pixel_ratio},this.contextOptions))}catch(e){throw new Error("Couldn't create WebGL context. Your browser may not support WebGL, or it's turned off? Visit http://webglreport.com/ for more info.")}this.handleViewportUpdate(),Jl.init(this.gl),this.render_states=new tp(this.gl),this.media_capture.setCanvas(this.canvas,this.gl)}}},{key:"getWorkerUrl",value:function(){var e;if(void 0!==ap){var t="("+ap+")()";if(up&&""!==lp)t+="\n//# sourceMappingURL="+up.slice(0,up.lastIndexOf("/")+1)+lp;e=fn(new Blob([t],{type:"application/javascript"}))}if(!e)throw new Error("Couldn't find internal Tangram source variable (may indicate the library did not build correctly)");return e}},{key:"updateExternalScripts",value:function(){var i=zr(this.external_scripts||[]),e=[];if(this.config.scene.scripts)for(var t in this.config.scene.scripts)-1===e.indexOf(this.config.scene.scripts[t])&&e.push(this.config.scene.scripts[t]);for(var r in this.config.sources){var n=this.config.sources[r];if(n.scripts)for(var o in n.scripts)-1===e.indexOf(n.scripts[o])&&e.push(n.scripts[o])}return this.external_scripts=e,!(this.external_scripts.length===i.length&&this.external_scripts.every(function(e,t){return e===i[t]}))}},{key:"createWorkers",value:function(){return this.updateExternalScripts()&&this.destroyWorkers(),this._workers?Promise.resolve():this.makeWorkers(this.getWorkerUrl())}},{key:"makeWorkers",value:function(i){var r=this,n=!!this.gl.getExtension("OES_element_index_uint"),o=[];this._workers=[];for(var s=0,e=function(){var e=new Worker(i);r._workers[s]=e,Cr.addWorker(e),Jr("debug","Scene.makeWorkers: initializing worker ".concat(s));var t=s;o.push(Cr.postMessage(e,"self.init",r.id,s,r.log_level,on.device_pixel_ratio,n,r.external_scripts).then(function(e){return Jr("debug","Scene.makeWorkers: initialized worker ".concat(e)),e},function(e){return Jr("error","Scene.makeWorkers: failed to initialize worker ".concat(t,":"),e),Promise.reject(e)}))};s<this.num_workers;s++)e();var t=new np;return this._workers.push(t),o.push(t.init(this.id,s,this.log_level,on.device_pixel_ratio,n,[])),this.next_worker=0,Promise.all(o).then(function(){Jr.setWorkers(r._workers.slice(0,r.num_workers)),function(e){void 0===an&&"function"!=typeof(an=window.URL&&window.URL.revokeObjectURL||window.webkitURL&&window.webkitURL.revokeObjectURL)&&(an=null,Jr("warn","window.URL.revokeObjectURL (or vendor prefix) not found, unable to create local blob URLs")),an&&an(e)}(i)})}},{key:"getWorkers",value:function(t){return this._workers.filter(function(e){switch(t){case Cl:return e instanceof Worker;case Fl:return e instanceof np;default:return!0}})}},{key:"destroyWorkers",value:function(){this.selection=null,Array.isArray(this._workers)&&(Jr.setWorkers(null),this._workers.forEach(function(e){e.terminate()}),this._workers=null)}},{key:"ready",value:function(){return!(!this.view.ready()||0===Object.keys(this.sources).length)}},{key:"handleViewportUpdate",value:function(){var e=this.viewport,t=e.width,i=e.height;0<t&&0<i&&(this.dirty=!0,this.view.handleViewportUpdate(),this.gl&&Ul.resize(this.gl,t,i,on.device_pixel_ratio))}},{key:"requestRedraw",value:function(){this.dirty=!0}},{key:"immediateRedraw",value:function(){this.dirty=!0,this.update()}},{key:"renderLoop",value:function(){this.render_loop_active=!0,this.initialized&&this.update(),Wo.setState({user_moving_view:this.view.user_input_active}),Wo.processAll(),this.render_loop_stop?(this.render_loop_stop=!1,this.render_loop_active=!1):window.requestAnimationFrame(this.renderLoop.bind(this))}},{key:"setupRenderLoop",value:function(){var e=this;this.render_loop_active||setTimeout(function(){e.renderLoop()},0)}},{key:"update",value:function(){var e=this.dirty,t=!!this.selection&&this.selection.hasPendingRequests(),i=!(!1===e&&!1===t||!1===this.initialized||0<this.updating||!1===this.ready());return this.trigger("pre_update",i),this.view.update(),i&&(this.dirty=!1,this.render({main:e,selection:t}),this.updateViewComplete(),this.media_capture.completeScreenshot(),this.trigger("post_update",i),!0!==this.animated&&!this.view.isAnimating()||(this.dirty=!0),this.frame++,Jr("trace","Scene.render()"),!0)}},{key:"render",value:function(e){var t=this,i=e.main,r=e.selection,n=this.gl;if(Object.keys(this.lights).forEach(function(e){return t.lights[e].update()}),i&&(this.render_count=this.renderPass(),this.last_main_render=this.frame),r){if(this.view.panning||this.view.user_input_active)return void this.selection.clearPendingRequests();(this.last_selection_render<this.last_main_render||this.selection.has_dirty_buffer)&&(this.selection.bind(),this.renderPass("selection_program",{allow_blend:!1}),n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,this.canvas.width,this.canvas.height),n.clearColor.apply(n,zr(this.background.color)),this.last_selection_render=this.frame,this.selection.has_dirty_buffer=!1),this.selection.read(this.tile_manager.getRenderableTiles()),this.selection.has_dirty_buffer&&this.render({main:!1,selection:r})}return this.render_count_changed=!1,this.render_count!==this.last_render_count&&(this.render_count_changed=!0),this.last_render_count=this.render_count,!0}},{key:"renderPass",value:function(e,t){var i=this,r=0<arguments.length&&void 0!==e?e:"program",n=(1<arguments.length&&void 0!==t?t:{}).allow_blend,o=this.gl;n=null==n||n,this.clearFrame();for(var s,a,l=this.tile_manager.getActiveStyles().map(function(e){return i.styles[e]}).filter(function(e){return e}).sort(cu.blendOrderSort),u=0,c=0,h=0;h<l.length;h++){var f=l[h];if(c-(a=parseInt(f.name))&&(this.render_states.depth_write.value.depth_write?o.clear(o.DEPTH_BUFFER_BIT):(o.depthMask(!0),o.clear(o.DEPTH_BUFFER_BIT),o.depthMask(!1)),c=a),f.blend!==s){var d=Object.assign({},cu.render_states[f.blend],{blend:n&&f.blend});this.setRenderState(d)}var _="translucent"===f.blend&&"program"===r;_&&(this.gl.colorMask(!1,!1,!1,!1),this.renderStyle(f.name,r),this.gl.colorMask(!0,!0,!0,!0),this.gl.depthFunc(this.gl.EQUAL),this.gl.enable(this.gl.STENCIL_TEST),this.gl.clear(this.gl.STENCIL_BUFFER_BIT),this.gl.stencilFunc(this.gl.EQUAL,this.gl.ZERO,255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.INCR)),u+=this.renderStyle(f.name,r),_&&(this.gl.disable(this.gl.STENCIL_TEST),this.gl.depthFunc(this.gl.LESS)),s=f.blend}return u}},{key:"renderStyle",value:function(n,o){for(var s,a=this,l=this.styles[n],u=!0,c=0,h=this.tile_manager.getRenderableTiles(),e=Math.max.apply(Math,zr(h.map(function(e){return e.meshes[n]?Math.max.apply(Math,zr(e.meshes[n].map(function(e){return e.variant.order}))):-1}))),t=function(t){for(var e=0;e<h.length;e++){var i=h[e];if(null!=i.meshes[n]&&i.shouldProxyForStyle(n)){var r=i.meshes[n].filter(function(e){return e.variant.order===t})[0];if(r){if(!0===u&&(u=!1,!(s=a.setupStyle(l,o))))return{v:0};a.view.setupTile(i,s),a.selection.setupDiscards(s),l.render(r)&&a.requestRedraw(),c+=r.geometry_count}}}},i=0;i<e+1;i++){var r=t(i);if("object"===vr(r))return r.v}return c}},{key:"setupStyle",value:function(t,e){var i;try{if(!(i=t.getProgram(e)))return}catch(e){return void this.trigger("warning",{type:"styles",message:"Error compiling style ".concat(t.name),style:t,shader_errors:t.program&&t.program.shader_errors})}for(var r in i.use(),t.setup(),i.uniform("1f","u_time",this.animated?(+new Date-this.start_time)/1e3:0),this.view.setupProgram(i),this.lights)this.lights[r].setupProgram(i);return i}},{key:"clearFrame",value:function(){this.initialized&&(this.render_states.depth_write.set({depth_write:!0}),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))}},{key:"setRenderState",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},i=t.depth_test,r=t.depth_write,n=t.cull_face,o=t.blend;if(this.initialized){var s=this.render_states;i=!1!==i&&s.defaults.depth_test,r=!1!==r&&s.defaults.depth_write,n=!1!==n&&s.defaults.culling,o=null!=o?o:s.defaults.blending;var a=this.gl;s.depth_test.set({depth_test:i}),s.depth_write.set({depth_write:r}),s.culling.set({cull:n,face:s.defaults.culling_face}),o?"opaque"===o?s.blending.set({blend:!1}):"overlay"===o||"inlay"===o||"translucent"===o?s.blending.set({blend:!0,src:a.SRC_ALPHA,dst:a.ONE_MINUS_SRC_ALPHA,src_alpha:a.ONE,dst_alpha:a.ONE_MINUS_SRC_ALPHA}):"add"===o?s.blending.set({blend:!0,src:a.ONE,dst:a.ONE}):"multiply"===o&&s.blending.set({blend:!0,src:a.ZERO,dst:a.SRC_COLOR}):s.blending.set({blend:!1})}}},{key:"getFeatureAt",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:{},r=i.radius,n=i.top_most_only;if(!this.initialized)return Jr("debug","Scene.getFeatureAt() called before scene was initialized"),Promise.resolve();var o={x:e.x/this.view.size.css.width,y:e.y/this.view.size.css.height};return r=0<r?{x:r/this.view.size.css.width,y:r/this.view.size.css.height}:null,this.selection.getFeatureAt(o,{radius:r,top_most_only:n}).catch(function(e){return Promise.resolve({error:e})})}},{key:"queryFeatures",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},i=t.filter,r=t.unique,l=void 0===r||r,n=t.group_by,u=void 0===n?null:n,o=t.visible,s=void 0===o?null:o,a=t.geometry,c=void 0!==a&&a;i=on.serializeWithFunctions(i);var h=this.tile_manager.getRenderableTiles().map(function(e){return e.id});return Cr.postMessage(this._workers,"self.queryFeatures",{filter:i,visible:s,geometry:c,tile_ids:h}).then(function(e){var r=[],n={},o={},s=(l="string"==typeof l?[l]:l)&&function(e){return JSON.stringify(Array.isArray(l)?Dl(e,l):e)},a=(u=("string"==typeof u||Array.isArray(u))&&u)&&function(e){return Array.isArray(u)?JSON.stringify(Dl(e,u)):e[u]};return e.forEach(function(e){return e.forEach(function(e){if(s){var t=s(e);if(n[t])return;n[t]=!0}if(a){var i=a(e.properties);o[i]=o[i]||[],o[i].push(e)}else r.push(e)})}),a?o:r})}},{key:"loadScene",value:function(e,t){var r=this,i=0<arguments.length&&void 0!==e?e:null,n=1<arguments.length&&void 0!==t?t:{},o=n.base_path,s=n.file_type;return this.config_source=i||this.config_source,"string"==typeof this.config_source?this.base_path=cn(o||this.config_source):this.base_path=cn(o),this.config_path=this.base_path,V_.loadScene(this.config_source,{path:this.base_path,type:s}).then(function(e){var t=e.config,i=e.bundle;return r.config=t,r.config_bundle=i,r.config})}},{key:"createDataSources",value:function(){var t=this,i=[],e=Object.keys(this.sources),r=0;for(var n in this.config.sources){var o=this.config.sources[n],s=this.sources[n];try{var a=Object.assign({},o,{name:n,id:r++});if(this.sources[n]=_n.create(a,this.sources),!this.sources[n])throw{}}catch(e){delete this.sources[n];var l="Could not create data source: ".concat(e.message);Jr("warn","Scene: ".concat(l),o),this.trigger("warning",{type:"sources",source:o,message:l})}_n.changed(this.sources[n],s)&&i.push(n)}for(var u in e.forEach(function(e){t.config.sources[e]||(delete t.sources[e],i.push(e))}),0<i.length&&this.tile_manager.removeTiles(function(e){return-1<i.indexOf(e.source.name)}),this.config.layers){var c=this.config.layers[u];!1!==c.enabled&&c.data&&this.sources[c.data.source]&&(this.sources[c.data.source].builds_geometry_tiles=!0)}}},{key:"loadTextures",value:function(){var e=this;return Jo.createFromObject(this.gl,this.config.textures).then(function(){return Jo.createDefault(e.gl)})}},{key:"updateStyles",value:function(){if(!this.initialized&&!this.initializing)throw new Error("Scene.updateStyles() called before scene was initialized");for(var e in this.styles=this.style_manager.build(this.config.styles),this.style_manager.initStyles(this),this.styles)this.styles[e].setGL(this.gl);this.dirty=!0}},{key:"createLights",value:function(){for(var e in this.lights={},this.config.lights)if(this.config.lights[e]&&"object"===vr(this.config.lights[e])){var t=this.config.lights[e];t.name=e.replace("-","_"),t.visible=!1!==t.visible,t.visible&&(this.lights[t.name]=ru.create(this.view,t))}ru.inject(this.lights)}},{key:"setBackground",value:function(){var e,t=this.config.scene.background;this.background={},t&&t.color&&(this.background.color=Fo.parseColor(t.color)),this.background.color||(this.background.color=[0,0,0,0]),1===this.background.color[3]?this.canvas.style.backgroundColor="rgba(".concat(this.background.color.map(function(e){return Math.floor(255*e)}).join(", "),")"):this.canvas.style.backgroundColor="transparent",(e=this.gl).clearColor.apply(e,zr(this.background.color))}},{key:"setIntrospection",value:function(e){var t=this;return e!==this.introspection?(this.introspection=e||!1,this.updating++,this.updateConfig({normalize:!1}).then(function(){return t.updating--})):Promise.resolve()}},{key:"updateConfig",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},i=t.load_event,r=void 0!==i&&i,n=t.serialize_funcs,o=t.normalize,s=void 0===o||o;t.fade_in;this.generation=++l.generation,this.updating++,this.config=V_.applyGlobalProperties(this.config),s?V_.normalize(this.config,this.config_bundle):(V_.hoistStyleShaderUniformTextures(this.config,this.config_bundle,{include_globals:!0}),V_.normalizeTextures(this.config,this.config_bundle)),this.trigger(r?"load":"update",{config:this.config}),this.style_manager.init(),this.createLights(),this.createDataSources(),this.loadTextures(),this.setBackground(),Zc.loadFonts(this.config.fonts),this.updateStyles();var a=this.syncConfigToWorker({serialize_funcs:n});return this.updating--,this.view.updateBounds(),this.requestRedraw(),a}},{key:"syncConfigToWorker",value:function(e){var t=(0<arguments.length&&void 0!==e?e:{}).serialize_funcs,i=void 0===t||t?on.serializeWithFunctions(this.config):JSON.stringify(this.config);return Cr.postMessage(this._workers,"self.updateConfig",{config:i,generation:this.generation,introspection:this.introspection},Ll)}},{key:"createListeners",value:function(){var t=this;this.listeners={},this.listeners.view={move:function(){return t.trigger("move")}},this.view.subscribe(this.listeners.view),this.listeners.texture={update:function(){return t.dirty=!0},warning:function(e){return t.trigger("warning",Object.assign({type:"textures"},e))}},Jo.subscribe(this.listeners.texture),this.listeners.scene_loader={error:function(e){return t.trigger("error",Object.assign({type:"scene"},e))}},V_.subscribe(this.listeners.scene_loader)}},{key:"destroyListeners",value:function(){this.unsubscribeAll(),this.view.unsubscribe(this.listeners.view),Jo.unsubscribe(this.listeners.texture),V_.unsubscribe(this.listeners.scene_loader),this.listeners=null}},{key:"resetFeatureSelection",value:function(){this.selection?this._workers&&Cr.postMessage(this._workers,"self.resetFeatureSelection"):this.selection=new Kl(this.gl,this._workers)}},{key:"resetTime",value:function(){this.start_time=+new Date}},{key:"updateViewComplete",value:function(){(this.render_count_changed||this.generation!==this.last_complete_generation)&&this.tile_manager.isReady()&&(this.last_complete_generation=this.generation,this.trigger("view_complete"))}},{key:"resetViewComplete",value:function(){this.last_complete_generation=null}},{key:"screenshot",value:function(e){var t=(0<arguments.length&&void 0!==e?e:{}).background,i=void 0===t?"white":t;return this.requestRedraw(),this.media_capture.screenshot({background:i})}},{key:"pixelRatio",value:function(){return on.device_pixel_ratio}},{key:"startVideoCapture",value:function(){return this.requestRedraw(),this.media_capture.startVideoCapture()}},{key:"stopVideoCapture",value:function(){return this.media_capture.stopVideoCapture()}},{key:"_profile",value:function(e){console.profile("main thread: ".concat(e)),Cr.postMessage(this._workers,"self.profile",e)}},{key:"_profileEnd",value:function(e){console.profileEnd("main thread: ".concat(e)),Cr.postMessage(this._workers,"self.profileEnd",e)}},{key:"animated",get:function(){var t=this;return void 0!==this.config.scene.animated?this.config.scene.animated:this.tile_manager.getActiveStyles().some(function(e){return t.styles[e]&&t.styles[e].animated})}}],[{key:"create",value:function(e,t){return new l(e,1<arguments.length&&void 0!==t?t:{})}}]),l}();op.id=0,op.generation=0;var sp=function(){function a(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};mr(this,a);var r,n=Math.pow(2,i.coords.z),o=Math.abs(Math.floor(i.coords.x/n));r=Math.abs(n*o-Math.abs(i.coords.x));var s=i.coords;return i.coords={x:r,y:s.y,z:s.z},Mr(this,wr(a).call(this,e,t,i))}return br(a,Jo),yr(a,[{key:"load",value:function(r){var n=this;if(!r||!r.uid)return Rr(wr(a.prototype),"load",this).call(this,r);var o=r.coords,s=new Uint8Array([0,0,0,0]);return this.loading=new Promise(function(e,t){var i=H.map.DataModel.invoke(r.uid,"requestTileAsPromise",[o.x,o.y,o.z])||null;i?i.then(function(e){var t=e.data;n.loaded=!0,!t||t instanceof ArrayBuffer?n.setData(1,1,s,{filtering:"nearest"}):"IMG"===t.tagName.toUpperCase()||"CANVAS"===t.tagName.toUpperCase()?n.setElement(t,r):n.setData(1,1,s,{filtering:"nearest"})},function(){n.loaded=!1}).then(e,function(e){return t(e)}):t(new Error("Unable to invoke on target "+r.uid))}),this.loading}}]),a}();Jo.register(sp,function(e){return e&&e.uid}),self.H=self.H||{},self.H.gl={DataSource:_n,Geo:Kr,MathUtils:vl,Scene:op,Task:Wo,Tile:ns,WorkerBroker:Cr,log:Jr,SceneLoader:V_,yaml:m_}}()};e()}();
